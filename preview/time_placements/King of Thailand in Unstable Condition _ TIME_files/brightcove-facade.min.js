!function(e,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?exports.BrightcoveFacade=i():e.BrightcoveFacade=i()}(this,function(){return function(e){function i(n){if(t[n])return t[n].exports;var a=t[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,i),a.loaded=!0,a.exports}var t={};return i.m=e,i.c=t,i.p="",i(0)}([function(e,i,t){"use strict";var n=t(1);e.exports=n},function(e,i,t){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e){if(Array.isArray(e)){for(var i=0,t=Array(e.length);i<e.length;i++)t[i]=e[i];return t}return Array.from(e)}function o(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},s=function(){function e(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(i,t,n){return t&&e(i.prototype,t),n&&e(i,n),i}}(),l=t(2),r=n(l),d=t(3),c=n(d),y=function(){function e(i){var t=arguments.length<=1||void 0===arguments[1]?.5:arguments[1],n=!(arguments.length<=2||void 0===arguments[2])&&arguments[2];return o(this,e),"undefined"==typeof window||"undefined"==typeof videojs?null:(this.debug=n,this.featuredVideoQuery=i,this.viewThreshold=1>=t&&0>t?t:.5,this.init(),this)}return s(e,[{key:"init",value:function(){this.videoState={},this.initializeFeatured(),this.saveVideoState(),this.bindListeners(),this.handleOnScroll()}},{key:"isIOSDevice",value:function(){return"undefined"!=typeof navigator&&/(iPhone|iPod)/g.test(navigator.userAgent)}},{key:"reflow",value:function(){var e=this,i=[];this.getAllPlayers().forEach(function(t){"undefined"!==t.id&&null!==t.id&&(i.push(t.id),e.initializePlayer(t.id))});var t=videojs.getPlayers();Object.keys(t).forEach(function(e){-1===i.indexOf(e)&&null!==t[e]&&videojs(e).dispose()}),this.init()}},{key:"initializePlayer",value:function(e){var i=!(arguments.length<=1||void 0===arguments[1])&&arguments[1],t=document.getElementById(e);if("DIV"===t.tagName)return!1;var n=t.getAttribute("autoplay"),a="string"==typeof n&&!0===n.toLowerCase();return Object.keys(videojs.getPlayers()).indexOf(e)!==-1&&videojs(e).dispose(),bc(e),a||!0===i?this.playPlayer(e):this.pausePlayer(e),!0}},{key:"getFeaturedVideo",value:function(){var e=this,i=[];return this.featuredVideoQuery.forEach(function(t){i=[].concat(a(i),a(e.convertNodeListToArray(document.querySelectorAll(t))))}),0===i.length?null:(1<i.length&&!0===this.debug&&(console.warn("Brightcove Facade: Found "+i.length+" featured videos. There should be only one."),console.warn("Brightcove Facade: Using the first featured video as featured.")),i[0].getAttribute("id"))}},{key:"convertNodeListToArray",value:function(e){for(var i=[],t=0;t<e.length;t++)i.push(e[t]);return i}},{key:"initializeFeatured",value:function(){var e=this.getFeaturedVideo();null!==e&&(this.updateStateValue(e,"willResumeVideo",!0),this.isPlayerVisible(e,this.viewThreshold)&&this.playVideo(e))}},{key:"getAllPlayers",value:function(){return this.convertNodeListToArray(document.querySelectorAll(".video-js"))}},{key:"getAllPlayerIds",value:function(){return this.getAllPlayers().map(function(e){return e.getAttribute("id")})}},{key:"getAllVideoState",value:function(){var e=this;if("undefined"==typeof videojs)return null;var i={};return this.getAllPlayerIds().forEach(function(t){i[t]=(0,r.default)(e.videoState[t],e.getSingleVideoState(t))}),i}},{key:"getSingleVideoState",value:function(e){return{adPlaying:this.isAdPlaying(e),hasStarted:this.hasStarted(e),isAutoplay:this.isAutoplay(e),isLoop:this.isLoop(e),isFeatured:this.isFeatured(e),isPlaying:this.isPlaying(e)}}},{key:"updateStateValue",value:function(e,i,t){var n={};n[e]={},n[e][i]=t,this.videoState=(0,r.default)(this.videoState,n)}},{key:"updateStateValues",value:function(e){var i=this;e.forEach(function(e){i.updateStateValue.apply(i,a(e))})}},{key:"getVideoState",value:function(e){return"object"!==u(this.videoState)?null:this.videoState[e]||null}},{key:"restoreVideoState",value:function(){var e=this;this.getAllPlayerIds().forEach(function(i){if(!0===e.isPlayerVisible(i,e.viewThreshold))return!0===e.willResumeAd(i)?void e.playVideoAd(i):void(!0===e.willResumeVideo(i)&&e.playVideo(i))})}},{key:"saveVideoState",value:function(){this.videoState=this.getAllVideoState()}},{key:"isPlaying",value:function(e){return!videojs(e).paused()}},{key:"isPaused",value:function(e){return videojs(e).paused()}},{key:"isInitialized",value:function(e){return"DIV"===document.getElementById(e).tagName}},{key:"isAdPlaying",value:function(e){return-1!==document.getElementById(e).className.indexOf("vjs-ad-playing")&&!1===this.isAdPaused(e)}},{key:"isAdPaused",value:function(e){return-1!==document.getElementById(e).className.indexOf("vjs-ima3-paused")}},{key:"isAutoplay",value:function(e){return videojs(e).autoplay()}},{key:"isLoop",value:function(e){return videojs(e).loop()}},{key:"isFeatured",value:function(e){return this.getFeaturedVideo()===e}},{key:"isUserActive",value:function(e){return-1!==document.getElementById(e).className.indexOf("vjs-user-active")&&-1===document.getElementById(e).className.indexOf("not-hover")}},{key:"hasStarted",value:function(e){return-1!==document.getElementById(e).className.indexOf("vjs-has-started")}},{key:"willResumeAd",value:function(e){return!0===this.videoState[e].willResumeAd}},{key:"willResumeVideo",value:function(e){return!0===this.videoState[e].willResumeVideo}},{key:"pauseVideo",value:function(e){!1!==this.isPlaying(e)&&(!1===this.isUserActive(e)&&this.updateStateValue(e,"willResumeVideo",!0),videojs(e).pause())}},{key:"pauseAd",value:function(e){!1!==this.isAdPlaying(e)&&(!1===this.isUserActive(e)&&this.updateStateValue(e,"willResumeAd",!0),videojs(e).ima3.adPlayer.pause())}},{key:"pausePlayer",value:function(e){this.pauseVideo(e),this.pauseAd(e)}},{key:"pauseAllPlayers",value:function(){var e=this;this.getAllPlayerIds().forEach(function(i){!0!==e.isPlaying(i)&&!0!==e.isAdPlaying(i)||e.pausePlayer(i)})}},{key:"pauseAllPlayersBut",value:function(e){var i=this;this.getAllPlayerIds().forEach(function(t){t===e||!0!==i.isPlaying(t)&&!0!==i.isAdPlaying(t)||i.pausePlayer(t)})}},{key:"playVideo",value:function(e){!0!==this.isIOSDevice()&&videojs(e).play()}},{key:"playVideoAd",value:function(e){!0!==this.isIOSDevice()&&videojs(e).ima3.adPlayer.play()}},{key:"playPlayer",value:function(e){!0!==this.isIOSDevice()&&(!0===this.willResumeAd(e)?this.playVideoAd(e):this.playVideo(e))}},{key:"playFeaturedVideo",value:function(){this.playPlayer(this.getFeaturedVideo())}},{key:"handleVisibilityChange",value:function(){!0===document[this.hidden]?this.pauseAllPlayers():this.restoreVideoState()}},{key:"resumePlayer",value:function(e){return!0===this.willResumeAd(e)?void this.playVideoAd(e):void(!0===this.willResumeVideo(e)&&this.playVideo(e))}},{key:"handleOnScroll",value:function(){var e=this;this.getAllPlayerIds().forEach(function(i){if(e.isPlayerVisible(i,e.viewThreshold)){if(!0===e.isPlaying(i)||!0===e.isAdPlaying(i))return;return!0===e.willResumeAd(i)?void e.playVideoAd(i):void(!0===e.willResumeVideo(i)&&e.playVideo(i))}return!0===e.isPlaying(i)?void e.pauseVideo(i):!0===e.isAdPlaying(i)?void e.pauseAd(i):void 0})}},{key:"bindListeners",value:function(){this.bindPlayPauseListeners(),this.bindOnFullScreenChangeListeners(),!0!==this.alreadyBoundVisibility&&(this.bindVisibilityListeners(),this.alreadyBoundVisibility=!0),!0!==this.alreadyBoundScroll&&(this.bindScrollListeners(),this.alreadyBoundScroll=!0)}},{key:"bindScrollListeners",value:function(){var e=this;document.addEventListener("scroll",(0,c.default)(function(){e.handleOnScroll()},300),!1)}},{key:"bindPlayPauseListeners",value:function(){var e=this;this.getAllPlayerIds().forEach(function(i){videojs(i).on("play",function(){e.updateStateValues([[i,"isPlaying",!0],[i,"willResumeAd",!1]]),!0===e.isUserActive(i)&&e.updateStateValue(i,"willResumeVideo",!0)}),videojs(i).on("pause",function(){e.updateStateValue(i,"isPlaying",!1),!0===e.isUserActive(i)&&e.updateStateValue(i,"willResumeVideo",!1)}),videojs(i).on("ads-play",function(){e.updateStateValues([[i,"isAdPlaying",!0],[i,"willResumeAd",!0]])}),videojs(i).on("ads-pause",function(){e.updateStateValue(i,"isAdPlaying",!1),!0===e.isUserActive(i)&&e.updateStateValue(i,"willResumeAd",!1)}),videojs(i).on("ads-ad-started",function(){e.updateStateValues([[i,"hasAdStarted",!0],[i,"isAdPlaying",!0],[i,"willResumeAd",!0]])}),videojs(i).on("ads-ad-ended",function(){e.updateStateValues([[i,"hasAdStarted",!1],[i,"isAdPlaying",!1],[i,"willResumeAd",!1]])}),videojs(i).on("ads-pod-started",function(){e.updateStateValues([[i,"hasAdStarted",!0],[i,"isAdPlaying",!0],[i,"willResumeAd",!0],[i,"willResumeVideo",!1]])}),videojs(i).on("ads-pod-ended",function(){e.updateStateValues([[i,"hasAdStarted",!1],[i,"isAdPlaying",!1],[i,"willResumeAd",!1],[i,"willResumeVideo",!0]])}),videojs(i).on("ima3error",function(){e.updateStateValues([[i,"hasAdStarted",!1],[i,"isAdPlaying",!1],[i,"willResumeAd",!1]])})})}},{key:"bindOnFullScreenChangeListeners",value:function(){var e=this;this.getAllPlayerIds().forEach(function(i){videojs(i).on("fullscreenchange",function(){!0===videojs(i).isFullscreen()?e.pauseAllPlayersBut(i):e.restoreVideoState()})})}},{key:"bindVisibilityListeners",value:function(){var e=this;return"hidden"in document?(this.hidden="hidden",this.visibilityChange="visibilitychange"):"mozHidden"in document?(this.hidden="mozHidden",this.visibilityChange="mozvisibilitychange"):"msHidden"in document?(this.hidden="msHidden",this.visibilityChange="msvisibilitychange"):"webkitHidden"in document&&(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"),!1 in document||!this.hidden in document?void console.error("You probably will never see this, but, please, upgrade your browser. It's really old."):void document.addEventListener(this.visibilityChange,function(){e.handleVisibilityChange()},!1)}},{key:"isPlayerVisible",value:function(e){var i=arguments.length<=1||void 0===arguments[1]?.5:arguments[1],t=document.getElementById(e).getBoundingClientRect();return this.isPlayerYVisible(t,i)&&this.isPlayerXVisible(t,i)}},{key:"isPlayerYVisible",value:function(e,i){var t=e.height-e.height*i;return 0<e.height&&-t<=e.top&&-t<=window.innerHeight-e.bottom}},{key:"isPlayerXVisible",value:function(e,i){var t=e.width-e.width*i;return 0<e.height&&-t<=e.left&&-t<=window.innerWidth-e.right}}]),e}();i.default=y},function(e,i,t){var n,a;!function(o,u){n=u,a="function"==typeof n?n.call(i,t,i,e):n,!(void 0!==a&&(e.exports=a))}(this,function(){return function e(i,t){var n=Array.isArray(t),a=n&&[]||{};return n?(i=i||[],a=a.concat(i),t.forEach(function(t,n){"undefined"==typeof a[n]?a[n]=t:"object"==typeof t?a[n]=e(i[n],t):i.indexOf(t)===-1&&a.push(t)})):(i&&"object"==typeof i&&Object.keys(i).forEach(function(e){a[e]=i[e]}),Object.keys(t).forEach(function(n){"object"==typeof t[n]&&t[n]&&i[n]?a[n]=e(i[n],t[n]):a[n]=t[n]})),a}})},function(e,i){function t(){return Date.now()}function n(e,i,n){function a(i){var t=p,n=g;return p=g=void 0,k=i,A=e.apply(n,t)}function o(e){return k=e,b=setTimeout(c,i),w?a(e):A}function s(e){var t=e-V,n=e-k,a=i-t;return j?S(a,m-n):a}function l(e){var t=e-V,n=e-k;return void 0===V||t>=i||t<0||j&&n>=m}function c(){var e=t();return l(e)?y(e):void(b=setTimeout(c,s(e)))}function y(e){return b=void 0,E&&p?a(e):(p=g=void 0,A)}function f(){void 0!==b&&clearTimeout(b),k=0,p=V=g=b=void 0}function h(){return void 0===b?A:y(t())}function v(){var e=t(),n=l(e);if(p=arguments,g=this,V=e,n){if(void 0===b)return o(V);if(j)return b=setTimeout(c,i),a(V)}return void 0===b&&(b=setTimeout(c,i)),A}var p,g,m,A,b,V,k=0,w=!1,j=!1,E=!0;if("function"!=typeof e)throw new TypeError(d);return i=r(i)||0,u(n)&&(w=!!n.leading,j="maxWait"in n,m=j?P(r(n.maxWait)||0,i):m,E="trailing"in n?!!n.trailing:E),v.cancel=f,v.flush=h,v}function a(e,i,t){var a=!0,o=!0;if("function"!=typeof e)throw new TypeError(d);return u(t)&&(a="leading"in t?!!t.leading:a,o="trailing"in t?!!t.trailing:o),n(e,i,{leading:a,maxWait:i,trailing:o})}function o(e){var i=u(e)?V.call(e):"";return i==y||i==f}function u(e){var i=typeof e;return!!e&&("object"==i||"function"==i)}function s(e){return!!e&&"object"==typeof e}function l(e){return"symbol"==typeof e||s(e)&&V.call(e)==h}function r(e){if("number"==typeof e)return e;if(l(e))return c;if(u(e)){var i=o(e.valueOf)?e.valueOf():e;e=u(i)?i+"":i}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(v,"");var t=g.test(e);return t||m.test(e)?A(e.slice(2),t?2:8):p.test(e)?c:+e}var d="Expected a function",c=NaN,y="[object Function]",f="[object GeneratorFunction]",h="[object Symbol]",v=/^\s+|\s+$/g,p=/^[-+]0x[0-9a-f]+$/i,g=/^0b[01]+$/i,m=/^0o[0-7]+$/i,A=parseInt,b=Object.prototype,V=b.toString,P=Math.max,S=Math.min;e.exports=a}])});