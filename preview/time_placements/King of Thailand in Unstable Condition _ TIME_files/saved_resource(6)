var _TgxAdBridgeGetSlotScript=window.TgxAdBridgeGetSlotScript;window.TgxAdBridgeGetSlotScript=function(){return"try {"+_TgxAdBridgeGetSlotScript.apply(this,arguments)+"} catch (e) { console.error(e) }"},function($,undefined){"use strict";var TimeAdFactory={},Time=window.Time||{},_is_ads_disabled=!1,_is_debug=!1;getParameterByName("debugads")&&(_is_debug=!0),getParameterByName("noads")&&(_is_ads_disabled=!0),"undefined"==typeof TiiAdConfig&&("object"==typeof console&&console.error("time-dfp -- TiiAdConfig/TGX not defined"),_is_ads_disabled=!0);try{sessionStorage&&(getParameterByName("testads")?(sessionStorage.setItem("testads",getParameterByName("testads")),$("body").addClass("testads")):sessionStorage.removeItem("testads"))}catch(e){"object"==typeof console&&console.error(e)}window.TiiAdsIsDebugMode=function(){return _is_debug};var adFactory,current_primary_section,$window=$(window),window_app_height=$window.height(),window_app_width=$window.width(),$html=$("html"),$body=$html.find("body"),ad_sizes={desktop:{"homepage-pushdown":["101x1","970x1","970x66","970x90","970x250"],pushdown:["101x1","970x66","970x90","970x250","970x418","994x250","728x90"],navigation:["900x250","970x418","1024x768"],"homepage-content-well":["728x90","900x250","970x418","994x250"],"homepage-cm-banner":["268x54"],"homepage-cm-brief":["454x40"],"ad-divider":["300x250"],"ad-divider-money":["450x375","728x90"],"collection-ad-divider":["300x251","450x375","728x90","900x250","970x418","994x250"],"left-rail":["300x250"],sub:["300x50","320x50"],"sub-cm":["268x54"],"in-article":["300x600"],list:["300x250"],"list-top-10":["300x250","818x450"],"magazine-cm-subscribe":["142x70"],"magazine-cm-module":["840x264"],"special-article-logo":["170x30"],"special-article-small":["300x250"],"special-article-xsmall":["300x250","300x600"],"special-article-large":["728x90","900x250","970x418","994x250"],"special-article-banner":["101x1","728x90","970x66","970x250"],"money-homepage-content-well":["300x251","728x90","900x250","970x418","994x250"],"money-homepage-right-rail":["300x250","300x600"],"money-homepage-cm-banner":["268x54"],"market-data-sponsor":["155x30","170x30"],"right-rail":["300x250","300x600"],"right-rail-short":["300x250"],nativo:["320x80"],parents__subscribeabv:["142x70"],"ad-divider-above":["728x90"],"gum-gum-ad":["1x6"],"below-gum-gum-ad":["5x5"],"vault-subscribe-banner-ad":["900x500"]},tablet:{"homepage-pushdown":["101x1","970x1","970x66","970x90","970x250"],pushdown:["101x1","970x66","970x90","970x250"],"homepage-content-well":["300x250","450x375"],"homepage-cm-banner":["268x54"],"homepage-cm-brief":["454x40"],"ad-divider":["300x250","450x375"],"collection-ad-divider":["450x375","300x251"],"left-rail":["300x250"],sub:["320x50","300x50"],"sub-cm":["268x54"],"in-article":["300x600"],list:["450x375","300x251"],"list-top-10":["450x375","300x251","818x450","616x400"],"magazine-cm-subscribe":["142x70"],"magazine-cm-module":["840x264"],"special-article-logo":["170x30"],"special-article-small":["300x250"],"special-article-xsmall":["300x250","300x600"],"special-article-large":["300x250"],"special-article-banner":["320x50"],"money-homepage-content-well":["300x250","450x375"],"money-homepage-right-rail":["300x250"],"money-homepage-cm-banner":["268x54"],"market-data-sponsor":["170x30","155x30"],"right-rail":["300x250","300x600"],"right-rail-short":["300x250"],nativo:["320x80"],parents__subscribeabv:["142x70"],"ad-divider-above":["728x90"],"gum-gum-ad":["1x6"],"below-gum-gum-ad":["5x5"],"vault-subscribe-banner-ad":["450x375"]},mobile:{"sub-cm":["300x50"],"homepage-content-well":["300x250","300x50","320x50"],"homepage-cm-banner":["300x50","320x50"],"homepage-cm-brief":["454x40"],"ad-divider":["300x50","320x50"],"ad-divider-money":["300x50","320x50"],"collection-ad-divider":["300x50"],"content-ad":["300x250"],"left-rail":["300x50","300x250"],sub:["300x50"],"in-article":["300x250"],list:["300x50","300x250"],"list-top-10":["450x375","300x251","616x400"],"magazine-cm-subscribe":["142x70"],"magazine-cm-module":["840x264"],"special-article-logo":["170x30"],"special-article-small":["300x250"],"special-article-xsmall":["300x250"],"special-article-large":["300x250","320x50"],"special-article-banner":["300x50","320x50"],"money-mobile-homepage-ad-before-section":["300x50","300x250"],"money-homepage-top":["300x50","320x50"],"money-homepage-content-well":["300x50","300x250"],"money-homepage-right-rail":["300x250"],"market-data-sponsor":["170x30","155x30"],nativo:["320x80"],parents__subscribeabv:["142x70"],"adhesion-ad":["300x50","320x50"],"right-rail":["300x250"],"gum-gum-ad":["1x6"],"below-gum-gum-ad":["5x5"],"vault-subscribe-banner-ad":["300x250"]}},left_rail_ad_timeout={},display_ad_timeouts={},$content_rail_ad_el_divs={},$left_rail_ad_el_divs={},$ad_left_rail_placeholders={},$article_viewport=$body.find(".article-viewport"),$pushdown_ad=$body.find("#pushdown-ad"),$left_rail_topper=$body.find(".left-rail-topper").eq(0),ad_left_rail_binded_events={},ad_content_rail_binded_events={},device=Time.device,is_ie=$.browser.msie,is_greater_than_ie_11=is_ie&&parseInt($.browser.version,10)>=11,is_tablet_landscape_mode=($.browser.webkit||is_greater_than_ie_11,$.browser.mozilla,navigator.appVersion.indexOf("Win")!==-1,"tablet"===device&&window_app_width>window_app_height),can_have_pushdown_ad="desktop"===device,initial_app_load=!0,initial_ad_page_load=!0,article_sub_ad_render=!1,pushdown_rendered=!1,is_topic=function(){var $topic=$left_rail_topper.find("#topic");return $topic.length&&$topic.hasClass("active")},get_primary_section=function(){return!!(Time.bootstrap&&Time.bootstrap.latest&&Time.bootstrap.latest.endpoint)&&Time.bootstrap.latest.endpoint},get_page_data=function(model){var page_data={$el:(model.views&&model.views.singleView,$("#article-"+model.get("id")).eq(0)),title:model.get("title"),url:model.get("url"),format:model.get("format"),section:model.get("section")?model.get("section").name:null,magazine_article:!!model.get("magazine_article"),paid:!!model.get("paid"),available:!!model.get("available"),id:model.get("id"),list_items:model.get("list_items")?model.get("list_items").length:0,neg:!!model.get("ads")&&model.get("ads").neg},modules=model.get("omniture")&&model.get("omniture").modules,right_rail_ad_id="right-rail-ad-"+page_data.id;return model.collection&&(page_data.env=model.collection.active_env,model.collection.sub&&(page_data.sub=model.collection.sub)),modules&&modules.indexOf("rr-ad")!==-1&&(page_data.right_rail_ad_id=right_rail_ad_id),page_data},get_active_rail=function(){return!(!Time.application||!Time.application.active_rail)&&Time.application.active_rail},get_active_article_id=function(){var active_rail=get_active_rail();return active_rail&&Time.application.model.get("activeArticle")?Time.application.model.get("activeArticle").get("id"):active_rail&&active_rail.models[0]?active_rail.models[0].id:Time.bootstrap.single_article?Time.bootstrap.single_article.id:TIME_DFP.aid?TIME_DFP.aid:!(!TIME_DFP.params||!TIME_DFP.params.aid)&&TIME_DFP.params.aid},get_$ad_left_rail_placeholder=function(ad_spacer_id){var $ad_spacer;return $ad_left_rail_placeholders[ad_spacer_id]?$ad_left_rail_placeholders[ad_spacer_id]:($ad_spacer=$("#"+ad_spacer_id),!!$ad_spacer.length&&($ad_left_rail_placeholders[ad_spacer_id]=$("#"+ad_spacer_id),$ad_spacer))},remove_pre_render_events=function(ad_placeholder_id,ad_location){console.log("removing ad events for "+ad_placeholder_id);var ad_bind_event_obj;ad_bind_event_obj="left-rail"===ad_location?ad_left_rail_binded_events:"content-rail"===ad_location?ad_content_rail_binded_events:ad_content_rail_binded_events,ad_bind_event_obj["scroll."+ad_placeholder_id]&&(ad_bind_event_obj["scroll."+ad_placeholder_id].unbind("scroll."+ad_placeholder_id),delete ad_bind_event_obj["scroll."+ad_placeholder_id]),ad_bind_event_obj["scroll."+ad_placeholder_id+"_notTheHeader"]&&(ad_bind_event_obj["scroll."+ad_placeholder_id+"_notTheHeader"].unbind("scroll."+ad_placeholder_id+"_notTheHeader"),delete ad_bind_event_obj["scroll."+ad_placeholder_id+"_notTheHeader"]),ad_bind_event_obj["resize."+ad_placeholder_id]&&(ad_bind_event_obj["resize."+ad_placeholder_id].unbind("resize."+ad_placeholder_id),delete ad_bind_event_obj["resize."+ad_placeholder_id]),"tablet"===device&&ad_bind_event_obj["orientationchange."+ad_placeholder_id]&&(ad_bind_event_obj["orientationchange."+ad_placeholder_id].unbind("orientationchange."+ad_placeholder_id),delete ad_bind_event_obj["orientationchange."+ad_placeholder_id])},remove_pre_render_content_rail_ad_events=function(ad_placeholder_id){remove_pre_render_events(ad_placeholder_id,"content-rail")},clear_bind_events_maker=function(bind_events_obj){return function(){var prop;for(prop in bind_events_obj)bind_events_obj.hasOwnProperty(prop)&&(bind_events_obj[prop].unbind(prop),delete bind_events_obj[prop])}},clear_timeout_maker=function(timeout_obj){return function(){var prop;for(prop in timeout_obj)timeout_obj.hasOwnProperty(prop)&&(clearTimeout(timeout_obj[prop]),delete timeout_obj[prop])}},clear_content_rail_bind_events=clear_bind_events_maker(ad_content_rail_binded_events),clear_left_rail_bind_events=clear_bind_events_maker(ad_left_rail_binded_events),clear_left_rail_timeouts=clear_timeout_maker(left_rail_ad_timeout),clear_display_ads_timeouts=clear_timeout_maker(display_ad_timeouts),remove_left_rail_ads=function(){for(var prop in $left_rail_ad_el_divs)if($left_rail_ad_el_divs.hasOwnProperty(prop)){prop.indexOf("ad-unit")===-1?$left_rail_ad_el_divs[prop].empty():($left_rail_ad_el_divs[prop].remove(),$("#"+prop).remove());try{delete $left_rail_ad_el_divs[prop],delete tgxDo.slots[prop]}catch(e){console.error("time-dfp -- remove_ads - couldn't delete "+prop)}Time.trigger("dfpAdManager:deleteAd",prop)}if(article_sub_ad_render=!1,"desktop"===Time.device)for(var prop2 in $ad_left_rail_placeholders)if($ad_left_rail_placeholders.hasOwnProperty(prop2)){try{delete $ad_left_rail_placeholders[prop2]}catch(e){}Time.trigger("dfpAdManager:deleteAd",prop2)}},remove_ads=function(){var prop;if(initial_app_load)return!1;clear_left_rail_bind_events(),clear_left_rail_timeouts(),clear_content_rail_bind_events(),remove_left_rail_ads(),clear_display_ads_timeouts(),Time.trigger("dfpAdManager:removeAds"),pushdown_rendered&&($pushdown_ad.empty(),pushdown_rendered=!1);for(prop in $content_rail_ad_el_divs)try{delete $content_rail_ad_el_divs[prop],delete tgxDo.slots[prop]}catch(e){}},clean_ad_key_value=function(value){return value.replace(/[^\w,]/g,"").toLowerCase()},get_adFactory_data=function(model){if(!model)return!1;var adFactory_data={},type=Time.application.active_route&&"rail"===Time.application.active_route?"article":Time.application.active_route;return adFactory_data.params={},model.get("section")&&model.get("section").name?(adFactory_data.params.ch=model.get("section").name,adFactory_data.zone=adFactory_data.params.ch):(adFactory_data.zone="",adFactory_data.params.ch=""),model.get("collection_meta")?/money_collection|money_collectionpost|money_article/.test(model.get("post_type"))?adFactory_data.zone="money/collections/"+model.get("collection_meta").ad_zone:adFactory_data.zone="collections/"+model.get("collection_meta").ad_zone:/money_collection|money_collectionpost|money_article/.test(model.get("post_type"))?adFactory_data.zone="money/"+adFactory_data.params.ch:adFactory_data.zone=adFactory_data.params.ch,model.get("format")&&(adFactory_data.params.ctype=model.get("format")),model.get("id")&&(adFactory_data.params.aid=model.get("id")),model.get("ads")&&(adFactory_data.params.neg=model.get("ads").neg),model.get("tags")&&(adFactory_data.params.tags=clean_ad_key_value(model.get("tags").replace(/\|/g,","))),model.get("topic")&&model.get("topic").slug&&(adFactory_data.params.topic=clean_ad_key_value(model.get("topic").slug)),model.get("hub_meta")&&(adFactory_data.params.subch=model.get("hub_meta").slug),model.get("is_nativo")&&model.get("sponsor")&&model.get("sponsor").slug&&(adFactory_data.params.spons=clean_ad_key_value(model.get("sponsor").slug)),is_topic()?adFactory_data.params.ptype="topic":Time.application.active_route&&(adFactory_data.params.ptype=type),model.get("topic")&&model.get("topic").is_vault&&(adFactory_data.zone="vault"),adFactory_data.url=model.get("url"),adFactory_data},init=function(){_is_debug?$html.addClass("debugads"):$html.removeClass("debugads"),Time.listenTo(Time,"article:offscreen",function(data){var $ad,model=data.model,$el=data.$el,id=model.get("id"),available=!!model.get("available"),right_rail_ad_id="right-rail-ad-"+id;if(right_rail_ad_id&&($ad=$("#"+right_rail_ad_id),$ad.length)){var adHeight=$ad.height();console.log("setting right rail ad height to",adHeight),$ad.css({height:adHeight}),remove_pre_render_content_rail_ad_events(right_rail_ad_id),Time.trigger("dfpAdManager:deleteAd",right_rail_ad_id)}available||($el.addClass("rendered-cm-ad-module-removed"),Time.trigger("dfpAdManager:deleteAd","magazine-cm-module-"+id))}),Time.listenTo(Time,"article:onscreen",function(data){var model=data.model;model.get("id"),model.get("omniture")&&model.get("omniture").modules})},activate_ads=function(article_model){if(console.log("-------- ACTIVATE_ADS --------",article_model),!_is_ads_disabled){var page_data=get_page_data(article_model),format=page_data.format,article_id=page_data.id,$el=page_data.$el,right_rail_ad_id=page_data.right_rail_ad_id,available=page_data.available,ads=[],current_page_type=Time.application.getPageType();if(current_primary_section=get_primary_section(),article_id){if(available||($el.hasClass("rendered-cm-ad")?$el.hasClass("rendered-cm-ad-module-removed")&&($el.removeClass("rendered-cm-ad-module-removed"),Time.trigger("dfpAdManager:activateCmAd","magazine-cm-module-"+article_id,Time.application.adSizes["magazine-cm-module"],"submodule","tout"),Time.trigger("dfpAdManager:refreshAds",Time.application.model.get("activeArticle"),["magazine-cm-module-"+article_id])):($el.addClass("rendered-cm-ad"),render_magazine_cm_ads(article_id),display_magazine_cm_ads(article_id))),Time.application.tgxFactory.get("isInitialLeftRailCycle")&&"collection"===current_page_type&&$("#ad-unit-0").length&&(console.log("-- activate_ads -- initial left collection - ad-unit-0"),Time.trigger("leftRail:activateAdZero"),ads.push("ad-unit-0")),"mobile"===device)Time.application.tgxFactory.get("isInitialLeftRailCycle")&&(console.log("ActivateAds -- Mobile, Initial -- activate left rail ads"),ads=ads.concat(mobileActivateLeftRailAds()));else if(Time.application.tgxFactory.get("isInitialLeftRailCycle")||Time.application.isRailOpen&&"collection"!==current_page_type)return console.log("ActivateAds -- Initial, activate left rail ads"),can_have_pushdown_ad&&!pushdown_rendered&&(pushdown_rendered=!0,Time.trigger("pushdown:activate"),ads.push("pushdown-ad")),console.log("-- old activate_ads rendered all of these ads: ",ads),Time.application.tgxFactory.set("isInitialLeftRailCycle",!1),console.log("--------- DONE ACTIVATE_ADS ---------"),ads;return console.log("activate_ads -- mobile OR l.rail already loaded OR not initial OR scrolled to article"),"gallery"===format?(console.log("--------- DONE ACTIVATE_ADS ---------"),ads):(window.TGX_SITE_CONFIG.refresh_oop_slot=!0,"collection"!==current_page_type&&(console.log("-- no ads are in the current content so just reload visible left rail ads"),right_rail_ad_id&&tgxDo.slots[right_rail_ad_id]&&ads.push(right_rail_ad_id),can_have_pushdown_ad&&(Time.trigger("pushdown:activate",article_model),ads.push("pushdown-ad"))),console.log("--------- DONE ACTIVATE_ADS ---------"),ads)}}},display_magazine_cm_ads=function(id){var ads=[];tgxDo.slots["magazine-cm-subscribe-top-"+id]&&ads.push("magazine-cm-subscribe-top-"+id),tgxDo.slots["magazine-cm-subscribe-bottom-"+id]&&ads.push("magazine-cm-subscribe-bottom-"+id),tgxDo.slots["magazine-cm-module-"+id]&&ads.push("magazine-cm-module-"+id),Time.trigger("dfpAdManager:refreshAds",Time.application.model.get("activeArticle"),ads)},render_magazine_cm_ads=function(id){$article_viewport.find("#magazine-cm-subscribe-top-"+id).length&&Time.trigger("dfpAdManager:activateCmAd","magazine-cm-subscribe-top-"+id,Time.application.adSizes["magazine-cm-subscribe"],"subscribeabv","tout"),$article_viewport.find("#magazine-cm-subscribe-bottom-"+id).length&&Time.trigger("dfpAdManager:activateCmAd","magazine-cm-subscribe-bottom-"+id,Time.application.adSizes["magazine-cm-subscribe"],"subscribeblw","tout"),$article_viewport.find("#magazine-cm-module-"+id).length&&Time.trigger("dfpAdManager:activateCmAd","magazine-cm-module-"+id,Time.application.adSizes["magazine-cm-module"],"submodule","tout")},mobileActivateLeftRailAds=function(){console.log("mobile -- activate left rail ads");var ads=[],active_rail=get_active_rail(),active_rail_view=active_rail.view?active_rail.view:Time.page.rail_view;if("collection"!==Time.application.getPageType()){if(console.log("-- isnt collection"),!active_rail_view)return void console.log("-- no rail");Time.application.is_homepage&&(console.log("-- is homepage"),("undefined"==typeof Time.application.is_money_homepage||!Time.application.is_money_homepage||Time.application.is_money_homepage.length<1)&&(console.debug("-- not money, push ad-unit-1"),ads.push(["ad-unit-1"])))}return ads},activate_vertical_homepage_ads=function(){var ads=[];if("mobile"!==device)Time.trigger("dfpAdManager:activateAd",null,{id:"money-homepage-content-well-ad",size:Time.application.adSizes["money-homepage-content-well"],position:1,group:"contentWell",subgroup:"moneyHomepage"}),ads.push("money-homepage-content-well-ad"),Time.trigger("dfpAdManager:activateAd",null,{id:"money-right-rail-ad",size:Time.application.adSizes["money-homepage-right-rail"],position:1,group:"rightRail",subgroup:"moneyHomepage"}),ads.push("money-right-rail-ad"),Time.page.isMarketDataEnabled&&(Time.trigger("dfpAdManager:activateAd",null,{id:"market-data-sponsor",size:Time.application.adSizes["market-data-sponsor"],position:1,group:"sponsor"}),ads.push("market-data-sponsor"));else{Time.trigger("dfpAdManager:activateAd",null,{id:"money-homepage-top-ad",size:Time.application.adSizes["money-homepage-top"],position:1,group:"topAd",subgroup:"moneyMobile"}),ads.push("money-homepage-top-ad");var inBriefAdId="ad-homepage-post-first-brief-article";Time.trigger("dfpAdManager:activateAd",null,{id:inBriefAdId,size:["300x250"],position:1,group:"homepageContentWell",subgroup:"moneyMobile"}),ads.push(inBriefAdId),$('<div class="money-mobile-homepage-ad" id="money-mobile-homepage-ad-before-watch-now"></div>').insertBefore(".home-container .home-watch-now:first"),Time.trigger("dfpAdManager:activateAd",null,{id:"money-mobile-homepage-ad-before-watch-now",size:["300x250","300x50","320x50"],position:2,group:"homepageContentWell",subgroup:"moneyMobile"}),ads.push("money-mobile-homepage-ad-before-watch-now"),$('<div class="money-mobile-homepage-ad" id="money-mobile-homepage-ad-before-features"></div>').insertBefore(".home-container .home-features:first"),Time.trigger("dfpAdManager:activateAd",null,{id:"money-mobile-homepage-ad-before-features",size:["300x250","300x50","320x50"],position:3,group:"homepageContentWell",subgroup:"moneyMobile"}),ads.push("money-mobile-homepage-ad-before-features"),Time.page.isMarketDataEnabled&&(Time.trigger("dfpAdManager:activateAd",null,{id:"market-data-sponsor",size:Time.application.adSizes["market-data-sponsor"],position:1,group:"sponsor"}),ads.push("market-data-sponsor"))}can_have_pushdown_ad&&!pushdown_rendered&&(pushdown_rendered=!0,Time.trigger("pushdown:activate"),ads.push("pushdown-ad")),"mobile"!==device&&$("#gum-gum-ad").length>0&&(Time.trigger("dfpAdManager:activateAd",null,{id:"gum-gum-ad",size:["1x6"],position:1,group:"contentWell"}),ads.push("gum-gum-ad")),Time.trigger("dfpAdManager:refreshAds",Time.application.model.get("activeArticle"),ads),("desktop"==device||is_tablet_landscape_mode)&&(Time.trigger("dfpAdManager:activateAd",null,{id:"money-home-banner-ad",size:Time.application.adSizes["money-homepage-cm-banner"],position:1,cmpos:"globalheadermny",cmtyp:"tout",isCmAd:!0}),Time.trigger("dfpAdManager:refreshAds",Time.application.model.get("activeArticle"),["money-home-banner-ad"]))},set_initial_app_load=function(val){initial_app_load=val},pushdown_ad_callback=function(){Time.application.setIsPastPushdowns(),console.log("pushdown ad callback"),$pushdown_ad.hasClass("hide-ad")||$pushdown_ad.css({height:"auto",overflow:"visible"}),Time.trigger("pushdown:loaded")},hide_ad_div=function(adId){var parentclass,$parentEl,$adEl=$("#"+adId);if(console.log("time_dfp -- hide_ad_div from adCallbackFunction -- hiding "+adId),$adEl.addClass("hide-ad"),$parentEl=$adEl.parent(),parentclass=$parentEl.prop("class"),-1!==parentclass.indexOf("-ad__wrapper")&&$parentEl.addClass("hide-ad"),adId.indexOf("ad-unit-")!==-1){var $ad_spacer;"desktop"===Time.device&&($ad_spacer=get_$ad_left_rail_placeholder($adEl.data("ad_placeholder_id")),$ad_spacer.addClass("hide-ad"))}else adId.indexOf("pushdown-ad")!==-1?Time.trigger("pushdown:loaded"):adId.indexOf("ad_brightcove")!==-1&&$("#ad_brightcove").closest(".ad_brightcove_video").addClass("hide-ad");return Time.trigger("dfpAdManager:callback:hide",adId),!1},adCallbackFunction=function(adId){var $adEl=$("#"+adId);return $adEl.hasClass("hide-ad")?($adEl.hasClass("collection-grid__tile")&&$adEl.remove(),console.log("time-dfp -- adCallbackFunction for hidden ad "+adId),!1):0===$adEl.length?(console.log("time-dfp -- adCallbackFunction for DOM MISSING "+adId),!1):(console.log("time-dfp -- adCallbackFunction for "+adId),adId.indexOf("pushdown-ad")!==-1?pushdown_ad_callback(adId):(Time.trigger("dfpAdManager:callback",adId),!1))},hide_left_rail_ads=function($arr_ad_divs){var prop,$the_ad_id,i,l,active_rail;if(active_rail=get_active_rail(),"desktop"===Time.device)if($arr_ad_divs&&$.isArray($arr_ad_divs))for(l=$arr_ad_divs.length,i=0;i<l;i+=1)$arr_ad_divs[i].css({left:"-3360px"});else for(prop in $left_rail_ad_el_divs)prop.indexOf("ad-unit-")!==-1&&($the_ad_id=$("#"+prop),$the_ad_id.css({left:"-3360px"}))},update_sponsor_ad_position=function(ad_placeholder_id,top,left){var $ad_placeholder_id=$("#"+ad_placeholder_id);top=parseInt(top,10),top&&$ad_placeholder_id.css({top:top}),left=parseInt(left,10),left&&$ad_placeholder_id.css({left:left})};TimeAdFactory.isInitialAdPageLoad=function(){return initial_ad_page_load},TimeAdFactory.isInitialAppLoad=function(){return initial_app_load},TimeAdFactory.getAdSizes=function(device){return ad_sizes[device]},TimeAdFactory.getFactoryInstance=function(){return adFactory},TimeAdFactory.getFactoryData=get_adFactory_data,TimeAdFactory.setGlobalFactory=function(newFactory){return adFactory=newFactory},TimeAdFactory.setInitialAdPageLoad=function(isInitialAdPageLoad){initial_ad_page_load=isInitialAdPageLoad},TimeAdFactory.init=init,TimeAdFactory.set_initial_app_load=set_initial_app_load,TimeAdFactory.clear_left_rail_bind_events=clear_left_rail_bind_events,TimeAdFactory.clear_left_rail_timeouts=clear_left_rail_timeouts,TimeAdFactory.remove_left_rail_ads=remove_left_rail_ads,TimeAdFactory.remove_ads=remove_ads,TimeAdFactory.activate_ads=activate_ads,TimeAdFactory.activate_vertical_homepage_ads=activate_vertical_homepage_ads,TimeAdFactory.hide_left_rail_ads=hide_left_rail_ads,TimeAdFactory.get_active_article_id=get_active_article_id,TimeAdFactory.ad_content_rail_binded_events=ad_content_rail_binded_events,TimeAdFactory.ad_left_rail_binded_events=ad_left_rail_binded_events,TimeAdFactory.$content_rail_ad_el_divs=$content_rail_ad_el_divs,TimeAdFactory.$left_rail_ad_el_divs=$left_rail_ad_el_divs,TimeAdFactory.$ad_left_rail_placeholders=$ad_left_rail_placeholders,TimeAdFactory.get_$ad_left_rail_placeholder=get_$ad_left_rail_placeholder,TimeAdFactory.left_rail_ad_timeout=left_rail_ad_timeout,TimeAdFactory.display_ad_timeouts=display_ad_timeouts,TimeAdFactory.remove_pre_render_content_rail_ad_events=remove_pre_render_content_rail_ad_events,TimeAdFactory.adCallbackFunction=adCallbackFunction,TimeAdFactory.hide_ad_div=hide_ad_div,TimeAdFactory.update_sponsor_ad_position=update_sponsor_ad_position,window.TimeAdFactory=TimeAdFactory}(jQuery);;
(function(){var $,LODASH_VERSION,Time,createSubapp,getSubmodules,module,require,root,start,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};LODASH_VERSION="3.9.3","undefined"!=typeof _&&null!==_&&_.VERSION!==LODASH_VERSION&&_.noConflict(),module={},require=_.noop,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.modules.ChartbeatFacade=function(superClass){function ChartbeatFacade(){return ChartbeatFacade.__super__.constructor.apply(this,arguments)}return extend(ChartbeatFacade,superClass),ChartbeatFacade.prototype.initialize=function(){return Time.on("article:activated",this._onArticleActivated)},ChartbeatFacade.prototype._onArticleActivated=function(readingPaneArticle){var attributes,author,authors,canonical,isMoney,path,ref,section,sections,title;if(attributes=readingPaneArticle.model.attributes,title=attributes.title,path=attributes.url.replace(/.*?\/\/.*?\//,"/"),canonical=null!=attributes&&null!=(ref=attributes.seo)?ref.canonical_link:void 0,authors=[],attributes.authors&&(authors=function(){var j,len,ref1,results;for(ref1=attributes.authors,results=[],j=0,len=ref1.length;j<len;j++)author=ref1[j],results.push(author.name);return results}()),sections=[],attributes.section&&sections.push(attributes.section.slug),isMoney=Time.application.isMoney(),isMoney&&(sections=function(){var j,len,results;for(results=[],j=0,len=sections.length;j<len;j++)section=sections[j],results.push("money-"+section);return results}()),isMoney?sections.unshift("money"):sections.unshift("time"),Time.application.is_homepage||(window._sf_async_config.sections=sections.join(","),window._sf_async_config.authors=authors.join(",")),(null!=canonical?canonical.length:void 0)>0?(window._sf_async_config.useCanonical=!1,window._sf_async_config.path=path):window._sf_async_config.useCanonical=!0,window.pSUPERFLY)return window.pSUPERFLY.virtualPage(path,title)},ChartbeatFacade}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.modules.ComscoreFacade=function(superClass){function ComscoreFacade(options){return null==options&&(options={}),this.app=options.app,this}return extend(ComscoreFacade,superClass),ComscoreFacade.prototype._CLIENT_ID="6035728",ComscoreFacade.prototype._TAG_TYPE="2",ComscoreFacade.prototype._isFirstRun=!0,ComscoreFacade.prototype.firePageviewCandidate=function(){var e;if(this._isFirstRun)return this._isFirstRun=!1,!0;try{window.COMSCORE.beacon({c1:this._TAG_TYPE,c2:this._CLIENT_ID})}catch(_error){return e=_error,console.error("Failed to fire comscore beacon",e),!1}return this.requestLocalXml(),!0},ComscoreFacade.prototype.requestLocalXml=function(){var url;url=Time.home_url+"/wp-content/themes/vip/time2014/comscore/"+(Time.bootstrap.branding||"time")+"/pageview_candidate.xml",$.get(url,{comscorekw:"pageview_candidate",rand:Math.floor(1e6*Math.random())})},ComscoreFacade}(Backbone.Events),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.modules.FacebookFacade=function(superClass){function FacebookFacade(){return this.renderWidgets=bind(this.renderWidgets,this),FacebookFacade.__super__.constructor.apply(this,arguments)}return extend(FacebookFacade,superClass),FacebookFacade.prototype.DEBUG=!0,FacebookFacade.prototype._FB_URL="//connect.facebook.net/en_UK/all.js",FacebookFacade.prototype._FB_APP_ID="53177223193",FacebookFacade.prototype._loadingFb=null!=window.FB,FacebookFacade.prototype._hasFb=null!=window.FB,FacebookFacade.prototype.initialize=function(options){return null==options&&(options={}),this.app=options.app,this.listenTo(Time,"article:fbembeds:activate",this.renderWidgets),this},FacebookFacade.prototype.renderWidgets=function(parentEl){this.asyncLoadFb(function(){window.FB.XFBML.parse(parentEl)})},FacebookFacade.prototype.asyncLoadFb=function(callback){return this._hasFb||this._loadingFb?void("function"==typeof callback&&callback()):(this._loadingFb=!0,this._hasFb=null!=window.FB,$("#fb-root").length||$('<div id="fb-root" />').appendTo("body"),$.ajaxSetup({cache:!0}),$.getScript(this._FB_URL,function(_this){return function(){_this._loadingFb=!1,_this._hasFb=null!=window.FB,window.FB.init({appId:_this._FB_APP_ID}),Time.trigger("facebook:sdk:loaded"),"function"==typeof callback&&callback()}}(this)),void $.ajaxSetup({cache:!1}))},FacebookFacade}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,module=module||{},module.exports=Time.modules.Mediator=function(){function Mediator(options){return this.refreshAdhesionOnTIME100=bind(this.refreshAdhesionOnTIME100,this),this.ssv2ComscorePageview=bind(this.ssv2ComscorePageview,this),this.ssv2OmniturePageview=bind(this.ssv2OmniturePageview,this),this.ssRefreshAds=bind(this.ssRefreshAds,this),this.specialStoryActivateAds=bind(this.specialStoryActivateAds,this),this.homepageActivateGumGumAd=bind(this.homepageActivateGumGumAd,this),this.nonmobileHomepageActivateAds=bind(this.nonmobileHomepageActivateAds,this),this.mobileHomepageActivateAds=bind(this.mobileHomepageActivateAds,this),this.homepageActivateLeftRailAd=bind(this.homepageActivateLeftRailAd,this),this.tgxHomepageActivateAds=bind(this.tgxHomepageActivateAds,this),this.nativoHomepageActivateAds=bind(this.nativoHomepageActivateAds,this),this.refreshListAds=bind(this.refreshListAds,this),this.activateListAds=bind(this.activateListAds,this),this.injectListAds=bind(this.injectListAds,this),this.tgxReloadLeftRailAdsWhenScrollPastFourthListItem=bind(this.tgxReloadLeftRailAdsWhenScrollPastFourthListItem,this),this.onChangeGallerySlide=bind(this.onChangeGallerySlide,this),this.onArticleDeactivated=bind(this.onArticleDeactivated,this),this.onArticleActivated=bind(this.onArticleActivated,this),this.activatePushdownAd=bind(this.activatePushdownAd,this),this.syncWithLeftRail=bind(this.syncWithLeftRail,this),this.maybeAppendChivas=bind(this.maybeAppendChivas,this),this.maybeAppendAd=bind(this.maybeAppendAd,this),this.tgxOnLeftRailTileRendered=bind(this.tgxOnLeftRailTileRendered,this),this.tgxLeftRailAdCallback=bind(this.tgxLeftRailAdCallback,this),this.tgxCreateLeftRailAd=bind(this.tgxCreateLeftRailAd,this),this.deleteSectionSubAd=bind(this.deleteSectionSubAd,this),this.activateSectionSubAd=bind(this.activateSectionSubAd,this),this.activateAdhesionAd=bind(this.activateAdhesionAd,this),this.tgxRenderLeftRailAd=bind(this.tgxRenderLeftRailAd,this),this.tgxRefreshNewVisibleAdsStream=bind(this.tgxRefreshNewVisibleAdsStream,this),this.tgxRefreshNewVisibleAds=bind(this.tgxRefreshNewVisibleAds,this),this.tgxOnLeftRailScroll=bind(this.tgxOnLeftRailScroll,this),this.nativoOnArticleLoaded=bind(this.nativoOnArticleLoaded,this),this.nativoOnArchiveLoaded=bind(this.nativoOnArchiveLoaded,this),this.nativoRequestData=bind(this.nativoRequestData,this),this.nativoOnAnyModelAdded=bind(this.nativoOnAnyModelAdded,this),this.app=options.app,this}return Mediator.prototype.peers={},Mediator.prototype.rules=null,Mediator.prototype.nativoTilePrevIndices=[],Mediator.prototype.nativoCount=0,Mediator.prototype.NATIVO_DISABLED_PAGETYPES=["author","collection","videos","nativo","magazine","sponsor","topic"],Mediator.prototype.isNativoLoading=!1,Mediator.prototype.contentAdActivated=!1,Mediator.prototype.dividerAdActivated=!1,Mediator.prototype._nativoWaitUntilRenderableTimeout=null,Mediator.prototype.CHIVAS_DISABLED_PAGETYPES=["author","collection","videos","nativo","magazine","sponsor","topic"],Mediator.prototype.CHIVAS_FREQUENCY=10,Mediator.prototype.CHIVAS_OFFSET=0,Mediator.prototype.CHIVAS_LIMIT=2,Mediator.prototype.CHIVAS_DATA=[{sponsor:{from:"Brought to you by",name:"Chivas"},title:"A Decade of Transformation",url:"http://time.com/time-100-decade-change/"},{sponsor:{from:"Brought to you by",name:"Chivas"},title:"Mentors Tell Their Stories",url:"http://time.com/time100mentors/"}],Mediator.prototype.chivasCount=0,Mediator.prototype.AD_ALLOWED_AFTER=[".rail-article",".rail-article-sponsored",".rail-article-magazine"],Mediator.prototype.isSubAdRenderedForRail=!1,Mediator.prototype.$lastPassedListItem=null,Mediator.prototype.LIST_AD_FREQUENCY=4,Mediator.prototype.LIST_AD_REFRESH_FREQUENCY=2,Mediator.prototype.SS_AD_REFRESH_FREQUENCY=1,Mediator.prototype.ssLastRefreshMarker=-1,Mediator.prototype.lastIsAdhesionAdHidden=!1,Mediator.prototype.addPeers=function(peers){_.extend(this.peers,peers)},Mediator.prototype.initialize=function(){return this.rules={"dfpAdManager:afterDisplay":{handlers:{tgx:function(_this){return function(adIds){var isInitialAdsDone;if(Time.Ad.isInitialAdPageLoad()&&(isInitialAdsDone="desktop"!==Time.device,isInitialAdsDone||(isInitialAdsDone=_this.isLeftRailAdsIncluded(adIds)),isInitialAdsDone||(isInitialAdsDone=null!=Time.page&&"object"==typeof Time.page),isInitialAdsDone))return Time.Ad.setInitialAdPageLoad(!1),window.TGX_SITE_CONFIG.refresh_oop_slot=!1,_this.initialAdsRefreshed(),_this}}(this)}},"dfpAdManager:callback":{handlers:{tgx:function(_this){return function(adId){var adModel;adModel=_this.peers.tgx.collection.get(adId),adModel&&("leftRail"===adModel.get("group")?_this.tgxLeftRailAdCallback(adModel):adModel.get("isTethered")&&_this.tgxHidePlaceholderCallback(adModel))}}(this)}},"dfpAdManager:callback:hide":{handlers:{tgx:function(_this){return function(adId){var adModel;adModel=_this.peers.tgx.collection.get(adId),adModel&&adModel.get("isTethered")&&_this.tgxHidePlaceholderCallback(adModel)}}(this)}},"window:pinnion":{handlers:{pinnion:this.peers.pinnion.handlePinnionEvent}},"omniture:pinnionPollPageview":{handlers:{tgx:function(_this){return function(){_this.syncWithLeftRail(null,[])}}(this)}},"pushdown:activate":{handlers:{tgx:this.activatePushdownAd}},"nativo:request":{handlers:{tgx:this.nativoRequestData}},"nativo:archive:loaded":{handlers:{nativo:this.nativoOnArchiveLoaded}},"nativo:article:loaded":{handlers:{nativo:this.nativoOnArticleLoaded}},"leftRail:model:added":{debug:!1,handlers:{nativo:this.nativoOnAnyModelAdded}},"leftRail:tile:rendered":{debug:!1,handlers:{tgx:this.tgxOnLeftRailTileRendered}},"leftRail:tile:injected":{handlers:{nativo:function(_this){return function(){_this.nativoCount+=1}}(this)}},"leftRail:flush":{handlers:{nativo:function(_this){return function(){_this.nativoTilePrevIndices=[],_this.nativoCount=0,_this.chivasCount=0,_this.peers.nativo.reset()}}(this),tgx:function(_this){return function(){var leftRailAdModels;_this.deleteSectionSubAd(),_this.isSubAdRenderedForRail=!1,leftRailAdModels=_this.peers.tgx.collection.where({group:"leftRail"}),_.each(leftRailAdModels,function(model){var base;if(model.get("view"))return"function"==typeof(base=model.get("view")).destroy?base.destroy():void 0}),_this.peers.tgx.collection.remove(leftRailAdModels)}}(this)}},"leftRail:syncAds":{handlers:{tgx:this.syncWithLeftRail}},"leftRail:opened":{handlers:{tgx:function(_this){return function(){var adIds,ref;if(!_this.peers.tgx.isInitialAdCycle&&(adIds=null!=(ref=_this.app.getRailView())?ref.getIdsOfVisibleAds():void 0,adIds.length))return _this.peers.tgx.refreshAds(null,adIds,function(){return Tether.position()})}}(this)}},"leftRail:scroll":{debug:!1,handlers:{tgx:this.tgxOnLeftRailScroll}},"leftRail:filled":{debug:!1,handlers:{tgx:function(_this){return function(railView){_this.peers.tgx.isInitialAdCycle||_this.tgxRefreshNewVisibleAds(railView)}}(this)}},"leftRail:activateAd":{handlers:{tgx:function(_this){return function(articleModel,params){var adModel;adModel=_this.tgxCreateLeftRailAd(articleModel,params),_this.peers.tgx.collection.add(adModel)}}(this)}},"leftRail:activateAdZero":{handlers:{tgx:function(_this){return function(){var $adZero,adModel;$adZero=$("#ad-unit-0"),adModel=_this.tgxCreateLeftRailAd($adZero),_this.app.getRailView().totalLeftRailAds+=1,_this.peers.tgx.collection.add(adModel)}}(this)}},"homepage:activateAds":{handlers:{tgx:this.tgxHomepageActivateAds,nativo:this.nativoHomepageActivateAds}},"special:ads:activate":{handlers:{tgx:this.specialStoryActivateAds}},"special:marker:passed":{handlers:{tgx:this.ssRefreshAds,omniture:this.ssv2OmniturePageview,comscore:this.ssv2ComscorePageview}},"article:activated":{handlers:{tgx:this.onArticleActivated}},"article:deactivated":{handlers:{tgx:this.onArticleDeactivated}},"article:list:injectAds":{handlers:{tgx:this.injectListAds}},"article:list:activateAds":{handlers:{tgx:this.activateListAds}},"article:list:toggleView":{handlers:{tgx:this.refreshListAds}},"article:list:gallerySlideChanged":{handlers:{omniture:this.listGallerySlideChangedPageview,tgx:this.onChangeGallerySlide}},"gallery:slide:activated gallery:slides:loadedMore":{handlers:{tgx:this.onChangeGallerySlide}},"body:scrolled":{debug:!1,handlers:{tgx:function(_this){return function(){_this.ssActivateNewAdsOnScroll(),_this.maybeHideAdhesionAd(),_this.tgxOnLeftRailScroll(),_this.tgxRefreshNewVisibleAdsStream()}}(this)}},"comscore:pageview":{handlers:{comscore:function(_this){return function(){_this.peers.comscore.firePageviewCandidate()}}(this)}},"calcxml:show":{handlers:{tgx:function(_this){return function(calculatorId,calculatorSection,calculatorCtype){var $adEl,adId,sizes;null==calculatorSection&&(calculatorSection=""),null==calculatorCtype&&(calculatorCtype=""),adId="ModalHeaderAd--calcxml--"+calculatorId,$adEl=$("#"+adId),sizes=$adEl.data("sizes-"+Time.device).split(","),_this.peers.tgx.activateAd(null,{id:adId,size:sizes,position:$adEl.data("pos"),group:"calcxml",extraParams:{topic:calculatorSection,ctype:calculatorCtype}})&&_this.peers.tgx.refreshAds(null,[adId])}}(this)}},"masonry:rendered":{handlers:{omniture:function(data){Time.Tracking.article_view(data)}}}},this.bindRules(),this},Mediator.prototype.bindRules=function(){return _.each(this.rules,function(_this){return function(settings,event){return _.each(settings.handlers,function(handler,peer){_.has(_this.peers,peer)&&(null==settings.listener&&(settings.listener=Time),null==settings.debug&&(settings.debug=!0),settings.debug&&Time.listenTo(settings.listener,event,function(){return console.debug("Mediator ",event," for ",peer)}),Time.listenTo(settings.listener,event,handler))})}}(this)),this},Mediator.prototype.isLeftRailAdsIncluded=function(adDivIds){var leftRailAds;return leftRailAds=_.find(adDivIds,function(id){var isLeftRailAd;return isLeftRailAd=id.indexOf("ad-unit")!==-1}),null!=leftRailAds?leftRailAds.length:void 0},Mediator.prototype.isState=function(states){var ref,ref1,ref2;return null==states&&(states=[]),ref=null!=(ref1=this.app.active_rail)?ref1.active_env:void 0,indexOf.call(states,ref)>=0||(ref2=this.app.getPageType(),indexOf.call(states,ref2)>=0)},Mediator.prototype.initialAdsRefreshed=function(){return this.peers.tgx.isInitialAdCycle=!1,Time.Ad.set_initial_app_load(!1),this},Mediator.prototype.findVisibleAds=function($parent,adSelector,topBound,bottomBound){var $allContentAds,adElsInViewport,visibleAdIds;return null==topBound&&(topBound=this.app.sizes.headerHeight),null==bottomBound&&(bottomBound=this.app.$body.height()),$allContentAds=$parent.find(adSelector),adElsInViewport=$allContentAds.filter(function(_this){return function(i,el){var found;return found=_this.isSlickActive(el),found&&(found=_this.isVisible($parent,el,topBound,bottomBound)),found}}(this)),visibleAdIds=_.map(adElsInViewport,function(adEl){return adEl.id})},Mediator.prototype.isSlickActive=function(el){var $el;return $el=$(el),!$el.closest(".slick-slider").length||($el.hasClass("slick-active")||$el.closest(".slick-active").length)},Mediator.prototype.isVisible=function($parent,child,topBound,bottomBound){var elRect,isAboveBottom,isBelowTop,isBottomVisible,isPartiallyAboveBottom,isPartiallyBelowTop,isTopVisible;return null==topBound&&(topBound=this.app.sizes.headerHeight),null==bottomBound&&(bottomBound=this.app.$body.height()),child instanceof jQuery&&(child=child.get(0)),elRect=child.getBoundingClientRect(),isPartiallyAboveBottom=elRect.top<=bottomBound,isBelowTop=elRect.top-topBound>=0,isTopVisible=isPartiallyAboveBottom&&isBelowTop,isPartiallyBelowTop=elRect.bottom-topBound>=0,isAboveBottom=elRect.bottom<=bottomBound,isBottomVisible=isPartiallyBelowTop&&isAboveBottom,isTopVisible||isBottomVisible||this.isFullyVisible($parent,child,topBound,bottomBound)},Mediator.prototype.isFullyVisible=function($parent,child,topBound,bottomBound){var elRect,isAboveBottom,isBelowTop,isCovering;return null==topBound&&(topBound=this.app.sizes.headerHeight),null==bottomBound&&(bottomBound=this.app.$body.height()),child instanceof jQuery&&(child=child.get(0)),elRect=child.getBoundingClientRect(),isBelowTop=elRect.top-topBound>=0,isAboveBottom=elRect.bottom<=bottomBound,isCovering=elRect.top<topBound&&elRect.bottom>bottomBound,isBelowTop&&isAboveBottom||isCovering},Mediator.prototype.nativoOnAnyModelAdded=function(articleModel){var collection,indexOfModelBeforeNativo,isSpot;if(!articleModel.isNativo()&&(collection=articleModel.collection,null!=collection&&!this.isState(this.NATIVO_DISABLED_PAGETYPES))){if(isSpot=this.isNativoSpot(collection)||"sponsored"===this._nativoSkip){if(articleModel.isSponsored())return console.debug("tile is sponsored, not adding nativo yet",articleModel.get("title")),void(this._nativoSkip="sponsored");"sponsored"===this._nativoSkip&&(console.debug("skipped sponsored tile, adding nativo after",articleModel.get("title")),this._nativoSkip="")}isSpot&&(indexOfModelBeforeNativo=collection.indexOf(articleModel),this.nativoTilePrevIndices.push(indexOfModelBeforeNativo),Time.trigger("nativo:request"),this.checkNativoList(collection))}},Mediator.prototype.checkNativoList=function(collection){var articleData,newNativoModelIndex;this.nativoTilePrevIndices.length&&this.nativoCount!==this.nativoTilePrevIndices.length&&(newNativoModelIndex=this.nativoTilePrevIndices[this.nativoCount]+1,articleData=_.last(this.peers.nativo.articles),null==collection&&(collection=this.app.active_rail),collection.add(articleData,{at:newNativoModelIndex}))},Mediator.prototype.isNativoSpot=function(collection){return!(null==collection||!collection.view)&&collection.view.regularTileViewsRendered%this.peers.nativo.FREQUENCY===this.peers.nativo.OFFSET},Mediator.prototype.nativoRequestData=function(){return this.isNativoLoading?(window.clearTimeout(this._nativoWaitUntilRenderableTimeout),void(this._nativoWaitUntilRenderableTimeout=window.setTimeout(function(_this){return function(){return _this.nativoRequestData()}}(this),this.peers.nativo.RETRY_DELAY))):(this.isNativoLoading=!0,this.peers.tgx.activateAd(null,{id:"nativo-trigger",size:this.app.adSizes.nativo,position:this.peers.nativo.totalTiles,isTrigger:!0,group:"nativo"}),void(this.peers.nativo.totalTiles+=1))},Mediator.prototype.nativoOnArchiveLoaded=function(articles,response){console.debug("nativo archive models loaded",articles),this.isNativoLoading=!1,this.app.active_rail.add(articles),this.app.active_rail.reached_page_limit()},Mediator.prototype.nativoOnArticleLoaded=function(articles,response){console.debug("single nativo article model loaded",articles),this.isNativoLoading=!1,this.checkNativoList()},Mediator.prototype.tgxOnLeftRailScroll=function(railView){null==railView&&(railView=this.app.getRailView()),!this.peers.tgx.isInitialAdCycle&&(null!=railView?railView.isRailOpen:void 0)&&this.tgxRefreshNewVisibleAds(railView)},Mediator.prototype.tgxRefreshNewVisibleAds=function(railView){var $placeholderEls,newAdModels,newAndVisibleAdIds,newAndVisibleAdModels,visibleAdPositions;newAdModels=this.peers.tgx.collection.filter(function(adModel){return!adModel.get("isRendered")}),newAdModels.length&&($placeholderEls=railView.getIdsOfVisibleAdPlaceholders(),visibleAdPositions=_.map($placeholderEls,function(adEl){return $(adEl).attr("pos")}),newAndVisibleAdModels=_.filter(newAdModels,function(adModel){var ref;return ref=adModel.get("position"),indexOf.call(visibleAdPositions,ref)>=0}),newAndVisibleAdModels.length&&(newAndVisibleAdIds=_.pluck(newAndVisibleAdModels,"id"),newAndVisibleAdIds.length&&this.peers.tgx.refreshAds(null,newAndVisibleAdIds)))},Mediator.prototype.tgxRefreshNewVisibleAdsStream=function(){var app,newAdModels,newAndVisibleAdIds,newAndVisibleAdModels;newAdModels=this.peers.tgx.collection.filter(function(adModel){return!adModel.get("isRendered")&&!!adModel.get("refreshOnPercentVisible")}),newAdModels.length&&(app=this.app,newAndVisibleAdModels=_.filter(newAdModels,function(adModel){var $adDiv,isVisible,notClipperHidden;return $adDiv=$("#"+adModel.get("id")),isVisible=app.getPercentVisible($adDiv.get(0).getBoundingClientRect())>=adModel.get("refreshOnPercentVisible"),notClipperHidden=!$adDiv.hasClass("clipper--hidden"),isVisible&&notClipperHidden}),newAndVisibleAdIds=_.pluck(newAndVisibleAdModels,"id"),newAndVisibleAdIds.length&&this.peers.tgx.refreshAds(null,newAndVisibleAdIds))},Mediator.prototype.isMetAdFrequency=function(tileIndex,adFrequency,adOffset){return!!tileIndex&&tileIndex%adFrequency===adOffset},Mediator.prototype.tgxRenderLeftRailAd=function(adId,isImmediate){null==isImmediate&&(isImmediate=!1),this.app.isRailOpen&&(this.peers.tgx.model.get("isInitialLeftRailCycle")||(console.debug("-- tgxRenderLeftRailAd -- not initial, refresh ",adId),this.peers.tgx.refreshAds(this.app.model.get("activeArticle"),[adId],isImmediate)))},Mediator.prototype.activateAdhesionAd=function(articleModel){var adId,adParams;return null==articleModel&&(articleModel=null),"mobile"!==Time.device?[]:(adId="adhesion-ad",$("#"+adId).length>0?[adId]:(this.$adhesionAd=$("<div />",{id:adId}).appendTo("body"),adParams={id:adId,size:Time.application.adSizes["adhesion-ad"],position:"1",group:"adhesion"},this.peers.tgx.activateAd(articleModel,adParams)?(this.adhesionAdVisibleTime=0,[adId]):[]))},Mediator.prototype.activateSectionSubAd=function(articleModel){var adId,adParams,isOnDynamicHeaderSubAdPage,isOnSectionSubAdPage,options,placeholderId,position,ref,ref1;return null==articleModel&&(articleModel=null),this.isSectionSubAdActivated?[]:(ref=this.app.getPageType(),isOnSectionSubAdPage=indexOf.call(this.app.adPlacements.sectionSubAd,ref)>=0,ref1=this.app.getPageType(),isOnDynamicHeaderSubAdPage=indexOf.call(this.app.adPlacements.dynamicHeaderSubAd,ref1)>=0,isOnSectionSubAdPage||isOnDynamicHeaderSubAdPage?(adId="section-sub-ad",placeholderId=adId,position=1,isOnDynamicHeaderSubAdPage&&(position="globalheaderleft"),"mobile"!==Time.device&&(adId="section-sub-ad--actual",placeholderId="section-sub-ad",options={id:adId,class:"left-rail-ad","data-ad_placeholder_id":placeholderId,pos:position},this.tetheredSectionSubAdView=new Time.views.LeftRailAd(options)),adParams={id:adId,size:Time.application.adSizes.sub,position:position,group:"leftRailTop",subgroup:"section",isTethered:"desktop"===Time.device,tetherTo:placeholderId},this.peers.tgx.activateAd(articleModel,adParams)?(this.isSectionSubAdActivated=!0,[adId]):[]):[])},Mediator.prototype.deleteSectionSubAd=function(){var ref;"desktop"===Time.device?(null!=(ref=this.tetheredSectionSubAdView)&&ref.destroy(),this.tetheredSectionSubAdView=null,this.peers.tgx.deleteAd("section-sub-ad--actual")):this.peers.tgx.deleteAd("section-sub-ad"),this.isSectionSubAdActivated=!1},Mediator.prototype.tgxCreateLeftRailAd=function($placeholder){var adId,adParams,placeholderId,pos;return placeholderId=$placeholder.attr("id"),pos=$placeholder.attr("pos"),adId=placeholderId,adParams={size:this.app.adSizes["left-rail"],position:pos,group:"leftRail"},adParams.id=adId,this.peers.tgx.activateAd(null,adParams)},Mediator.prototype.tgxHidePlaceholderCallback=function(adModel){var $ad,$placeholder,isHidden,placeholderId;return"desktop"!==Time.device||($ad=$("#"+adModel.id),!$ad.length||(placeholderId=adModel.get("tetherTo"),$placeholder=$("#"+placeholderId),!$placeholder.length||(isHidden=$ad.hasClass("hide-ad"),$placeholder.toggleClass("hide-ad",isHidden),Tether.position(),isHidden)))},Mediator.prototype.tgxLeftRailAdCallback=function(adModel){var $actualAd,$ad,$placeholder,actualAdHeight,done,foundHeight,isActionNeeded,placeholderId,railView;if(isActionNeeded=this.tgxHidePlaceholderCallback(adModel),!isActionNeeded){if($ad=$("#"+adModel.id),placeholderId=adModel.get("tetherTo"),$placeholder=$("#"+placeholderId),railView=this.app.getRailView(),$actualAd=$ad,actualAdHeight=$actualAd.height())return void $placeholder.height(actualAdHeight+20);$actualAd=null,done=!1,foundHeight=0,$ad.children().each(function(){var $child,childHeight;return $child=$(this),childHeight=$child.height(),childHeight>foundHeight?(foundHeight=childHeight,!1):($child.children().each(function(){var $subchild,subchildHeight;if($subchild=$(this),subchildHeight=$subchild.height(),subchildHeight>foundHeight)return foundHeight=subchildHeight,done=!0,!1}),!done&&void 0)}),$placeholder.height(foundHeight+20)}},Mediator.prototype.getTileIndex=function(articleModel){return null!=articleModel.collection?articleModel.collection.indexOf(articleModel):null!=articleModel.realIndex&&articleModel.realIndex},Mediator.prototype.tgxOnLeftRailTileRendered=function(renderedTileView,railView){var collection;if(renderedTileView.model&&(railView||(collection=renderedTileView.collection,railView=collection.view),railView)){if(renderedTileView.model.get("is_nativo")||(railView.regularTileViewsRendered+=1),"collections"===renderedTileView.type)return this.maybeAppendAdToCollectionLeftRail(renderedTileView,railView);this.maybeAppendAd(renderedTileView,railView),this.app.featureToggles.chivasTiles&&!this.app.isMoney()&&this.maybeAppendChivas(renderedTileView,railView)}},Mediator.prototype.maybeAppendAdToCollectionLeftRail=function(precedingTileView,railView){var collection,indexPromise,ref,ref1,tileModel;return(null!=(ref=Time.bootstrap)&&null!=(ref1=ref.collection)?ref1.left_rail_top_ad:void 0)?void this.tgxRefreshNewVisibleAds(railView):void(railView.totalLeftRailAds>=railView._maxAds||(tileModel=precedingTileView.model,tileModel&&(tileModel.get("isIntro")||tileModel.get("isSeed")||(collection=tileModel.collection,indexPromise=collection.promiseCrosshubIndex(tileModel),indexPromise.fail(function(result){return"undefined"!=typeof console&&null!==console?console.error(result):void 0}),indexPromise.done(function(_this){return function(tileIndex){_this.appendAdToCollectionLeftRail(precedingTileView,tileIndex,railView)&&_this.tgxRefreshNewVisibleAds(railView)}}(this))))))},Mediator.prototype.appendAdToCollectionLeftRail=function(precedingTileView,tileIndex,railView){var $placeholder,adFrequency,adModel,adOffset,base,notificationData;if(!(railView.totalLeftRailAds>=railView._maxAds))return adFrequency=railView.adFrequency,adOffset=railView.adOffset[Time.device],tileIndex===adOffset&&($placeholder=railView.appendAd(precedingTileView.el),this.peers.tgx.isInitialAdCycle||(adModel=this.tgxCreateLeftRailAd($placeholder)),notificationData={message:"Ad Appended",id:$placeholder.attr("id"),index:$placeholder.attr("pos")},railView.adsPromise.notify(notificationData),null!=precedingTileView.hub&&adModel&&((base=precedingTileView.hub).adModels||(base.adModels=[]),precedingTileView.hub.adModels.push(adModel)),railView.totalLeftRailAds+=1,!0)},Mediator.prototype.maybeAppendAd=function(precedingTileView,railView){var adOffset,collection,collectionLength,isFewModels,isLastTile,tileIndex;if(!(railView.totalLeftRailAds>=railView._maxAds))return collection=precedingTileView.collection,collectionLength=collection.length,tileIndex=this.getTileIndex(precedingTileView.model),adOffset=railView.adOffset[Time.device],this.isMetAdFrequency(tileIndex,railView.adFrequency,adOffset)?void(this.appendAdAfterTile(railView)&&(this.peers.tgx.isInitialAdCycle||this.tgxRefreshNewVisibleAds(railView))):void("collections"!==precedingTileView.type&&"popular"!==collection.active_env&&(isFewModels=collectionLength<railView.adFrequency+adOffset,isFewModels&&(isLastTile=tileIndex===collectionLength-1,isLastTile&&this.appendAdAfterTile(railView)&&(this.peers.tgx.isInitialAdCycle||this.tgxRefreshNewVisibleAds(railView)))))},Mediator.prototype.maybeAppendChivas=function(precedingTileView,railView){var desiredChivasIndex,precedingTileIndex;this.chivasCount!==this.CHIVAS_LIMIT&&(this.isState(this.CHIVAS_DISABLED_PAGETYPES)||(precedingTileIndex=this.getTileIndex(precedingTileView.model),desiredChivasIndex=precedingTileIndex+1,this.isMetAdFrequency(desiredChivasIndex,this.CHIVAS_FREQUENCY,this.CHIVAS_OFFSET)&&this.appendChivas(precedingTileView)))},Mediator.prototype.appendChivas=function(precedingTileView){var adId,appendAfterEl,data,lrmoduleHtml,tileHtml;appendAfterEl=precedingTileView.el,appendAfterEl&&(data=_.extend(this.CHIVAS_DATA[this.chivasCount],{is_chivas:!0}),tileHtml=Time.templates["article-tile-sponsored"].render(data),this.chivasCount+=1,lrmoduleHtml=Time.templates["lrm-chivas"].render({index:this.chivasCount,tileHtml:tileHtml}),$(lrmoduleHtml).insertAfter(appendAfterEl),adId="ChivasLeftRailModule--"+this.chivasCount+"__ad",this.peers.tgx.activateAd(null,{id:adId,size:["1x1"],position:this.chivasCount,group:"chivasTile",renderOnce:!0})&&this.peers.tgx.refreshAds(null,[adId]))},Mediator.prototype.appendAdAfterTile=function(railView){var $appendAfterEls,$placeholder,adOffset,adPosition,appendAfterEl,notificationData;if(!(railView.totalLeftRailAds>=railView._maxAds))return $appendAfterEls=$("#rail-articles").find(this.AD_ALLOWED_AFTER.join(",")),!!$appendAfterEls.length&&(adOffset=railView.adOffset[Time.device],adPosition=0===railView.totalLeftRailAds&&railView.tileViews.length<=adOffset?railView.tileViews.length-1:railView.totalLeftRailAds*railView.adFrequency+adOffset,appendAfterEl=$appendAfterEls.get(adPosition),null!=appendAfterEl&&($placeholder=railView.appendAd(appendAfterEl),this.peers.tgx.isInitialAdCycle||this.tgxCreateLeftRailAd($placeholder),notificationData={message:"Ad Appended",id:$placeholder.attr("id"),index:$placeholder.attr("pos")},railView.adsPromise.notify(notificationData),railView.totalLeftRailAds+=1,!0))},Mediator.prototype.syncWithLeftRail=function(articleModel,syncIds,callback){var adIds,ref;if(null==syncIds&&(syncIds=[]),null==callback&&(callback=!1),adIds=[],this.app.model.get("isFullscreen")||(adIds=null!=(ref=this.app.getRailView())?ref.getIdsOfVisibleAds():void 0),adIds=adIds.concat(syncIds),0!==adIds.length)return this.peers.tgx.refreshAds(articleModel,adIds,callback)},Mediator.prototype.activatePushdownAd=function(articleModel){var adSize,position;return null==articleModel&&(articleModel=null),this.app.is_homepage?(adSize=this.app.adSizes["homepage-pushdown"],position="1"):(adSize=this.app.adSizes.pushdown,position="0"),this.peers.tgx.activateAd(articleModel,{id:"pushdown-ad",size:adSize,position:position,group:"pushdown"})},Mediator.prototype.onArticleActivated=function(articleView){var adDivIds,articleModel,ref;articleModel=articleView.model,"nativo_archive"!==("undefined"!=typeof TIME_DFP&&null!==TIME_DFP?TIME_DFP.ch:void 0)&&this.peers.tgx.model.maybeResetFactory(articleModel),adDivIds=[],"money"===Time.bootstrap.branding&&"desktop"===Time.device&&(adDivIds=adDivIds.concat(this.activateMoneyCMAd(articleView))),null!=(ref=this.app.getRailView())&&ref.adsPromise.progress(function(_this){return function(progress){if(progress.index<=1)return adDivIds=adDivIds.concat(Time.Ad.activate_ads(articleModel)),adDivIds=adDivIds.concat(_this.activateAdhesionAd(articleModel)),adDivIds=adDivIds.concat(_this.activateAboveDividerAd(articleView)),Time.application.getRailView().isRailOpen&&(_this.tgxCreateLeftRailAd($("#"+progress.id)),adDivIds=adDivIds.concat(progress.id)),adDivIds=adDivIds.concat(_this.activateHeaderAd(articleView)),adDivIds=adDivIds.concat(_this.activateRightRailAd(articleView)),"mobile"===Time.device&&_this.activateContentAds(articleView),
adDivIds=adDivIds.concat(_this.activateBelowDividerAd(articleView)),"mobile"!==Time.device&&(adDivIds=adDivIds.concat(_this.activateGumGumAd(articleView))),_this.activateVideoAd()&&(adDivIds=adDivIds.concat(_this.activateBelowGumGumAd(articleView))),_this.peers.tgx.refreshAds(articleModel,adDivIds)}}(this)),"desktop"===Time.device&&"topic"===this.app.getPageType()&&$(".top-banner__ad").css("display","block"),"mobile"===Time.device&&("http://time.com"===Time.home_url&&4264746===Time.bootstrap.single_article.id&&this.refreshAdhesionOnTIME100(),"http://staging.time.com"===Time.home_url&&3054649===Time.bootstrap.single_article.id&&this.refreshAdhesionOnTIME100())},Mediator.prototype.activateMoneyCMAd=function(articleView){var params;return"money"!==Time.bootstrap.branding?[]:"desktop"!==Time.device?[]:(params={group:"subAd",id:"money-cm-banner",size:Time.application.adSizes["money-homepage-cm-banner"],position:1,cmpos:"globalheadermny",cmtyp:"tout",renderOnce:!0,isCmAd:!0},this.peers.tgx.activateAd(articleView.model,params)?(this.isSubAdRenderedForRail=!0,["money-cm-banner"]):[])},Mediator.prototype.onArticleDeactivated=function(articleView){return this.deactivateAboveDividerAd(articleView),this.deactivateBelowDividerAd(articleView),this.deactivateContentAds(articleView),this.deactivateRightRailAd(articleView),this},Mediator.prototype.activateSubAd=function(articleView){var params,ref,tetherOptions,tetheredSubAd;if(!this.isSubAdRenderedForRail)return null!=Time.page?[]:(ref=this.app.getPageType(),indexOf.call(this.app.adPlacements.subAd,ref)<0?[]:(params={id:"sub-ad",size:this.app.adSizes["sub-cm"],cmpos:"globalheader",cmtyp:"tout",group:"subAd",renderOnce:!0,isCmAd:!0},this.app.isMoney()&&(params.cmpos="globalheadermny"),this.app.isDynamicHeaderEnabled&&this.app.isDynamicHeaderLeftRailAdEnabled&&(tetherOptions={id:"sub-ad",class:"left-rail-ad","data-cb-ad-id":"sub-ad","data-ad_placeholder_id":"sub-ad-placeholder",pos:"globalheaderleft"},tetheredSubAd=new Time.views.LeftRailAd(tetherOptions),params.cmpos="globalheaderleft",params.size=["300x50"],params.isTethered=!0,params.tetherTo="sub-ad-placeholder"),this.peers.tgx.activateAd(articleView.model,params)?(this.isSubAdRenderedForRail=!0,["sub-ad"]):[]))},Mediator.prototype.activateVideoAd=function(){var $adBrightcoveVideo,$outbrainContent,ref,ref1;return"mobile"===Time.device||($adBrightcoveVideo=$(".ad_brightcove_video"),$outbrainContent=$(".article-footer .OUTBRAIN"),!((null!=$adBrightcoveVideo&&null!=(ref=$adBrightcoveVideo.offset())?ref.top:void 0)+350>(null!=$outbrainContent&&null!=(ref1=$outbrainContent.offset())?ref1.top:void 0)))},Mediator.prototype.activateHeaderAd=function(articleView){var collectionMeta,headerAdParams;return collectionMeta=articleView.model.get("collection_meta"),"next-generation-leaders"===(null!=collectionMeta?collectionMeta.slug:void 0)&&$("#top-banner__ad").length>0?(headerAdParams={id:"top-banner__ad",position:1,size:["88x31"],group:"header"},this.peers.tgx.activateAd(articleView.model,headerAdParams)?("desktop"===Time.device&&$(".top-banner__ad").removeClass("top-banner__ad--pre-rendered"),["top-banner__ad"]):[]):[]},Mediator.prototype.activateRightRailAd=function(articleView){var params,rightRailAd;return(rightRailAd=articleView.rightRailAd)?(params={id:rightRailAd.id,position:rightRailAd.position,size:rightRailAd.size,group:rightRailAd.group,refreshOnPercentVisible:60},this.peers.tgx.activateAd(articleView.model,params)?[rightRailAd.id]:void 0):[]},Mediator.prototype.activateBelowGumGumAd=function(currentView){var belowGumgumAdParams;return belowGumgumAdParams={id:"ad_brightcove",position:1,size:this.app.adSizes["below-gum-gum-ad"],group:"contentWell"},this.peers.tgx.activateAd(currentView.model,belowGumgumAdParams)?["ad_brightcove"]:[]},Mediator.prototype.activateGumGumAd=function(articleView){var gumgumAdParams;if($("#gum-gum-ad").length>0)return gumgumAdParams={id:"gum-gum-ad",position:1,size:["1x6"],group:"contentWell"},this.peers.tgx.activateAd(articleView.model,gumgumAdParams)?["gum-gum-ad"]:[]},Mediator.prototype.deactivateRightRailAd=function(articleView){var rightRailAd;rightRailAd=articleView.rightRailAd,rightRailAd&&rightRailAd.divId&&this.peers.tgx.deleteAd(rightRailAd.divId,!1)},Mediator.prototype.activateAboveDividerAd=function(articleView){var aboveDivider,params;return(aboveDivider=articleView.aboveDivider)?(params={id:aboveDivider.divId,position:aboveDivider.position,size:aboveDivider.size,group:aboveDivider.group,subgroup:aboveDivider.subgroup},this.peers.tgx.activateAd(articleView.model,params)?[aboveDivider.divId]:[]):[]},Mediator.prototype.deactivateAboveDividerAd=function(articleView){var aboveDivider;aboveDivider=articleView.aboveDivider,aboveDivider&&aboveDivider.divId&&this.peers.tgx.deleteAd(aboveDivider.divId,!1)},Mediator.prototype.activateBelowDividerAd=function(articleView){var belowDivider,params;return(belowDivider=articleView.belowDivider)?(this.$activeDividerAd=$("#"+belowDivider.divId),"money"===Time.bootstrap.branding&&(belowDivider.position=2),"mobile"===Time.device&&(belowDivider.position=2),params={id:belowDivider.divId,position:belowDivider.position,size:belowDivider.size,group:belowDivider.group,subgroup:belowDivider.subgroup,refreshOnPercentVisible:50},this.peers.tgx.activateAd(articleView.model,params)?[belowDivider.divId]:[]):[]},Mediator.prototype.deactivateBelowDividerAd=function(articleView){var belowDivider;this.$activeDividerAd=null,belowDivider=articleView.belowDivider,belowDivider&&belowDivider.divId&&this.peers.tgx.deleteAd(belowDivider.divId,!1)},Mediator.prototype.activateContentAds=function(articleView){var $articleParagraphs,$outbrainContent,articleModel,bottomOfLastContentAd,subsequentContentAdOffset;return articleModel=articleView.model,subsequentContentAdOffset=600,$articleParagraphs=$(".article-content p"),$outbrainContent=$(".article-footer .OUTBRAIN"),this.contentAdCount=0,0===$articleParagraphs.length&&($articleParagraphs=$(".video-content p")),$articleParagraphs.each(function(_this){return function(index,el){if($(el).offset().top>600)return _this.$activeContentAd=_this.$lastContentAd=$("<div/>",{id:"content-ad-"+_this.contentAdCount,class:"content-ad-mobile","data-index":_this.contentAdCount}).insertAfter($(el)),_this.contentAdCount++,!1}}(this)),!!this.$lastContentAd&&($articleParagraphs.each(function(_this){return function(index,el){var bottomOfLastContentAd;if(bottomOfLastContentAd=_this.$lastContentAd.offset().top+_this.$lastContentAd.outerHeight(!0),$(el).offset().top-bottomOfLastContentAd>subsequentContentAdOffset)return _this.$lastContentAd=$("<div/>",{id:"content-ad-"+_this.contentAdCount,class:"content-ad-mobile","data-index":_this.contentAdCount}).insertAfter($(el)),_this.contentAdCount++}}(this)),this.lastItem=this.contentAdCount-1,bottomOfLastContentAd=this.$lastContentAd.offset().top+this.$lastContentAd.outerHeight(!0),bottomOfLastContentAd+300>$outbrainContent.offset().top&&$("#content-ad-"+this.lastItem).remove(),this.$contentAds=$(".content-ad-mobile"),void $(".content-ad-mobile").each(function(_this){return function(index,el){return _this.peers.tgx.activateAd(articleModel,{id:$(el).attr("id"),position:index+1,size:_this.app.adSizes["content-ad"],group:"contentWell",subgroup:"inContent",refreshOnPercentVisible:50})}}(this)))},Mediator.prototype.deactivateContentAds=function(articleView){var contentWellAds;contentWellAds=this.peers.tgx.collection.where({group:"contentWell",subgroup:"inContent"}),_.invoke(contentWellAds,"set",{isActive:!1})},Mediator.prototype.onChangeGallerySlide=function(galleryModel,articleView){var adDivIds;if(!(null!=articleView.galleriesCollection&&null!=articleView._galleriesRendered&&articleView._galleriesRendered<articleView.galleriesCollection.size()))return adDivIds=this.peers.tgx.collection.getIds({isActive:!0,isTrigger:!1,groups:["gallery"]}),adDivIds.push("gum-gum-ad"),this.throttledSyncWithLeftRail(articleView.model,adDivIds),this},Mediator.prototype.throttledSyncWithLeftRail=_.throttle(function(model,adDivIds){return this.syncWithLeftRail(model,adDivIds)},4e3),Mediator.prototype.isLongListFormat=function(articleModel){var LIMIT;return LIMIT=2,"list"===articleModel.get("format")&&"gallery"!==articleModel.get("listFormat")?articleModel.get("list_items").length>LIMIT:"gallery"===articleModel.get("format")&&"vertical"===articleModel.get("gallery").size&&articleModel.get("gallery").photos>LIMIT},Mediator.prototype.getListItemSelector=function(articleModel){return"list"===articleModel.get("format")?".article-item":"gallery"===articleModel.get("format")&&"vertical"===articleModel.get("gallery").size?".galleryVertical__slide--image":""},Mediator.prototype.tgxReloadLeftRailAdsWhenScrollPastFourthListItem=function(articleModel){var $fourthItem,fourthItemOffset,isFourthItemAtTop,isPastFourthItem,listItems,offsetPadding;listItems=articleModel.get("list_items"),listItems.length<4||($fourthItem=articleModel.views.singleView.$('[data-index="'+listItems[3].id+'"]'),$fourthItem.length>0&&(offsetPadding=70,fourthItemOffset=$fourthItem.offset(),isFourthItemAtTop=fourthItemOffset.top>offsetPadding,isPastFourthItem=fourthItemOffset.top-offsetPadding<this.app.$notHeader.get(0).scrollTop,isFourthItemAtTop&&isPastFourthItem&&this.syncWithLeftRail(articleModel,[])))},Mediator.prototype.checkPassedListItems=function(articleModel){var $listItems,$oldLastPassedListItem,$passedItems,articleView,totalPassed;return!!this.isLongListFormat(articleModel)&&(articleView=articleModel.views.singleView,$listItems=articleView.$(this.getListItemSelector(articleModel)),$passedItems=$listItems.filter(function(_this){return function(index,el){var $item;return $item=$(el),$item.offset().top+$item.outerHeight(!1)-_this.app.$main_header.outerHeight(!0)<=0}}(this)),!!(totalPassed=$passedItems.length)&&($oldLastPassedListItem=this.$lastPassedListItem,this.$lastPassedListItem=$listItems.eq(totalPassed-1),$oldLastPassedListItem&&this.$lastPassedListItem.data("index")===$oldLastPassedListItem.data("index")?(console.debug("passed "+this.LIST_AD_REFRESH_FREQUENCY+" items, at ",totalPassed," but was old"),!1):totalPassed%this.LIST_AD_REFRESH_FREQUENCY===0&&(console.debug("passed "+this.LIST_AD_REFRESH_FREQUENCY+" items, at ",totalPassed," -- new last passed item"),!0)))},Mediator.prototype.omnitureOnPassedListItems=function(articleModel){articleModel.set("userAction","listItems"),Time.Tracking.article_view(articleModel.toJSON())},Mediator.prototype.injectListAds=function(articleModel){var $articleItem,adIndex,adSizes,articleId,articleView,ref,ref1,totalListItems;articleModel.get("ads")&&"tragedy"===articleModel.get("ads").neg||(articleView=null!=(ref=articleModel.views)?ref.singleView:void 0,articleView&&(null!=(ref1=articleView.listAds)&&ref1.length||(articleId=articleModel.id,adSizes=this.getListAdSizes(articleModel),articleView.listAds=[],adIndex=1,$articleItem=articleView.$(".article-item"),totalListItems=$articleItem.length,$articleItem.each(function(_this){return function(i,el){var adHtml,adId,index,isLastSlide;index=i+1,isLastSlide=index===totalListItems,isLastSlide||_this.isMetAdFrequency(index,_this.LIST_AD_FREQUENCY,0)&&(adId="list_ad_"+articleId+"_"+adIndex,adHtml=Time.templates["list-ad"].render({id:adId}),$(adHtml).insertAfter(el),articleView.listAds.push({id:adId,size:adSizes,position:adIndex,group:"list",slide:index+1,isActive:!1}),adIndex+=1)}}(this)))))},Mediator.prototype.getListAdSizes=function(articleModel){var adSizes,ref;return adSizes=["300x250"],"top-10-everything-of-2014"===(null!=(ref=articleModel.get("collection_meta"))?ref.ad_zone:void 0)&&("desktop"===Time.device?adSizes.push("818x450"):"tablet"===Time.device&&"landscape"===this.app.orientation?(adSizes.push("818x450"),adSizes.push("616x400")):("tablet"===Time.device&&"portrait"===this.app.orientation||"mobile"===Time.device)&&adSizes.push("616x400")),adSizes},Mediator.prototype.activateListAds=function(articleModel){var activatedAds,adIds;if(null!=articleModel.views.singleView.listAds&&0!==articleModel.views.singleView.listAds.length)return activatedAds=_.filter(articleModel.views.singleView.listAds,function(_this){return function(ad){return _this.peers.tgx.activateAd(articleModel,ad)}}(this)),adIds=_.pluck(activatedAds,"id")},Mediator.prototype.toggleListAdStateByVisibility=function(articleModel){var nonvisibleAdModels,visibleAdIds,visibleAdModels;return visibleAdIds=this.findVisibleAds(articleModel.views.singleView.$el,".list_ad_div"),visibleAdModels=this.peers.tgx.collection.filter(function(adModel){var ref;return ref=adModel.id,indexOf.call(visibleAdIds,ref)>=0}),nonvisibleAdModels=this.peers.tgx.collection.filter(function(adModel){var isListAd,isNotVisible,ref;return ref=adModel.id,isNotVisible=!(indexOf.call(visibleAdIds,ref)>=0),isListAd="list"===adModel.get("group"),isListAd&&isNotVisible}),_.invoke(visibleAdModels,"set",{isActive:!0}),_.invoke(nonvisibleAdModels,"set",{isActive:!1}),visibleAdModels},Mediator.prototype.toggleListAdState=function(articleModel){var $adsAfter,adDivEls,adIds,adModels,hasEmbeddedListicles,inactiveAdModels,isGallery,ref;return isGallery="gallery"===articleModel.get("listFormat"),hasEmbeddedListicles=(null!=(ref=articleModel.views.singleView.$listicles)?ref.length:void 0)>0,isGallery||hasEmbeddedListicles?this.toggleListAdStateByVisibility(articleModel):($adsAfter=this.$lastPassedListItem?this.$lastPassedListItem.nextAll(".list_ad"):articleModel.views.singleView.$(".list_ad"),adDivEls=$adsAfter.find(".list_ad_div").get(),adIds=_.map(adDivEls,function(el){return el.id}),adModels=this.peers.tgx.collection.filter(function(adModel){var ref1;return ref1=adModel.id,indexOf.call(adIds,ref1)>=0}),_.invoke(adModels,"set",{isActive:!0}),inactiveAdModels=this.peers.tgx.collection.filter(function(adModel){var isListAd,isPassed,ref1;return ref1=adModel.id,isPassed=indexOf.call(adIds,ref1)>=0,isListAd="list"===adModel.get("group"),isListAd&&!isPassed}),_.invoke(inactiveAdModels,"set",{isActive:!1}),adModels)},Mediator.prototype.refreshListAds=function(articleModel,listAdIds){var listAdModels;listAdIds||(listAdModels=this.toggleListAdState(articleModel),0!==listAdModels.length&&(listAdIds=[_.first(listAdModels).get("id")])),Time.trigger("leftRail:syncAds",articleModel,listAdIds)},Mediator.prototype.listGallerySlideChangedPageview=function(articleModel,slider,targetIndex){var omniData;null!=articleModel&&(omniData=articleModel.toJSON(),omniData.userAction="list-gallery",Time.Tracking.article_view(omniData))},Mediator.prototype.nativoHomepageActivateAds=function(homepageView,railView){var $leftRailArticles,ref,ref1,sponsorIndex,totalSponsors;totalSponsors=null!=(ref=Time.bootstrap)&&null!=(ref1=ref.sponsors)?ref1.length:void 0,totalSponsors&&(sponsorIndex=0,$leftRailArticles=railView.$parentEl.find(".rail-article"),$leftRailArticles.each(function(_this){return function(i,el){var html,ref2,sponsorModel;i%_this.peers.nativo.FREQUENCY===_this.peers.nativo.OFFSET&&(sponsorModel=Time.bootstrap.sponsors[sponsorIndex],"vsp"===(null!=(ref2=sponsorModel.sponsor)?ref2.slug:void 0)&&(sponsorModel.sponsor_timestamp=(new Date).getTime(),html=Time.templates["article-tile-sponsored"].render(sponsorModel),$(html).insertAfter(el),sponsorIndex+=1,sponsorIndex+1>totalSponsors&&(sponsorIndex=0)))}}(this)))},Mediator.prototype.tgxHomepageActivateAds=function(homepageView,railView){var adIds;adIds=[],railView.isRailOpen&&adIds.push(this.homepageActivateLeftRailAd(homepageView,railView)),adIds="mobile"===Time.device?adIds.concat(this.mobileHomepageActivateAds(homepageView,railView)):adIds.concat(this.nonmobileHomepageActivateAds(homepageView)),"mobile"!==Time.device&&adIds.push(this.homepageActivateGumGumAd(homepageView)),this.peers.tgx.refreshAds(null,adIds,!1)},Mediator.prototype.homepageActivateLeftRailAd=function(homepageView,railView){var $leftRailArticles,$placeholder,$tileToInsertAfter,adData,adId;return $leftRailArticles=railView.$parentEl.find(".rail-article"),$tileToInsertAfter=$leftRailArticles.eq(railView.adOffset[Time.device]),$placeholder=railView.appendAd($tileToInsertAfter),adId="ad-unit-1",adData={id:adId,size:this.app.adSizes["left-rail"],position:1,group:"leftRail",subgroup:"homepage"},this.peers.tgx.activateAd(null,adData),adId},Mediator.prototype.mobileHomepageActivateAds=function(homepageView,railView){var adId,adIds,adIndex,inBriefAdId,j;for(adIds=[],inBriefAdId="ad-homepage-post-first-brief-article",this.peers.tgx.activateAd(null,{id:inBriefAdId,size:["300x250"],position:1,group:"contentWell",subgroup:"homepage"})&&adIds.push(inBriefAdId),railView.isRailOpen&&this.peers.tgx.activateAd(null,{id:"sub-ad-head",size:this.app.adSizes["homepage-cm-banner"],position:"globalheader",type:"tout",isCmAd:!0})&&adIds.push("sub-ad-head"),adIndex=j=1;j<=3;adIndex=j+=1)adId="ad-homepage-content-well-"+adIndex,this.peers.tgx.activateAd(null,{id:adId,size:this.app.adSizes["homepage-content-well"],position:adIndex+1,group:"contentWell",subgroup:"homepage"})&&adIds.push(adId);return adIds},Mediator.prototype.nonmobileHomepageActivateAds=function(homepageView){var adIds,bannerParams,contentWellAdSizeName,ref,tetherOptions,tetheredHomeBannerAd;return adIds=[],contentWellAdSizeName="homepage-content-well","undefined"!=typeof vertical&&null!==vertical&&(contentWellAdSizeName=vertical+"-"+adSizeLabel),this.peers.tgx.activateAd(null,{id:"ad-homepage-content-well",size:this.app.adSizes[contentWellAdSizeName],position:1,group:"contentWell",subgroup:"homepage",refreshOnPercentVisible:90}),(null!=(ref=Time.page)?ref.isMarketDataEnabled:void 0)&&this.peers.tgx.activateAd(null,{id:"market-data-sponsor",size:this.app.adSizes["market-data-sponsor"],position:1,group:"sponsor"})&&adIds.push("market-data-sponsor"),this.peers.tgx.activateAd(null,{id:"ad-homepage-post-brief",size:this.app.adSizes["homepage-cm-brief"],position:"blwbriefsubhp",type:"tout",isCmAd:!0})&&adIds.push("ad-homepage-post-brief"),bannerParams={id:"home-banner-ad",size:this.app.adSizes["homepage-cm-banner"],cmpos:"globalheader",cmtyp:"tout",isCmAd:!0},this.app.isDynamicHeaderEnabled&&this.app.isDynamicHeaderLeftRailAdEnabled&&(tetherOptions={id:"home-banner-ad",class:"left-rail-ad","data-ad_placeholder_id":"home-banner-ad-placeholder",pos:"globalheaderleft"},tetheredHomeBannerAd=new Time.views.LeftRailAd(tetherOptions),bannerParams.size=["300x50"],bannerParams.cmpos=null,bannerParams.position="globalheaderleft",bannerParams.cmtyp=null,bannerParams.type="tout",bannerParams.isCmAd=!1,bannerParams.isTethered=!0,bannerParams.tetherTo="home-banner-ad-placeholder"),($("#home-banner-ad").length>0&&"time"!==Time.branding||"mobile"===Time.device)&&this.peers.tgx.activateAd(null,bannerParams)&&adIds.push("home-banner-ad"),this.app.currentBreakpoint>=1024&&(Time.trigger("pushdown:activate"),adIds.push("pushdown-ad")),adIds},Mediator.prototype.homepageActivateGumGumAd=function(homepageView){var adIds;return adIds=[],"mobile"!==Time.device&&this.peers.tgx.activateAd(null,{id:"gum-gum-ad",size:["1x6"],position:1,group:"contentWell"})&&adIds.push("gum-gum-ad"),adIds},Mediator.prototype.specialStoryActivateAds=function(specialPageView){var adIds,notLogged;adIds=[],notLogged=$("#super-template-paywall-slot").length>0,notLogged?(this.setLMPCookie(),adIds=this.activateSuperTemplateAd(specialPageView)):$("#special-story-banner-ad").length>0&&(adIds=this.activateSpecialStoryBannerAd(specialPageView)),adIds=adIds.concat(this.ssSpecialStoryShortcodeAds(specialPageView)),adIds=adIds.concat(this.activateSpecialStoryCmAds(specialPageView)),adIds=adIds.concat(this.activateSpecialStoryGumGumAd(specialPageView)),this.peers.tgx.refreshAds(null,adIds,!1)},Mediator.prototype.activateSpecialStoryBannerAd=function(){var adIds;return adIds=[],this.peers.tgx.activateAd(null,{id:"special-story-banner-ad",size:this.app.adSizes["special-article-logo"],position:1})&&adIds.push("special-story-banner-ad"),adIds},Mediator.prototype.activateSpecialStoryGumGumAd=function(){var adIds;return adIds=[],this.peers.tgx.activateAd(null,{id:"gum-gum-ad",size:["1x6"],position:1})&&adIds.push("gum-gum-ad"),adIds},Mediator.prototype.activateSpecialStoryBelowGumGumAd=function(){var adIds;return adIds=[],this.peers.tgx.activateAd(null,{id:"below-gum-gum-ad",size:this.app.adSizes["below-gum-gum-ad"],position:1,group:"contentWell"})&&adIds.push("below-gum-gum-ad"),adIds},Mediator.prototype.activateSuperTemplateAd=function(){var adIds;return adIds=[],this.peers.tgx.activateAd(null,{id:"super-template-paywall-slot",size:["1x1"],position:1,cmpos:"pywllnolagate",cmtyp:"tout",isCmAd:!0})&&adIds.push("super-template-paywall-slot"),adIds},Mediator.prototype.activateSpecialStoryCmAds=function(){var $cmSubscribeAboveAd,adId,adIds,hasCmAd,hasCmSubscribeAboveAd,hasCmSubscribeAd,id;return adIds=[],id=Time.bootstrap.postID,id||(id=0),adId="dfpCmadParentsSubscribeabv"+id,$cmSubscribeAboveAd=$("#"+adId),hasCmSubscribeAboveAd=$cmSubscribeAboveAd.length>0,hasCmSubscribeAboveAd&&this.peers.tgx.activateAd(null,{id:adId,size:this.app.adSizes.parents__subscribeabv,position:"subscribeabv",type:"tout",isCmAd:!0})&&adIds.push(adId),hasCmAd=$("#magazine-cm-module-"+id).length>0,hasCmAd&&this.peers.tgx.activateAd(null,{id:"magazine-cm-module-"+id,size:this.app.adSizes["magazine-cm-module"],position:"submodule",type:"tout",isCmAd:!0})&&adIds.push("magazine-cm-module-"+id),hasCmSubscribeAd=$("#magazine-cm-subscribe-bottom-"+id).length>0,hasCmSubscribeAd&&this.peers.tgx.activateAd(null,{id:"magazine-cm-subscribe-bottom-"+id,size:this.app.adSizes["magazine-cm-subscribe"],position:"subscribeblw",type:"tout",isCmAd:!0})&&adIds.push("magazine-cm-subscribe-bottom-"+id),adIds},Mediator.prototype.ssActivateVisibleSpecialStoryShortcodeAds=function(specialPageView){var adIds;if(adIds=[],null!=specialPageView)return $(".special-article-ad").each(function(_this){return function(index,el){var $ad,sizeKey;if(_this.isVisible(specialPageView.$specialStory,el,specialPageView.headerBottom)&&($ad=$(el),!$ad.data("adState")))return $ad.data("adState","initialized"),sizeKey="special-article-"+$ad.data("size"),_this.peers.tgx.activateAd(null,{id:el.id,size:_this.app.adSizes[sizeKey],position:$ad.data("pos")})?adIds.push(el.id):void 0}}(this)),adIds},Mediator.prototype.ssSpecialStoryShortcodeAds=function(specialPageView){var adIds;return adIds=[],$(".special-article-ad").each(function(_this){return function(index,el){var $ad,sizeKey;if($ad=$(el),$ad.data("adState","initialized"),sizeKey="special-article-"+$ad.data("size"),_this.peers.tgx.activateAd(null,{id:el.id,size:_this.app.adSizes[sizeKey],position:$ad.data("pos")}))return adIds.push(el.id)}}(this)),adIds},Mediator.prototype.ssActivateNewAdsOnScroll=function(){var adIdsToRefresh,newVisibleAdIds,specialPageView;if(specialPageView=Time.page,newVisibleAdIds=this.ssActivateVisibleSpecialStoryShortcodeAds(specialPageView),null!=newVisibleAdIds?newVisibleAdIds.length:void 0)return adIdsToRefresh=["special-story-banner-ad"].concat(newVisibleAdIds),this.peers.tgx.refreshAds(null,adIdsToRefresh,!1)},Mediator.prototype.isSsAdRefreshNeeded=function(specialPageView,direction,difference){var lpm,refreshDifference;return lpm=specialPageView.lastPassedMarker,lpm!==this.ssLastRefreshMarker&&(refreshDifference=lpm>this.ssLastRefreshMarker?lpm-this.ssLastRefreshMarker:this.ssLastRefreshMarker-lpm,"up"===direction&&(refreshDifference-=this.SS_AD_REFRESH_FREQUENCY),!(refreshDifference<this.SS_AD_REFRESH_FREQUENCY)&&(this.ssLastRefreshMarker=lpm,!0))},Mediator.prototype.ssRefreshAds=function(specialPageView,direction,difference){var adIdsToRefresh,visibleAds;this.isSsAdRefreshNeeded(specialPageView,direction,difference)&&(visibleAds=this.findVisibleAds(specialPageView.$specialStory,".special-article-ad",specialPageView.headerBottom),visibleAds=_.filter(visibleAds,function(adId){var $ad,adState;return $ad=$("#"+adId),adState=$ad.data("adState"),"initialized"!==adState||($ad.data("adState","refreshable"),!1)}),(null!=visibleAds?visibleAds.length:void 0)&&(adIdsToRefresh=["special-story-banner-ad"].concat(visibleAds),this.peers.tgx.refreshAds(null,adIdsToRefresh,!1)))},Mediator.prototype.ssv2OmniturePageview=function(specialPageView){var articleModel,editDate,friendlyUrl,fullUrl,props,ref,ref1;specialPageView.isV2&&(articleModel=specialPageView.articleModel,friendlyUrl=articleModel.get("url"),fullUrl=articleModel.get("url"),editDate=articleModel.getEditDate(),props={},props.prop5="",props.prop7="special story",props.prop8=articleModel.id,props.prop12="person of the year 2014",props.prop14=friendlyUrl,props.prop16=null!=(ref=articleModel.get("section"))?ref.slug:void 0,props.prop17=fullUrl,props.prop26=editDate,props.prop28=null!=(ref1=articleModel.get("authors"))?ref1.join("|"):void 0,props.prop30=articleModel.get("friendly_title"),props.prop64="v2",props.prop69="Person of the Year",props.pageName=props.prop16+"|"+props.prop7+"|"+props.prop30,props.channel="time",this.peers.omniture.syntheticPageview({props:props}))},Mediator.prototype.ssv2ComscorePageview=function(specialPageView){specialPageView.isV2&&this.peers.comscore.firePageviewCandidate()},Mediator.prototype.maybeHideAdhesionAd=function(){var $nextContentAd,$previousContentAd,activeContentAdRect,activeDividerAdRect,isAdhesionAdHidden,isContentAdInView,isDividerAdInView,ref,ref1,ref2,ref3;"mobile"===Time.device&&this.$adhesionAd&&(null!=(ref=this.$contentAds)?ref.length:void 0)>0&&(this.$contentAds.length>1&&this.$activeContentAd.length>0&&($nextContentAd=$("#content-ad-"+(this.$activeContentAd.data("index")+1)),$nextContentAd.length>0&&this.$activeContentAd.get(0).getBoundingClientRect().top+this.$activeContentAd.outerHeight()<0&&(this.$activeContentAd=$nextContentAd),$previousContentAd=$("#content-ad-"+(this.$activeContentAd.data("index")-1)),$previousContentAd.length>0&&$previousContentAd.get(0).getBoundingClientRect().top+$previousContentAd.outerHeight()>0&&(this.$activeContentAd=$previousContentAd)),activeDividerAdRect=(null!=(ref1=this.$activeDividerAd)?ref1.length:void 0)>0?this.$activeDividerAd.get(0).getBoundingClientRect():null,activeContentAdRect=(null!=(ref2=this.$activeContentAd)?ref2.length:void 0)>0?this.$activeContentAd.get(0).getBoundingClientRect():null,isDividerAdInView=activeDividerAdRect&&activeDividerAdRect.top-this.app.sizes.wh<30&&activeDividerAdRect.top+this.$activeDividerAd.outerHeight()>0,isContentAdInView=activeContentAdRect&&activeContentAdRect.top-this.app.sizes.wh<30&&activeContentAdRect.top+this.$activeContentAd.outerHeight()>0,isAdhesionAdHidden=!!(isDividerAdInView||"none"!==(null!=(ref3=this.$activeContentAd)?ref3.css("display"):void 0)&&isContentAdInView),this.lastIsAdhesionAdHidden===!isAdhesionAdHidden&&(this.lastIsAdhesionAdHidden=isAdhesionAdHidden,this.$adhesionAd.toggleClass("adhesion-ad__hidden",isAdhesionAdHidden),isAdhesionAdHidden||(this.peers.tgx.refreshAds(null,["adhesion-ad"]),this.adhesionAdVisibleTime=0)))},Mediator.prototype.refreshAdhesionOnTIME100=function(){setInterval(function(_this){return function(){_this.peers.tgx.refreshAds(null,["adhesion-ad"])}}(this),15e3)},Mediator.prototype.setLMPCookie=function(){return Time.CookiesPlugin.raw=!0,Time.CookiesPlugin.set("LMP","//"+window.location.host+window.location.pathname,{path:"/",domain:".time.com"}),Time.CookiesPlugin.raw=!1},Mediator}(),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.modules.NativoFacade=function(superClass){function NativoFacade(options){var base;return null==options&&(options={}),this.initOnArchiveReady=bind(this.initOnArchiveReady,this),this.initOnToutsReady=bind(this.initOnToutsReady,this),this.app=options.app,(base=window.top).Nativo||(base.Nativo={}),this.nativo=window.top.Nativo,"time.com"!==window.top.location.host&&(this.nativo.pageURL="http://time.com"),this.reset(),this.articleUUID=getParameterByName("ntv_a"),""!==this.articleUUID?this.nativo.onArticlesReady=this.initOnArchiveReady:this.nativo.onArticlesReady=this.initOnToutsReady,this.isNtvExDisabled="true"===getParameterByName("disable_ntv_ex"),this.injectScript(this.articleUUID),this}return extend(NativoFacade,superClass),NativoFacade.prototype.DEBUG=!0,NativoFacade.prototype.nativo=null,NativoFacade.prototype.articles=[],NativoFacade.prototype.articleUUID=null,NativoFacade.prototype.isNtvExDisabled="",NativoFacade.prototype.RETRY_DELAY=2500,NativoFacade.prototype.FREQUENCY=10,NativoFacade.prototype.OFFSET=7,NativoFacade.prototype.totalTiles=1,NativoFacade.prototype.tileIndex=0,NativoFacade.prototype.reset=function(){return this.articles=[],this.totalTiles=1,this},NativoFacade.prototype.constructJsUrl=function(articleUUID){var extraParams,file,jsUrl,prxUrl,rand;return rand=1e9*Math.random(),extraParams=[],prxUrl=window.location.protocol+"//"+window.location.hostname+window.top.location.pathname,file="init.js",""!==articleUUID&&(prxUrl="staging.time.com"===window.top.location.host?"http://staging.time.com/":"http://time.com/",this.app.isMoney()&&(prxUrl+="money/"),file="index.js",extraParams.push("&ntv_a="+articleUUID),this.isNtvExDisabled||extraParams.push("&ntv_ex=3")),jsUrl=["http://adserve.postrelease.com/"+file+"?async=true","&prx_url="+prxUrl,"&rand="+rand].concat(extraParams).join(""),this.DEBUG&&console.debug("NativoFacade -- loading JS: ",jsUrl),jsUrl},NativoFacade.prototype.injectScript=function(articleUUID){var firstScriptTag,nativoTag;return null==articleUUID&&(articleUUID=this.articleUUID),nativoTag=document.createElement("script"),nativoTag.type="text/javascript",nativoTag.src=this.constructJsUrl(articleUUID),firstScriptTag=document.body.getElementsByTagName("script")[0],firstScriptTag.parentNode.insertBefore(nativoTag,firstScriptTag),this},NativoFacade.prototype.initOnToutsReady=function(response){var article,articleData,ref;return this.DEBUG&&console.debug("nativo touts ready",response),article=(null!=(ref=response.articles)?ref[0]:void 0)||{},articleData=this.getArticleData(article),this.articles.push(articleData),Time.trigger("nativo:article:loaded",this.articles,response),this},NativoFacade.prototype.initOnArchiveReady=function(response){return this.DEBUG&&console.debug("nativo archive ready",response),this.articles=_.map(response.articles,function(_this){return function(article){var articleData;return articleData=_this.getArticleData(article),articleData.is_nativo_page=!0,articleData}}(this)),Time.trigger("nativo:archive:loaded",this.articles,response),this},NativoFacade.prototype.sanitizeKey=function(value){return value.replace(/[^\w,]/g,"").toLowerCase()},NativoFacade.prototype.getArticleData=function(data){var advertiser_slug_name,articleUrl,datetime,encoded_title,encoded_url,landing_url,modelId,path,relativePath,result,source,title;return _.isEmpty(data)?{}:(modelId="s"+data.article_id+"_"+this.tileIndex++,data.advertiser_name&&(advertiser_slug_name=this.sanitizeKey(data.advertiser_name)),data.article_title&&(encoded_title=encodeURIComponent(data.article_title)),articleUrl=[Time.home_url],this.app.isMoney()&&articleUrl.push("money"),relativePath=data.article_relative_url,relativePath=relativePath.replace(/^\/(money\/)?/,""),path=relativePath,relativePath.indexOf("sponsored-from/")!==-1?(title=relativePath.replace(/\/?sponsored-from\//,""),path=["content-from",advertiser_slug_name,modelId,title].join("/")):path=path.indexOf("_0")!==-1?path.replace(/s[\d]*_0/,modelId):path.replace(/s1000/,modelId),articleUrl.push(path),articleUrl=articleUrl.join("/"),encoded_url=encodeURIComponent(articleUrl),source="TIME",this.app.isMoney()&&(source="MONEY"),result={},result.id=modelId,result.format="article",result.title=data.article_title,result.short_title=data.preview_headline,result.content=data.article,result.email_title=encodeURIComponent(data.article_title+" | "+source),result.email_body=encodeURIComponent(data.article_title+"\n"+data.preview_text+"...\n\n"+articleUrl+"&xid=emailshare"),result.nativo_key=data.article_key,result.nativo_preview_image=data.preview_image,result.nativo_preview_text=data.preview_text,
result.twitter_text=data.preview_headline,result.encoded_shortlink=articleUrl,result.url=articleUrl,result.twitter_via=Time.bootstrap.branding.toUpperCase(),result.encoded_url=encoded_url,result.encoded_title=encoded_title,result.is_nativo=!0,result.is_nativo_page=!1,result.article_top=data.article_top,result.article_right_rail=data.article_right_rail,result.is_desktop="desktop"===Time.device&&this.app.sizes.ww>1024,result.social_encoded_url={facebook:encodeURIComponent(articleUrl+"&xid=fbshare"),twitter:encodeURIComponent(articleUrl+"&xid=tcoshare"),linkedin:encodeURIComponent(articleUrl+"&xid=linkedinshare"),google:encodeURIComponent(articleUrl+"&xid=gplusshare"),pinterest:encodeURIComponent(articleUrl+"&xid=pinterestshare"),whatsapp:encodeURIComponent(data.article_title+"\n"+articleUrl+"&xid=whatsappshare")},landing_url=["content-from",relativePath.split("/")[1],data.advertiser_id],this.app.isMoney()&&landing_url.unshift("money"),result.sponsor={url:/^(?:f|ht)tps?\:\/\//.test(data.advertiser_url)?data.advertiser_url:"http://"+data.advertiser_url,name:data.advertiser_name,color:"",slug:advertiser_slug_name,thumbnail:data.advertiser_logo,landing_url:landing_url.join("/")},this.app.isMoney()&&(result.sponsor.vertical="money"),datetime=data.article_date+" "+data.article_time,result.time={pretty:datetime,published:datetime,updated:"",minute:"",short:""},2===data.article_type&&(result.clickout=!0,result.url=data.article_full_url),this.DEBUG&&console.debug("nativo create article model",result),result)},NativoFacade}(Backbone.Events),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.modules.OmnitureFacade=function(superClass){function OmnitureFacade(options){return null==options&&(options={}),this.syntheticPageview=bind(this.syntheticPageview,this),this.onFirstAdLoad=bind(this.onFirstAdLoad,this),this.onArticleActivated=bind(this.onArticleActivated,this),OmnitureFacade.__super__.constructor.apply(this,arguments),this.app=options.app,this.isRailInitialized=!1,this.listenTo(this.app.model,"change:isRailOpen",function(_this){return function(model,value,options){_this.isRailInitialized&&(_this.listenTo(Time,"leftRail:opened",function(){return"function"==typeof window.omniTrackEv?window.omniTrackEv("mobi-expose"):void 0}),_this.listenTo(Time,"leftRail:closed",function(){return"function"==typeof window.omniTrackEv?window.omniTrackEv("mobi-close"):void 0}),_this.stopListening(_this.app.model,"change:isRailOpen")),_this.isRailInitialized=!0}}(this)),this.bindListeners(),this}return extend(OmnitureFacade,superClass),OmnitureFacade.prototype.DEBUG=!0,OmnitureFacade.prototype._isReadyForTracking=!1,OmnitureFacade.prototype.bindListeners=function(){this.listenToOnce(Time,"dfpAdManager:afterDisplay",this.onFirstAdLoad),this.listenTo(Time,"article:activated",this.onArticleActivated),this.listenTo(Time,"analytics:pageview",this.syntheticPageview)},OmnitureFacade.prototype.onArticleActivated=function(articleView){this.DEBUG&&console.log("Omniture - article activated - set up s_time"),Time.Tracking.article_view(articleView.model.toJSON(),this._isReadyForTracking)},OmnitureFacade.prototype.onFirstAdLoad=function(){var props,ref,urlFragment;this._isReadyForTracking=!0,props=(null!=(ref=Time.bootstrap)?ref.initial_omniture:void 0)||{},props.prop56=this.isAdBlocked()?"on":"off",urlFragment=window.location.hash.slice(window.location.hash.indexOf("#")+1).split("?")[0],urlFragment&&(props.prop68=urlFragment),this.DEBUG&&console.log("Omniture - first ad load done, should fire syntheticPageview first time now!"),this.syntheticPageview({props:props})},OmnitureFacade.prototype.syntheticPageview=function(data){var e;null==data&&(data={}),this.DEBUG&&console.log("Omniture - maybe fire syntheticPageview with extra props",data),data.props&&(window.s_time=_.extend(window.s_time,data.props));try{this.DEBUG&&console.log("Omniture - FIRING synthetic pageview",window.s_time),window.s_time.t(),getParameterByName("tiiadtrackrevsci")&&"function"==typeof TiiAdTrackRevSci&&TiiAdTrackRevSci()}catch(_error){e=_error,this.DEBUG&&console.error("Omniture - ERROR firing synthetic pageview",window.s_time,e)}},OmnitureFacade.prototype.isAdBlocked=function(){var adDivs,isBlocked;return adDivs=["#pushdown-ad",".vault__ad","#special-story-banner-ad",".parents_ads",".masonry__ad",".ad-unit"],isBlocked=adDivs.some(function(adDivSelector){return $(adDivSelector+" > div > script").length>0})},OmnitureFacade}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,module=module||{},module.exports=Time.modules.PaywallFacade=function(superClass){function PaywallFacade(){return this.isUserSubscriber=bind(this.isUserSubscriber,this),PaywallFacade.__super__.constructor.apply(this,arguments)}return extend(PaywallFacade,superClass),PaywallFacade.prototype.timeSubCookieData={},PaywallFacade.prototype.initialize=function(options){null==options&&(options={}),this.app=options.app,this.listenTo(Time,"article:deactivated",function(article){return this.app.$body.removeClass(article.model.get("classes"))}),this.listenTo(Time,"article:activated",function(article){return this.DEBUG&&console.debug("tinypass -- article:activated",article.model.clone()),this.setLMPCookie(),article.model.get("money_article")&&article.model.set("classes","non-metered"),this.app.$body.addClass(article.model.get("classes")),this.showPaywallGate()}),this.listenTo(Time,"special:activated",function(articleModel){return this.DEBUG&&console.debug("tinypass -- special:activated",articleModel),this.setLMPCookie(),articleModel.get("money_article")&&articleModel.set("classes","non-metered"),this.app.$body.addClass(articleModel.get("classes")),this.showPaywallGate()})},PaywallFacade.prototype.setLMPCookie=function(){return Time.CookiesPlugin.raw=!0,Time.CookiesPlugin.set("LMP","//"+window.location.host+window.location.pathname,{path:"/",domain:".time.com"}),Time.CookiesPlugin.raw=!1},PaywallFacade.prototype.showPaywallGate=function(){this.isContentBlocked()&&(this.DEBUG&&console.debug("gated -- showPaywallGate"),this.showPaywallOverlay("gated"))},PaywallFacade.prototype.isContentBlocked=function(){return this.app.$body.hasClass("gated")},PaywallFacade.prototype.isUserSubscriber=function(){var data,element,j,len,ref;for(ref=decodeURIComponent(Time.CookiesPlugin.get("TimeSub")).split("|"),j=0,len=ref.length;j<len;j++)element=ref[j],data=element.split("~"),this.timeSubCookieData[data[0]]=data[1];return!!this.timeSubCookieData.availableAppIds&&this.timeSubCookieData.availableAppIds.indexOf("time.com.paywall")!==-1},PaywallFacade.prototype.showPaywallOverlay=function(type){var adParams,cmpos;this.isUserSubscriber()||(this.DEBUG&&console.debug("tinypass -- showPaywallOverlay",type),cmpos=function(){switch(type){case"gated":return"pywllgated"}}(),adParams={id:"meter-ad-slot",size:["1x1"],cmpos:cmpos,cmtyp:"tout",dcopt:"ist",isCmAd:!0},Time.trigger("dfpAdManager:activateAd",null,adParams,!0))},PaywallFacade}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.modules.PinnionFacade=function(superClass){function PinnionFacade(options){return null==options&&(options={}),this.handlePinnionEvent=bind(this.handlePinnionEvent,this),this.app=options.app,this.app.$window.on("pinnionEvent",function(e){window.clearTimeout(this._pinnionTimeout),this._pinnionTimeout=window.setTimeout(function(){return Time.trigger("window:pinnion",e)},100)}),this.currentPoll=this.TIME_100_MAP,this}return extend(PinnionFacade,superClass),PinnionFacade.prototype.POY_MAP={special_feature_value:"person of the year 2014",12836:{url:"http://time.com/3562179/time-person-of-the-year-poll/",prefix:"ynpoll_",name:"Vote Now: Who Should Be TIME’s Person of the Year?",id:3562179},12833:{url:"http://time.com/3562166/time-person-of…-face-off-poll/",prefix:"fpoll_",name:"Face-Off: Who Should Be TIME’s Person of the Year?",id:3562166}},PinnionFacade.prototype.TIME_100_MAP={special_feature_value:"time 100 2015",12980:{url:"http://time.com/3747734/time-100-poll/",prefix:"time100poll_",name:"Cast Your Vote: Who Should Be Part of 2015's TIME 100?",id:3747734}},PinnionFacade.prototype._pinnionTimeout=null,PinnionFacade.prototype.handlePinnionEvent=function(event){var base,eventData,isLeftRailModule,lrmPrefix,omniData,ref,value;null!=(null!=event&&null!=(ref=event.originalEvent)?ref.data:void 0)&&(eventData=JSON.parse(event.originalEvent.data),isLeftRailModule=eventData.location_href.indexOf("leftRailModule")!==-1||eventData.location_href.indexOf("&frame=1")!==-1,lrmPrefix=isLeftRailModule?"lr_":"",value=this.getPinnionEvent(eventData),value&&"function"==typeof window.omniTrackEv&&window.omniTrackEv(lrmPrefix+this.currentPoll[eventData.survey_id].prefix+value),"scroll"!==value||isLeftRailModule||(omniData=this.app.model.get("activeArticle").toJSON(),omniData.userAction="poll",omniData.format="poll",omniData.url=this.currentPoll[eventData.survey_id].url,omniData.friendly_title=this.currentPoll[eventData.survey_id].name,omniData.id=this.currentPoll[eventData.survey_id].id,omniData.special_feature_value=this.currentPoll.special_feature_value,"function"==typeof(base=Time.Tracking).article_view&&base.article_view(omniData),Time.trigger("omniture:pinnionPollPageview")))},PinnionFacade.prototype.getPinnionEvent=function(eventData){return eventData.events.q_advance||eventData.events.q_previous?"scroll":eventData.events.q_resp_change?"vote":""},PinnionFacade}(Backbone.Events),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,module=module||{},module.exports=Time.modules.TgxFacade=function(superClass){function TgxFacade(){return this._onRenderAd=bind(this._onRenderAd,this),this.waitForAds=bind(this.waitForAds,this),this.refreshAds=bind(this.refreshAds,this),this.enqueueAds=bind(this.enqueueAds,this),this.deleteAd=bind(this.deleteAd,this),this.activateCmAd=bind(this.activateCmAd,this),this.removeAds=bind(this.removeAds,this),this.onApplicationRendered=bind(this.onApplicationRendered,this),TgxFacade.__super__.constructor.apply(this,arguments)}return extend(TgxFacade,superClass),TgxFacade.prototype.DEBUG=!0,TgxFacade.prototype.PRESERVED_AD_PARAMS=["ad_div","cmpos","cmtyp","ctype","etype","nlsub","poll","pos","slide","spons","tile","topic"],TgxFacade.prototype.REQUIRED_PARAMS=["id","size"],TgxFacade.prototype.isEnabled=!1,TgxFacade.prototype.isInitialAdCycle=!0,TgxFacade.prototype.enqueuedAds=[],TgxFacade.prototype.initialize=function(options){return null==options&&(options={}),this.app=options.app,this.isEnabled=null==options.enabled||options.enabled,"undefined"==typeof TiiAdConfig?("undefined"!=typeof console&&null!==console&&console.error("-- init -- TiiAdConfig/TGX not defined"),this.isEnabled=!1,this):window.location.href.indexOf("noads")!==-1?("undefined"!=typeof console&&null!==console&&console.error("-- init -- noads is set"),this.isEnabled=!1,this):this.isEnabled?(this.TOP_BANNER_HEIGHT=null,this.setTopBannerHeight(),$("html").toggleClass("debugads",window.location.href.indexOf("debugads")!==-1),this.app.$body.addClass("hasAd"),"desktop"===Time.device&&this.app.$body.addClass("expandable-ad-enable"),this.bindListeners(),this):("undefined"!=typeof console&&null!==console&&console.error("-- init -- ads disabled"),this)},TgxFacade.prototype.setTopBannerHeight=function(){return this.TOP_BANNER_HEIGHT=this.app.$topBanner.height(),this.TOP_BANNER_HEIGHT},TgxFacade.prototype.bindListeners=function(){return this.listenTo(Time,"dfpAdManager:refreshAds",this.refreshAds),this.listenTo(Time,"dfpAdManager:activateAd",function(_this){return function(articleModel,params,callback){null==params&&(params={}),null==callback&&(callback=!1),_this.activateAd(articleModel,params),"function"==typeof callback&&callback(),callback===!0&&_this.refreshAds(articleModel,[params.id])}}(this)),this.listenTo(Time,"dfpAdManager:activateCmAd",this.activateCmAd),this.listenTo(Time,"dfpAdManager:deleteAd",this.deleteAd),this.listenTo(Time,"dfpAdManager:removeAds",this.removeAds),this.listenTo(Time,"dfpAdManager:setInitialAppLoad",function(value){Time.Ad.set_initial_app_load(value)}),this.listenTo(Time,"dfpAdManager:setInitialLeftRailLoad",function(value){this.model.set("isInitialLeftRailCycle",value)}),this.listenTo(Time,"sectionfront:ads:activate",function(_this){return function(sectionFrontAdSelector){var ads,wW;ads=[],wW=_this.app.$window.width(),$(sectionFrontAdSelector).each(function(){if(wW>600&&"mobile"!==$(this).data("viewport")||wW<600&&"mobile"===$(this).data("viewport"))return ads.push($(this).attr("id")),_this.activateAd(null,{id:$(this).attr("id"),size:[$(this).data("size")],position:$(this).data("position"),type:$(this).data("type"),isCmAd:$(this).data("cmad")})}),_this.refreshAds(null,ads)}}(this)),this.listenTo(Time,"nativolanding:ads:activate",function(_this){return function(sectionFrontAdSelector){var ads,wW;ads=[],wW=_this.app.$window.width(),$(sectionFrontAdSelector).each(function(){var spons;if(wW>1024&&"desktop"===$(this).data("viewport")||wW<=1024&&"tablet mobile"===$(this).data("viewport"))return ads.push($(this).attr("id")),spons=$(this).data("spons")?$(this).data("spons"):"",_this.activateAd(null,{id:$(this).attr("id"),size:[$(this).data("size")],position:$(this).data("position"),type:$(this).data("type"),isCmAd:$(this).data("cmad"),sponsor:spons})}),_this.refreshAds(null,ads)}}(this)),this.listenTo(Time,"vertical:ads:activate",function(vertical){Time.Ad.activate_vertical_homepage_ads(vertical)}),this.listenTo(Time,"parents:ads:activate",function(_this){return function(parentAdSelector){var ads;ads=[],$(parentAdSelector).each(function(){return ads.push($(this).attr("id")),_this.activateAd(null,{id:$(this).attr("id"),size:[$(this).data("size")],position:$(this).data("position"),type:$(this).data("type"),isCmAd:$(this).data("cmad")})}),_this.refreshAds(null,ads)}}(this)),this.listenToOnce(Time,"application:rendered",this.onApplicationRendered),this.listenTo(Time,"dfpAdManager:callback",function(id){Tether.position()}),this.listenTo(this.model,"change:isInitialLeftRailCycle",function(model,value,options){Time.application.is_homepage=!1,value&&Time.Ad.remove_ads()}),this},TgxFacade.prototype.onApplicationRendered=function(){this.listenTo(Time,"leftRail:flush",function(_this){return function(){_this.model.set("isInitialLeftRailCycle",!0)}}(this)),this.listenTo(Time,"leftRail:filter:before",function(_this){return function(){var leftRailAds,leftRailAdsToRemove;leftRailAds=_this.collection.where({group:"leftRail"}),leftRailAdsToRemove=_.reject(leftRailAds,function(ad){return"0"===ad.get("position")}),_this.removeAds(leftRailAdsToRemove),_this.app.active_rail.view.adIndex=0}}(this))},TgxFacade.prototype.removeAds=function(adModels){var articleGroups;return null==adModels&&(adModels=null),adModels||(articleGroups=["contentWell","dividers","gallery","leftRail","listAds","rightRail"],adModels=this.collection.filter(function(model){return _.contains(articleGroups,model.get("group"))})),_.each(adModels,function(_this){return function(model){var $el,placeholderId;return $el=$("#"+model.id),$el.length&&(placeholderId=$el.data("ad_placeholder_id"),placeholderId&&$("#"+placeholderId).remove(),$el.remove()),null!=model&&(model.adInstance=null),_this.collection.remove(model),model=null}}(this)),this},TgxFacade.prototype.prioritizeGroups=function(adDivIds){var divGroups,prioritizedDivIds,priority;return priority=["mobileTopAd"],divGroups=_.groupBy(adDivIds,function(_this){return function(id){var adModel,group;return(adModel=_this.collection.get(id))?(group=adModel.get("group"),_.contains(priority,group)?group:"others"):"others"}}(this)),prioritizedDivIds=[],_.each(priority,function(group){if(null!=divGroups[group])return prioritizedDivIds=prioritizedDivIds.concat(divGroups[group])}),null!=divGroups.others&&(prioritizedDivIds=prioritizedDivIds.concat(divGroups.others)),prioritizedDivIds},TgxFacade.prototype.setAdParams=function(adModels,params){_.each(adModels,function(adModel){var key,results,value;if(adModel.adInstance){results=[];for(key in params)value=params[key],results.push(adModel.adInstance.setParam(key,value));return results}})},TgxFacade.prototype.getArticleModel=function(){var articleModel,isInNativoArchive,ref;return(articleModel=this.app.model.get("activeArticle"))?articleModel:(isInNativoArchive="nativo"===(null!=(ref=this.app.active_rail)?ref.active_env:void 0),isInNativoArchive?this.app.active_rail.first():null)},TgxFacade.prototype.createAd=function(articleModel,params){var adModel,attributes,el,isAcceptable;return null==articleModel&&(articleModel=this.getArticleModel()),null==params&&(params={}),(el=document.getElementById(params.id))?(this.deleteAd(params.id),attributes=_.extend({articleModel:articleModel},params),(isAcceptable=_.every(this.REQUIRED_PARAMS,function(key){return attributes[key]}))?(adModel=new Time.models.DfpAd(attributes,{parse:!0}),this.collection.add(adModel,{merge:!0}),adModel):("undefined"!=typeof console&&null!==console&&console.error("Error creating ad!",articleModel,params),!1)):("undefined"!=typeof console&&null!==console&&console.error("Not activating ad "+params.id+" -- no div for it"),!1)},TgxFacade.prototype.activateAd=function(articleModel,params){var adModel;return null==articleModel&&(articleModel=this.getArticleModel()),null==params&&(params={}),adModel=this.collection.get(params.id),adModel&&!adModel.isFetched()||(adModel=this.createAd(articleModel,params)),adModel?(adModel.fetch(this.model.getFactory()),adModel.get("isParsed")&&adModel.sync(),adModel):("undefined"!=typeof console&&null!==console&&console.error("Ad model was not created",articleModel,params),null)},TgxFacade.prototype.activateCmAd=function(adId,size,cmpos,cmtyp){return this.activateAd(null,{id:adId,size:size,cmpos:cmpos,cmtyp:cmtyp,isCmAd:!0,isActive:!1})},TgxFacade.prototype.deleteAd=function(id,empty){var $el,adModel;null==empty&&(empty=!0),this.enqueuedAds=_.without(this.enqueuedAds,id),empty&&($el=$("#"+id),$el.length&&($el.find("iframe").each(function(){return $(this).attr("src","about:blank")}),$el.empty())),adModel=this.collection.get(id),adModel&&(adModel.destroy(),this.DEBUG&&("undefined"!=typeof console&&null!==console?console.debug("-- deleteAd -- deleted",id):void 0))},TgxFacade.prototype.getAdEl=function(id){var $el,selector;return selector="#"+id,$el=$(selector),$el.length||"undefined"!=typeof console&&null!==console&&console.error("DfpAdManagerView - getAdEl - couldn't find element in DOM",selector),$el},TgxFacade.prototype.activateInactiveAdsByIds=function(adIds,articleModel){var inactiveAds;return null==articleModel&&(articleModel=null),inactiveAds=this.collection.filter(function(model){var ref;return ref=model.id,indexOf.call(adIds,ref)>=0&&!model.isFetched()}),_.each(inactiveAds,function(_this){return function(adModel){return _this.activateAd(articleModel,{id:adModel.id})}}(this)),inactiveAds},TgxFacade.prototype.getImmediateType=function(maybeBoolean){return"boolean"==typeof maybeBoolean&&maybeBoolean},TgxFacade.prototype.enqueueAds=function(adIds){this.enqueuedAds=this.enqueuedAds.concat(adIds)},TgxFacade.prototype.refreshAds=function(articleModel,adIds,callback){var adId,adModel,inactiveAds,index,j,len,onComplete,onFail,promiseRefresh,timesToWait;if(null==articleModel&&(articleModel=null),this.isInitialAdCycle=!1,!(null!=adIds?adIds.length:void 0))return void(this.DEBUG&&("undefined"!=typeof console&&null!==console?console.warn("-- refreshAds needs ad div ids"):void 0));for(index=j=0,len=adIds.length;j<len;index=++j)adId=adIds[index],adModel=this.collection.get(adId),(null!=adModel?adModel.get("refreshOnPercentVisible"):void 0)&&this.app.getPercentVisible($("#"+adId).get(0).getBoundingClientRect())<adModel.get("refreshOnPercentVisible")&&adIds.splice(index,1);this.enqueuedAds=this.enqueuedAds.concat(adIds),inactiveAds=this.activateInactiveAdsByIds(adIds,articleModel),timesToWait=inactiveAds.length,onFail=function(_this){return function(response){_this.DEBUG&&("undefined"!=typeof console&&null!==console?console.warn(response):void 0)}}(this),onComplete=function(_this){return function(){_this._displayAds(articleModel,_this.getImmediateType(callback)),"function"==typeof callback&&callback()}}(this),promiseRefresh=this.waitForAds(inactiveAds,timesToWait),promiseRefresh.fail(onFail).always(onComplete)},TgxFacade.prototype.waitForAds=function(inactiveModels,attempt,promise){var inactiveAds,isAllActive,isLastTry;return null==inactiveModels&&(inactiveModels=[]),null==attempt&&(attempt=1),null==promise&&(promise=$.Deferred()),inactiveAds=_.filter(inactiveModels,function(adModel){return!adModel.hasAdInstance()}),isAllActive=0===inactiveAds.length,isLastTry=attempt<=0,isLastTry&&!isAllActive?(this.enqueuedAds=_.without(this.enqueuedAds,_.pluck(inactiveAds,"id")),promise.reject({message:"Some ads never got an adInstance",inactive:inactiveAds})):isAllActive?(this.DEBUG&&("undefined"!=typeof console&&null!==console?console.debug("All inactive ads successfully activated",_.pluck(inactiveModels,"id")):void 0),promise.resolve()):(this.DEBUG&&("undefined"!=typeof console&&null!==console?console.debug("Waiting for these ads to activate",_.pluck(inactiveAds,"id")):void 0),window.setTimeout(function(_this){return function(){return _this.waitForAds(inactiveModels,attempt-1,promise)}}(this),100),promise)},TgxFacade.prototype.getJqueryObjsByModels=function(adModels){var nodes;return nodes=_.map(adModels,function(m){return document.getElementById(m.id)}),$(nodes)},TgxFacade.prototype.getJqueryObjsByIds=function(ids){var nodes;return nodes=[],_.each(ids,function(i){if(document.getElementById(i))return nodes.push(document.getElementById(i))}),$(nodes)},TgxFacade.prototype.getLeftRailAdsById=function(ids){var leftRailAdIds,leftRailAdModels;return leftRailAdIds=_.filter(ids,function(_this){return function(id){var adModel;return adModel=_this.collection.get(id),"leftRail"===(null!=adModel?adModel.get("group"):void 0)}}(this)),leftRailAdModels=this.collection.filter(function(adModel){var ref;return ref=adModel.id,indexOf.call(leftRailAdIds,ref)>=0})},TgxFacade.prototype.isArticleWithGallery=function(articleModel){var ref,ref1;return null==articleModel&&(articleModel=this.app.model.get("activeArticle")),null!=articleModel&&null!=(ref=articleModel.views)&&null!=(ref1=ref.singleView)?ref1._galleriesRendered:void 0},TgxFacade.prototype._onRenderAd=function(id){var adModel;adModel=this.collection.get(id),adModel&&(adModel.set("isRendered",!0),adModel.get("renderOnce")&&adModel.set("isActive",!1))},TgxFacade.prototype._displayAds=function(articleModel,isImmediate){var $els,adDivIds,error,etype,prioritizedIds;if(null==isImmediate&&(isImmediate=!1),adDivIds=_.compact(_.uniq(this.enqueuedAds)),adDivIds.length){etype="",this.isArticleWithGallery(articleModel)&&(etype="gallery"),this.setAdParams(this.getLeftRailAdsById(adDivIds),{etype:etype}),_.each(adDivIds,this._onRenderAd),$els=this.getJqueryObjsByIds(adDivIds),$els&&$els.removeClass("hide-ad"),indexOf.call(adDivIds,"pushdown-ad")>=0&&(document.getElementById("pushdown-ad").style.padding="10px 0"),prioritizedIds=this.prioritizeGroups(adDivIds),this.DEBUG&&("undefined"!=typeof console&&null!==console?console.debug("-- _displayAds clearRefreshAds with",prioritizedIds,"OOP:",window.TGX_SITE_CONFIG.refresh_oop_slot):void 0);try{this.model.setFactorySegments(),this.model.IS_SRA_ENABLED?this.model.getFactory().clearRefreshBatchAds(prioritizedIds,this.PRESERVED_AD_PARAMS):this.model.getFactory().clearRefreshAds(prioritizedIds,this.PRESERVED_AD_PARAMS)}catch(_error){error=_error,"undefined"!=typeof console&&null!==console&&console.error("-- _displayAds could not clearRefreshAds",prioritizedIds,error)}this.enqueuedAds.length=0,Time.trigger("dfpAdManager:afterDisplay",prioritizedIds),window.TGX_SITE_CONFIG.refresh_oop_slot=!1}},TgxFacade.prototype.loadNativoOop=function(){var error,originalOOP;originalOOP=window.TGX_SITE_CONFIG.refresh_oop_slot,window.TGX_SITE_CONFIG.refresh_oop_slot=!1;try{this.model.getFactory().clearRefreshAds(["nativo-trigger"],this.PRESERVED_AD_PARAMS)}catch(_error){error=_error,"undefined"!=typeof console&&null!==console&&console.error("-- loadNativoTrigger failed to refresh",error)}return window.TGX_SITE_CONFIG.refresh_oop_slot=originalOOP,this},TgxFacade}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.modules.TgxFactory=function(superClass){function TgxFactory(){return this.watchForScrollPushdownChange=bind(this.watchForScrollPushdownChange,this),this.monitorPushdownHeight=bind(this.monitorPushdownHeight,this),this.stopWatchingForPushdownResize=bind(this.stopWatchingForPushdownResize,this),this.watchForPushdownResize=bind(this.watchForPushdownResize,this),this.pinPushdown=bind(this.pinPushdown,this),this.unpinPushdown=bind(this.unpinPushdown,this),this.slotRenderedCallback=bind(this.slotRenderedCallback,this),TgxFactory.__super__.constructor.apply(this,arguments)}return extend(TgxFactory,superClass),TgxFactory.prototype.DEBUG=getParameterByName("tgxdebug"),TgxFactory.prototype.IS_SRA_ENABLED=!0,TgxFactory.prototype.sitename="3475.tim",TgxFactory.prototype.factoryInstance=null,TgxFactory.prototype.defaults={zone:"",isInitialLeftRailCycle:!0},TgxFactory.prototype.initialize=function(attributes,options){var error;if(null==attributes&&(attributes={}),null==options&&(options={}),null!=options.app&&(this.app=options.app),"undefined"==typeof TiiAdConfig||null===TiiAdConfig)return console.error("DfpAdManager -- Tgx not present"),this.app.isAdsEnabled=!1,null;if("undefined"==typeof TIME_DFP||null===TIME_DFP)return console.error("DfpAdManager -- TIME_DFP not defined"),this.app.isAdsEnabled=!1,null;this.bindListeners(),this.factoryConfig=this.createConfig(),this.factoryData=TIME_DFP,this.factoryZone=this.getFactoryZone(this.factoryData),this.factoryInstance=this.createFactory(this.factoryConfig,this.factoryZone),this.setDefaultFactoryParams(),this.setInitialFactoryParams(this.factoryData);try{Time.Ad.setGlobalFactory(this.factoryInstance),Time.Ad.init()}catch(_error){error=_error,console.error("DfpAdManager -- could not init Time.Ad",error)}return this},TgxFactory.prototype.slotRenderedCallback=function(ad){var calculatedBreakpoint,windownHeight;if("home-banner-ad"!==ad&&"money-homepage-banner"!==ad||$("#home-banner-ad, #money-homepage-banner").css("display","inline-block").css("width","320px"),"pushdown-ad"===ad)return this.app.$pushdown.css("height","auto").show(),this.$itemsNeedingPushdown=$(".readingpane, .navigation, .main-nav, .section-menu"),this.app.$main_header.css("transition","all .25s"),this.app.$leftRailTopper.css("transition","all .25s"),this.pinPushdown(),this.app.$wpAdminBar.length?this.zeroTop=this.app.wpAdminBarHeight:this.zeroTop=0,_.delay(function(_this){return function(){return _this.pushdownWatch=_this.watchForPushdownResize(),_this.watchForScrollPushdownChange()}}(this),250),windownHeight=$(window).height(),calculatedBreakpoint=windownHeight-this.calculatedPushdownHeight-this.app.sizes.headerHeightWithTopper-50,calculatedBreakpoint>350?this.SCROLL_POSITION_TO_UNPIN_PUSHDOWN=calculatedBreakpoint:this.SCROLL_POSITION_TO_UNPIN_PUSHDOWN=350},TgxFactory.prototype.unpinPushdown=function(){return this.stopWatchingForPushdownResize(),this.$itemsNeedingPushdown.css("margin-top",0),this.app.$pushdown.css({position:"relative",top:this.app.sizes.headerHeight,"z-index":this.app.pushdownZIndex}),this.app.$main_header.css("top",this.zeroTop),this.app.$leftRailWrapper.css("margin-top",0).find(".left-rail-ad").css("margin-top",0),this.app.setIsPastPushdowns(),this.app.isPushdownPinned=!1,this.app.$leftRailTopper.css("top",this.app.sizes.headerHeight+"px")},TgxFactory.prototype.pinPushdown=function(context){var adminHeightBump;return this.savedPushdownIframeHeight=this.app.$pushdown.find("iframe").outerHeight(),this.savedPushdownHeight=this.app.$pushdown.outerHeight(),"iframe"===context?(this.calculatedPushdownHeight=this.savedPushdownIframeHeight+40,this.app.$pushdown.css("height",this.calculatedPushdownHeight+"px")):this.calculatedPushdownHeight=this.savedPushdownHeight,adminHeightBump=this.app.$wpAdminBar.length?this.app.wpAdminBarHeight:0,this.$itemsNeedingPushdown.css("margin-top",this.calculatedPushdownHeight+"px"),this.app.$leftRailWrapper.css("margin-top",this.calculatedPushdownHeight+"px"),this.app.$pushdown.css({position:"fixed",top:this.zeroTop,"z-index":parseInt(this.app.mainHeaderZIndex)+1}),this.app.$main_header.css("top",this.calculatedPushdownHeight+adminHeightBump+"px"),this.app.$leftRailTopper.css("top",this.calculatedPushdownHeight+this.app.sizes.headerHeight+"px"),this.app.isPushdownPinned=!0,this.app.setIsPastPushdowns(),this.app.getSizes()},TgxFactory.prototype.watchForPushdownResize=function(){return setInterval(function(_this){return function(){return _this.monitorPushdownHeight()}}(this),333)},TgxFactory.prototype.stopWatchingForPushdownResize=function(){return window.clearInterval(this.pushdownWatch)},TgxFactory.prototype.monitorPushdownHeight=function(){var adDivHeight,adIframeHeight;if(this.app.isPushdownPinned)return adDivHeight=this.app.$pushdown.outerHeight(),adIframeHeight=this.app.$pushdown.find("iframe").outerHeight(),this.savedPushdownHeight!==adDivHeight?_.defer(this.pinPushdown("div")):this.savedPushdownIframeHeight!==adIframeHeight?_.defer(this.pinPushdown("iframe")):void 0},TgxFactory.prototype.watchForScrollPushdownChange=function(){return Time.on("body:scrolled",function(_this){return function(e){var windowScroll;if(windowScroll=$(window).scrollTop(),windowScroll>_this.SCROLL_POSITION_TO_UNPIN_PUSHDOWN)return _this.unpinPushdown(),_this.app.$pushdown.css("height",0).hide()}}(this))},TgxFactory.prototype.bindListeners=function(){return this.listenTo(Time,"dfpAdManager:factory:maybeReset",function(_this){return function(articleModel){_this.DEBUG&&console.debug("Time heard dfpAdManager:factory:maybeReset for article:",null!=articleModel?articleModel.id:void 0),_this.maybeResetFactory(articleModel)}}(this)),this.listenTo(Time,"dfpAdManager:factory:setZone",function(_this){return function(zone){var ref;null!=(ref=_this.getFactory())&&ref.setZone(zone)}}(this)),this.listenTo(this,"change:isInitialLeftRailCycle",function(model,value,options){return Time.trigger("dfpAdManager:change:isInitialLeftRailCycle",value)}),this.listenTo(Time,"dfpAdManager:afterDisplay",function(_this){return function(ads){return _this.factoryInstance.slotRenderEnded(_this.slotRenderedCallback,ads)}}(this)),this},TgxFactory.prototype.createConfig=function(){var adConfig,error;try{return this.DEBUG&&console.debug("-- createConfig with sitename "+this.sitename),adConfig=new TiiAdConfig(this.sitename),adConfig.setCmSitename("cm.tim"),null!=window.rsi_now&&adConfig.setRevSciTracking(!0),adConfig.setdisableInitLoad(!0),this.IS_SRA_ENABLED&&adConfig.setsingleRequestMode(!0),adConfig}catch(_error){error=_error,console.error("-- createConfig - couldn't create a config",error)}return null},TgxFactory.prototype.getConfig=function(){var error;this.factoryConfig=null;try{this.factoryConfig=Time.Ad.getFactoryConfig()}catch(_error){return error=_error,console.error("-- getConfig - couldn't get ad factory config",error),null}return this.factoryConfig},TgxFactory.prototype.getFactoryZone=function(factoryData){var vertical,zone;return zone="",(null!=factoryData?factoryData.zone:void 0)?(zone=factoryData.zone,null==factoryData.params||null==factoryData.params.subch&&"collection"!==factoryData.params.ptype||(vertical=window.history&&history.pushState?window.location.pathname.substring(1).split("/")[0]:window.location.hash.substring(1).split("/")[0],zone="collections/"+factoryData.zone,vertical.match(/money/)&&(zone="money/"+zone)),zone=zone.toLowerCase().replace(/\./g,"")):(this.DEBUG&&console.debug("-- no zone in factoryData",factoryData),"")},TgxFactory.prototype.getFactory=function(){return this.factoryInstance=Time.Ad.getFactoryInstance(),
this.factoryInstance},TgxFactory.prototype.createFactory=function(factoryConfig,factoryZone){return factoryConfig||(factoryConfig=this.getConfig()),null==factoryConfig?(console.error("-- createFactory -- missing factory config"),null):factoryZone?new TiiAdFactory(factoryConfig,factoryZone):new TiiAdFactory(factoryConfig)},TgxFactory.prototype.sanitizeFactoryParamsZone=function(zone){return zone.toLowerCase().replace(/\./g,"")},TgxFactory.prototype.sanitizeFactoryParamsPath=function(url){var path;return path=url.split("/"),path=path.slice(3,path.length-1)},TgxFactory.prototype.flattenParams=function(params){var k,v;for(k in params)hasProp.call(params,k)&&(v=params[k],_.isObject(v)&&!_.isArray(v)&&(_.extend(params,v),delete params[k]));return params},TgxFactory.prototype.sanitizeFactoryParams=function(params){var key,sanitizedParams,value;sanitizedParams={},null!=(null!=params?params.url:void 0)&&(sanitizedParams.path=this.sanitizeFactoryParamsPath(params.url)),sanitizedParams.dcove="d",params=this.flattenParams(params);for(key in params)value=params[key],"topic"===key||"tags"===key?sanitizedParams[key]=value.replace(/[^\w,]/g,"").toLowerCase():"string"==typeof value?sanitizedParams[key]=value.toLowerCase():sanitizedParams[key]=value;return sanitizedParams},TgxFactory.prototype.wipeFactoryParams=function(){var key,ref,value;ref=this.factoryInstance.params;for(key in ref)hasProp.call(ref,key)&&(value=ref[key],this.DEBUG&&console.debug("-- wipeFactoryParam",key),this.factoryInstance.clearParam(key));return this.factoryInstance},TgxFactory.prototype.setFactoryParams=function(params){var key,value;for(key in params)hasProp.call(params,key)&&(value=params[key],this.DEBUG&&console.debug("-- setFactoryParams",key,value),this.factoryInstance.setParam(key,value));return this.factoryInstance},TgxFactory.prototype.setInitialFactoryParams=function(factoryData){var $topic,params;return params={},factoryData.url=window.location.href,params=this.sanitizeFactoryParams(factoryData),$topic=$("body").find(".left-rail-topper").eq(0).find("#topic"),$topic.length&&$topic.hasClass("active")&&(params.ptype="topic"),this.DEBUG&&console.debug("DfpAdManager - setInitialFactoryParams",params),this.setFactoryParams(params),this},TgxFactory.prototype.setDefaultFactoryParams=function(){var defaultParams,e,matchesTest,regexMatchesTest,test;this.DEBUG&&console.debug("DfpAdManager - setDefaultFactoryParams"),defaultParams={rdsn:"yes"},Time.CookiesPlugin.get("time_visit")&&(this.DEBUG&&console.debug("-- setDefaultFactoryParams setting rvisit to yes"),defaultParams.rvisit=!0),null!=document.referrer&&document.referrer&&(defaultParams.rhost=document.referrer.split("/")[2],this.DEBUG&&console.debug("-- setDefaultFactoryParam setting rhost to "+defaultParams.rhost)),test=!1;try{test="undefined"!=typeof sessionStorage&&null!==sessionStorage?sessionStorage.getItem("testads"):void 0}catch(_error){e=_error,"undefined"!=typeof console&&null!==console&&console.error(e)}return test||(regexMatchesTest=/testads=([0-9]+)/,matchesTest=regexMatchesTest.exec(window.location.href),test=null!=matchesTest?matchesTest[1]:void 0),this.DEBUG&&console.debug("-- setDefaultFactoryParams with ?testads = "+test),defaultParams.test=test,this.setFactoryParams(defaultParams)},TgxFactory.prototype.maybeResetFactory=function(articleModel){var params,ref,ref1,vertical;return null==this.factoryInstance?(console.error("-- maybeResetFactory in ",this," needs a valid factoryInstance."),this):null==articleModel?this:articleModel.id===(null!=(ref=this.factoryInstance.params)?ref.aid:void 0)?this:(params=Time.Ad.getFactoryData(articleModel),"page"===articleModel.get("post_type")||articleModel.get("is_nativo_page")?null!=("undefined"!=typeof TIME_DFP&&null!==TIME_DFP?TIME_DFP.zone:void 0)&&(params.zone||(params.zone=TIME_DFP.zone)):articleModel.get("is_nativo")&&(vertical=null!=(ref1=articleModel.get("sponsor"))?ref1.vertical:void 0,null!=vertical&&(params.zone||(params.zone=vertical))),articleModel.get("collection_meta")&&articleModel.get("collection_meta").ad_topic&&(params.topic=articleModel.get("collection_meta").ad_topic),articleModel.get("collection_meta")&&articleModel.get("collection_meta").ad_channel&&(params.ch=articleModel.get("collection_meta").ad_channel),articleModel.get("collection_meta")&&articleModel.get("collection_meta").ad_sub_channel&&(params.subch=articleModel.get("collection_meta").ad_sub_channel),this.resetFactory(params),this)},TgxFactory.prototype.resetFactory=function(params){var sanitizedParams,zone;return this.DEBUG&&console.debug("DfpAdManager reset factory --------------------"),this.wipeFactoryParams(),zone="",(null!=params?params.zone:void 0)&&(zone=this.sanitizeFactoryParamsZone(params.zone)),this.factoryInstance.zone!==zone&&this.factoryInstance.setZone(zone),this.setDefaultFactoryParams(),sanitizedParams=this.sanitizeFactoryParams(params),this.setFactoryParams(sanitizedParams),this.factoryInstance},TgxFactory.prototype.setFactorySegments=function(){var quantSegs,revSciSegments;return window.TiiAdGetRevSciSegments&&(revSciSegments=window.TiiAdGetRevSciSegments(),this.factoryInstance.setParam("rsseg",revSciSegments)),window.TiiAdGetQuantcastSegments&&(quantSegs=window.TiiAdGetQuantcastSegments(),this.factoryInstance.setParam("qc",quantSegs)),this.factoryInstance},TgxFactory}(Backbone.Model),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.component.Dropdown=function(){function Dropdown(elSelector,options){return this.$el=$(elSelector),this.opts=$.extend(!0,{},this.opts,options),this.$el.on("touchend.dropdown-"+this.opts.classToAdd+" click.dropdown-"+this.opts.classToAdd,function(_this){return function(evt){return _this.toggle(evt)}}(this)),this}return Dropdown.prototype.opts={parentSelector:"body",classToAdd:"show-nav",menuSelector:".main-nav",handleClickOutside:!0},Dropdown.isShowing=!1,Dropdown.prototype.$html=$("html"),Dropdown.prototype.show=function(evt){return evt&&evt.preventDefault(),$(this.opts.parentSelector).addClass(this.opts.classToAdd),this.isShowing=!0,this.opts.handleClickOutside&&this.bindClose(evt),$(this.opts.menuSelector).trigger("shown"),this.$el},Dropdown.prototype.hide=function(evt){return evt&&evt.preventDefault(),$(this.opts.parentSelector).removeClass(this.opts.classToAdd),$(this.opts.menuSelector).trigger("hidden"),this.isShowing=!1,this.$el},Dropdown.prototype.bindClose=function(e){return $("html").on("click.dropdown-"+this.opts.classToAdd,function(_this){return function(evt){var $targ,targetIsNotDropdown,targetsNotAChildOfDropdown;if($targ=$(e.target||window.event.srcElement),targetIsNotDropdown=!$targ.is(_this.opts.menuSelector),targetsNotAChildOfDropdown=0===$(_this.opts.menuSelector).has($targ).length,targetIsNotDropdown&&targetsNotAChildOfDropdown)return $("html").off(".dropdown-"+_this.opts.classToAdd),_this.hide()}}(this)),this},Dropdown.prototype.toggle=function(evt){return evt&&evt.preventDefault(),this.isShowing?(this.$el.trigger("clicked-close"),this.hide(evt)):(this.$el.trigger("clicked-open"),this.show(evt))},Dropdown.prototype.destroy=function(){return this.$el.off("dropdown-"+this.opts.classToAdd),$.removeData(this.$el,"Dropdown Navigation MobileNavigation"),$("html").off("dropdown-"+this.opts.classToAdd)},Dropdown}(),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.component.InfiniteScroll=function(){function InfiniteScroll(options){var ref;return null==options&&(options={}),this.on_scroll=bind(this.on_scroll,this),arguments.length>1&&(options.parentEl=arguments[0],options.contentEl=arguments[1],options.threshold=arguments[2],options.onDown=arguments[3],options.onUp=arguments[4],options.context=arguments[5]),options.contentEl||(options.contentEl=window),this.$viewport=options.parentEl,this.$content=options.contentEl,this.threshold=options.threshold,null!=options.onUp&&(this.up_callback=options.onUp),null!=options.onDown&&(this.down_callback=options.onDown),this.context=options.context,this.position=this.$viewport.scrollTop(),_.defer(function(_this){return function(){return _this.bind()}}(this)),this.DEBUG&&this._debug(),"notTheHeader"===this.$viewport.attr("id")&&"collection"===Time.application.active_route&&this.enableMouseWheelUpScroll(),this.upThreshold="desktop"===Time.device&&(null!=(ref=Time.application.$pushdowns)?ref.height():void 0)>0?Time.application.$pushdowns.height()+this.threshold:this.threshold,this}return InfiniteScroll.prototype.DEBUG=getParameterByName("debug-is"),InfiniteScroll.prototype.mouseWheelUpScrollEnabled=!1,InfiniteScroll.prototype._debug=function(){0===$("#debug-upThreshold").length&&$("body").prepend('<div id="debug-upThreshold" style="display:block;position:absolute;width:100%;height:3px;background:blue;z-index:9999999;top:0px;"></div>'),0===$("#debug-viewportTop").length&&$("body").prepend('<div id="debug-viewportTop" style="display:block;position:absolute;width:100%;height:3px;background:red;z-index:9999999;top:0px;"></div>')},InfiniteScroll.prototype.bind=function(){return Time.off("body:scrolled",this.on_scroll),Time.on("body:scrolled",this.on_scroll)},InfiniteScroll.prototype.unbind=function(){return Time.off("body:scrolled",this.on_scroll)},InfiniteScroll.prototype.on_scroll=function(){return this.handle_scroll(),this},InfiniteScroll.prototype.handle_scroll=_.debounce(function(e){if(!this.paused)return this.DEBUG&&($("#debug-upThreshold").css("top",this.upThreshold),$("#debug-viewportTop").css("top",this.$viewport.scrollTop())),this.mouseWheelUpScrollEnabled&&this.disableMouseWheelUpScroll(),this.currentPosition=this.$viewport.scrollTop(),this.currentPosition<=this.upThreshold&&null!=this.up_callback&&this.position>this.currentPosition?(window.clearTimeout(this.upCallbackTimeout),this.upCallbackTimeout=window.setTimeout(function(_this){return function(){return _this.up_callback.call(_this.context)}}(this),500)):this.$viewport.height()+this.currentPosition+this.threshold>=this.$content.height()&&this.down_callback.call(this.context),this.position=this.currentPosition,this.position},50),InfiniteScroll.prototype.pause=function(){return this.paused=!0},InfiniteScroll.prototype.resume=function(){return this.paused=!1},InfiniteScroll.prototype.reset=function(){return this.position=0},InfiniteScroll.prototype.enableMouseWheelUpScroll=function(){this.mouseWheelUpScrollEnabled=!0,this.$viewport.on("DOMMouseScroll mousewheel",function(_this){return function(e){if((e.originalEvent.detail<0||e.originalEvent.wheelDelta>0)&&_this.$viewport.scrollTop()<=_this.upThreshold)return window.clearTimeout(_this.upScrollTimeout),_this.upScrollTimeout=window.setTimeout(function(){var ref;return null!=(ref=_this.up_callback)?ref.call(_this.context):void 0},100),_this.disableMouseWheelUpScroll()}}(this))},InfiniteScroll.prototype.disableMouseWheelUpScroll=function(){this.mouseWheelUpScrollEnabled=!1,this.$viewport.off("DOMMouseScroll mousewheel")},InfiniteScroll}(),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.component.MobileNavigation=function(superClass){function MobileNavigation(elSelector,options){var $doc,$header,posTop;MobileNavigation.__super__.constructor.apply(this,arguments),$doc=$(document),posTop=0,$header=$(".main-header"),$(this.opts.menuSelector).on("shown",function(){var headerHeight,viewportHeight,viewportWidth;posTop=$doc.scrollTop(),headerHeight=$header.outerHeight(),viewportHeight=$("body").height(),viewportWidth=$(window).width()}),$(this.opts.menuSelector).on("hidden",function(_this){return function(){Modernizr.touch&&$doc.scrollTop(posTop),$("body").css({overflow:"",position:""}),$(_this.opts.menuSelector).removeProp("style")}}(this)),$(this.opts.parentSelector).find(".main-nav a:not(.login-nav-item)").on("click",function(_this){return function(){_this.hide()}}(this))}return extend(MobileNavigation,superClass),MobileNavigation}(Time.component.Dropdown),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.component.RailSearch=function(superClass){function RailSearch(){return RailSearch.__super__.constructor.apply(this,arguments)}return extend(RailSearch,superClass),RailSearch.prototype.opts={parentSelector:"body",classToAdd:"show-search",menuSelector:".tabs-inner",handleClickOutside:!0,formSelector:".search-form",fieldSelector:".search-field"},RailSearch.prototype.toggle=function(evt){return evt&&evt.preventDefault(),this.isShowing?(this.handleEnter(),this.exitSearch(evt)):this.enterSearch(evt)},RailSearch.prototype.enterSearch=function(evt){return this.show(evt),this.placeholderShim(),$(".search-field").focus(),$("body").on("keydown.rail-search-"+this.opts.classToAdd,function(_this){return function(e){return _this.handleKeydown(e)}}(this))},RailSearch.prototype.handleKeydown=function(e){var key;return key=e.which||e.keyCode,this.isEnter(key)?this.handleEnter():this.isESC(key)?this.exitSearch():void 0},RailSearch.prototype.handleEnter=function(){var value;if(value=$(this.opts.fieldSelector).val(),value!==$(this.opts.fieldSelector).attr("placeholder")&&value.length&&!/\s+/.test(value))return $(this.opts.formSelector).submit()},RailSearch.prototype.exitSearch=function(evt){return $("body").off("keydown.rail-search-"+this.opts.classToAdd),this.hide(evt)},RailSearch.prototype.isEnter=function(key){return 13===parseInt(key)},RailSearch.prototype.isESC=function(key){return 27===parseInt(key)},RailSearch.prototype.placeholderShim=function(){var field,placeholder;return field=$(this.opts.fieldSelector),placeholder=field.attr("placeholder"),field.val()!==placeholder&&field.val(placeholder),field.focus(function(){if(this.value===placeholder)return this.setSelectionRange(0,0),field.addClass("empty")}),field.blur(function(){if(""===this.value)return this.value=placeholder}),$("body").on("keydown.@opts.fieldSelector",function(_this){return function(e){return _this.placeholderShimKeyDown(e,field,placeholder)}}(this)),$("body").on("keyup.@opts.fieldSelector",function(_this){return function(e){return _this.placeholderShimKeyUp(e,field,placeholder)}}(this))},RailSearch.prototype.placeholderShimKeyDown=function(e,field,placeholder){if(field.val()===placeholder)return field.val(field.val().replace(placeholder,"")).removeClass("empty")},RailSearch.prototype.placeholderShimKeyUp=function(e,field,placeholder){if(""===field.val())return field.setSelectionRange(0,0).val(placeholder).addClass("empty")},RailSearch}(Time.component.Dropdown),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.component.Modal=function(){function Modal(elSelector,config){return this.closeModal=bind(this.closeModal,this),this.show=bind(this.show,this),this.opts=$.extend(!0,{},this.defaults,config),this.$el=$(elSelector),this.opts.$html.on("click.smart-modal",this.opts.buttonSelector,this.show),this}return Modal.prototype.defaults={closeSelector:".close-button",buttonSelector:".modal-button",interiorSelector:".modal",classToShow:"active",isShowing:!1,$html:$("html")},Modal.prototype.show=function(e){var shownEvt;return null!=e&&e.preventDefault(),this.opts.isShowing?this.$el:(shownEvt=$.extend(!0,e,{type:"shown"}),this.isShowing=!0,this.opts.$html.css("overflow","hidden"),this.opts.$html.on("click.smart-modal-close",this.closeModal),this.$el.addClass(this.opts.classToShow).trigger(shownEvt))},Modal.prototype.hide=function(e){return null!=e&&e.preventDefault(),this.opts.isShowing=!1,this.opts.$html.off(".smart-modal-close"),this.opts.$html.css("overflow","visible"),this.$el.removeClass(this.opts.classToShow).trigger("hidden")},Modal.prototype.closeModal=function(e){var $targ,isCloseBtn,isNotModal;$targ=$(e.target||event.sourceElement),isCloseBtn=$targ.is(this.opts.closeSelector||$(this.opts.closeSelector).has($targ).length>0),isNotModal=!($(this.opts.interiorSelector).has($targ).length>0||$(this.opts.interiorSelector).is($targ)),(isNotModal||isCloseBtn)&&(e.preventDefault(),this.hide())},Modal.prototype.destroy=function(){return this.opts.$html.off(".smart-modal .smart-modal-close"),this.$el.off(".smart-modal").removeData(".smart-modal")},Modal}(),root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.models.Application=function(superClass){function Application(){return this.resetDividers=bind(this.resetDividers,this),this.onPrimaryGalleryFound=bind(this.onPrimaryGalleryFound,this),this.onArticleNavigated=bind(this.onArticleNavigated,this),Application.__super__.constructor.apply(this,arguments)}return extend(Application,superClass),Application.prototype._bootstrapDividerIndex=0,Application.prototype._initialGallerySlug="",Application.prototype.defaults={isPreview:!1,isPrintMode:!1,activeArticle:null,activeGallery:null,isFullscreen:!1,isPastPushdowns:null},Application.prototype.initialize=function(){return this.listenTo(Time,"article:navigated",this.onArticleNavigated),this.listenTo(Time,"article:primaryGallery:found",this.onPrimaryGalleryFound),this.listenTo(Time,"leftRail:flush",this.resetDividers),this},Application.prototype.onArticleNavigated=function(articleModel){var e;this.set("activeArticle",articleModel);try{sessionStorage.removeItem("testads")}catch(_error){e=_error,"undefined"!=typeof console&&null!==console&&console.error(e)}},Application.prototype.onPrimaryGalleryFound=function(galleryModel){this.set("activeGallery",galleryModel)},Application.prototype.resetDividers=function(){this._bootstrapDividerIndex=0,this._dividerIndex=1},Application.prototype.getDividerHtml=function(){var result;return null==Time.bootstrap.dividers?"":(result=Time.bootstrap.dividers[this._bootstrapDividerIndex],this._bootstrapDividerIndex++,this._bootstrapDividerIndex>=Time.bootstrap.dividers.length&&(this._bootstrapDividerIndex=0),result)},Application}(Backbone.Model),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,module=module||{},module.exports=Time.models.Article=function(superClass){function Article(){return Article.__super__.constructor.apply(this,arguments)}return extend(Article,superClass),Article.prototype.defaults={isActive:!1,format:null,listFormat:null,list_gallery_style:!1,url:null,title:"Untitled",post_type:null,time:null,is_cms:!1,sponsor:null,sponsor_timestamp:null,is_nativo:!1,magazine_id:null,magazine:null},Article.prototype.initialize=function(){var ref,ref1,ref2,ref3,ref4,ref5;return this.views={},this.get("singleView")&&(this.views.singleView=this.get("singleView")),this.get("sponsor")&&(this.set("is_cms",!this.isNativo()),"vsp"===this.get("sponsor").slug&&this.set("sponsor_timestamp",(new Date).getTime())),this.listenTo(this,"change:isActive",function(model,value,options){value&&this._maybeNavigateTo()}),this.listenTo(this,"view:destroy",function(){var ref,ref1;null!=(ref=this.views.tile_view)&&ref.destroy(),null!=(ref1=this.views.singleView)&&ref1.destroy(),this.views={}}),null!=(null!=(ref=Time.bootstrap)&&null!=(ref1=ref.single_article)&&null!=(ref2=ref1.outbrain)?ref2.widget_id:void 0)&&("mobile"===Time.device?Time.bootstrap.single_article.outbrain.widget_id=Time.bootstrap.single_article.outbrain.mobile_widget_id:Time.bootstrap.single_article.outbrain.widget_id=Time.bootstrap.single_article.outbrain.desktop_widget_id),null!=(null!=(ref3=Time.bootstrap)&&null!=(ref4=ref3.single_article)&&null!=(ref5=ref4.titles_outbrain)?ref5.widget_id:void 0)&&("mobile"===Time.device?Time.bootstrap.single_article.titles_outbrain.widget_id=Time.bootstrap.single_article.titles_outbrain.mobile_widget_id:Time.bootstrap.single_article.titles_outbrain.widget_id=Time.bootstrap.single_article.titles_outbrain.desktop_widget_id),"object"==typeof this.get("outbrain")&&this.set("outbrain",_.extend(this.get("outbrain"),{widget_id:"mobile"===Time.device?this.get("outbrain").mobile_widget_id:this.get("outbrain").desktop_widget_id})),"object"==typeof this.get("titles_outbrain")&&this.set("titles_outbrain",_.extend(this.get("titles_outbrain"),{widget_id:"mobile"===Time.device?this.get("titles_outbrain").mobile_widget_id:this.get("titles_outbrain").desktop_widget_id})),this},Article.prototype.isNativo=function(){return this.get("is_nativo")},Article.prototype.isSponsored=function(){return this.get("sponsor")},Article.prototype.url=function(){return Time.api_url+"post/"+this.id+"/"},Article.prototype.fetch=function(opts){var fn_complete,fn_error,fn_success;if(null==opts&&(opts={}),!this.syncing)return(null==opts.cache||opts.cache)&&(opts.cache=!0),this.trigger("sync:syncing"),this.syncing=!0,opts.dataType="json",fn_success=opts.success,opts.success=function(_this){return function(model,response,options){return"object"!=typeof response?(_this.trigger("sync:error"),opts.error(model,response,options),!1):(_this.trigger("sync:success"),null!=fn_success?fn_success(model,response,options):void 0)}}(this),fn_complete=opts.complete,opts.complete=function(_this){return function(model,response,options){if(_this.trigger("sync:complete"),_this.syncing=!1,null!=fn_complete)return fn_complete(model,response,options)}}(this),fn_error=opts.error,opts.error=function(_this){return function(model,response,options){if(_this.trigger("sync:error"),fn_error)return fn_error(model,response,options)}}(this),Backbone.Collection.prototype.fetch.call(this,opts)},Article.prototype.getBrandedTitle=function(){var title;return title=this.get("title"),/money_collection|money_collectionpost|money_article/.test(this.get("post_type"))?title+" | MONEY":title+" | TIME"},Article.prototype.getSectionTitle=function(){var ref;if(null!=(null!=(ref=this.get("section"))?ref.name:void 0))return this.get("section").name},Article.prototype.getTopicTitle=function(){return this.get("topic")?null!=this.get("topic").topic_header_title?this.get("topic").topic_header_title:null!=this.get("topic").name?this.get("topic").name:void 0:""},Article.prototype.getTopicSlug=function(){var ref;if(null!=(null!=(ref=this.get("topic"))?ref.slug:void 0))return this.get("topic").slug},Article.prototype.getEditDate=function(){return this.get("time").published.substring(0,10)},Article.prototype.getNativoData=function(){var data;return data=this.toJSON(),null==data.sponsor&&(data.sponsor={}),Time.application.isMoney()&&(data.sponsor.vertical="money"),data},Article.prototype.createTileView=function(overrides){var coverModel,defaults,options;if(null==overrides&&(overrides={}),defaults={model:this,collection:this.collection},options=_.extend(defaults,overrides),this.isNativo())return new Time.views.NativoArticleTile(options);switch(this.collection.active_env){case"magazine":return options.magazineId=this.get("magazine_id"),this.get("magazine")?new Time.views.MagazineCollapsible(options):(coverModel=this.collection.findWhere({cover:1,magazine_id:this.get("magazine_id")}),options.cover=coverModel.views.tile_view,options.$parent=options.cover.$('.rail-article-magazine-cover[data-issue="'+this.get("magazine_id")+'"] ~ .leftRailModule--collapsible__body'),new Time.views.MagazineTile(options));case"collection":return options.$el=$("#article-tile-"+this.id),new Time.views.ArticleCollectionsTile(options);default:return new Time.views.ArticleTile(options)}return null},Article.prototype._maybeNavigateTo=function(){return null!=this.collection&&(this.collection.freeze_url||this.collection.freeze_url_once)?this.collection.freeze_url_once=!1:this.navigateTo(),"undefined"!=typeof console&&null!==console&&console.info("article model triggering article:navigated on Time"),Time.trigger("article:navigated",this),this},Article.prototype.navigateTo=function(relativeUrl){var options,query,ref;return options={},Time.application.isInitialRoute?(query=window.location.search,relativeUrl=Time.application.stripBaseUrl(this.get("url"),query),options={replace:!0}):(relativeUrl=Time.application.stripBaseUrl(this.get("url")),(null!=(ref=this.collection)?ref.query:void 0)&&(relativeUrl+="?"+this.collection.query)),Time.trigger("article:navigate",relativeUrl,options),this},Article}(Backbone.Model),root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.models.DfpAd=function(superClass){function DfpAd(){return DfpAd.__super__.constructor.apply(this,arguments)}return extend(DfpAd,superClass),DfpAd.prototype.DEBUG=!0,DfpAd.prototype.adInstance=null,DfpAd.prototype.defaults={articleModel:null,isTethered:!1,tetherTo:null,isActive:!0,isParsed:!1,isRendered:!1,isTrigger:!1,isWritten:!1,isCmAd:!1,group:"",subgroup:"",sizesString:"",extraParams:null,ad_div:"",cmpos:"",cmtyp:"",etype:"",position:"1",size:null,slide:"",type:"",spons:"",dcopt:""},DfpAd.prototype.COMPANION_SIZE_WHITELIST=[],DfpAd.prototype.initialize=function(attributes,options){return this},DfpAd.prototype.isFetched=function(){var ref;return null!=("undefined"!=typeof tgxDo&&null!==tgxDo&&null!=(ref=tgxDo.slots)?ref[this.id]:void 0)},DfpAd.prototype.hasAdInstance=function(){return null!=this.adInstance},DfpAd.prototype.parsePosition=function(position){return null!=position?position+"":""},DfpAd.prototype.parseSlide=function(slide){return slide||""},DfpAd.prototype.parseEType=function(etype){return"gallery"===etype?"gallery":""},DfpAd.prototype.parseSize=function(sizeArray){var firstSize,result;return(null!=sizeArray?sizeArray.length:void 0)?(result={},firstSize=sizeArray[0].split("x"),result.sizeX=firstSize[0],result.sizeY=firstSize[1],result.sizesString=sizeArray.join("|"),result):(this.DEBUG&&("undefined"!=typeof console&&null!==console?console.warn("DfpAd parse - needs a size array of strings",this):void 0),null)},DfpAd.prototype.parseCmAd=function(response){var result;return result=_.clone(response),result.cmpos||(result.cmpos=response.position),result.cmtyp||(result.cmtyp=response.type),result},DfpAd.prototype.parse=function(response,options){var articleModel,parsedResponse,ref,result,sizeObject;return null==response&&(response={}),null==options&&(options={}),result={},(sizeObject=this.parseSize(response.size))?(result=_.extend(result,sizeObject),response.isCmAd&&(result=_.extend(result,this.parseCmAd(response))),result.position=this.parsePosition(response.position),result.slide=this.parseSlide(response.slide),result.etype=this.parseEType(response.group),result.spons="",articleModel=response.articleModel,null!=articleModel&&!articleModel.get("isSpecial")&&articleModel.isNativo()&&(result.spons=null!=(ref=articleModel.get("sponsor"))?ref.slug:void 0),response.sponsor&&(result.spons=response.sponsor),parsedResponse=_.extend(response,result),parsedResponse.isParsed=!0,parsedResponse):null},DfpAd.prototype.fetch=function(factory){var error;if(this.adInstance=null,null==factory)return void("undefined"!=typeof console&&null!==console&&console.error("DfpAd fetch - needs a TiiAdFactory to fetch with",this,factory));if(this.isFetched())return void("undefined"!=typeof console&&null!==console&&console.error("DfpAd fetch - already have ad in tgxDo",this,factory));try{this.get("isCmAd")?this.adInstance=factory.getCmAd(this.get("sizeX"),this.get("sizeY"),this.get("cmpos"),this.get("cmtyp")):this.adInstance=factory.getAd(this.get("sizeX"),this.get("sizeY"))}catch(_error){error=_error,"undefined"!=typeof console&&null!==console&&console.error("DfpAd fetch - failed to get adInstance",factory,this)}return this.DEBUG&&("undefined"!=typeof console&&null!==console?console.debug("DfpAd - fetched ad instance",this.id):void 0),this.adInstance},DfpAd.prototype.isCompanion=function(){var article,ref,ref1,ref2;return!(null==(ref=Time.application)||!ref.active_rail)&&(article=null!=(ref1=Time.application.model)?ref1.get("activeArticle"):void 0,null==article&&(article=Time.application.active_rail.first()),!((null!=article&&null!=(ref2=article.views)?ref2.singleView:void 0)&&!article.views.singleView.hasVideos())&&("leftRail"===this.get("group")&&"1"===this.get("position")))},DfpAd.prototype.sync=function(method,model,options){switch(method){case"delete":this.syncDelete(model);break;default:this.syncCreate()}return this},DfpAd.prototype.syncDelete=function(model,options){try{delete tgxDo.slots[this.id],delete tgxDo.slotparams[this.id]}catch(_error){}},DfpAd.prototype.syncCreate=function(model,options){var error;if(!this.adInstance)return void("undefined"!=typeof console&&null!==console&&console.error("DfpAd sync - tried to syncCreate without an adInstance",this,model,options));try{this.get("isCmAd")||this.adInstance.setParam("pos",this.get("position")),this.adInstance.setParam("ad_div",this.get("id")),this.adInstance.setParam("slide",this.get("slide")),this.adInstance.setParam("etype",this.get("etype")),this.get("dcopt")&&this.adInstance.setParam("dcopt",this.get("dcopt")),this.adInstance.setParam("spons",this.get("spons")),this.get("size").length>1&&this.adInstance.setParam("sz",this.get("size").join(",")),null!=this.get("extraParams")&&_.each(this.get("extraParams"),function(_this){return function(value,key,list){return _this.adInstance.setParam(key,value)}}(this)),this.isCompanion()?(this.DEBUG&&("undefined"!=typeof console&&null!==console?console.debug("DfpAd -- WRITING COMPANION AD",this.id,this.adInstance):void 0),this.adInstance.write(this.id,"companion")):(this.DEBUG&&("undefined"!=typeof console&&null!==console?console.debug("DfpAd -- WRITING AD",this.id,this.adInstance):void 0),this.adInstance.write(this.id))}catch(_error){error=_error,"undefined"!=typeof console&&null!==console&&console.error("DfpAd sync failed",this,error)}},DfpAd}(Backbone.Model),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.collections.DfpAds=function(superClass){function DfpAds(){return DfpAds.__super__.constructor.apply(this,arguments)}return extend(DfpAds,superClass),DfpAds.prototype.model=Time.models.DfpAd,DfpAds.prototype.initialize=function(){return this.listenTo(this,"remove",function(model,collection,options){model.adInstance=null,console.debug(model.id," DfpAd removed from collection, deleting slot");try{delete tgxDo.slots[model.id]}catch(_error){}}),this},DfpAds.prototype.getIds=function(options){var adModels,ids,ref;if(null==options&&(options=!1),options){if(null!=(ref=options.groups)?ref.length:void 0)return console.debug("-- getting div ids for "+options.groups.toString()),ids=[],_.each(options.groups,function(_this){return function(group){var groupIds,newOptions;return newOptions=_.omit(options,"groups"),newOptions.group=group,groupIds=_this.getIds(newOptions),ids=ids.concat(groupIds)}}(this)),ids;adModels=this.where(options)}else adModels=this.models;return ids=_.pluck(adModels,"id")},DfpAds}(Backbone.Collection),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.ContainingView=function(superClass){function ContainingView(){return this.getThresholdY=bind(this.getThresholdY,this),this.updateThreshold=bind(this.updateThreshold,this),ContainingView.__super__.constructor.apply(this,arguments)}return extend(ContainingView,superClass),ContainingView.prototype.DEBUG=getParameterByName("debug"),ContainingView.prototype.containingEl=null,ContainingView.prototype.$containingEl=null,ContainingView.prototype._isThresholdElContainingEl=!0,ContainingView.prototype.thresholdEl=null,ContainingView.prototype.$thresholdEl=null,ContainingView.prototype._thresholdMode=!1,ContainingView.prototype.threshold=0,ContainingView.prototype._thresholdY=0,ContainingView.prototype.initialize=function(options){return null==options&&(options={}),options.threshold&&(this.threshold=options.threshold),this._thresholdMode=null!=this.threshold||null!=this._thresholdY,options.thresholdEl&&this.setThresholdElement(options.thresholdEl),this.thresholdEl&&(this._isThresholdElContainingEl=!1),this.setContainingElement(options.containingEl||this.el),this.DEBUG&&this._debug(),this},ContainingView.prototype._debug=function(){$("<style> #debug-thresholdY:before { background: blue; color: white; content: 'thresholdY'; } #debug-elrect-top:before { background: red; color: white; content: 'elRectTop'; } #debug-elrect-bottom:before { background: green; color: white; content: 'elRectBottom'; } </style>").appendTo("head"),
0===$("#debug-thresholdY").length&&$("body").prepend('<div id="debug-thresholdY" style="display:block;position:absolute;width:100%;height:3px;background:blue;z-index:9999999;top:0px;"></div>'),0===$("#debug-elrect-top").length&&$("body").prepend('<div id="debug-elrect-top" style="display:block;position:absolute;width:100%;height:3px;background:red;z-index:9999999;top:0px;"></div>'),0===$("#debug-elrect-bottom").length&&$("body").prepend('<div id="debug-elrect-bottom" style="display:block;position:absolute;width:100%;height:3px;background:green;z-index:9999999;top:0px;"></div>')},ContainingView.prototype.render=function(){if(this._thresholdMode)return this.listenTo(Time,"application:resize",this.updateThreshold),this.updateThreshold(),this},ContainingView.prototype.updateThreshold=function(){return this._thresholdY=this.getThresholdY(),this.DEBUG&&$("#debug-thresholdY").css("top",this._thresholdY),this._thresholdY},ContainingView.prototype.setThresholdElement=function(el){return el instanceof jQuery?this.$thresholdEl=el:this.$thresholdEl=$(el),this.thresholdEl=this.$thresholdEl.get(0),this.thresholdEl},ContainingView.prototype.setContainingElement=function(el,alsoSetElement){return null==alsoSetElement&&(alsoSetElement=!1),el instanceof jQuery?this.$containingEl=el:this.$containingEl=$(el),this.containingEl=this.$containingEl.get(0),this._isThresholdElContainingEl&&this.setThresholdElement(el),alsoSetElement&&this.setElement(this.$containingEl),this.containingEl},ContainingView.prototype.isFilled=function(threshold){return null==threshold&&(threshold=100),this.el.scrollHeight>this.$thresholdEl.outerHeight(!0)+threshold},ContainingView.prototype.getThresholdY=function(threshold){var offsetTop;return null==threshold&&(threshold=this.threshold),offsetTop=this.$thresholdEl.length>0?this.$thresholdEl.offset().top:0,parseInt(this.$thresholdEl.height()*threshold+offsetTop,10)},ContainingView.prototype.getEls=function(selector,options){var $els,ref;return null==options&&(options={}),$els=selector?this.$(selector):jQuery(),(null!=(ref=options.detachedEls)?ref.length:void 0)&&($els=$els.add(options.detachedEls)),$els},ContainingView.prototype.rect=function(el){return null==el&&(el=this.containingEl),el.getBoundingClientRect()},ContainingView.prototype.isCoveredByRect=function(elRect,coveringRect){return!(elRect.bottom<coveringRect.top)&&!(elRect.top>coveringRect.bottom)},ContainingView.prototype.isRectVisible=function(rect){return!this.isBottomAboveContainer(rect)&&(!this.isTopBelowWindow(rect)&&(0!==rect.left||0!==rect.right))},ContainingView.prototype.isBottomAboveContainer=function(rect){return rect.bottom<this.$thresholdEl.offset().top},ContainingView.prototype.isTopBelowWindow=function(rect){return rect.top>$(window).height()},ContainingView.prototype.isAtTop=function(el){var containingElTop,elRect,elTop;return elRect=el.getBoundingClientRect(),elTop=elRect.top-parseInt($(el).css("margin-top"),10),this._thresholdMode&&this.$containingEl.offset().top>0?(containingElTop=this.containingEl.getBoundingClientRect().top,elTop-containingElTop===0):0===elTop},ContainingView.prototype.elPosition=function($el){var elRect,thresholdElRect;return elRect=$el.get(0).getBoundingClientRect(),thresholdElRect=this.thresholdEl.getBoundingClientRect(),elRect.bottom<thresholdElRect.top?"above":elRect.top>thresholdElRect.bottom?"below":"in"},ContainingView.prototype.isOnThreshold=function(el){var bottomOffset,containingElOffset,elRect,isAboveThreshold,isBelowThreshold;return elRect=this.rect(el),!!this.isRectVisible(elRect)&&(!!this.isAtTop(el)||(containingElOffset=this.$containingEl.offset().top,containingElOffset<0&&(containingElOffset=0),bottomOffset="collection"===Time.application.active_route?parseInt($(el).css("margin-bottom"),10):0,isAboveThreshold=elRect.top<=this._thresholdY+containingElOffset,isBelowThreshold=elRect.bottom+bottomOffset>=this._thresholdY+containingElOffset,this.DEBUG&&($("#debug-thresholdY").css("top",this._thresholdY),$("#debug-elrect-top").css("top",elRect.top),$("#debug-elrect-bottom").css("top",elRect.bottom+bottomOffset)),isAboveThreshold&&isBelowThreshold))},ContainingView.prototype.findContained=function($els,options){var $containedEls,windowRect;return null==options&&(options={}),$els.length?(options=_.defaults(options,{partial:!1,window:!0}),options.window&&(windowRect={top:0,left:0,right:$(window).width(),bottom:$(window).height()}),$containedEls=$els.filter(function(_this){return function(index,el){var isContained,isInWindow;return isContained=_this.isContained(el,options),options.window?(isInWindow=_this.isContained(el,{partial:options.partial,containerRect:windowRect}),isContained&&isInWindow):isContained}}(this))):jQuery()},ContainingView.prototype.isContained=function(el,options){var $el,elRect,isPartialMatched;return null==options&&(options={}),!!el&&(!!document.body.contains(el)&&($el=$(el),"none"!==$el.css("display")&&(elRect=this.rect(el),options=_.defaults(options,{partial:!1,containerRect:this.rect()}),!!this.isRectVisible(elRect,options.containerRect)&&(!!this.isRectHorizontallyContained(elRect)&&(isPartialMatched=options.partial===!0,!(!isPartialMatched||!this.isRectPartiallyContained(elRect,options.containerRect))||this.isRectFullyContained(elRect,options.containerRect))))))},ContainingView.prototype.isRectHorizontallyContained=function(rect){return rect.right>=0},ContainingView.prototype.isRectFullyContained=function(rect,containerRect){return null==containerRect&&(containerRect=this.rect()),this.isRectBelowTop(rect,containerRect)&&this.isRectAboveBottom(rect,containerRect)},ContainingView.prototype.isRectPartiallyContained=function(rect,containerRect){return null==containerRect&&(containerRect=this.rect()),this.isRectTopContained(rect,containerRect)||this.isRectBottomContained(rect,containerRect)},ContainingView.prototype.isRectTopContained=function(rect,containerRect){return null==containerRect&&(containerRect=this.rect()),this.isRectBelowTop(rect,containerRect)&&rect.top<=containerRect.bottom},ContainingView.prototype.isRectBottomContained=function(rect,containerRect){return null==containerRect&&(containerRect=this.rect()),this.isRectAboveBottom(rect,containerRect)&&rect.bottom>=containerRect.top},ContainingView.prototype.isRectAboveBottom=function(rect,containerRect){return null==containerRect&&(containerRect=this.rect()),rect.bottom<=containerRect.bottom},ContainingView.prototype.isRectBelowTop=function(rect,containerRect){return null==containerRect&&(containerRect=this.rect()),rect.top>=containerRect.top},ContainingView.prototype.getPercentVisible=function(rect){var percentVisible,wh;return wh=Time.application.sizes.wh||Math.ceil(Time.application.$body.height()),percentVisible=(wh-rect.top)/rect.height,percentVisible<=0||rect.bottom<0?0:percentVisible>=1?100:parseInt((wh-rect.top)/rect.height*100)},ContainingView}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,module=module||{},module.exports=Time.views.SubNav=function(superClass){function SubNav(){return SubNav.__super__.constructor.apply(this,arguments)}return extend(SubNav,superClass),SubNav.prototype.template=null,SubNav.prototype.data=null,SubNav.prototype.initialize=function(options){null==options&&(options={}),this.app=options.app,this.data=options.data,this.listenTo(this.app.model,"change:isPastPushdowns",this.setIsSubNavPastPushdowns)},SubNav.prototype.render=function(){return this.template?this.data?void 0:"undefined"!=typeof console&&null!==console?console.error("No data for Sub Nav!"):void 0:"undefined"!=typeof console&&null!==console?console.error("No template for Sub Nav!"):void 0},SubNav.prototype.setIsSubNavPastPushdowns=function(){this.$el.toggleClass("sub-nav--past-pushdowns",this.app.model.get("isPastPushdowns"))},SubNav}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,module=module||{},module.exports=Time.views.Application=function(superClass){function Application(){return this.destroyCollection=bind(this.destroyCollection,this),this.onClickAnchor=bind(this.onClickAnchor,this),this.reset_scroll=bind(this.reset_scroll,this),this.scrollTo=bind(this.scrollTo,this),this.detectScrollDirection=bind(this.detectScrollDirection,this),this._onMainScroll=bind(this._onMainScroll,this),this._onClickBody=bind(this._onClickBody,this),this._onClickExpandShare=bind(this._onClickExpandShare,this),this.toggleFullscreenGallery=bind(this.toggleFullscreenGallery,this),this._onGalleryKeyboardEvent=bind(this._onGalleryKeyboardEvent,this),this.reposition=bind(this.reposition,this),this._onWindowResize=bind(this._onWindowResize,this),this.renderSkybox=bind(this.renderSkybox,this),this.destroyDynamicHeader=bind(this.destroyDynamicHeader,this),this.renderDynamicHeader=bind(this.renderDynamicHeader,this),this.bindHamburger=bind(this.bindHamburger,this),Application.__super__.constructor.apply(this,arguments)}var ref;return extend(Application,superClass),Application.prototype.el=document,Application.prototype.events={"click .sign-in-form__submit-button":"_onClickSignin","click a":"onClickAnchor","click a.popup":"_onClickOpenPopup","click body":"_onClickBody","click .ie-message-modal":"hideIeModal","click .expand-share":"_onClickExpandShare","click .toggle-magazine-region-dropdown":"toggle_magazine_region_dropdown","click .magazine-region":"toggle_magazine_region_dropdown",'click .sign-sub-wrap a[href="#signin"], .sign-in':"_onClickSign","click .reset-password":"_onClickResetPassward"},Application.prototype.DEBUG=!0,Application.prototype.featureToggles={dynamicHeader:(null!=(ref=Time.bootstrap)?ref.dynamic_header:void 0)||!1,chivasTiles:!1,fbEmbeds:!1},Application.prototype.baseUrl=window.location.protocol+"//"+window.location.host,Application.prototype.hasPushstate=Modernizr.history&&window.location.href.indexOf("nopushstate")===-1,Application.prototype.isInitialRoute=!0,Application.prototype.is_homepage=!1,Application.prototype.isPushdownPinned=!1,Application.prototype.adSizes=[],Application.prototype.adPlacements={subAd:["article","popular"],sectionSubAd:["section","videos"],dynamicHeaderSubAd:[]},Application.prototype.sizes={},Application.prototype.isIOS7=navigator.userAgent.match(/(iPad|iPhone|iPod touch);.*CPU.*OS 7_\d/i),Application.prototype.isNativeAndroid=function(){var isAndroid,isChrome,isMozilla,isWebkit;return isMozilla=navigator.userAgent.indexOf("Mozilla/5.0")>-1,isAndroid=navigator.userAgent.indexOf("Android ")>-1,isWebkit=navigator.userAgent.indexOf("AppleWebKit")>-1,isChrome=navigator.userAgent.indexOf("Chrome")>-1,isMozilla&&isAndroid&&isWebkit&&!isChrome},Application.prototype.breakpoints=[450,750,800,1024,1206],Application.prototype.currentBreakpoint=0,Application.prototype.ticker=null,Application.prototype.isTickerEnabled=!1,Application.prototype.dynamicHeader=null,Application.prototype.isDynamicHeaderEnabled=!1,Application.prototype.isMoveSubAd=!1,Application.prototype._lastScrollPosition=0,Application.prototype.initialize=function(options){return null==options&&(options={}),this.model&&this.listenTo(this.model,"change:activeArticle",function(_this){return function(model,value,options){(null!=value&&"function"==typeof value.get?value.get("isActive"):void 0)&&_this.$window.trigger("time-article-active")}}(this)),this.promoTray=new Time.views.PromoTray({app:this}),this.featureToggles.fbEmbeds&&(this.facebookFacade=new Time.modules.FacebookFacade({app:this})),this.setLMPCookie(),this.listenTo(Time,"env:init",this.destroyCollection),this},Application.prototype.initAds=function(){return this.mediator=new Time.modules.Mediator({app:this}),this.chartbeatFacade=new Time.modules.ChartbeatFacade({app:this}),this.omnitureFacade=new Time.modules.OmnitureFacade({app:this}),this.mediator.addPeers({omniture:this.omnitureFacade}),this.comscoreFacade=new Time.modules.ComscoreFacade({app:this}),this.mediator.addPeers({comscore:this.comscoreFacade}),this.pinnionFacade=new Time.modules.PinnionFacade({app:this}),this.mediator.addPeers({pinnion:this.pinnionFacade}),this.paywallFacade=new Time.modules.PaywallFacade({app:this}),this.isAdsEnabled=window.location.href.indexOf("noads")===-1,this.isAdsEnabled&&(Time.Ad=window.TimeAdFactory,this.getAdSizes(),this.tgxFactory=new Time.modules.TgxFactory({},{app:this})),this.isAdsEnabled&&(this.dfpAds=new Time.collections.DfpAds,this.tgxFacade=Time.tgxFacade=new Time.modules.TgxFacade({app:this,model:this.tgxFactory,collection:this.dfpAds}),this.mediator.addPeers({tgx:this.tgxFacade}),this.nativoFacade=new Time.modules.NativoFacade({app:this,model:this.tgxFactory}),this.mediator.addPeers({nativo:this.nativoFacade})),this.mediator.initialize(),this},Application.prototype.getAdSizes=function(){var error;try{"mobile"===Time.device?this.adSizes=Time.Ad.getAdSizes("mobile"):"tablet"===Time.device?"tablet"===Time.device&&"portrait"===this.orientation?this.adSizes=Time.Ad.getAdSizes("mobile"):this.adSizes=Time.Ad.getAdSizes("tablet"):this.adSizes=Time.Ad.getAdSizes("desktop")}catch(_error){error=_error,console.error("error getting ad sizes",error)}},Application.prototype.isBootstrappedCollection=function(collectionSlug){var ref1,ref2;return null==collectionSlug&&(collectionSlug=""),collectionSlug===(null!=(ref1=Time.bootstrap)&&null!=(ref2=ref1.collection)?ref2.collection_slug:void 0)},Application.prototype.isInCollection=function(){return null!=Time.bootstrap.collection},Application.prototype.getCollectionID=function(){var ref1,ref2;return null!=(ref1=Time.bootstrap)&&null!=(ref2=ref1.collection)?ref2.collection_id:void 0},Application.prototype.isInVault=function(){return null!=Time.bootstrap.vault},Application.prototype.isInMagazine=function(){var ref1;return"magazine"===(null!=(ref1=this.active_rail)?ref1.active_env:void 0)||!(!this.isInitialRoute||!Time.bootstrap.magazine)},Application.prototype.isInSection=function(){var ref1;return"section"===(null!=(ref1=this.active_rail)?ref1.active_env:void 0)||!(!this.isInitialRoute||!Time.bootstrap.section)},Application.prototype.isInTopic=function(){var ref1;return"topic"===(null!=(ref1=this.active_rail)?ref1.active_env:void 0)||null!=Time.bootstrap.topic},Application.prototype.isTopicPage=function(){var $topic;return!!$(".left-rail-topper").length&&($topic=$(".left-rail-topper").find("#topic"),$topic.length&&$topic.hasClass("active"))},Application.prototype.getPageType=function(){var pageType;return this.isTopicPage()?"topic":(pageType=null!=this.active_route?this.active_route:void 0,"rail"===pageType&&(pageType="article"),pageType)},Application.prototype.getActiveArticle=function(){return this.model.get("activeArticle")},Application.prototype.getActiveGallery=function(){var activeArticle,activeArticleView,activeGalleryModel,galleriesCollection,ref1,topBannerHeight,windowTop;return this.model.get("activeArticle")?(activeArticle=this.model.get("activeArticle"),activeArticleView=null!=activeArticle&&null!=(ref1=activeArticle.views)?ref1.singleView:void 0,null==activeArticleView?null:(galleriesCollection=activeArticleView.galleriesCollection,(null!=galleriesCollection?galleriesCollection.size():void 0)?(windowTop=this.$window.scrollTop(),topBannerHeight=this.$topBanner.height(),activeGalleryModel=galleriesCollection.find(function(gallery,i){var galleryTop,ref2;return!(null==(ref2=gallery.view)||!ref2.$el)&&(!!gallery.get("isFullscreen")||(galleryTop=gallery.view.$el.offset().top,galleryTop>=windowTop+topBannerHeight||void 0))}),null!=activeGalleryModel?(this.model.set("activeGallery",activeGalleryModel),activeGalleryModel):null):null)):null},Application.prototype.getOrientation=function(){return this.sizes.ww<this.sizes.wh?"portrait":"landscape"},Application.prototype.render=function(){var isPrintMode;return this.$wpAdminBar=$("#wpadminbar"),this.wpAdminBarHeight=this.$wpAdminBar.outerHeight(),this.$window=$(window),this.$html=$("html"),this.title=$("title").text(),this.$body=$("body"),this.$main_header=this.$body.find(".main-header"),this.mainHeaderZIndex=this.$main_header.css("z-index"),this.$mainNav=this.$main_header.find(".left-rail-header").find(".main-nav"),this.$topBanner=this.$main_header.find(".top-banner"),this.$hatContainer=this.$main_header.find(".hat_container"),this.$topHeaderTitle=this.$topBanner.find(".top-header-title"),this.$leftRailWrapper=this.$body.find(".leftRailWrapper"),this.$leftRailTopper=this.$leftRailWrapper.find(".left-rail-topper"),this.$articleListScroll=this.$leftRailWrapper.find(".rail-articles-scroll"),this.$notHeader=$("#notTheHeader"),this.$notHeaderWrapper=$("#notTheHeader > .wrapper"),this.$pushdowns=this.$body.find(".pushdowns"),this.$pushdown=this.$pushdowns.find("#pushdown-ad"),this.pushdownZIndex=this.$pushdowns.css("z-index"),this.$magazineCover=$(".magazine-cover:first"),this.$viewport=this.$notHeader.find(".article-viewport"),this.$viewportWrapper=this.$notHeader.find(".article-viewport > .wrapper"),isPrintMode=!$(".print-mode").is(":hidden"),this.model.set("isPrintMode",isPrintMode),this.$html.addClass(Time.device).toggleClass("print",isPrintMode),this.hasPushstate||this.setBranding(),Modernizr.svg||this.svgFallback(),isPrintMode||this.renderDeviceMode(),Time.trigger("application:rendered"),this.$body.removeClass("hidden"),this},Application.prototype.setBranding=function(branding){var ref1;if(null==branding&&(branding=null!=(ref1=Time.bootstrap)?ref1.branding:void 0),branding)return this.$body.addClass(branding+"-branding")},Application.prototype.setTabHref=function(){var i,l,tabs;if("time"!==Time.bootstrap.branding)for(tabs=Time.tab_data.default.tabs,l=tabs.length,i=0;i<l;)tabs[i].href="/"+Time.bootstrap.branding+tabs[i].href,i+=1},Application.prototype.touchUnfocus=function(){return this.$body.on("blur","input, textarea",function(_this){return function(e){window.clearTimeout(_this._touchUnfocusTimeout),_this._touchUnfocusTimeout=window.setTimeout(function(){var d,h;return d=$(document),h=d.scrollTop(),d.scrollTop(h+1)},750)}}(this))},Application.prototype.renderDeviceMode=function(){return Modernizr.touch&&this.touchUnfocus(),this.setTabHref(),this.autoshowIeModal(),Time.components.main_modal=new Time.component.Modal("#Sign_In_Modal",{buttonSelector:'.sign-sub-wrap a[href="#signin"], .subscribe a[href="#signin"], .login-nav-wrapper .sign-in, .inline_article_signin .sign-in'}),this.signinModal=new Time.component.Modal("#Sign_In_Modal",{buttonSelector:'.sign-sub-wrap a[href="#signin"], .subscribe a[href="#signin"], .login-nav-wrapper .sign-in, .inline_article_signin .sign-in'}),Time.components.main_modal=new Time.component.Modal("#Reset_Password_Modal",{buttonSelector:".reset-password"}),this.resetPasswordModal=new Time.component.Modal("#Reset_Password_Modal",{buttonSelector:".reset-password"}),this.getSizes(),this.checkLogin(),this.initAds(),this.bindHamburger(),this.initHeader(),this.bindDeviceType(),this.resizeWindow(),this.$window.on("resize",_.throttle(this._onWindowResize,100)),this.$window.on("scroll",_.throttle(this._onMainScroll,100)),this.bindArticleEvents(),this},Application.prototype.getContributorModal=function(){return this.isInSection()?(Time.components.contributor_modal=new Time.component.Modal("#contributor-modal",{buttonSelector:".contributor-signup"}),Time.components.contributor_modal):null},Application.prototype.bindHamburger=function(){this.$mainNav.on("shown",function(_this){return function(){return"function"==typeof window.omniTrackEv&&window.omniTrackEv("nav-expose"),_this.isPushdownPinned&&null!=_this.tgxFactory.calculatedPushdownHeight&&_this.$mainNav.css("margin-top",_this.tgxFactory.calculatedPushdownHeight),Time.trigger("hamburger:opened")}}(this)),this.$mainNav.on("hidden",function(_this){return function(){return Time.trigger("hamburger:closed")}}(this))},Application.prototype.render_section_header=function(data){var html;return html=Time.templates["top-header"].render(data),this.$topBanner.html(html),this.active_rail.load_tabs(this.active_rail.sub,".rail-tabs"),this},Application.prototype.render_top_banner=function(data){var html;return html=Time.templates["top-header"].render(data),this.$topBanner.html(html),this},Application.prototype.initHeader=function(){if(this.listenTo(Time,"leftRail:flush",function(_this){return function(){_this.isTickerEnabled=!1,_this.isDynamicHeaderEnabled=!1}}(this)),this.isDynamicHeaderEnabled=this.featureToggles.dynamicHeader&&!this.isMoney(),this.isDynamicHeaderLeftRailAdEnabled=!1,this.isDynamicHeaderEnabled)return this.listenToOnce(Time,"dynamicHeader:initialize",this.initDynamicHeader),this.initDynamicHeader()},Application.prototype.initDynamicHeader=function(){this.isDynamicHeaderLeftRailAdEnabled&&(this.adPlacements.dynamicHeaderSubAd=_.clone(this.adPlacements.subAd)),this.adPlacements.subAd.length=0,this.listenTo(Time,"dynamicHeader:enable",function(_this){return function(){_this.stopListening(Time,"ticker:enable"),_this.stopListening(Time,"ticker:show"),_this.isTickerEnabled=!1,_this.isDynamicHeaderEnabled=!0,_this.renderDynamicHeader()}}(this)),this.listenTo(Time,"dynamicHeader:disable",this.destroyDynamicHeader)},Application.prototype.renderDynamicHeader=function(){null==this.dynamicHeader&&(this.DEBUG&&console.debug("DYNAMIC HEADER, RENDER!!!!"),null==Time.page&&(this.removeSubAd(),this.isMoveSubAd&&this.addSubAdPlaceholder()),this.dynamicHeader=new Time.views.DynamicHeaderImage({app:this}))},Application.prototype.destroyDynamicHeader=function(){var ref1;null==Time.page&&this.restoreSubAd(),null!=(ref1=this.dynamicHeader)&&ref1.destroy(),this.dynamicHeader=null},Application.prototype.removeSubAd=function(){this.$("#sub-ad").remove()},Application.prototype.addSubAdPlaceholder=function(){var $cmAdPlaceholder;$cmAdPlaceholder=$("<div />",{id:"sub-ad-placeholder"}),$cmAdPlaceholder.prependTo(this.$articleListScroll)},Application.prototype.restoreSubAd=function(){var $cmAdPlaceholder;this.$("#sub-ad, #sub-ad-placeholder").remove(),$cmAdPlaceholder=$("<div />",{id:"sub-ad","data-cb-ad-id":"sub-ad"}),$cmAdPlaceholder.appendTo(this.$topBanner)},Application.prototype.initSkybox=function(){this.listenTo(Time,"ticker:enable",function(_this){return function(){_this.stopListening(Time,"dynamicHeader:enable"),_this.stopListening(Time,"dynamicHeader:disable"),_this.isDynamicHeaderEnabled=!1,_this.isTickerEnabled=!0}}(this)),this.listenTo(Time,"ticker:show",function(_this){return function(){if(_this.isTickerEnabled)return _this.renderSkybox()}}(this))},Application.prototype.renderSkybox=function(){return"mobile"===Time.device?this:null!=this.ticker?this.ticker.render():(this.ticker=new Time.views.SkyboxTicker({app:this}),this)},Application.prototype._onWindowResize=function(e){this.getSizes(),this.resizeWindow(),this.reposition(),Time.trigger("application:resize",e)},Application.prototype.getSizes=function(sizes1){var $collectionSubnav;return this.sizes=null!=sizes1?sizes1:{},this.sizes.ww=this.$window.width(),this.sizes.wh=Math.ceil(this.$body.height()),this.sizes.headerHeight=this.$main_header.outerHeight(),this.$wpAdminBar.length&&(this.sizes.headerHeight+=this.wpAdminBarHeight),$collectionSubnav=$(".collection-hub-banner-wrapper"),$collectionSubnav.length&&$collectionSubnav.is(":visible")&&(this.sizes.headerHeight+=$collectionSubnav.outerHeight()),this.sizes.headerHeightWithTopper=this.sizes.headerHeight+this.$leftRailTopper.outerHeight(),this.sizes},Application.prototype.getBreakpoint=function(){var breakpoint;return breakpoint=_.find(this.breakpoints,function(_this){return function(bp){return bp>=_this.sizes.ww}}(this)),breakpoint||(breakpoint=_.last(this.breakpoints)),breakpoint},Application.prototype.resizeWindow=function(){var newBreakpoint,newOrientation;newOrientation=this.getOrientation(),this.orientation!==newOrientation&&(this.orientation=newOrientation,Time.trigger("application:orientationchanged")),newBreakpoint=this.getBreakpoint(),this.currentBreakpoint!==newBreakpoint&&(this.currentBreakpoint=newBreakpoint,this.renderMobileNavigation(),Time.trigger("application:breakpointchanged")),this.setIsPastPushdowns()},Application.prototype.bindDeviceType=function(){return this.listenTo(Time,"application:breakpointchanged",function(_this){return function(){var newDeviceType;if(newDeviceType=_this.getDeviceType(),Time.device!==newDeviceType)return Time.device=newDeviceType,Time.trigger("application:devicetypechanged",newDeviceType)}}(this))},Application.prototype.getDeviceType=function(){return this.currentBreakpoint<=750?"mobile":this.currentBreakpoint<=1024?"tablet":"desktop"},Application.prototype.reposition=function(){Tether.position()},Application.prototype.setIsPastPushdowns=function(){this.sizes.headerHeight&&this.model.set("isPastPushdowns",!0)},Application.prototype.bindArticleEvents=function(){return this.listenToOnce(Time,"article:activated",function(_this){return function(articleView){_this.$body.on("keydown.gallery-arrows",_this._onGalleryKeyboardEvent)}}(this)),this.listenTo(Time,"article:activated",function(_this){return function(articleView){var headerTitle;_this.setTitle(articleView.model.getBrandedTitle()),_this.isInCollection()||"college-news-and-advice"!==articleView.model.getTopicSlug()&&(headerTitle=articleView.model.getTopicTitle(),null==headerTitle&&(headerTitle=articleView.model.getSectionTitle()),null!=headerTitle&&_this.setTopicHeaderTitle(headerTitle))}}(this)),this.listenTo(Time,"gallery:isFullscreen",this.toggleFullscreenGallery),this.isMoney()&&(this.calcxmlModule=new Time.views.CalcxmlModal),this},Application.prototype._onGalleryKeyboardEvent=function(e){var galleryModel,ref1;galleryModel=this.getActiveGallery()||null,galleryModel&&null!=(ref1=galleryModel.view)&&ref1.trigger("gallery:keyboardEvent",e)},Application.prototype.toggleFullscreenGallery=function(galleryView,isFullscreen){var ref1;this.model.set("isFullscreen",isFullscreen),this.$html.toggleClass("fullscreenmode",isFullscreen),isFullscreen||(null!=galleryView&&null!=(ref1=galleryView.parent)?ref1.$el:void 0)&&this.$notHeader.scrollTo(galleryView.parent.$el),Tether.position()},Application.prototype._onClickSignin=function(e){var $form,$targ,ref1,ref2,trimmedURL;e.preventDefault(),$targ=$(e.target||e.sourceElement),$form=$($targ.closest("form")),trimmedURL=document.URL.split("?"),trimmedURL=trimmedURL[0],null!=(ref1=$form.find('input[name="rurl"]'))&&ref1.val(trimmedURL+"?loginfailure=true"),null!=(ref2=$form.find('input[name="turl"]'))&&ref2.val(trimmedURL),$form.submit()},Application.prototype._onClickSign=function(e){e.preventDefault(),$("#signinOverlay").attr("src",$("#signinOverlay").data("url"))},Application.prototype._onClickResetPassward=function(e){e.preventDefault(),$("#resetPasswordOverlay").attr("src",$("#resetPasswordOverlay").data("url"))},Application.prototype.checkLogin=function(){var logoutUrl,signOutDiv;window.location.search.replace(/\??(?:([^=]+)=([^&]*)&?)/g,function(_this){return function(){var decode,urlPath;if(decode=function(s){return decodeURIComponent(s.split("+").join(" "))},Time.$_GET[decode(arguments[1])]=decode(arguments[2]),Time.$_GET.loginfailure)return urlPath=document.URL.split("?")[0],_this.hasPushstate&&window.history.pushState({html:"",pageTitle:""},"",urlPath),$("#Sign_In_Modal_Error").removeClass("hidden"),_this.signinModal.show()}}(this)),Time.CookiesPlugin.get("TimeIAT")&&Time.bootstrap.auth_url&&(logoutUrl=Time.bootstrap.auth_url+"logout.php",signOutDiv='<a href="'+logoutUrl+"?turl="+window.location.href+'/">Sign Out</a>')},Application.prototype.toggle_share_tooltip=function(e){var $targ,is_showing;return"close"===e?$(".expand-share").removeClass("expanded"):($targ=$(e.target),is_showing=$targ.hasClass("expanded"),$(".expand-share").removeClass("expanded"),void(is_showing||($targ.addClass("expanded"),"function"==typeof window.omniTrackEv&&window.omniTrackEv("exp-micro"))))},Application.prototype._onClickExpandShare=function(e){null!=e&&e.preventDefault(),this.toggle_share_tooltip(e)},Application.prototype._onClickBody=function(e){this.trigger("body:clicked"),$(e.target).hasClass("expand-share")||this.toggle_share_tooltip("close")},Application.prototype.svgFallback=function(){$('img[src$=".svg"]').each(function(i,el){var $el,fallback,src;return $el=$(el),fallback=$el.attr("data-fallback"),src=$el.attr("src"),$el.attr("src",fallback||src.replace(".svg",".png"))})},Application.prototype.hide_images=function($el){var images;images=$el.find("img"),images.each(function(x,$el){var $this;return $this=$(this),$this.css({height:$this.height()}).attr({"old-src":$this.attr("src"),src:""})})},Application.prototype.show_images=function($el){var images;images=$el.find("img"),images.each(function(x,$el){var $this;return $this=$(this),$this.css({height:""}).attr({src:$this.attr("old-src")})})},Application.prototype.init_search=function(){this.$search_component&&(this.$search_component=null,delete this.$search_component),this.$search_component=this.makeComponent("RailSearch",".main-nav-search-icon",{})},Application.prototype.getRailView=function(){var ref1,ref2;return(null!=(ref1=Time.page)?ref1.rail_view:void 0)||(null!=(ref2=this.active_rail)?ref2.view:void 0)},Application.prototype.load_tabs=function(tabs,el_selector){var ref1;return null==tabs&&(tabs=Time.tab_data.default),null==el_selector&&(el_selector=!1),$(".rail-tabs").empty(),null!=(ref1=this.tabs_view)&&ref1.destroy(),this.tabs_view=new Time.views.Tabs(tabs,el_selector),this.init_search(),this},Application.prototype._onMainScroll=function(e){this.model.get("isFullscreen")||(Time.trigger("body:scrolled",e),this.setIsPastPushdowns(),this.detectScrollDirection())},Application.prototype.detectScrollDirection=function(){if(this._currentScrollPosition=this.$window.scrollTop(),this._lastScrollPosition>this._currentScrollPosition?this.currentDirection="up":this._lastScrollPosition<this._currentScrollPosition&&(this.currentDirection="down"),this._lastScrollPosition=this._currentScrollPosition,this.currentDirection&&this.currentDirection!==this.lastDirection){switch(this.currentDirection){case"up":Time.trigger("scroll:direction-changed","up");break;case"down":Time.trigger("scroll:direction-changed","down")}this.lastDirection=this.currentDirection}},Application.prototype.scrollTo=function(target,options){this.$window.scrollTo(target,options)},Application.prototype.reset_scroll=function(scrollTo){return null==scrollTo&&(scrollTo=this.readingPane.$el),window.clearTimeout(this.resumeInfiniteScrollTimeout),Time.trigger("readingPane:pauseScrolling"),this.$body.removeClass("hidden"),this.$notHeader.scrollTo(scrollTo,{offset:1}),this.setIsPastPushdowns(),this.getSizes(),this.resizeWindow(),this.reposition(),this.resumeInfiniteScrollTimeout=window.setTimeout(function(){return Time.trigger("readingPane:resumeScrolling"),Time.trigger("application:ready")},500),this},Application.prototype._onClickOpenPopup=function(e){var $clickedEl,HEIGHT,WIDTH,href,options;return e.preventDefault(),$clickedEl=$(e.currentTarget),href=$clickedEl.data("href")||$clickedEl.attr("href"),WIDTH=$clickedEl.data("width")||$clickedEl.attr("width")?$clickedEl.data("width")||$clickedEl.attr("width"):550,HEIGHT=$clickedEl.data("height")||$clickedEl.attr("height")?$clickedEl.data("height")||$clickedEl.attr("height"):420,options="scrollbars=yes,resizable=yes,toolbar=no,location=yes,width="+WIDTH+",height="+HEIGHT,window.open(href,"Share",options),!1},Application.prototype.isHardLink=function($el){var $articleTile,HARDLINK_ANCHOR_IDS,HARDLINK_BODY_CLASSES,articleId,ref1;if(HARDLINK_BODY_CLASSES=[".home",".page-template-pagespage-special-story-php",".masonry",".error404",".ti-sitemap"].join(","),this.$body.is(HARDLINK_BODY_CLASSES))return!0;if(HARDLINK_ANCHOR_IDS=["collection","magazine"],ref1=$el.attr("id"),indexOf.call(HARDLINK_ANCHOR_IDS,ref1)>=0)return!0;if("nav-latest"===$el.data("event"))return!0;if("skybox"===$el.data("event")){if(null==this.getRailView().collection)return!0;if($articleTile=$el.closest("[data-article]"),0===$articleTile.length)return!0;if(articleId=$articleTile.data("article"),!this.getRailView().collection.get(articleId))return!0;
}return!1},Application.prototype.onClickAnchor=function(e){var $clickedEl,HARDLINK_CLASSES,href,isTrigger,path;if(href=e.currentTarget.href,$clickedEl=$(e.currentTarget),href&&($clickedEl.is("[data-bypass]")&&(window.location=href),this.isInternalLink(href)&&(HARDLINK_CLASSES=[".sponsored-from"].join(","),!$clickedEl.is(HARDLINK_CLASSES)&&"desktop"===Time.device&&$clickedEl.is(".article-permalink,.next-article-link__href"))))return e.preventDefault(),this.isHrefToArticle(href)&&!this.isHardLink($clickedEl)&&this.isInternalLink(document.referrer)?(path=this.stripBaseUrl(href),isTrigger=!$clickedEl.is("[data-silent]"),Time.trigger("link:navigate",path,{trigger:isTrigger}),void this.scrollTo(0)):void(window.location=href)},Application.prototype.isLinkToDifferentBrand=function(path){var isMoneyLink;return isMoneyLink=this.isMoney(path),!("time"!==Time.bootstrap.branding||!isMoneyLink)||"money"===Time.bootstrap.branding&&!isMoneyLink},Application.prototype.isHrefToArticle=function(url){var baseRegex,isInSite,isMoneySpecial,moneyPageRegex,sanitizedUrl;return sanitizedUrl=this.stripBaseUrl(url),!this.isLinkToDifferentBrand(sanitizedUrl)&&(baseRegex=/^\/($|(([0-9]+)\/)|(author\/)|(magazine)|(money\/)|(collection\/)|(topic\/)|(tag\/)|(content\-from\/)|(right-now\/)|(popular\/)|(videos\/))/,isInSite=baseRegex.test(sanitizedUrl),moneyPageRegex=/^\/money\/page\//,isMoneySpecial=moneyPageRegex.test(sanitizedUrl),!(!isInSite||isMoneySpecial))},Application.prototype.isInternalLink=function(url){return null==url&&(url=""),"#"!==url.charAt(0)&&"#"!==url.charAt(url.length-1)&&(!/^mailto:/.test(url)&&(!/^javascript:/.test(url)&&(url.indexOf("//")===-1||url.substr(0,this.baseUrl.length)===this.baseUrl)))},Application.prototype.stripBaseUrl=function(fullUrl,parametersOverride){var parameterIndex,parameters,relativeUrl,sanitizedUrl,sub;return null==fullUrl&&(fullUrl=""),null==parametersOverride&&(parametersOverride=""),sanitizedUrl=fullUrl,fullUrl.indexOf(this.baseUrl)!==-1?sanitizedUrl=fullUrl.substr(this.baseUrl.length):"https:"===window.location.protocol&&(sub="http://"+window.location.host,fullUrl.indexOf(sub)!==-1&&(sanitizedUrl=fullUrl.substr(sub.length))),parameterIndex=sanitizedUrl.indexOf("?"),parameterIndex!==-1?(relativeUrl=sanitizedUrl.substring(0,parameterIndex),parameters=sanitizedUrl.substr(parameterIndex)):(relativeUrl=sanitizedUrl,parameters=""),parametersOverride&&(parameters=parametersOverride),relativeUrl+parameters},Application.prototype.isMoney=function(path){var REGEX_IS_MONEY;return null==path&&(path=""),path||(path=this.stripBaseUrl(window.location.href)),REGEX_IS_MONEY=/^\/?money|post_type=(money_(article|collection|collectionpost|page)|time_money_homepage)/,REGEX_IS_MONEY.test(path)},Application.prototype.htmlDecode=function(str){var a_el;return a_el=document.createElement("a"),a_el.innerHTML=str,a_el.textContent},Application.prototype.setTitle=function(title){return this.title=this.htmlDecode(title),document.title=this.title,this.title},Application.prototype.setTopicHeaderTitle=function(topicHeaderTitle){if(!this.$topHeaderTitle.hasClass("time-icons"))return this.$topHeaderTitle.html(topicHeaderTitle)},Application.prototype.makeComponent=function(componentName,selector,config){return $(selector).each(function(){var tempObj;$.data(this,componentName)||(tempObj=new Time.component[componentName](selector,config),$.data(this,componentName,tempObj))})},Application.prototype.renderMobileNavigation=function(){return null!=this.$nav_component&&null!=this.$nav_component.data("Navigation")&&(this.$nav_component.data("Navigation").destroy(),this.$nav_component=null),this.$nav_component=this.makeComponent("MobileNavigation",".header-nav-button",{menuSelector:".left-rail-header .main-nav",handleClickOutside:!1}),this},Application.prototype.toggle_magazine_region_dropdown=function(e){return $(".magazine-region-header").toggleClass("open")},Application.prototype.show_loader=function($container){return $container.addClass("loading-overlay"),$container},Application.prototype.hide_loader=function($container){return $container.removeClass("loading-overlay loading-error"),$container},Application.prototype.show_loader_error=function($container,message,duration){var loader_timeout;return null==message&&(message="Sorry, the requested content could not be loaded"),null==duration&&(duration=3e3),$container.attr("data-error",message),$container.addClass("loading-error"),duration&&(loader_timeout=window.setTimeout(function(_this){return function(){return _this.hide_loader($container)}}(this),duration)),$container},Application.prototype.destroyCollection=function(){var ref1,ref2;return window.clearInterval(Time.homepage_refresh),window.clearInterval(Time.marketdata_refresh),Time.trigger("readingPane:unbindScrolling"),null!=(ref1=this.railXHR)&&"function"==typeof ref1.abort&&ref1.abort(),this.railXHR=null,this.$body.removeClass("tax-time_section home money-home"),null!=this.active_rail&&(null!=(ref2=this.active_rail.view)&&"function"==typeof ref2.annihilate&&ref2.annihilate(),this.active_rail.reset(),this.active_rail=null),this},Application.prototype.sanitizeRailParams=function(params){var ref1,ref2,sanitizedParams;return sanitizedParams=$.extend(!0,{},params),sanitizedParams.env=(null!=(ref1=sanitizedParams.env)?ref1.toLowerCase():void 0)||"rail",sanitizedParams.sub=(null!=(ref2=sanitizedParams.sub)?ref2.toLowerCase():void 0)||null,sanitizedParams.section_tag=sanitizedParams.section_tag||null,sanitizedParams},Application.prototype.getArticleCollectionClass=function(env){var collectionClassName,collectionType;return null==env&&(env=""),collectionType=env.charAt(0).toUpperCase()+env.slice(1),"Money_magazine"===collectionType&&(collectionType="MoneyMagazine"),"Videos"===collectionType&&(collectionType="Video"),"Life_category"===collectionType&&(collectionType="LifeCategory"),"Rail"===collectionType&&(collectionType=""),collectionClassName=collectionType+"Articles",null==Time.collections[collectionClassName]&&(console.error("Invalid env / collection type",env,collectionType),collectionClassName="Articles"),Time.collections[collectionClassName]},Application.prototype.clearEnvClasses=function(env){if(null==env&&(env=this.$body.data("env")),this.$body.removeClass("tax-money_topic tax-time_topic"),env)return this.$body.removeClass(env+"-template")},Application.prototype.setEnvClasses=function(env){if(env)return this.$body.data("env",env).addClass(env+"-template")},Application.prototype.realGetArticleCollection=function(params){var collectionClass,options;return options={app:this,sub:params.sub,section_tag:params.section_tag},"magazine"===options.env&&(options.magazineId=params.magazineId),collectionClass=this.getArticleCollectionClass(params.env),this.active_rail=new collectionClass([],options),this.active_rail},Application.prototype.getArticleCollection=function(params){var itemSlug,railParams;return this.DEBUG&&console.log("--- getArticleCollection ---",arguments),Time.trigger("env:init",params),railParams=this.sanitizeRailParams(params),itemSlug=railParams.item_slug,this.clearEnvClasses(),this.setEnvClasses(railParams.env),railParams.sub&&(this.active_template=railParams.sub),railParams.env&&(this.active_route=railParams.env),this.readingPane.collection=this.realGetArticleCollection(railParams),this.listenToOnce(this.active_rail,"add",function(_this){return function(model){itemSlug&&model.set("slug",itemSlug),Time.trigger("readingPane:bindScrolling"),null!=railParams.article_id?_this.active_rail.load_single_article(railParams.article_id,itemSlug):_this.readingPane.startOnArticle(model)}}(this)),railParams.article?this.active_rail.load_articles(railParams.article):this.active_rail.load_articles(),this.getContributorModal(),null!=railParams.open_rail&&this.toggleLeftRail(!0),this.active_rail},Application.prototype.cleanArticleId=function(articleId){return/^[^s]/.test(articleId)&&(articleId=parseInt(articleId,10)),articleId},Application.prototype.load_article=function(articleId,itemSlug){var articleModel,ref1,ref2;return this.DEBUG&&console.log("--- load_article ---",arguments),(articleId=this.cleanArticleId(articleId))?(this.active_template="article",this.active_route="article",articleModel=null!=(ref1=this.active_rail)?ref1.get(articleId):void 0,(null!=articleModel?articleModel.get("is_nativo_page"):void 0)&&(this.active_route="nativo"),null!=articleModel?this.readingPane.startOnArticle(articleModel):(articleModel=new Time.models.Article({id:articleId}),this.listenToOnce(articleModel,"change",function(_this){return function(model,options){return _this.loadArticleRail(model,itemSlug)}}(this)),articleId===(null!=(ref2=Time.bootstrap.single_article)?ref2.id:void 0)?articleModel.set(Time.bootstrap.single_article):articleModel.fetch(),this)):("undefined"!=typeof console&&null!==console&&console.error("-- load_article -- Invalid article ID",articleId),!1)},Application.prototype.loadArticleRail=function(articleModel,itemSlug){var params;return params={article:articleModel,article_id:articleModel.id,item_slug:itemSlug},articleModel.get("topic")&&(params.env="topic",params.sub=articleModel.get("topic").slug),this.getArticleCollection(params)},Application.prototype.placeholderPolyfill=function(formSelector,fieldSelector){var field,form,placeholder;return form=$(formSelector),field=$(fieldSelector),placeholder=field.attr("placeholder"),""===field.val()&&(field.val(placeholder),field.addClass("empty")),field.focus(function(){if(this.value===placeholder)return field.val(""),field.removeClass("empty")}),field.blur(function(){if(""===this.value)return field.val(placeholder),field.addClass("empty")}),form.submit(function(){if(field.val()===placeholder||/\s+/.test(field.val()))return!1})},Application.prototype.autoshowIeModal=function(){var e,isAlreadySawToday,savedDay,thisDayOfYear;if(this.$html.hasClass("is-ie"))try{if(window.localStorage.length=(document.cookie.match(/\=/g)||window.localStorage).length,thisDayOfYear=moment().dayOfYear(),savedDay=localStorage.getItem("last_day"),isAlreadySawToday=parseInt(savedDay,10)===parseInt(thisDayOfYear,10))return;$(".ie-message-modal").show(),localStorage.setItem("last_day",thisDayOfYear)}catch(_error){e=_error,"undefined"!=typeof console&&null!==console&&console.error(e)}},Application.prototype.hideIeModal=function(e){$(e.target).is("a")||$(".ie-message-modal").hide()},Application.prototype.executeWhenReady=function(fn){var endTime,interval,poll,promise;return promise=$.Deferred(),endTime=Number(new Date)+(arguments[1]||1e4),interval=arguments[2]||250,(poll=function(){return window[fn]?promise.resolve():Number(new Date)<endTime?setTimeout(poll,interval):promise.reject()})(),promise},Application.prototype.setLMPCookie=function(){return Time.CookiesPlugin.raw=!0,Time.CookiesPlugin.set("LMP","//"+window.location.host+window.location.pathname,{path:"/",domain:".time.com"}),Time.CookiesPlugin.raw=!1},Application.prototype.getPercentVisible=function(rect){var percentVisible,wh;return wh=Time.application.sizes.wh||Math.ceil(Time.application.$body.height()),percentVisible=(wh-rect.top)/rect.height,percentVisible<=0||rect.bottom<0?0:percentVisible>=1?100:parseInt((wh-rect.top)/rect.height*100)},Application}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,module=module||{},module.exports=Time.views.CategoryLandingView=function(superClass){function CategoryLandingView(){return CategoryLandingView.__super__.constructor.apply(this,arguments)}return extend(CategoryLandingView,superClass),CategoryLandingView.prototype.initialize=function(options){return null==options&&(options={}),this.app=options.app,this.options=options,this.renderAds(),this.renderSectionMenu(),this},CategoryLandingView.prototype.renderSectionMenu=function(){var ref,ref1,ref2,ref3;if(this.options.section&&(null!=(ref=Time.bootstrap.section)&&null!=(ref1=ref[this.options.section])&&null!=(ref2=ref1.menu)&&null!=(ref3=ref2.items)?ref3.length:void 0))return this.subnav=new Time.views.SectionMenuSubNav({app:this.app,data:Time.bootstrap.section[this.options.section]}),this.$el.prepend(this.subnav.render().$el),this},CategoryLandingView.prototype.renderAds=function(ads){var app,gumgumAdParams,headerAdParams,idDivs;null==ads&&(ads=[]),app=this.app,idDivs=[],$(".section-archive__ad").each(function(){var adParams;if($(this).is(":visible"))return adParams={id:$(this).attr("id"),position:"1",size:$(this).data("size").split(","),group:"section-archive",refreshOnPercentVisible:30},idDivs=idDivs.concat([$(this).attr("id")]),Time.trigger("dfpAdManager:activateAd",null,adParams)}),$("#top-banner__ad").length>0&&(headerAdParams={id:"top-banner__ad",position:1,size:["88x31"],group:"header"},idDivs=idDivs.concat(["top-banner__ad"]),Time.trigger("dfpAdManager:activateAd",null,headerAdParams)),"desktop"===Time.device&&(Time.trigger("pushdown:activate"),idDivs=idDivs.concat(["pushdown-ad"])),"mobile"!==Time.device&&$("#gum-gum-ad").length>0&&(gumgumAdParams={id:"gum-gum-ad",position:1,size:["1x6"],group:"contentWell"},idDivs=idDivs.concat(["gum-gum-ad"]),Time.trigger("dfpAdManager:activateAd",null,gumgumAdParams)),Time.trigger("dfpAdManager:refreshAds",null,idDivs)},CategoryLandingView}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.DigitalAccountLanding=function(superClass){function DigitalAccountLanding(){return DigitalAccountLanding.__super__.constructor.apply(this,arguments)}return extend(DigitalAccountLanding,superClass),DigitalAccountLanding.prototype.el="body",DigitalAccountLanding.prototype.initialize=function(options){return null==options&&(options={}),this},DigitalAccountLanding}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.Error404=function(superClass){function Error404(){return Error404.__super__.constructor.apply(this,arguments)}return extend(Error404,superClass),Error404.prototype.initialize=function(options){return this.app=options.app,this.app.isInitialRoute=!1,this.rail_view=new Time.views.DefaultLeftRail({app:this.app,containingEl:$(".rail-articles-scroll"),parentEl:$(".rail-articles-scroll")}),Time.trigger("dfpAdManager:setInitialAppLoad",!1),this.app.load_tabs(Time.tab_data.default),this.app.tabs_view.set_active(0),this.listenToOnce(Time,"application:ready",function(){$(".site-footer").remove(),$("body").removeClass("error404")}),this},Error404}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.ListicleView=function(superClass){function ListicleView(){return this._onSlickAfterChange=bind(this._onSlickAfterChange,this),this._onSlickBeforeChange=bind(this._onSlickBeforeChange,this),this.updateSlick=bind(this.updateSlick,this),this._onSlickInit=bind(this._onSlickInit,this),this.renderSlick=bind(this.renderSlick,this),this._onArticleRendered=bind(this._onArticleRendered,this),this.destroyListicle=bind(this.destroyListicle,this),this._onClickToggle=bind(this._onClickToggle,this),ListicleView.__super__.constructor.apply(this,arguments)}return extend(ListicleView,superClass),ListicleView.prototype.template=Time.templates["article-single-listicle"],ListicleView.prototype.events={"click .list-gallery__nextButton":"_onClickNext","click .gallery__ad__skip":"_onClickNext","click .list-gallery__prevButton":"_onClickPrev","click .button--read-more":"_onReadMore","click .list-gallery__toggle":"_onClickToggle"},ListicleView.prototype.hasNextArticle=!1,ListicleView.prototype.hasPrevArticle=!1,ListicleView.prototype.isGalleryMode=!0,ListicleView.prototype._initialSlide=0,ListicleView.prototype._onSlickEnd=_.noop,ListicleView.prototype._onSlickBegin=_.noop,ListicleView.prototype.parentArticleView=null,ListicleView.prototype.parentArticleModel=null,ListicleView.prototype.viewIsDesktop=!1,ListicleView.prototype.viewIsTablet=!1,ListicleView.prototype.viewIsMobile=!1,ListicleView.prototype.slickInstance=null,ListicleView.prototype.initialize=function(options){var articleIndex,nextArticle,prevArticle,ref;return null==options&&(options={}),this.options=options,this.$el.length?null==options.article?("undefined"!=typeof console&&null!==console&&console.error("listicleView needs to be attached to an ReadingPaneArticle view",options),this.remove(),null):(this.viewIsDesktop=Time.application.$window.width()>1024,this.viewIsTablet=750<(ref=Time.application.$window.width())&&ref<=1024,this.viewIsMobile=Time.application.$window.width()<=750,this.parentArticleView=options.article,this.parentArticleModel=null!=this.parentArticleView.$specialStory?this.parentArticleView.articleModel:this.parentArticleView.model,options.embedded?(this.template=Time.templates["listicle-embedded"],this.listicleId=this.$el.data("listicle-id"),this.listicleArticleModel=new Time.models.Article(_.extend(_.findWhere(this.parentArticleModel.get("listicles"),{id:this.listicleId}),{singleView:this}))):(this.listicleArticleModel=this.parentArticleModel,this.parentArticleModel.set("listFormat","gallery"),articleIndex=Time.application.active_rail.models.indexOf(this.parentArticleModel),nextArticle=Time.application.active_rail.getNextListArticle(articleIndex),prevArticle=Time.application.active_rail.getPrevListArticle(articleIndex),nextArticle&&(this.hasNextArticle=!0,this._onSlickEnd=function(){var relativeUrl;relativeUrl=Time.application.stripBaseUrl(nextArticle.get("url")),Time.trigger("gallery:daisychain",relativeUrl)}),prevArticle&&(this.hasPrevArticle=!0,this._onSlickBegin=function(){var relativeUrl;relativeUrl=Time.application.stripBaseUrl(prevArticle.get("url")),Time.trigger("gallery:daisychain",relativeUrl)})),this.render(),this.listenTo(Time,"article:rendered",this._onArticleRendered),this.listenTo(this.parentArticleView,"view:destroy",this.destroyListicle),this):("undefined"!=typeof console&&null!==console&&console.error("listicleView needs to be instantiated with an el",options),this.remove(),null)},ListicleView.prototype._onReadMore=function(e){var $container,$content,$media;e.preventDefault(),e.stopPropagation(),e.currentTarget&&($container=$(e.currentTarget).closest(".article-item-body"),$content=$container.triggerHandler("originalContent"),$media=$container.find(".time-embed"),0===$media.length?($container.html(""),$container.append($content)):($container.children().filter(":not(.time-embed)").remove(),$content.each(function(){if(!$(this).hasClass("time-embed"))return $container.append(this)})),this.renderoEmbeds(),this.updateSlick())},ListicleView.prototype._onClickNext=function(e){var ref;e.preventDefault(),null!=(ref=this.slickInstance)&&ref.slickNext()},ListicleView.prototype._onClickPrev=function(e){var ref;e.preventDefault(),null!=(ref=this.slickInstance)&&ref.slickPrev()},ListicleView.prototype._onClickToggle=function(e){var omniData;e.preventDefault(),this.toggleListView(),omniData=Time.application.model.get("activeArticle").toJSON(),omniData.userAction=this.isGalleryMode?"viewasgallery":"viewaslist",Time.Tracking.article_view(omniData)},ListicleView.prototype.destroyListicle=function(){var ref,ref1,ref2;null!=(ref=window.twttr)&&null!=(ref1=ref.events)&&ref1.unbind("rendered",this.updateSlick),null!=(ref2=this.slickInstance)&&ref2.unslick(),this.slickInstance=null,this.remove(),this.unbind(),this.setElement(null)},ListicleView.prototype.render=function(){var $oEmbedEl,j,len,len1,listItem,n,oEmbed,ref,ref1;for(this.$el.html(this.template.render(this.listicleArticleModel.toJSON(),Time.partials)),this.listItems=this.listicleArticleModel.get("list_items"),this.oEmbeds=[],ref=this.listItems,j=0,len=ref.length;j<len;j++)for(listItem=ref[j],ref1=listItem.oembeds,n=0,len1=ref1.length;n<len1;n++)oEmbed=ref1[n],$oEmbedEl=this.$(".time-embed[data-url='"+oEmbed.url+"']"),$oEmbedEl.length>0&&($oEmbedEl.html(""),this.oEmbeds.push(oEmbed));this.maybeFullWidth(),this.shortenListicles()},ListicleView.prototype.maybeFullWidth=function(){if(this.options.embedded&&"special"!==Time.application.active_route&&!this.viewIsMobile)return this.parentArticleView.isNextToRightRailModule(this.$el)||this.$el.addClass("listicle--fullwidth"),this},ListicleView.prototype.shortenListicles=function(){var height;this.options.embedded&&(this.viewIsDesktop||this.viewIsTablet&&this.$el.hasClass("listicle--fullwidth")||(height=this.viewIsTablet?520:360,this.$(".article-item").each(function(){var $content;return $content=$(this).find(".article-item-body"),$content.dotdotdot({ellipsis:"...",height:height,callback:function(isTruncated,originalContent){isTruncated&&$content.append('<span class="button--read-more">+ READ MORE</span>')}})})))},ListicleView.prototype.renderoEmbeds=function(slider,index){var $currentSlide,$currentSlideoEmbeds,that;that=this,slider=slider||this.slider,index=null!=index?index:slider.currentSlide,$currentSlide=$(slider.$slides[index]),$currentSlideoEmbeds=$currentSlide.find(".time-embed:not(.time-embed--rendered)"),$currentSlideoEmbeds.each(function(){var oEmbed,ref;if(oEmbed=_.find(that.oEmbeds,{url:$(this).data("url")})){switch($(this).html($(oEmbed.content).children()),oEmbed.provider){case"facebook":null!=(ref=window.FB)&&ref.XFBML.parse();break;case"instagram":window.clearTimeout(this.refreshInstagramTimeout),this.refreshInstagramTimeout=window.setTimeout(function(){var ref1;return null!=(ref1=window.instgrm)?ref1.Embeds.process():void 0},100);break;case"twitter":window.clearTimeout(this.refreshTwitterTimeout),this.refreshTwitterTimeout=window.setTimeout(function(){var ref1,ref2;return null!=(ref1=window.twttr)&&null!=(ref2=ref1.widgets)?ref2.load():void 0},100)}return $(this).addClass("time-embed--rendered")}})},ListicleView.prototype._onArticleRendered=function(articleView){var initialSlug;articleView.cid===this.parentArticleView.cid&&(this.stopListening(Time,"article:rendered",this._onArticleRendered),this.listicleArticleModel.get("slug")&&(initialSlug=this.listicleArticleModel.get("slug"),this._initialSlide=this.$("[data-item-slug='"+initialSlug+"']").index()),this.parentArticleModel.get("list_gallery_style")||this.options.embedded?this.enableGalleryMode():this.disableGalleryMode())},ListicleView.prototype.renderSlick=function(articleView){var ref,ref1;return this.slickInstance?this.slickInstance:(this.slickInstance=this.$(".article-items").slick({adaptiveHeight:!0,arrows:!1,infinite:!1,draggable:!1,onInit:this._onSlickInit,onBeforeChange:this._onSlickBeforeChange,onAfterChange:this._onSlickAfterChange,slide:"li",onEnd:this._onSlickEnd,onBegin:this._onSlickBegin,initialSlide:this._initialSlide}),this.listenTo(Time,"facebook:xfbml:rendered",this.updateSlick),null!=(ref=window.twttr)&&null!=(ref1=ref.events)&&ref1.bind("rendered",this.updateSlick),this.$(".article-items").imagesLoaded(this.updateSlick),this.slickInstance)},ListicleView.prototype._onSlickInit=function(slider){var $passedAdSlides;this.renderoEmbeds(slider),this.renderoEmbeds(slider,slider.currentSlide+1),this.options.embedded||(this.parentArticleView.prepended&&(this.parentArticleView.prepended=!1,Time.application.scrollTo(this.parentArticleView.$el,{margin:!0,over:{top:.99}})),$passedAdSlides=this.$(".list_ad").filter(function(){return $(this).attr("index")<slider.currentSlide}),this.$(".list-gallery__counter--current").html(slider.currentSlide+1-$passedAdSlides.length),0!==slider.currentSlide||this.hasPrevArticle||this.$(".list-gallery__prevButton").addClass("disabled")),this.$el.addClass("listicle--ready"),this.slider=slider},ListicleView.prototype.toggleListView=function(){var ref;this.isGalleryMode=!this.isGalleryMode,this.parentArticleModel.set("list_gallery_style",this.isGalleryMode),this.$el.toggleClass("listicle",this.isGalleryMode),this.$(".list-gallery__tools").toggleClass("list-gallery__tools--show-for-list",!this.isGalleryMode),this.isGalleryMode?(this.enableGalleryMode(),this.parentArticleView.refreshOutbrain(),"function"==typeof window.omniTrackEv&&window.omniTrackEv("viewasgallery")):(this.disableGalleryMode(),"function"==typeof window.omniTrackEv&&window.omniTrackEv("viewaslist")),null!=this.listicleArticleModel.listAds&&null!=(ref=this.listicleArticleModel.listAds)&&(ref.length=0),Time.trigger("article:list:toggleView",this.parentArticleModel)},ListicleView.prototype.enableGalleryMode=function(){this.parentArticleModel.set("listFormat","gallery"),this.renderSlick(),this.renderEmbeds(),Time.trigger("application:resize")},ListicleView.prototype.disableGalleryMode=function(){this.parentArticleModel.set("listFormat","list"),this.destroySlick(),this.renderEmbeds(),this.$el.addClass("listicle--ready"),Time.trigger("application:resize")},ListicleView.prototype.renderEmbeds=function(){var j,len,listItem,listItems;if(listItems=this.listicleArticleModel.get("list_items"))for(j=0,len=listItems.length;j<len;j++)listItem=listItems[j],this.parentArticleView.renderEmbeds(listItem.oembeds)},ListicleView.prototype.updateSlick=function(){var ref;null!=(ref=this.slickInstance)&&ref.slickSetHeight()},ListicleView.prototype.destroySlick=function(){var ref,ref1,ref2;this.stopListening(Time,"facebook:xfbml:rendered",this.updateSlick),null!=(ref=window.twttr)&&null!=(ref1=ref.events)&&ref1.unbind("rendered",this.updateSlick),null!=(ref2=this.slickInstance)&&ref2.unslick(),this.slickInstance=null},ListicleView.prototype.getArticleTopOffset=function(){return $(".article-navigation .chapters").length>0?-36:0},ListicleView.prototype.scrollToListicleTop=function(){this.viewIsTablet?Time.application.$notHeader.scrollTo(this.$el,{offset:this.getArticleTopOffset()}):this.viewIsMobile&&Time.application.$notHeader.scrollTo(this.$(".listicle--container"),{offset:this.getArticleTopOffset()})},ListicleView.prototype._onSlickBeforeChange=function(slider,currentIndex,targetIndex){var $currentSlide,$currentSlideoEmbed,$passedAdSlides,isAdSlide,j,len,oEmbed,ref;for($passedAdSlides=this.$(".list_ad").filter(function(){return $(this).attr("index")<targetIndex}),this.$(".list-gallery__counter--current").html(targetIndex+1-$passedAdSlides.length),isAdSlide=0!==this.$(".list_ad[index="+targetIndex+"]").length,this.$(".list-gallery__counter").toggleClass("offScreen",isAdSlide),this.$(".list-gallery__prevButton, .list-gallery__nextButton").removeClass("disabled"),0!==targetIndex||this.hasPrevArticle||this.$(".list-gallery__prevButton").addClass("disabled"),targetIndex!==this.$(".article-items li").length-1||this.hasNextArticle||this.$(".list-gallery__nextButton").addClass("disabled"),this.options.embedded&&this.scrollToListicleTop(),this.$(".gallery__ad__skip").removeClass("gallery__ad__skip--visible"),ref=this.oEmbeds,j=0,len=ref.length;j<len;j++)oEmbed=ref[j],$currentSlide=$(slider.$slides[currentIndex]),$currentSlideoEmbed=$currentSlide.find(".time-embed[data-url='"+oEmbed.url+"']"),$currentSlideoEmbed.length>0&&$currentSlideoEmbed.html("").removeClass("time-embed--rendered");null!=window.bcFacade&&window.bcFacade.pauseAllPlayers()},ListicleView.prototype._onSlickAfterChange=function(slider,currentIndex){Time.trigger("article:list:gallerySlideChanged",this.listicleArticleModel,slider,currentIndex),this.renderoEmbeds(slider,currentIndex+1),this.renderoEmbeds(slider,currentIndex-1)},ListicleView}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.MoneyCollegesLanding=function(superClass){function MoneyCollegesLanding(){return MoneyCollegesLanding.__super__.constructor.apply(this,arguments)}return extend(MoneyCollegesLanding,superClass),MoneyCollegesLanding.prototype.el="body",MoneyCollegesLanding.prototype.initialize=function(options){return null==options&&(options={}),Time.trigger("sectionfront:ads:activate",".moneycolleges-landing__ad"),this.adModal=new Time.component.Modal("#ad_modal",{buttonSelector:".open_ad_modal"}),this},MoneyCollegesLanding}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.NativoLanding=function(superClass){function NativoLanding(){return NativoLanding.__super__.constructor.apply(this,arguments)}return extend(NativoLanding,superClass),NativoLanding.prototype.el="body",NativoLanding.prototype.initialize=function(options){return null==options&&(options={}),Time.trigger("nativolanding:ads:activate",".nativo-landing__ad"),this},NativoLanding}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.PromoTray=function(superClass){function PromoTray(){return this.render=bind(this.render,this),this.setupTray=bind(this.setupTray,this),PromoTray.__super__.constructor.apply(this,arguments)}return extend(PromoTray,superClass),PromoTray.prototype.template=Time.templates["promo-tray"],PromoTray.prototype.events={"click .title":"togglePromoTray"},PromoTray.prototype.initialize=function(options){var $el,html,ref;null==options&&(options={}),this.app=options.app,"desktop"===Time.device&&null!=(null!=(ref=Time.bootstrap)?ref.promo_tray:void 0)&&(this.model=Time.bootstrap.promo_tray,html=this.template.render(this.model),$el=$(html),this.setElement($el),this.listenToOnce(Time,"router:route",this.setupTray))},PromoTray.prototype.setupTray=function(){var ref,ref1,sections;sections=["entertainment","health"],null!=this.app.active_route&&"magazine"===this.app.active_route||null!=(null!=(ref=this.app.active_rail)?ref.sub:void 0)&&(ref1=this.app.active_rail.sub,indexOf.call(sections,ref1)>=0)?this.listenToOnce(Time,"article:activated",this.render):this.$el.hasClass("invisible")||this.$el.addClass("invisible collapsed")},PromoTray.prototype.render=function(){return this.$el.appendTo(this.app.$body),setTimeout(function(_this){return function(){_this.$el.removeClass("invisible"),setTimeout(function(){_this.$el.removeClass("collapsed")},400),setTimeout(function(){_this.$el.addClass("collapsed")},3e4)}}(this),1e3),this},PromoTray.prototype.togglePromoTray=function(e){e.preventDefault(),this.$el.toggleClass("collapsed")},PromoTray}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,module=module||{},module.exports=Time.views.SectionMenuSubNav=function(superClass){function SectionMenuSubNav(){return SectionMenuSubNav.__super__.constructor.apply(this,arguments)}return extend(SectionMenuSubNav,superClass),SectionMenuSubNav.prototype.template=Time.templates["section-menu"],SectionMenuSubNav.prototype.initialize=function(options){return null==options&&(options={}),SectionMenuSubNav.__super__.initialize.apply(this,arguments),this},SectionMenuSubNav.prototype.render=function(){var html;return SectionMenuSubNav.__super__.render.apply(this,arguments),html=this.template.render(this.data),this.$el=$(html),this.setElement(this.$el),this.setIsSubNavPastPushdowns(),this},SectionMenuSubNav}(Time.views.SubNav),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,module=module||{},module.exports=Time.controllers.article=function(articleId,articleSlug,itemType,itemSlug){var app;return app=Time.application,app.isInCollection()?Time.controllers.collection(null,null,articleId,itemSlug):(app.readingPane||(app.readingPane=new Time.views.DefaultStream({app:app,el:".readingpane",thresholdEl:document.getElementById("notTheHeader"),threshold:.25}),app.readingPane.render()),app.load_article(articleId,itemSlug))},$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,module=module||{},getSubmodules=function(key,params){var submodules;return submodules=function(){switch(key){case"best_colleges":return{collection:"BestCollegesArticles",leftRail:"BestCollegesLeftRail",stream:"BestCollegesStream"};case"best_places":return{collection:"BestPlacesArticles",leftRail:"BestPlacesLeftRail",stream:"BestPlacesStream"};default:return{collection:"CollectionArticles",leftRail:"CollectionLeftRail",stream:"CollectionStream"}}}(),params.collectionSlug&&(delete submodules.leftRail,submodules.stream=function(){switch(key){case"time100":return"Time100CollectionStreamLanding";
default:return"CollectionStreamLanding"}}()),submodules},createSubapp=function(app,classes){var subapp;return subapp=Time.subapp=new Time.views.CollectionApp({app:app,submodules:classes})},start=function(app,subapp,params){var ref;null!=(ref=subapp.leftRail)&&ref.start(params),subapp.stream.start(params),app.isInitialRoute=!1},module.exports=Time.controllers.collection=function(collectionSlug,hubSlug,articleId,itemSlug){var app,ref,startParams,subapp,submodules;return app=Time.application,app.isInCollection()?collectionSlug&&!app.isBootstrappedCollection(collectionSlug)&&-1===document.location.search.indexOf("preview=true")?window.location.reload():(app.active_route="collection",startParams={},startParams.itemSlug=itemSlug,startParams.articleId=parseInt(articleId,10)||null,startParams.hubSlug=articleId?null:hubSlug,startParams.collectionSlug=collectionSlug?collectionSlug:null,subapp=null,app.isInitialRoute?(submodules=getSubmodules(null!=(ref=Time.bootstrap.collection)?ref.template:void 0,startParams),subapp=createSubapp(app,submodules),start(app,subapp,startParams)):(subapp||(subapp=Time.subapp),start(app,subapp,startParams))):window.location.reload()},root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.controllers.index=function(){var DEBUG;return DEBUG=!1,DEBUG&&console.log("Index controller"),Time.page=new Time.views.TimeHomepage({app:Time.application}),Time.page.render()},root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.controllers.magazine=function(region,magazineId,magazineSlug){var DEBUG,app,params;return DEBUG=!0,app=Time.application,app.readingPane||(app.readingPane=new Time.views.DefaultStream({app:app,el:".readingpane",thresholdEl:document.getElementById("notTheHeader"),threshold:.25}),app.readingPane.render()),DEBUG&&console.log("Magazine controller"),params={env:"magazine",sub:region},null!=magazineId&&(params.magazineId=magazineId),app.getArticleCollection(params)},root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.controllers.vault=function(filterType,filterValue,context,page){var options;return"year"===filterType||"subject"===filterType||"issue"===filterType?(options={app:Time.application,filterType:filterType,filterValue:filterValue,context:context,page:page},null==Time.vault&&(Time.vault=new Time.views.Vault({app:Time.application})),void Time.vault.initFromRoute(options)):void(Time.vault=new Time.views.Vault({app:Time.application,landing:!0}))}}).call(this);;
/*global window,jQuery*/

/**
 * This is just a quick POC script to show how to interact with TI\Tealium at a basic level.
 * It fires page views and events.
 *
 * The page view tracking is basic and queries the TI\Tealium API for a UDO to pass through.
 * Purely synthetic page views will require additional logic
 *
 * The event tracking works the same as it does today with Omniture
 *
 */
(function ($, window) {
  "use strict";

  window.Time = window.Time || {};

  window.Time.Tealium = {

    activeUDO: null,

    getUDO: function (id) {
      var url = window.location.origin + '/tealium-api/id/' + parseInt(id, 10);
      return $.getJSON(url).then( function(data) {
        return data;
      });
    },

    articleActivated: function(articleView) {
      if ( typeof articleView.model === 'object' ) {
        var articleID = parseInt(articleView.model.get('id'), 10);
        if ( ! isNaN(articleID) && articleID > 0 ) {
          this.pageView(articleID);
        }
      }
    },

    pageView: function (articleID) {
      var t = this;
      var u = this.getUDO(articleID);
      u.done( function(data) {
        t.activeUDO = data;
        t.generateView(data);
      });
    },

    articleListGallerySlideChanged: function(articleModel, slider, targetIndex) {
      if ( typeof articleModel === 'object' && ! isNaN( targetIndex ) ) {
        var items, target, itemId;
        if ( typeof ( items = articleModel.get( 'list_items' ) ) !== 'undefined' ) {
          if ( typeof ( target = items[ targetIndex ] ) !== 'undefined' ) {
            if ( typeof target.id !== 'undefined' ) {
              itemId = parseInt( target.id );
              if ( ! isNaN( itemId ) ) {
                this.pageView( itemId );
              }
            }
          }
        }
      }
    },

    gallerySlideChanged: function (galleryModel,index ) {
      var t = this;
      if ( typeof galleryModel === 'object' && ! isNaN( index ) ) {
        var photos, target, photoId, udo;
        if ( typeof ( photos = galleryModel.get( 'photos' ) ) !== 'undefined' ) {
          if ( typeof ( target = photos[ index ] ) !== 'undefined' ) {
            if ( typeof target.url !== 'undefined' ) {
              if ( typeof t.activeUDO === 'object' && typeof t.activeUDO.content_id !== 'undefined' && galleryModel.id === parseInt( t.activeUDO.content_id ) ) {
                var udo = t.activeUDO;
                udo.friendly_url = target.url;
                t.generateView(udo);
              } else {
                var u = this.getUDO(galleryModel.id);
                u.done( function(data) {
                  data.friendly_url = target.url;
                  t.generateView(data);
                });
              }
            }
          }
        }
      }
    },

    generateView: function (data) {
      try {
        window.utag_data = $.extend(window.utag_data, data);
        window.utag.view(window.utag_data);
        window.Time.trigger('tealium:pageView', [window.utag_data]);
      }
      catch (e) {}
    },

    trackEvent: function (eventName) {
      var event = {
        event_name: eventName
      };
      try {
        window.utag.link(event);
      }
      catch (e) {}
    }
  };

  $(document).ready(function () {

    var articlePosition = 0;

    // Global listener for event tracking
    $('body').on('click', '[data-event]', function () {
      if ( $(this).attr('data-event') != 'left-hand-rail' ) {
        window.Time.Tealium.trackEvent($(this).attr('data-event'));
      }
    });

    // Fire a Tealium page view event on new infinite scroll articles
    window.Time.on('article:activated', function (articleView) {
      if ( articlePosition > 0 ) {
        window.Time.Tealium.articleActivated(articleView);
      }
      articlePosition ++;
    });

    // Tealium page view event on list slide views
    window.Time.on('article:list:gallerySlideChanged', function (articleModel, slider, targetIndex) {
      window.Time.Tealium.articleListGallerySlideChanged(articleModel, slider, targetIndex);
    });

    // Tealium page view event on gallery slide view
    window.Time.on('gallery:slide:changed', function (galleryModel, index) {
      window.Time.Tealium.gallerySlideChanged(galleryModel, index);
    });

  });
})(jQuery, window);;
(function() {
	var ajaxurl = window.ajaxurl || '/wp-admin/admin-ajax.php',
		data = window.wpcomVipAnalytics,
		dataQs, percent;

	if ( typeof XMLHttpRequest === 'undefined' ) {
		return;
	}

	if ( ! data ) {
		return;
	}

	percent = ~~data.percentToTrack;
	if ( percent && percent < 100 && ( ~~( ( Math.random() * 100 ) + 1 ) > percent ) ) {
		return;
	}

	dataQs = 'action=wpcom_vip_analytics';

	for ( var key in data ) {
		if ( key === 'percentToTrack' ) {
			continue;
		}
		if ( data.hasOwnProperty( key ) ) {
			dataQs += '&' +
				encodeURIComponent( key ).replace(/%20/g, '+' ) + '=' +
				encodeURIComponent( data[key] ).replace(/%20/g, '+' );
		}
	}

	function sendInfo() {
		var xhr = new XMLHttpRequest();
		xhr.open( 'POST', ajaxurl, true );
		xhr.setRequestHeader( 'Content-type', 'application/x-www-form-urlencoded' );
		xhr.send( dataQs );
	}

	// Delay for some time after the document is ready to ping
	function docReady() {
		setTimeout( function() {
			sendInfo();
		}, 1500 );
	}

	if ( document.readyState === 'complete' ) {
		docReady.apply();
	}
	else if ( document.addEventListener ) {
		document.addEventListener( 'DOMContentLoaded', docReady, false );
	}
	else if ( document.attachEvent ) {
		document.attachEvent( 'onreadystatechange', docReady );
	}
})();
;
(function(e,h,l,c){e.fn.sonar=function(o,n){if(typeof o==="boolean"){n=o;o=c}return e.sonar(this[0],o,n)};var f=l.body,a="scrollin",m="scrollout",b=function(r,n,t){if(r){f||(f=l.body);var s=r,u=0,v=f.offsetHeight,o=h.innerHeight||l.documentElement.clientHeight||f.clientHeight||0,q=l.documentElement.scrollTop||h.pageYOffset||f.scrollTop||0,p=r.offsetHeight||0;if(!r.sonarElemTop||r.sonarBodyHeight!==v){if(s.offsetParent){do{u+=s.offsetTop}while(s=s.offsetParent)}r.sonarElemTop=u;r.sonarBodyHeight=v}n=n===c?0:n;return(!(r.sonarElemTop+(t?0:p)<q-n)&&!(r.sonarElemTop+(t?p:0)>q+o+n))}},d={},j=0,i=function(){setTimeout(function(){var s,o,t,q,p,r,n;for(t in d){o=d[t];for(r=0,n=o.length;r<n;r++){q=o[r];s=q.elem;p=b(s,q.px,q.full);if(t===m?!p:p){if(!q.tr){if(s[t]){e(s).trigger(t);q.tr=1}else{o.splice(r,1);r--;n--}}}else{q.tr=0}}}},25)},k=function(n,o){n[o]=0},g=function(r,p){var t=p.px,q=p.full,s=p.evt,o=b(r,t,q),n=0;r[s]=1;if(s===m?!o:o){setTimeout(function(){e(r).trigger(s===m?m:a)},0);n=1}d[s].push({elem:r,px:t,full:q,tr:n});if(!j){e(h).bind("scroll",i);j=1}};e.sonar=b;d[a]=[];e.event.special[a]={add:function(n){var p=n.data||{},o=this;if(!o[a]){g(this,{px:p.distance,full:p.full,evt:a})}},remove:function(n){k(this,a)}};d[m]=[];e.event.special[m]={add:function(n){var p=n.data||{},o=this;if(!o[m]){g(o,{px:p.distance,full:p.full,evt:m})}},remove:function(n){k(this,m)}}})(jQuery,window,document);;
(function(){var $,LODASH_VERSION,Time,module,require,root,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};LODASH_VERSION="3.9.3","undefined"!=typeof _&&null!==_&&_.VERSION!==LODASH_VERSION&&_.noConflict(),module={},require=_.noop,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.models.MarketData=function(superClass){function MarketData(){return MarketData.__super__.constructor.apply(this,arguments)}return extend(MarketData,superClass),MarketData.prototype.initialize=function(){},MarketData}(Backbone.Model),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.collections.MarketData=function(superClass){function MarketData(){return MarketData.__super__.constructor.apply(this,arguments)}return extend(MarketData,superClass),MarketData.prototype.model=Time.models.MarketData,MarketData.prototype.url="http://www.fortune.idmanagedsolutions.com/money/index/index-quotes-json",MarketData.prototype.sync=function(method,model,options){var params;return params=_.extend({type:"GET",dataType:"jsonp",url:this.url,processData:!1},options),$.ajax(params)},MarketData}(Backbone.Collection),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,module=module||{},module.exports=Time.views.LeftRailModule=function(superClass){function LeftRailModule(){return LeftRailModule.__super__.constructor.apply(this,arguments)}return extend(LeftRailModule,superClass),LeftRailModule.prototype.tagName="div",LeftRailModule.prototype.className="leftRailModule",LeftRailModule.prototype.isRendered=!1,LeftRailModule.prototype.initialize=function(options){var ref,ref1,ref2;return null==options&&(options={}),(null!=(ref=options.$el)?ref.length:void 0)&&this.setElement(options.$el),null!=options.parent&&(this.parent=options.parent,this.$parent=this.parent.$el,this.collection=this.parent.collection),(null!=(ref1=options.$parent)?ref1.length:void 0)&&(this.$parent=options.$parent),this.isRendered=(null!=(ref2=this.$parent)?ref2.find(this.$el).length:void 0)>0,this},LeftRailModule}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,module=module||{},module.exports=Time.views.LeftRail=function(superClass){function LeftRail(){return this._onBreakpointChange=bind(this._onBreakpointChange,this),this._onCloseLeftRailUntether=bind(this._onCloseLeftRailUntether,this),this._onOpenLeftRailRetether=bind(this._onOpenLeftRailRetether,this),this._onClickHandleToggleLeftRail=bind(this._onClickHandleToggleLeftRail,this),this._onClickArticleCloseLeftRail=bind(this._onClickArticleCloseLeftRail,this),this.toggleLeftRail=bind(this.toggleLeftRail,this),this._onBodyScroll=bind(this._onBodyScroll,this),this.createCollapsible=bind(this.createCollapsible,this),this._onCollectionModelChangeIsActive=bind(this._onCollectionModelChangeIsActive,this),this._onFlush=bind(this._onFlush,this),LeftRail.__super__.constructor.apply(this,arguments)}return extend(LeftRail,superClass),LeftRail.prototype.tagName="section",LeftRail.prototype.className="article-list",LeftRail.prototype.$parentEl=null,LeftRail.prototype.tileViews=[],LeftRail.prototype.isScrollOnTileActivation=!0,LeftRail.prototype._isFirstActivation=!0,LeftRail.prototype.collapsibleViews=[],LeftRail.prototype._isShowAll=!0,LeftRail.prototype.$pinnedAd=null,LeftRail.prototype.adsPromise=$.Deferred(),LeftRail.prototype.pinFirstLeftRailAdOnScroll=!0,LeftRail.prototype._maxAds=1,LeftRail.prototype.tetheredAdViews=[],LeftRail.prototype.$firstAd=null,LeftRail.prototype.adFrequency=10,LeftRail.prototype.adOffset={desktop:2,tablet:2,mobile:2},LeftRail.prototype.adIndex=0,LeftRail.prototype.totalLeftRailAds=0,LeftRail.prototype.isRailInitialized=!1,LeftRail.prototype.isRailToggleable=null,LeftRail.prototype.isRailOpen=null,LeftRail.prototype.initialize=function(options){null==options&&(options={}),LeftRail.__super__.initialize.apply(this,arguments),this.app=options.app,this.subapp=options.subapp,this.$parentEl=options.parentEl,this.$leftRailWrapper=this.app.$leftRailWrapper,this.$articleListScroll=this.app.$articleListScroll,this.app.currentBreakpoint<=1024&&(this.pinFirstLeftRailAdOnScroll=!1,this._maxAds=10),this.listenTo(Time,"hamburger:opened",function(_this){return function(){return _this.isScrollOnTileActivation=!1}}(this)),this.listenTo(Time,"hamburger:closed",function(_this){return function(){return _this.isScrollOnTileActivation=!0}}(this)),this.listenTo(Time,"leftRail:collapsible:expanded",function(collapsibleView){var $tetherTargets,ref,ref1;$tetherTargets=collapsibleView.$(".tether-target"),null!=$tetherTargets&&$tetherTargets.each(function(index,el){var $target,$tetheredElement,tether;if($target=$(el),tether=$target.data("tether"),null!=tether)return $target.removeClass("leftRailModule--collapsible__collapsedAd"),$tetheredElement=$(tether.element),$tetheredElement.removeClass("leftRailModule--collapsible__collapsedAd").data("collapsed",!1),tether.enable()}),null!=collapsibleView&&null!=(ref=collapsibleView.collection)&&null!=(ref1=ref.view)&&ref1.$el.trigger("scroll"),Tether.position()}),this.listenTo(Time,"leftRail:collapsible:collapsed",function(collapsibleView){var $tetherTargets;$tetherTargets=collapsibleView.$(".tether-target"),null!=$tetherTargets&&$tetherTargets.each(function(index,el){var $target,$tetheredElement,tether;if($target=$(el),tether=$target.data("tether"),null!=tether)return tether.disable(),$target.addClass("leftRailModule--collapsible__collapsedAd"),$tetheredElement=$(tether.element),$tetheredElement.addClass("leftRailModule--collapsible__collapsedAd").data("collapsed",!0)}),Tether.position()}),this.listenTo(Time,"leftRail:scroll",function(_this){return function(){_this.isRailOpen&&Tether.position()}}(this)),this.listenTo(Time,"leftRail:flush",this._onFlush),this.listenToOnce(Time,"leftRail:rendered",function(_this){return function(){return _this.$leftRailWrapper.addClass("leftRailWrapper--rendered")}}(this)),this.listenTo(Time,"body:scrolled",this._onBodyScroll),this.listenTo(this.app.model,"change:isPastPushdowns",this.setIsRailPastPushdowns),this.listenTo(Time,"homepage:initialized",this.setIsRailPastPushdowns),this.setIsRailPastPushdowns(),this.bindRailEvents(),this.setIsRailToggleable()?this.toggleLeftRail(!1):this.toggleLeftRail(!0)},LeftRail.prototype._onFlush=function(){_.invoke(this.collapsibleViews,"destroy"),this.collapsibleViews.length=0,_.invoke(this.tetheredAdViews,"destroy"),this.tetheredAdViews.length=0},LeftRail.prototype._onCollectionModelChangeIsActive=function(model,value,options){if(value!==!1)return this._isFirstActivation?void(this._isFirstActivation=!1):void(this.isScrollOnTileActivation&&_.defer(function(_this){return function(){return _this.scrollToArticleTile(model)}}(this)))},LeftRail.prototype._onClickTile=function(e){var $tile,articleId,isVideoTile;$tile=$(e.target),isVideoTile=$tile.closest(".format-video").length>0,articleId=$tile.closest(".rail-article").data("article"),Time.trigger("leftRail:tile:clicked",articleId),isVideoTile&&Time.trigger("leftRail:videoTile:clicked",articleId)},LeftRail.prototype.getTileByModel=function(model){return model?_.find(this.tileViews,function(tileView){var ref;return(null!=(ref=tileView.model)?ref.id:void 0)===model.id}):null},LeftRail.prototype.getActiveTile=function(){var articleModel;return this.collection?(articleModel=this.collection.findWhere({isActive:!0}),this.getTileByModel(articleModel)):null},LeftRail.prototype.scrollToArticleTile=function(model){var tileView;tileView=this.getTileByModel(model),tileView&&this.scrollToTile(tileView)},LeftRail.prototype.scrollToActiveTile=function(){var tileView;this.collection&&(tileView=this.getActiveTile(),this.scrollToTile(tileView))},LeftRail.prototype.scrollToTile=function(tileView){this.scrollElIntoView(tileView.el,{axis:"y",duration:200,interrupt:!0,offset:{top:-10}})},LeftRail.prototype.scrollElIntoView=function(el,options){var $pinnedAd,base;null==options&&(options={}),$pinnedAd=this.getPinnedAd(),$pinnedAd&&($pinnedAd.outerHeight(),options.offset||(options.offset={}),(base=options.offset).top||(base.top=0),options.offset.top-=$pinnedAd.outerHeight()),this.isContained(el,{partial:!1})&&!this.isCoveredByPinnedAd(el,$pinnedAd)||this.$parentEl.scrollTo(el,options),"undefined"!=typeof Tether&&null!==Tether&&Tether.position()},LeftRail.prototype.bindCollapsibles=function(){this.$(".leftRailModule--collapsible").each(function(_this){return function(index,el){_this.collapsibleViews.push(_this.createCollapsible(el))}}(this))},LeftRail.prototype.createCollapsible=function(el){var $collapsibleEl,collapsible;return $collapsibleEl=$(el),collapsible=new Time.views.CollapsibleModule({collection:this.collection,parent:this,$el:$collapsibleEl,isExpanded:$collapsibleEl.hasClass("leftRailModule--collapsible--expanded")})},LeftRail.prototype._onBodyScroll=function(e){var base,headerBreakpoint,isHeaderPastAd;this.pinFirstLeftRailAdOnScroll&&this.$firstAd&&(headerBreakpoint=this.app.sizes.headerHeightWithTopper,this.app.isPushdownPinned&&(headerBreakpoint+=this.app.$pushdown.outerHeight()),isHeaderPastAd=("function"==typeof(base=this.$firstAd).get?base.get(0).getBoundingClientRect().top:void 0)<=headerBreakpoint,this.$firstAd.toggleClass("left-rail-ad__wrapper--pinned",isHeaderPastAd),isHeaderPastAd&&this.app.isPushdownPinned?$(".left-rail-ad").css("margin-top",this.app.$pushdown.outerHeight()+"px"):$(".left-rail-ad").css("margin-top",0))},LeftRail.prototype.setIsRailPastPushdowns=function(){this.$leftRailWrapper.toggleClass("past-pushdown",this.app.model.get("isPastPushdowns"))},LeftRail.prototype.isCoveredByPinnedAd=function(el,$pinnedAd){var elRect,pinnedRect;return!!$pinnedAd&&(pinnedRect=$pinnedAd.get(0).getBoundingClientRect(),elRect=el.getBoundingClientRect(),this.isCoveredByRect(elRect,pinnedRect))},LeftRail.prototype.getPinnedAd=function(){return this.pinFirstLeftRailAdOnScroll&&this.$firstAd?this.$firstAd.find(".ad-unit:first-child"):null},LeftRail.prototype.getIdsOfVisibleAdPlaceholders=function(){var $containedEls,$placeholderEls,ref;return(null!=(ref=Time.tgxFacade)?ref.isEnabled:void 0)?($placeholderEls=this.getEls(null,{detachedEls:".ad-unit, #sub-ad"}),$containedEls=this.findContained($placeholderEls,{partial:!0})):[]},LeftRail.prototype.getIdsOfVisibleAds=function(){var $pinnedAd,$visibleAdEls,$visiblePlaceholderEls,ref;return(null!=(ref=Time.tgxFacade)?ref.isEnabled:void 0)?($visiblePlaceholderEls=this.getIdsOfVisibleAdPlaceholders(),$visibleAdEls=$visiblePlaceholderEls.map(function(i,el){var tether;return tether=$(el).data("tether"),tether?tether.element:el}),$pinnedAd=this.getPinnedAd(),$pinnedAd&&$visibleAdEls.push($pinnedAd.get(0)),_.uniq(_.pluck($visibleAdEls,"id"))):[]},LeftRail.prototype.appendAd=function(afterEl){var $placeholder,$placeholderWrapper,id;return this.adIndex+=1,id="ad-unit-"+this.adIndex,$placeholderWrapper=$("<div/>",{class:"left-rail-ad__wrapper"}),$placeholder=$("<div/>",{class:"ad-unit left-rail-ad",id:id,pos:this.adIndex}),$placeholderWrapper.append($placeholder),$placeholderWrapper.insertAfter(afterEl),1===this.adIndex&&(this.$firstAd=$placeholderWrapper),$placeholder},LeftRail.prototype.tetherAd=function(placeholderId){var adId,options,tetheredAd;return adId=placeholderId+"_ad",options={id:adId,class:"left-rail-ad","data-ad_placeholder_id":placeholderId,pos:this.adIndex},tetheredAd=new Time.views.LeftRailAd(options),this.tetheredAdViews.push(tetheredAd),tetheredAd},LeftRail.prototype.setIsRailToggleable=function(){return this.isRailToggleable=this.app.currentBreakpoint<=800,this.$leftRailWrapper.toggleClass("leftRailWrapper--toggleable",this.isRailToggleable),this.isRailToggleable},LeftRail.prototype.moveRailToBody=function(){var leftRailScrollTop;leftRailScrollTop=this.$articleListScroll.scrollTop(),this.$leftRailWrapper.detach().appendTo("body"),this.$articleListScroll.scrollTop(leftRailScrollTop),this.setElement(".article-list")},LeftRail.prototype.moveRailToContent=function(){var leftRailScrollTop;leftRailScrollTop=this.$articleListScroll.scrollTop(),this.$leftRailWrapper.detach().insertAfter(".pushdowns"),this.$articleListScroll.scrollTop(leftRailScrollTop),this.setElement(".article-list")},LeftRail.prototype.userToggleLeftRail=function(){return this.toggleLeftRail(!this.isRailOpen),this},LeftRail.prototype.toggleLeftRail=function(newOpenValue){if(newOpenValue!==this.isRailOpen)return newOpenValue?this._openLeftRail():this._closeLeftRail()},LeftRail.prototype._openLeftRail=function(){return this.isRailOpen=!0,this.$leftRailWrapper.addClass("left-rail-open").removeClass("left-rail-closed"),this.isRailInitialized&&Time.trigger("leftRail:opened"),this.isRailInitialized=!0,this},LeftRail.prototype._closeLeftRail=function(){if(this.isRailToggleable)return this.isRailOpen=!1,this.$leftRailWrapper.addClass("left-rail-closed").removeClass("left-rail-open"),Time.trigger("leftRail:closing"),this.isRailInitialized&&Time.trigger("leftRail:closed"),this.isRailInitialized=!0,this},LeftRail.prototype._onClickArticleCloseLeftRail=function(e){this.isRailToggleable&&this.toggleLeftRail(!1)},LeftRail.prototype._onClickHandleToggleLeftRail=function(e){e.preventDefault(),e.stopPropagation(),this.userToggleLeftRail()},LeftRail.prototype._onOpenLeftRailRetether=function(){var $tetherTargets;$tetherTargets=this.$(".tether-target"),null!=$tetherTargets&&$tetherTargets.each(function(index,el){var $target,$tetheredElement,tether;if($target=$(el),!$target.data("collapsed")&&(tether=$target.data("tether"),null!=tether))return $tetheredElement=$(tether.element),$tetheredElement.show(),tether.enable()}),Tether.position()},LeftRail.prototype._onCloseLeftRailUntether=function(){var $tetherTargets;$tetherTargets=this.$(".tether-target"),null!=$tetherTargets&&$tetherTargets.each(function(index,el){var $target,$tetheredElement,tether;if($target=$(el),tether=$target.data("tether"),null!=tether)return tether.disable(),$tetheredElement=$(tether.element),$tetheredElement.hide()})},LeftRail.prototype._onClosedLeftRailReposition=function(){Tether.position()},LeftRail.prototype._onBreakpointChange=function(e){this.setIsRailToggleable()&&this.toggleLeftRail(!1)},LeftRail.prototype.bindRailEvents=function(){this.app.$body.on("click",".article-permalink",this._onClickArticleCloseLeftRail),$(".rail-handle").on("touchend click",this._onClickHandleToggleLeftRail),this.listenTo(Time,"leftRail:toggle",this.toggleLeftRail),this.listenTo(Time,"leftRail:opened",this._onOpenLeftRailRetether),this.listenTo(Time,"leftRail:closing",this._onCloseLeftRailUntether),this.listenTo(Time,"leftRail:closed",this._onClosedLeftRailReposition),this.listenTo(Time,"application:breakpointchanged",this._onBreakpointChange)},LeftRail}(Time.views.ContainingView),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,module=module||{},module.exports=Time.views.ArticleTile=function(superClass){function ArticleTile(){return ArticleTile.__super__.constructor.apply(this,arguments)}return extend(ArticleTile,superClass),ArticleTile.prototype.template=function(){return null!=this.model.get("sponsor")?Time.templates["article-tile-sponsored"]:null!=this.model.get("tax")?Time.templates["article-tile-section-front"]:Time.templates["article-tile"]},ArticleTile.prototype.type="article",ArticleTile.prototype.initialize=function(options){var ref,ref1,ref2;return null==options&&(options={}),null==options.$parent&&(options.$parent=null!=(ref=this.collection)&&null!=(ref1=ref.view)?ref1.$el:void 0),null==options.$el&&(options.$el=null!=(ref2=options.$parent)?ref2.find('[data-article="'+this.model.id+'"]'):void 0),ArticleTile.__super__.initialize.apply(this,arguments),this.bindListeners(),this},ArticleTile.prototype.bindListeners=function(){return this.listenTo(this.model,"change:isActive",function(_this){return function(model,value,options){_this.toggleActive(value)}}(this)),this},ArticleTile.prototype.render=function(){var html;return this.isRendered||(html=this.template().render(this.model.toJSON()),this.setElement($(html)),this.$el.appendTo(this.$parent)),Time.trigger("leftRail:tile:rendered",this),this},ArticleTile.prototype.toggleActive=function(isActive){var ref;null==isActive&&(isActive=null!=(ref=this.model)?ref.get("isActive"):void 0),this.$el.toggleClass("active",isActive)},ArticleTile}(Time.views.LeftRailModule),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,module=module||{},module.exports=Time.views.CollapsibleModule=function(superClass){function CollapsibleModule(){return CollapsibleModule.__super__.constructor.apply(this,arguments)}return extend(CollapsibleModule,superClass),CollapsibleModule.prototype.template=Time.templates["lrm-collapsible"],CollapsibleModule.prototype.events={"click [data-toggle-collapsible]":"_onToggle","click [data-toggle-expand]":"_onExpand","click [data-toggle-collapse]":"_onCollapse"},CollapsibleModule.prototype.isExpanded=!0,CollapsibleModule.prototype.initialize=function(options){var collapsibleEl;return null==options&&(options={}),CollapsibleModule.__super__.initialize.apply(this,arguments),null!=options.isExpanded&&(this.isExpanded=options.isExpanded),this.isRendered||(collapsibleEl=this.template.render({isExpanded:this.isExpanded}),this.setElement(collapsibleEl)),this.listenTo(Time,"leftRail:collapsibles:toggle",function(_this){return function(expand){return null==expand&&(expand=!0),expand?_this.expand():_this.collapse()}}(this)),this.listenTo(this,"expanded",function(){Time.trigger("leftRail:collapsible:expanded",this)}),this.listenTo(this,"collapsed",function(){Time.trigger("leftRail:collapsible:collapsed",this)}),this},CollapsibleModule.prototype._onToggle=function(e){return e.preventDefault(),this.toggle()},CollapsibleModule.prototype._onExpand=function(e){return e.preventDefault(),this.expand()},CollapsibleModule.prototype._onCollapse=function(e){return e.preventDefault(),this.collapse()},CollapsibleModule.prototype.toggle=function(isExpanded){return null==isExpanded&&(isExpanded=this.isExpanded),isExpanded?this.collapse():this.expand()},CollapsibleModule.prototype.expand=function(){return this.$el.addClass("leftRailModule--collapsible--expanded"),this.$el.removeClass("leftRailModule--collapsible--collapsed"),this.isExpanded=!0,this.trigger("expanded",this),this},CollapsibleModule.prototype.collapse=function(){return this.$el.addClass("leftRailModule--collapsible--collapsed"),this.$el.removeClass("leftRailModule--collapsible--expanded"),this.isExpanded=!1,this.trigger("collapsed",this),this},CollapsibleModule}(Time.views.LeftRailModule),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,module=module||{},module.exports=Time.views.DefaultLeftRail=function(superClass){function DefaultLeftRail(){return this.onSyncError=bind(this.onSyncError,this),this.onSyncStart=bind(this.onSyncStart,this),this.onSyncComplete=bind(this.onSyncComplete,this),this.bindCollectionSyncing=bind(this.bindCollectionSyncing,this),this.fillWithTiles=bind(this.fillWithTiles,this),this._onCollectionAdd=bind(this._onCollectionAdd,this),this._onCollectionReset=bind(this._onCollectionReset,this),this.renderArticleTile=bind(this.renderArticleTile,this),this.onScroll=bind(this.onScroll,this),DefaultLeftRail.__super__.constructor.apply(this,arguments)}return extend(DefaultLeftRail,superClass),DefaultLeftRail.prototype.events={"click .rail-article-title a":"_onClickTile"},DefaultLeftRail.prototype._fillTimeout=null,DefaultLeftRail.prototype.regularTileViewsRendered=0,DefaultLeftRail.prototype._infiniteScrolling=null,DefaultLeftRail.prototype.parentEl=null,DefaultLeftRail.prototype._isTopicHeaderRendered=!1,DefaultLeftRail.prototype._isTopicHeaderEmbeddedShortcodeRendered=!1,DefaultLeftRail.prototype.initialize=function(options){return null==options&&(options={}),DefaultLeftRail.__super__.initialize.apply(this,arguments),this.parentEl=this.$parentEl.get(0),null!=options.adFrequency&&(this.adFrequency=options.adFrequency),null!=options.adOffset&&_.extend(this.adOffset,options.adOffset),this.render(),this},DefaultLeftRail.prototype.annihilate=function(){var ref;null!=(ref=this._infiniteScrolling)&&ref.unbind(),this.destroy()},DefaultLeftRail.prototype.isRailAtEnd=function(){return!this.parentEl||this.$parentEl.scrollTop()+this.$parentEl.innerHeight()>=this.parentEl.scrollHeight},DefaultLeftRail.prototype.isRailFullyVisible=function(){return!!this.parentEl&&this.parentEl.scrollHeight<=this.$parentEl.innerHeight()},DefaultLeftRail.prototype.render=function(){var $railArticles;return this.bindScroll(),null!=this.collection&&(this.clearDomData(),this.bindCollectionSyncing(),this.bindCollectionRendering(),this.setDynamicEl(),this.app.load_tabs(Time.tab_data.default),this.app.tabs_view.set_active(0),$railArticles=this.$el.closest("#rail-articles"),"magazine"===this.collection.active_env&&$railArticles.addClass("magazine_rail"),this.renderLeftRailFooter(),this.bindCollapsibles()),this.$el.addClass("article-list--rendered"),Time.trigger("leftRail:rendered",this),this},DefaultLeftRail.prototype.renderLeftRailFooter=function(){var text,url;"popular"!==this.app.active_route&&(this.app.isInMagazine()?(url="/vault/year/"+Time.bootstrap.magazine[this.collection.region][0].pubDate.slice(0,4),text="See Other Issues"):this.app.isInTopic()?(url="/"+this.collection.endpoint,this.app.isMoney()&&(url="/money"+url),text="More "+Time.bootstrap.single_article.topic.name):(url="latest"===this.collection.endpointSub?"/":"/"+this.collection.endpointSub,text="More "+this.collection.endpointSubName),0===$(".left-rail--footer").length?$(".rail-articles-scroll").append(Time.templates["lrm-footer"].render({url:url,text:text})):$(".left-rail--footer a").html(text))},DefaultLeftRail.prototype.clearDomData=function(){var old_env;return null!=this.collection.active_env&&(old_env=this.$parentEl.data("env"),null!=old_env&&this.$parentEl.removeClass(old_env),this.$parentEl.data("env",this.collection.active_env),this.$parentEl.addClass(this.collection.active_env)),this.$el.html(""),this},DefaultLeftRail.prototype.setDynamicEl=function(){var $oldList;$oldList=this.$parentEl.find(".article-list"),$oldList.length?$oldList.replaceWith(this.$el):this.$el.insertAfter("#section-sub-ad")},DefaultLeftRail.prototype.render_author_header=function(data){var $html,template;return null==data&&(data={}),template=Time.templates["rail-header-author"],$html=$(template.render(data)),$html.prependTo(this.$el),this},DefaultLeftRail.prototype.render_section_header=function(data){var $html,template;return null==data&&(data={}),template=Time.templates["section-description"],$html=$(template.render(data)),$html.prependTo(this.$el),this},DefaultLeftRail.prototype.render_topic_header=function(data){var $html,template;if(null==data&&(data={}),!this._isTopicHeaderRendered)return template=Time.templates["rail-header-topic"],data.topic_header_title&&(data.name=data.topic_header_title),$html=$(template.render(data)),$html.prependTo(this.$el),this._isTopicHeaderRendered=!0,this},DefaultLeftRail.prototype.render_topic_header_embed=function(html){var $embeddedShortcode,$firstElement,d,embedScript,n;if(!this._isTopicHeaderEmbeddedShortcodeRendered&&($embeddedShortcode=$(html),$embeddedShortcode.prependTo(this.$el),$firstElement=$embeddedShortcode.first(),embedScript=$firstElement.data("script")))return d=new Date,n=d.getMilliseconds(),Modernizr.load({load:Time.template_uri+embedScript+"?"+n}),"desktop"!==Time.device&&setTimeout(function(_this){return function(){if(null!=_this.collection)return _this.$parentEl.trigger("scroll")}}(this),500),this._isTopicHeaderEmbeddedShortcodeRendered=!0,this},DefaultLeftRail.prototype.render_header=function(copy,tile_position){var $header_el;return null==copy&&(copy="Most Read"),null==tile_position&&(tile_position=0),$header_el=$("<h3 />",{class:"rail-list-heading"}).text(copy),null!=this.models&&this.models[tile_position]?$header_el.insertBefore(this.collection.models[tile_position].views.tile_view.$el):$header_el.appendTo(this.$el),this},DefaultLeftRail.prototype.bindScroll=function(){this.$parentEl.scroll(this.onScroll)},DefaultLeftRail.prototype.onScroll=function(e){_.throttle(function(e){return Time.trigger("leftRail:scroll",this)},50)},DefaultLeftRail.prototype.scrollToActiveTile=function(){var articleModel,ref;this.collection&&(articleModel=this.collection.findWhere({isActive:!0}),(null!=articleModel&&null!=(ref=articleModel.views)?ref.tile_view:void 0)&&this.scrollElIntoView(articleModel.views.tile_view.el))},DefaultLeftRail.prototype.scroll_limit_message=function(){var $message,href,text;if(0===$(".response-eot").length)return this.app.isInMagazine()?(href="http://content.time.com/time/magazine/",text="Read more articles in the magazine archive"):this.app.isMoney()?(href="/money/",text="Get the latest news on Money.com's home page"):(href="/",text="Get the latest news on TIME's home page"),$message=$("<a />",{class:"meta response-eot"}),$message.attr("href",href).html(text),$message.appendTo(this.$el),this},DefaultLeftRail.prototype.show_loader=function(){return this.$parentEl.addClass("fetching"),this},DefaultLeftRail.prototype.hide_loader=function(){return this.$parentEl.removeClass("fetching"),this},DefaultLeftRail.prototype.show_loader_error=function(){var $load_error,$manual_fetch;return $load_error=$("<p />",{class:"meta response-error"}),$load_error.html("The requested content could not be loaded."),$load_error.appendTo(this.$el),$manual_fetch=$("<a />",{class:"manual-fetch",href:"javascript:void(0)"}),$manual_fetch.html("Try now"),$manual_fetch.appendTo($load_error),$manual_fetch.one("click",function(_this){return function(){_this.collection.fetch()}}(this)),this.listenToOnce(this.collection,"sync:syncing",this.remove_loader_error),this},DefaultLeftRail.prototype.remove_loader_error=function(){return $(".response-error").remove(),this},DefaultLeftRail.prototype.renderArticleTile=function(articleModel,collection,options){var tileView;articleModel.isSponsored()&&!articleModel.isNativo()&&(collection.sponsored_article_index+=1),tileView=articleModel.createTileView(),articleModel.views.tile_view=tileView,this.tileViews.push(tileView),tileView.render()},DefaultLeftRail.prototype.bindCollectionRendering=function(){return"nativo"!==this.collection.active_env&&this.listenTo(Time,"leftRail:collapsible:collapsed",this.fillWithTiles),this.listenToOnce(this.collection,"add reset",this._onCollectionReset),this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"change:isActive",this._onCollectionModelChangeIsActive),this},DefaultLeftRail.prototype._onCollectionReset=function(){var pinnionPoll;this.DEBUG&&("undefined"!=typeof console&&null!==console?console.log("Left Rail init @collection(add/reset)"):void 0),"time"===Time.bootstrap.branding&&null!=Time.bootstrap.lrm_pinnion&&"trending"===this.collection.active_env&&(pinnionPoll=new Time.views.PinnionPollCollapsible({parent:this}),pinnionPoll.render("before"))},DefaultLeftRail.prototype._onCollectionAdd=function(articleModel,collection,options){this.renderArticleTile(articleModel,collection,options),"nativo"===this.collection.active_env||this.collectionCalled||this.fillWithTiles(!0)},DefaultLeftRail.prototype.fillWithTiles=function(initial){return null==initial&&(initial=!1),initial===!0&&(this.collectionCalled=!0),Time.trigger("leftRail:fill:progress",this.collection.length),this.collection.length<=35&&"nativo"!==this.collection.active_env?this.collection.fetch_next_page({complete:function(_this){return function(){return _this.fillWithTiles()}}(this)}):Time.trigger("leftRail:filled",this),this},DefaultLeftRail.prototype.bindCollectionSyncing=function(){this.listenTo(this.collection,"sync:syncing",this.onSyncStart),this.listenTo(this.collection,"sync",this.onSyncComplete),this.listenTo(this.collection,"sync:error",this.onSyncError)},DefaultLeftRail.prototype.onSyncComplete=function(){var isFilled;isFilled=this.$parentEl[0].scrollHeight===this.$parentEl.innerHeight(),this.hide_loader()},DefaultLeftRail.prototype.onSyncStart=function(){this.show_loader()},DefaultLeftRail.prototype.onSyncError=function(){this.hide_loader(),this.show_loader_error()},DefaultLeftRail}(Time.views.LeftRail),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.LeftRailAd=function(superClass){function LeftRailAd(){return this.resize=bind(this.resize,this),LeftRailAd.__super__.constructor.apply(this,arguments)}return extend(LeftRailAd,superClass),LeftRailAd.prototype.tagName="div",LeftRailAd.prototype.tether=null,LeftRailAd.prototype.$placeholder=null,LeftRailAd.prototype.VERTICAL_PADDING=9,LeftRailAd.prototype.initialize=function(options){return null==options&&(options={}),$("#"+options.id).data("tether")?this:(this.listenTo(this,"view:destroy",function(){this.tether.destroy(),this.$placeholder.data("tether",null),this.$placeholder.remove(),this.$placeholder=null,this.$el.data("tether",null),this.$el.remove()}),this.render(options),this)},LeftRailAd.prototype.isPlaceholderCollapsed=function(){var ref;return(null!=(ref=this.$placeholder)?ref.closest(".leftRailModule--collapsible--collapsed").length:void 0)>0},LeftRailAd.prototype.resize=function(){return this.$el.css({width:this.$placeholder.width()+"px"})},LeftRailAd.prototype.render=function(options){var isCollapsed,offsetTop,placeholderSelector,tetherOptions;return placeholderSelector="#"+options["data-ad_placeholder_id"],this.$placeholder=$(placeholderSelector),this.$placeholder.show(),this.$el.attr(options),this.$el.data("pos",options.pos),this.listenTo(Time,"application:resize",this.resize),this.listenTo(Time,"leftRail:opened",this.resize),this.resize(),isCollapsed=this.isPlaceholderCollapsed(),this.$el.toggleClass("leftRailModule--collapsible__collapsedAd",isCollapsed).data("collapsed",isCollapsed),this.$el.appendTo(placeholderSelector),tetherOptions={enabled:!isCollapsed,element:this.$el,target:placeholderSelector,attachment:"top left",targetAttachment:"top left",optimizations:{gpu:"desktop"!==Time.device,moveElement:"mobile"!==Time.device}},"desktop"===Time.device&&(offsetTop="ad-unit-1_ad"===this.$el.attr("id")&&Time.application.isDynamicHeaderEnabled&&Time.application.isDynamicHeaderLeftRailAdEnabled?68:0,tetherOptions.constraints=[{to:$(".rail-articles-scroll").get(0),pin:["top"],offsetTop:offsetTop}]),this.tether=new Tether(tetherOptions),this.$el.data("tether",this.tether),this.$placeholder.data("tether",this.tether),this},LeftRailAd}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.MagazineCollapsible=function(superClass){function MagazineCollapsible(){return MagazineCollapsible.__super__.constructor.apply(this,arguments)}return extend(MagazineCollapsible,superClass),MagazineCollapsible.prototype.coverTemplate=Time.templates["lrm-magazine-cover"],MagazineCollapsible.prototype.initialize=function(options){var coverHtml;return null==options&&(options={}),null==options.$parent&&(options.$parent=this.collection.view.$el),options.isExpanded=this.model.get("isActive"),MagazineCollapsible.__super__.initialize.apply(this,arguments),coverHtml=this.coverTemplate.render(this.model.toJSON()),this.$el.prepend(coverHtml),this.$coverTile=this.$(".rail-article-magazine-cover"),this.bindListeners(),this},MagazineCollapsible.prototype.bindListeners=function(){return this.listenTo(this.model,"change:isActive",function(_this){return function(model,value,options){var base;_this.$coverTile.toggleClass("active",value),value&&(_this.collection.view.scroll_freeze||"function"==typeof(base=Time.application.getRailView()).scrollToActiveTile&&base.scrollToActiveTile(),
_this.expand())}}(this)),this},MagazineCollapsible.prototype.render=function(){return this.$el.appendTo(this.$parent),Time.trigger("leftRail:tile:rendered",this),this},MagazineCollapsible}(Time.views.CollapsibleModule),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.MagazineTile=function(superClass){function MagazineTile(){return MagazineTile.__super__.constructor.apply(this,arguments)}return extend(MagazineTile,superClass),MagazineTile.prototype.template=function(){return Time.templates["lrm-magazine-article"]},MagazineTile.prototype.initialize=function(options){return null==options&&(options={}),MagazineTile.__super__.initialize.apply(this,arguments),this.cover=options.cover,this},MagazineTile.prototype.bindListeners=function(){return this.listenTo(this.model,"change:isActive",function(_this){return function(model,value,options){var base,ref;value&&(_this.collection.view.scroll_freeze||"function"==typeof(base=Time.application.getRailView()).scrollToActiveTile&&base.scrollToActiveTile(),null!=(ref=_this.cover)&&ref.expand()),_this.$el.toggleClass("active",value)}}(this)),this},MagazineTile}(Time.views.ArticleTile),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.MarketDataView=function(superClass){function MarketDataView(){return this.renderContent=bind(this.renderContent,this),MarketDataView.__super__.constructor.apply(this,arguments)}return extend(MarketDataView,superClass),MarketDataView.prototype.template=function(){return this.app.isMoney()?Time.templates["lrm-market-money"]:Time.templates["lrm-market"]},MarketDataView.prototype.contentTemplate=Time.templates["market-data"],MarketDataView.prototype.$content=null,MarketDataView.prototype._DAYS=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],MarketDataView.prototype.initialize=function(options){return null==options&&(options={}),this.app=options.app,this.collection=new Time.collections.MarketData,this.listenTo(this.collection,"reset",function(_this){return function(collection,options){return _this.renderContent()}}(this)),this.update(),this},MarketDataView.prototype.update=function(){return this.collection.fetch({reset:!0})},MarketDataView.prototype.render=function(){var shellHtml;return shellHtml=this.template().render(),this.setElement($(shellHtml)),this},MarketDataView.prototype.renderContent=function(){var contentHtml,date,day,marketData,marketDataArray,recentStockDateString,recentStockTimestamp,sortedStockList;marketDataArray=this.collection.toJSON(),this.app.isMoney()&&(marketDataArray=function(){var j,len,results;for(results=[],j=0,len=marketDataArray.length;j<len;j++)marketData=marketDataArray[j],"10-YR BOND"!==marketData.label&&results.push(marketData);return results}()),_.each(marketDataArray,function(mData,i){return mData.changePercent=parseFloat(mData.changePercent).toFixed(2),mData.change=parseFloat(mData.change).toFixed(2),marketDataArray[i]=mData}),contentHtml=this.contentTemplate.render({marketdata:marketDataArray}),this.$content=$(contentHtml),sortedStockList=_(marketDataArray).sortBy(function(x){return x.timestamp}).pop(),recentStockTimestamp=sortedStockList.timestamp,date=new Date(1e3*parseInt(recentStockTimestamp,10)),day=this._DAYS[date.getDay()],recentStockDateString="As of "+day+" "+sortedStockList.dateTimeString,this.$content.find(".idc-timestamp").html(recentStockDateString),this.$content.find(".idc-tablestyle tbody tr").each(function(){var perChange;return perChange=parseFloat($(this).find(".idc-td-perchange span").text(),10),perChange>0?($(this).find(".idc-td-perchange span").addClass("idc-changeup"),$(this).find(".idc-td-change span").addClass("idc-changeup")):perChange<0?($(this).find(".idc-td-perchange span").addClass("idc-changedown"),$(this).find(".idc-td-change span").addClass("idc-changedown")):($(this).find(".idc-td-perchange span").addClass("idc-changedown").addClass("idc-change-none"),$(this).find(".idc-td-change span").addClass("idc-changenone"))}),this.$(".market-data-module").html(this.$content)},MarketDataView}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,module=module||{},module.exports=Time.views.NativoLeftRail=function(superClass){function NativoLeftRail(){return this._onCollectionAdd=bind(this._onCollectionAdd,this),NativoLeftRail.__super__.constructor.apply(this,arguments)}return extend(NativoLeftRail,superClass),NativoLeftRail.prototype.initialize=function(options){return null==options&&(options={}),options.parentEl=$(".rail-articles-scroll"),NativoLeftRail.__super__.initialize.apply(this,arguments),this},NativoLeftRail.prototype.render=function(){var $railArticles;return this.bindScroll(),null!=this.collection&&(this.clearDomData(),this.bindCollectionRendering(),this.setDynamicEl(),this.app.load_tabs(Time.tab_data.default),this.app.tabs_view.set_active(0),$railArticles=this.$el.closest("#rail-articles")),Time.trigger("leftRail:rendered",this),this},NativoLeftRail.prototype.scroll_limit_message=function(){var $message,href,text;if(0===$(".response-eot").length)return this.app.isMoney()?(href="/money/",text="Get the latest news on Money.com's home page"):(href="/",text="Get the latest news on TIME's home page"),$message=$("<a />",{class:"meta response-eot"}),$message.attr("href",href).html(text),$message.appendTo(this.$el),this},NativoLeftRail.prototype.bindCollectionRendering=function(){return this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"change:isActive",this._onCollectionModelChangeIsActive),this},NativoLeftRail.prototype._onCollectionAdd=function(articleModel,collection,options){this.renderArticleTile(articleModel,collection,options)},NativoLeftRail}(Time.views.DefaultLeftRail),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.NativoArticleTile=function(superClass){function NativoArticleTile(){return NativoArticleTile.__super__.constructor.apply(this,arguments)}return extend(NativoArticleTile,superClass),NativoArticleTile.prototype.template=Time.templates["article-tile-sponsored"],NativoArticleTile.prototype.type="sponsored",NativoArticleTile.prototype.initialize=function(){var html;return NativoArticleTile.__super__.initialize.apply(this,arguments),html=this.template.render(this.model.getNativoData()),this.setElement($(html)),this},NativoArticleTile.prototype.render=function(isArchive){var $prevTile,collection,prevModel;return null==isArchive&&(isArchive=this.model.get("is_nativo_page")),isArchive?this.renderInArchive():(collection=this.model.collection,prevModel=collection.at(collection.indexOf(this.model)-1),$prevTile=prevModel.views.tile_view.$el,$prevTile.after(this.$el),Time.trigger("leftRail:tile:injected",this),this)},NativoArticleTile.prototype.renderInArchive=function(){return this.$el.appendTo(this.$parent),Time.trigger("leftRail:tile:rendered",this),this},NativoArticleTile}(Time.views.ArticleTile),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.PinnionPollCollapsible=function(superClass){function PinnionPollCollapsible(){return this.onClick=bind(this.onClick,this),this.onPinnionEvent=bind(this.onPinnionEvent,this),PinnionPollCollapsible.__super__.constructor.apply(this,arguments)}return extend(PinnionPollCollapsible,superClass),PinnionPollCollapsible.prototype.events={"click .leftRailModule--pinnion-poll":"onClick"},PinnionPollCollapsible.prototype.pollTemplate=Time.templates["lrm-pinnion-poll"],PinnionPollCollapsible.prototype.AUTO_COLLAPSE_TIMEOUT_DELAY=8e3,PinnionPollCollapsible.prototype._autoCollapseTimeout=null,PinnionPollCollapsible.prototype.isUserInteracted=!1,PinnionPollCollapsible.prototype.isAdsRefreshable=!1,PinnionPollCollapsible.prototype.AD_ID="LeftRailPinnionPollAd",PinnionPollCollapsible.prototype.AD_SIZES=["300x50","320x50"],PinnionPollCollapsible.prototype.initialize=function(options){return null==options&&(options={}),_.extend(this.events,Time.views.CollapsibleModule.prototype.events),options.isExpanded=!0,PinnionPollCollapsible.__super__.initialize.apply(this,arguments),this.createDOM(),this.listenTo(Time,"leftRail:scroll",function(railView){Tether.position()}),this.listenTo(Time,"leftRail:opened",function(_this){return function(){_this.$pollEmbed.height(0).height(_this.$pollEmbed.find("iframe").height()),_this.isUserInteracted||_.defer(function(){return _this.autoCollapse()})}}(this)),this.listenTo(this,"expanded",function(){this.isUserInteracted=!0,window.clearTimeout(this._autoCollapseTimeout),"function"==typeof window.omniTrackEv&&window.omniTrackEv("lr_fpoll_open"),this.$(".leftRailModule--pinnion-poll__toggle").text("Close")}),this.listenTo(this,"collapsed",function(){this.isUserInteracted=!0,window.clearTimeout(this._autoCollapseTimeout),this.$(".leftRailModule--pinnion-poll__toggle").text("Open")}),this.listenTo(Time,"dfpAdManager:callback:hide",function(_this){return function(adId){var ref;adId===_this.AD_ID&&(null!=(ref=_this.$ad)?ref.length:void 0)&&(_this.$(".leftRailModule--pinnion-poll__ad").toggle(!_this.$ad.hasClass("hide-ad")),Tether.position())}}(this)),this.listenToOnce(Time,"dfpAdManager:change:isInitialLeftRailCycle",function(_this){return function(value){_this.isAdsRefreshable=!0}}(this)),this},PinnionPollCollapsible.prototype.createDOM=function(){var pollHtml;return pollHtml=this.pollTemplate.render(Time.bootstrap.lrm_pinnion),this.$el.html(pollHtml),this.$pollEmbed=$("#LeftRailPinnionPollEmbed"),this.$pollEmbed.length||(this.$pollEmbed=$("<div />",{id:"LeftRailPinnionPollEmbed"}),this.$pollEmbed.html(Time.bootstrap.lrm_pinnion.iframe)),this.$ad=$("#"+this.AD_ID),this.$ad.length||(this.$ad=$("<div />",{id:this.AD_ID})),this},PinnionPollCollapsible.prototype.render=function(before){var adParams,adTetherOptions,appendAd,embedTetherOptions,moveElement;return null==before&&(before=!0),before&&this.$el.prependTo(this.$parent),before||this.$el.appendTo(this.$parent),this.$embedContainer=this.$(".leftRailModule--pinnion-poll__embed"),this.$pollEmbed.appendTo(this.$embedContainer).css("display","block"),this.$embedContainer.height(this.$pollEmbed.height()||this.$pollEmbed.find("iframe").height()),embedTetherOptions={enabled:!0,element:this.$pollEmbed,target:this.$embedContainer,attachment:"top center",targetAttachment:"top center",constraints:[{to:"scrollParent"}],optimizations:{moveElement:!1}},this.tetheredEmbed=new Tether(embedTetherOptions),this.$pollEmbed.data("tether",this.tetheredEmbed),this.$adContainer=this.$(".leftRailModule--pinnion-poll__ad"),appendAd="body",moveElement=!0,"desktop"!==Time.device&&(appendAd=this.$adContainer,moveElement=!1),this.$ad.appendTo(appendAd),adTetherOptions={enabled:!0,element:this.$ad,target:this.$adContainer,attachment:"top center",targetAttachment:"top center",constraints:[{to:"scrollParent"}],optimizations:{moveElement:moveElement}},this.tetheredAd=new Tether(adTetherOptions),this.$ad.data("tether",this.tetheredAd),adParams={id:this.AD_ID,size:this.AD_SIZES,position:0,group:"leftRail-pinnionpoll",extraParams:{poll:"time 100"},renderOnce:!0},Time.trigger("dfpAdManager:activateAd",null,adParams),$(window).off("pinnionEvent.leftRail").on("pinnionEvent.leftRail",this.onPinnionEvent),Time.trigger("leftRail:tile:rendered",this),this},PinnionPollCollapsible.prototype.onPinnionEvent=function(e){var data;if(null!=e.originalEvent){if(data=JSON.parse(e.originalEvent.data),window.clearTimeout(this._autoCollapseTimeout),data.events.height_change)return this.$embedContainer.height(this.$pollEmbed.height()||this.$pollEmbed.find("iframe").height()),Tether.position(),this.isUserInteracted||Time.application.$articleListScroll.scrollTop(0),void(!this.isUserInteracted&&Time.application.isRailOpen&&_.defer(function(_this){return function(){return _this.autoCollapse()}}(this)));this.isUserInteracted=!0,this.isAdsRefreshable&&(data.events.q_advance||data.events.q_previous)&&Time.trigger("dfpAdManager:refreshAds",null,[this.AD_ID])}},PinnionPollCollapsible.prototype.autoCollapse=function(){return window.clearTimeout(this._autoCollapseTimeout),this._autoCollapseTimeout=window.setTimeout(function(_this){return function(){if(!_this.isUserInteracted)return _this.collapse()}}(this),this.AUTO_COLLAPSE_TIMEOUT_DELAY),this},PinnionPollCollapsible.prototype.onClick=function(e){window.clearTimeout(this._autoCollapseTimeout),this.isUserInteracted=!0},PinnionPollCollapsible}(Time.views.CollapsibleModule),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,module=module||{},module.exports=Time.views.Tabs=function(superClass){function Tabs(){return Tabs.__super__.constructor.apply(this,arguments)}return extend(Tabs,superClass),Tabs.prototype.el=".rail-tabs",Tabs.prototype.template=Time.templates["rail-tabs"],Tabs.prototype.events={click:"load_rail"},Tabs.prototype.initialize=function(display_data,el_selector){return null!=el_selector&&el_selector&&Time.application.currentBreakpoint>800&&(this.el=el_selector),this.render(display_data),this},Tabs.prototype.render=function(display_data){return"undefined"!=typeof console&&null!==console&&console.dir(display_data),$(this.template.render(display_data)).appendTo(this.$el)},Tabs.prototype.load_rail=function(e){var $el,env,pos,sub;return $el=$(e.target),$el.is(".rail-tab")?!$el.hasClass("active")&&(pos=this.$el.index($el),env=$el.attr("id"),sub=$el.attr("data-sub"),this.set_active(env||0),void(null!=$el.data("event")&&"function"==typeof window.omniTrackEv&&window.omniTrackEv($el.data("event")))):e},Tabs.prototype.set_active=function(env){return this.$(".rail-tab").removeClass("active"),"number"==typeof env?this.$(".rail-tab").eq(0).addClass("active"):this.$(".rail-tab#"+env).addClass("active"),this},Tabs.prototype.destroy=function(){return this.undelegateEvents(),this.$el.removeData().unbind().empty(),this},Tabs}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.TextModule=function(superClass){function TextModule(){return TextModule.__super__.constructor.apply(this,arguments)}return extend(TextModule,superClass),TextModule.prototype.template=Time.templates["lrm-text"],TextModule.prototype.type="text",TextModule.prototype.initialize=function(options){var ref;return null==options&&(options={}),TextModule.__super__.initialize.apply(this,arguments),this.data=options.data||(null!=(ref=this.model)?ref.toJSON():void 0),null==this.data&&(this.data={}),this},TextModule.prototype.render=function(){var html;return this.isRendered||(html=this.template.render(this.data),this.setElement($(html)),this.$el.appendTo(this.$parent)),this},TextModule}(Time.views.LeftRailModule)}).call(this);;
(function(){var $,LODASH_VERSION,Time,module,require,root,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;LODASH_VERSION="3.9.3","undefined"!=typeof _&&null!==_&&_.VERSION!==LODASH_VERSION&&_.noConflict(),module={},require=_.noop,$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.DynamicHeader=function(superClass){function DynamicHeader(){return this.render=bind(this.render,this),DynamicHeader.__super__.constructor.apply(this,arguments)}return extend(DynamicHeader,superClass),DynamicHeader.prototype.el=".top-banner",DynamicHeader.prototype.DEBUG=!0,DynamicHeader.prototype.initialize=function(options){null==options&&(options={}),this.app=options.app,this.app.$body.addClass("has-dynamic-header")},DynamicHeader.prototype.render=function(){this.app.$body.addClass("has-dynamic-header"),this.$el.empty()},DynamicHeader.prototype.destroy=function(){this.app.$body.removeClass("has-dynamic-header"),this.$el.empty(),this.unbind(),this.stopListening()},DynamicHeader.prototype.destroyImage=function(){this.$el.empty()},DynamicHeader}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.DynamicHeaderImage=function(superClass){function DynamicHeaderImage(){return DynamicHeaderImage.__super__.constructor.apply(this,arguments)}return extend(DynamicHeaderImage,superClass),DynamicHeaderImage.prototype._SETTINGS={link:null,data_event:null,digital_account:null,logout_url:null,subscribe_link_desktop:null,subscribe_link_mobile:null},DynamicHeaderImage.prototype._logoutUrl=null,DynamicHeaderImage.prototype.initialize=function(options){null==options&&(options={}),DynamicHeaderImage.__super__.initialize.apply(this,arguments),this.listenTo(Time,"application:resize",this.onResize),"staging.time.com"===window.location.host?this._logoutUrl="https://qa-auth.time.com/logout.php?turl=http://staging.time.com":this._logoutUrl="https://auth.time.com/logout.php?turl=http://www.time.com",this._SETTINGS={link:Time.home_url,data_event:"default-dynamic header",digital_account:window.location.protocol+"//"+window.location.host+"/digital-account/",logout_url:this._logoutUrl,subscribe_link_desktop:Time.bootstrap.subscribe_link_desktop,subscribe_link_mobile:Time.bootstrap.subscribe_link_mobile},"time_poywalkup_header_activate"===Time.bootstrap.dynamic_header_name&&(this._SETTINGS={link:Time.home_url+"/4108617/time-person-of-the-year-poll-2015/?iid=poy111615",data_event:"poy-walkup header",digital_account:window.location.protocol+"//"+window.location.host+"/digital-account/",logout_url:this._logoutUrl,subscribe_link_desktop:Time.bootstrap.subscribe_link_desktop,subscribe_link_mobile:Time.bootstrap.subscribe_link_mobile}),"time_yearinspace_header_activate"===Time.bootstrap.dynamic_header_name&&(this._SETTINGS={link:Time.home_url+"/space-nasa-scott-kelly-mission/?iid=space030216",data_event:"space-promotion header",digital_account:window.location.protocol+"//"+window.location.host+"/digital-account/",logout_url:this._logoutUrl,subscribe_link_desktop:Time.bootstrap.subscribe_link_desktop,subscribe_link_mobile:Time.bootstrap.subscribe_link_mobile}),"time_motto_header_activate"===Time.bootstrap.dynamic_header_name&&(this._SETTINGS={link:"http://motto.time.com/?iid=motto020316",data_event:"motto header",digital_account:window.location.protocol+"//"+window.location.host+"/digital-account/",logout_url:this._logoutUrl,subscribe_link_desktop:Time.bootstrap.subscribe_link_desktop,subscribe_link_mobile:Time.bootstrap.subscribe_link_mobile}),"time100_2016_header_activate"===Time.bootstrap.dynamic_header_name&&(this._SETTINGS={link:"http://time.com/collection/2016-time-100/?iid=t100-042116",data_event:"time 100",digital_account:window.location.protocol+"//"+window.location.host+"/digital-account/",logout_url:this._logoutUrl,subscribe_link_desktop:Time.bootstrap.subscribe_link_desktop,subscribe_link_mobile:Time.bootstrap.subscribe_link_mobile}),"next_generation_leaders_activate"===Time.bootstrap.dynamic_header_name&&(this._SETTINGS={link:"http://time.com/collection/next-generation-leaders/?iid=ngl-100716",data_event:"NGL header",digital_account:window.location.protocol+"//"+window.location.host+"/digital-account/",logout_url:this._logoutUrl,subscribe_link_desktop:Time.bootstrap.subscribe_link_desktop,subscribe_link_mobile:Time.bootstrap.subscribe_link_mobile}),this.render()},DynamicHeaderImage.prototype.render=function(){var html;return html=Time.templates["dynamic-header-image"].render({href:this._SETTINGS.link,omniture:this._SETTINGS.data_event,digital_account:this._SETTINGS.digital_account,logout_url:this._SETTINGS.logout_url,subscribe_link_desktop:this._SETTINGS.subscribe_link_desktop,subscribe_link_mobile:this._SETTINGS.subscribe_link_mobile}),this.$el.html(html),this},DynamicHeaderImage}(Time.views.DynamicHeader),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.DynamicHeaderSpace=function(superClass){function DynamicHeaderSpace(){return this.brightcovePauseAtTimestamp=bind(this.brightcovePauseAtTimestamp,this),this._brightcoveOnStop=bind(this._brightcoveOnStop,this),this._brightcoveOnComplete=bind(this._brightcoveOnComplete,this),this._brightcoveOnProgress=bind(this._brightcoveOnProgress,this),this._brightcoveOnBegin=bind(this._brightcoveOnBegin,this),this._brightcoveOnTemplateReady=bind(this._brightcoveOnTemplateReady,this),this._brightcoveOnTemplateLoad=bind(this._brightcoveOnTemplateLoad,this),this.render=bind(this.render,this),this.onResize=bind(this.onResize,this),this.onClickEmbed=bind(this.onClickEmbed,this),DynamicHeaderSpace.__super__.constructor.apply(this,arguments)}return extend(DynamicHeaderSpace,superClass),DynamicHeaderSpace.prototype.events={"click .BrightcoveExperience":"onClickEmbed"},DynamicHeaderSpace.prototype._BREAKPOINT_LARGE_VIDEO=1313,DynamicHeaderSpace.prototype._BREAKPOINT_SMALL_VIDEO=1024,DynamicHeaderSpace.prototype._BREAKPOINT_IMAGE=1024,DynamicHeaderSpace.prototype._LINK=Time.home_url+"/space-nasa-scott-kelly-mission/?iid=space070815",DynamicHeaderSpace.prototype._OBJECT_ID="spaceAdPlayer",DynamicHeaderSpace.prototype._BG_COLOR="#000000",DynamicHeaderSpace.prototype._PLAYER_ID="4083183491001",DynamicHeaderSpace.prototype._PLAYER_KEY="AQ~~,AAAAABGEUMg~,hNlIXLTZFZnRxDphZJhkr7J3UnhLqcai",DynamicHeaderSpace.prototype._VIDEO_PROGRESS_PAUSE_OFFSET=.2,DynamicHeaderSpace.prototype._VIDEO_END_OFFSET=.05,DynamicHeaderSpace.prototype._VIDEOS={large:{videoId:"4096227055001",width:988,height:82},small:{videoId:"4096221822001",width:699,height:82}},DynamicHeaderSpace.prototype._isInitialized=!1,DynamicHeaderSpace.prototype._isVideoStarted=!1,DynamicHeaderSpace.prototype._video=null,DynamicHeaderSpace.prototype._videoId=null,DynamicHeaderSpace.prototype._videoDuration=0,DynamicHeaderSpace.prototype._player=null,DynamicHeaderSpace.prototype.renderedVideo=null,DynamicHeaderSpace.prototype.initialize=function(options){null==options&&(options={}),DynamicHeaderSpace.__super__.initialize.apply(this,arguments),this.DEBUG&&console.debug("SPACE HEADER, INITIALIZE!!!!"),this.listenTo(Time,"application:resize",this.onResize),this.render()},DynamicHeaderSpace.prototype.isImage=function(){return this.app.sizes.ww>=this._BREAKPOINT_IMAGE},DynamicHeaderSpace.prototype.getVideoKey=function(){return this.app.sizes.ww>=this._BREAKPOINT_LARGE_VIDEO?"large":this.app.sizes.ww>=this._BREAKPOINT_SMALL_VIDEO?"small":null},DynamicHeaderSpace.prototype.getVideoObject=function(){var key;return key=this.getVideoKey(),key?this._VIDEOS[key]:null},DynamicHeaderSpace.prototype.getData=function(video){var data;return null==video&&(video=this.getVideoObject()),video?data={objectId:this._OBJECT_ID,bgColor:this._BG_COLOR,width:video.width,height:video.height,playerId:this._PLAYER_ID,playerKey:this._PLAYER_KEY,videoId:video.videoId,href:this._LINK,omniture:"space header"}:null},DynamicHeaderSpace.prototype.onClickEmbed=function(e){return window.location=this._LINK,!1},DynamicHeaderSpace.prototype.onResize=function(){var isTooSmall,isVideoChanged;"desktop"===Time.device?(isVideoChanged=this.renderedVideo!==this.getVideoKey(),isTooSmall=this.app.sizes.ww<this._BREAKPOINT_SMALL_VIDEO,(isVideoChanged||isTooSmall)&&this.destroyVideo(),isVideoChanged&&!isTooSmall&&this.render()):(isTooSmall=this.app.sizes.ww<this._BREAKPOINT_IMAGE,isTooSmall&&this.destroyImage(),isTooSmall||this.render())},DynamicHeaderSpace.prototype.render=function(){return DynamicHeaderSpace.__super__.render.apply(this,arguments),this.renderImage()},DynamicHeaderSpace.prototype.destroy=function(){DynamicHeaderSpace.__super__.destroy.apply(this,arguments),this.$el.removeClass("video-playing video-ready"),this.destroyVideo(),this.destroyImage()},DynamicHeaderSpace.prototype.renderVideo=function(){var data,html;return(data=this.getData())?(this._videoId=data.videoId,this.renderedVideo=this.getVideoKey(),html=Time.templates["dynamic-header-video"].render(data),this.$el.html(html),this.DEBUG&&console.debug("SPACE HEADER, RENDER!!!!"),this):this.destroyVideo()},DynamicHeaderSpace.prototype.destroyVideo=function(){var base;this.brightcoveClearEvents(),this._video&&(this._video.pause(),"function"==typeof(base=this._video).loadVideoById&&base.loadVideoById()),this.$el.empty(),this.$el.removeClass("video-ready"),this._video=null,this._videoId=null,this._player=null,this._isInitialized=!1,this.renderedVideo=null},DynamicHeaderSpace.prototype.renderImage=function(){var html;return html=Time.templates["dynamic-header-image"].render({href:this._LINK,omniture:"space header"}),this.$el.html(html),this},DynamicHeaderSpace.prototype._brightcoveOnTemplateLoad=function(experienceID){this._player=window.brightcove.api.getExperience(experienceID)},DynamicHeaderSpace.prototype._brightcoveOnTemplateReady=function(event){this._isInitialized||(this._isInitialized=!0,this._video=this._player.getModule(window.brightcove.api.modules.APIModules.VIDEO_PLAYER),this._video.addEventListener(window.brightcove.api.events.MediaEvent.BEGIN,this._brightcoveOnBegin),this._video.addEventListener(window.brightcove.api.events.MediaEvent.PROGRESS,this._brightcoveOnProgress),this._video.addEventListener(window.brightcove.api.events.MediaEvent.COMPLETE,this._brightcoveOnComplete),this._video.addEventListener(window.brightcove.api.events.MediaEvent.STOP,this._brightcoveOnStop),this._video.play())},DynamicHeaderSpace.prototype._brightcoveOnBegin=function(e){this.DEBUG&&console.debug("SPACE HEADER, VIDEO BEGIN EVENT!!!!"),this.$el.addClass("video-ready"),this._videoDuration=e.duration},DynamicHeaderSpace.prototype._brightcoveOnProgress=function(e){var isAtEnd;!this._isVideoStarted&&e.position>1&&(this.$el.addClass("video-playing"),this._isVideoStarted=!0),isAtEnd=e.position+this._VIDEO_PROGRESS_PAUSE_OFFSET>=e.duration,isAtEnd&&(this.brightcoveClearEvents(),this.brightcovePauseAtTimestamp(this._videoDuration-this._VIDEO_END_OFFSET))},DynamicHeaderSpace.prototype._brightcoveOnComplete=function(e){this._video.loadVideoByID(this._videoId),this.brightcoveClearEvents(),this.brightcovePauseAtTimestamp(this._videoDuration-this._VIDEO_END_OFFSET)},DynamicHeaderSpace.prototype._brightcoveOnStop=function(e){this.brightcoveClearEvents(),window.setTimeout(function(_this){return function(){return _this.brightcovePauseAtTimestamp(e.position-_this._VIDEO_END_OFFSET)}}(this),100)},DynamicHeaderSpace.prototype.brightcoveClearEvents=function(){null!=this._video&&(this._video.removeEventListener(window.brightcove.api.events.MediaEvent.BEGIN,this._brightcoveOnBegin),this._video.removeEventListener(window.brightcove.api.events.MediaEvent.PROGRESS,this._brightcoveOnProgress),this._video.removeEventListener(window.brightcove.api.events.MediaEvent.COMPLETE,this._brightcoveOnComplete),this._video.removeEventListener(window.brightcove.api.events.MediaEvent.STOP,this._brightcoveOnStop))},DynamicHeaderSpace.prototype.brightcovePauseAtTimestamp=function(timestamp){null==timestamp&&(timestamp=this._videoDuration-this._VIDEO_END_OFFSET),this._video&&(this._video.play(),this._video.seek(timestamp),this._video.pause())},DynamicHeaderSpace}(Time.views.DynamicHeader),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.DynamicHeaderTime100=function(superClass){function DynamicHeaderTime100(){return this.render=bind(this.render,this),this.onResize=bind(this.onResize,this),DynamicHeaderTime100.__super__.constructor.apply(this,arguments)}return extend(DynamicHeaderTime100,superClass),DynamicHeaderTime100.prototype._BREAKPOINT_IMAGE=1024,DynamicHeaderTime100.prototype._LINK="http://time.com/collection/2015-time-100/?iid=2015time100influential041615",DynamicHeaderTime100.prototype.initialize=function(options){null==options&&(options={}),DynamicHeaderTime100.__super__.initialize.apply(this,arguments),this.DEBUG&&console.debug("Time100 HEADER, INITIALIZE!!!!"),this.listenTo(Time,"application:resize",this.onResize),this.render()},DynamicHeaderTime100.prototype.onResize=function(){var isTooSmall;isTooSmall=this.app.sizes.ww<this._BREAKPOINT_IMAGE,isTooSmall&&this.destroyImage(),isTooSmall||this.render()},DynamicHeaderTime100.prototype.render=function(){var html;return DynamicHeaderTime100.__super__.render.apply(this,arguments),html=Time.templates["dynamic-header-image"].render({href:this._LINK,omniture:"time100 header"}),this.$el.html(html),this},DynamicHeaderTime100.prototype.destroy=function(){DynamicHeaderTime100.__super__.destroy.apply(this,arguments),this.destroyImage()},DynamicHeaderTime100}(Time.views.DynamicHeader)}).call(this);;
(function(){var $,LODASH_VERSION,Time,module,require,root,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};LODASH_VERSION="3.9.3","undefined"!=typeof _&&null!==_&&_.VERSION!==LODASH_VERSION&&_.noConflict(),module={},require=_.noop,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.models.Gallery=function(superClass){function Gallery(){return Gallery.__super__.constructor.apply(this,arguments)}return extend(Gallery,superClass),Gallery.prototype.defaults={isPrimary:!1,photos:[],hasAds:!0,adfrequency:null,view:null,slideIndex:0},Gallery.prototype.url=function(){return"/api/gallery/"+this.id+"/"},Gallery.prototype.initialize=function(){return this.DEBUG=window.location.href.indexOf("debuggallery")!==-1,_.bindAll(this,"url"),this.syncing=!1,this.listenTo(this,"change:isPrimary",function(model,value,options){value&&Time.trigger("article:primaryGallery:found",this)}),this.listenToOnce(this,"sync:error",function(){"undefined"!=typeof console&&null!==console&&console.error("GalleryModel "+this.id+" could not sync")}),this.listenToOnce(this,"gallery:dataReady",function(){this.get("adfrequency")||this.set("adfrequency","vertical"===this.get("size")?4:6)}),this},Gallery.prototype.getData=function(){return this.get("photos").length?this.trigger("gallery:dataReady"):(this.listenToOnce(this,"sync:complete",function(){this.trigger("gallery:dataReady")}),this.fetch()),this},Gallery.prototype.parse=function(response){return response.gallery},Gallery.prototype.checkCache=function(){var cachedModelAttributes;return cachedModelAttributes=this.collection.get_from_cache(this.id),null!=(null!=cachedModelAttributes?cachedModelAttributes.photos:void 0)&&(this.set(cachedModelAttributes),!0)},Gallery.prototype.fetch=function(opts){var complete_callback,success_callback;return null==opts&&(opts={}),!this.syncing&&(complete_callback=opts.complete,success_callback=opts.success,this.checkCache()?(null!=complete_callback&&complete_callback.call(this),null!=success_callback&&success_callback.call(this),this.trigger("sync:success",this),this):(this.trigger("sync:syncing"),this.syncing=!0,opts.dataType="json",opts.complete=function(_this){return function(response){return _this.trigger("sync:complete"),_this.syncing=!1,null!=complete_callback?complete_callback.call(model,response,options):void 0}}(this),opts.success=function(_this){return function(model,response,options){return"object"!=typeof response?(_this.trigger("sync:error"),opts.error(model,response,options),!1):(_this.trigger("sync:success"),null==response.error&&null!=success_callback?success_callback.call(model,response,options):void 0)}}(this),Backbone.Collection.prototype.fetch.call(this,opts)))},Gallery.prototype.getView=function(parentView){return null!=this.view?this.view:(this.view=new Time.views.GalleryVertical({model:this,parent:parentView}),this.view)},Gallery.prototype.getSlideIndex=function(){return parseInt(this.get("slideIndex"),10)},Gallery.prototype.getTotalSlides=function(){var ref;return null==(null!=(ref=this.view)?ref.slidesCollection.length:void 0)?0:this.view.slidesCollection.length},Gallery}(Backbone.Model),root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.models.GalleryLightbox=function(superClass){function GalleryLightbox(){return GalleryLightbox.__super__.constructor.apply(this,arguments)}return extend(GalleryLightbox,superClass),GalleryLightbox.prototype.defaults=_.extend({},Time.models.Gallery.prototype.defaults,{lastSlideIndex:0,prerenderCount:3,isFullscreen:!1,isCaptionTruncated:!1,isCaptionExpanded:!0,isInitialSlide:!0,isAdvanceable:!1,isSwappable:!1}),GalleryLightbox.prototype.initialize=function(){return GalleryLightbox.__super__.initialize.apply(this,arguments),this},GalleryLightbox.prototype.getView=function(parentView){return null!=this.view?this.view:(this.view=new Time.views.GalleryLightbox({model:this,parent:parentView}),this.view)},GalleryLightbox.prototype.currentSlide=function(){var ref;return null!=(ref=this.view)?ref.slidesCollection.at(this.get("slideIndex")):void 0},GalleryLightbox.prototype.isAtEnd=function(){return 0===this.getTotalSlides()||this.getSlideIndex()===this.getTotalSlides()-1},GalleryLightbox.prototype.goSlide=function(index){return this.getSlideIndex()===index?this:index<0?this:index>this.getTotalSlides()-1?this:(this.set("slideIndex",index),this)},GalleryLightbox.prototype.goNextSlide=function(){var currentIndex,isAtSecondToLastSlide;if(this.canSkipAd())return currentIndex=this.getSlideIndex(),isAtSecondToLastSlide=this.getTotalSlides()>=2?this.getTotalSlides()-2:0,this.get("custom_recirc_url")&&currentIndex===isAtSecondToLastSlide?(window.location=this.get("custom_recirc_url"),this):"endless"===this.get("type")&&this.get("next_gallery")&&currentIndex===isAtSecondToLastSlide?($(".gallery__viewport").empty(),$(".gallery__viewport").addClass("loading-overlay"),window.location=this.get("next_gallery").url,this):(this.isAtEnd()?this.trigger("gallery:pastEnd"):this.set("slideIndex",currentIndex+1),this)},GalleryLightbox.prototype.goPrevSlide=function(){var currentIndex;if(this.canSkipAd())return currentIndex=this.getSlideIndex(),0===currentIndex?this.trigger("gallery:swapPrev"):this.set("slideIndex",currentIndex-1),this},GalleryLightbox.prototype.canSkipAd=function(){var currentSlide;return currentSlide=this.currentSlide(),"ad"!==currentSlide.get("slideType")||currentSlide.get("canSkip")===!0},GalleryLightbox}(Time.models.Gallery),root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.models.GallerySlide=function(superClass){function GallerySlide(){return GallerySlide.__super__.constructor.apply(this,arguments)}return extend(GallerySlide,superClass),GallerySlide.prototype.defaults={slideType:"default",isActive:!1,title:"Untitled Image",slug:"",caption:"",credit:"",alt:"",width:0,height:0,orientation:"landscape",url:"",encoded_shortlink:"",galleryTitle:"Untitled Gallery",twitterVia:"Time",twitterText:"",facebookText:"",emailText:""},GallerySlide.prototype.initialize=function(){var XID_MAP,key,xid;switch(this.get("slideType")){case"endless":this.view=new Time.views.GallerySlideLightboxEndless({model:this});break;case"related":this.view=new Time.views.GallerySlideLightboxRelated({model:this});break;default:this.view=new Time.views.GallerySlide({model:this})}XID_MAP={email:"emailshare",facebook:"fbshare",linkedin:"linkedinshare",google:"gplusshare",whatsapp:"whatsappshare"},this.eUrlWithXid={};for(key in XID_MAP)xid=XID_MAP[key],this.eUrlWithXid[key]=encodeURIComponent(this.get("url")+"?xid="+xid);return this},GallerySlide.prototype.getEncodedGalleryTitle=function(){return encodeURIComponent(this.get("galleryTitle"))},GallerySlide.prototype.getEncodedUrl=function(){return encodeURIComponent(this.get("url"))},GallerySlide.prototype.getShareMail=function(){var emailBody,lineBreak;return lineBreak="%0D%0A%0D%0A",emailBody=this.get("emailText"),emailBody=emailBody?emailBody+lineBreak:"",emailBody=this.getEncodedGalleryTitle()+lineBreak+emailBody+this.eUrlWithXid.email,"mailto:?subject="+this.getEncodedGalleryTitle()+"&body="+emailBody},GallerySlide.prototype.getShareTwitter=function(){var twitterText,twitterUrl;return twitterText=this.get("twitterText")||this.getEncodedGalleryTitle(),twitterUrl="https://twitter.com/intent/tweet",twitterUrl+="?url="+this.get("twitter_encoded_shortlink"),twitterUrl+="&text="+twitterText,"TIME"!==this.get("twitterVia").toUpperCase()&&(twitterUrl+="&via="+this.get("twitterVia")),twitterUrl},GallerySlide.prototype.getShareGplus=function(){return"https://plus.google.com/share?url="+this.eUrlWithXid.google},GallerySlide.prototype.getShareLinkedIn=function(){return"http://www.linkedin.com/shareArticle?mini=true&url="+this.eUrlWithXid.linkedin+"&title="+this.getEncodedGalleryTitle()},GallerySlide.prototype.getShareFacebook=function(){var fbUrl;return fbUrl="http://facebook.com/sharer.php?s=100",fbUrl+="&p[title]="+this.getEncodedGalleryTitle(),fbUrl+="&p[url]="+this.eUrlWithXid.facebook},GallerySlide}(Backbone.Model),root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.models.GallerySlideAd=function(superClass){function GallerySlideAd(){return GallerySlideAd.__super__.constructor.apply(this,arguments)}return extend(GallerySlideAd,superClass),GallerySlideAd.prototype.defaults={slideType:"ad",index:0,adIndex:1,isActive:!1,adModelId:"",canSkip:!1},GallerySlideAd.prototype.initialize=function(attributes,options){var ref,size,templates;return null==attributes&&(attributes={}),null==options&&(options={}),this.galleryModel=options.galleryModel,this.set("adModelId","gallery__ad--"+this.getAdPosition()),size="vertical"===(null!=(ref=this.galleryModel)?ref.get("size"):void 0)?"vertical":"lightbox",templates={lightbox:"gallery-slide-lightbox-ad",vertical:"gallery-slide-vertical-ad"},this.view=new Time.views.GallerySlideAd({template:Time.templates[templates[size]],collection:this.collection,model:this}),this},GallerySlideAd.prototype.getAdPosition=function(){var articleId,articleModel,articleView,galleries,galleryId,ref,ref1,slideIndex;return galleryId=(null!=(ref=this.galleryModel)?ref.id:void 0)||"",slideIndex=this.get("index")||"",galleries=(null!=(ref1=this.galleryModel)?ref1.collection:void 0)||null,articleView=(null!=galleries?galleries.article:void 0)||null,articleModel=(null!=articleView?articleView.model:void 0)||null,articleId=(null!=articleModel?articleModel.id:void 0)||"","a"+articleId+"g"+galleryId+"s"+slideIndex},GallerySlideAd}(Backbone.Model),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.collections.Galleries=function(superClass){function Galleries(){return Galleries.__super__.constructor.apply(this,arguments)}return extend(Galleries,superClass),Galleries.prototype.model=function(attributes,options){switch(null!=attributes?attributes.size:void 0){case"vertical":return new Time.models.Gallery(attributes,options);default:return new Time.models.GalleryLightbox(attributes,options)}},Galleries.prototype.initialize=function(models,options){return null==options&&(options={}),this.cache={},options.article?(this.article=options.article,this.listenTo(this,"add change",function(model){return this.addToCache(model.toJSON(),model.id)}),this.listenTo(this,"gallery:replace",function(oldId,newId){var ref;return null==oldId&&(oldId=null!=(ref=Time.activeGallery)?ref.id:void 0),this.replaceGallery(oldId,newId)})):(console.error("Galleries collection needs an article",options),null)},Galleries.prototype.replaceGallery=function(oldId,newId){var $galleryViewParent,newGalleryModel,oldGalleryModel,ref;return null==oldId&&(oldId=null!=(ref=Time.activeGallery)?ref.id:void 0),oldGalleryModel=this.get(oldId),newGalleryModel=this.get(newId),null==newGalleryModel&&(this.add({id:newId}),newGalleryModel=this.get(newId)),$galleryViewParent=oldGalleryModel.view.$el.parent(),this.listenTo(newGalleryModel,"sync:success",function(){var galleryView,html;return oldGalleryModel.view.remove(),galleryView=newGalleryModel.getView({model:newGalleryModel}),html=galleryView.render().el,$galleryViewParent.html(html),$galleryViewParent.attr("data-gallery",newId),Time.application.model.set("activeGallery",newGalleryModel),galleryView.trigger("gallery:rendered")}),newGalleryModel.get("photos")?newGalleryModel.trigger("sync:success"):newGalleryModel.fetch()},Galleries.prototype.addToCache=function(data,id){return null==id&&(id=null),null==id&&(id=data.id),null==this.cache[id]&&(this.cache[id]=data),this},Galleries.prototype.get_from_cache=function(id){return null!=this.cache[id]?this.model(this.cache[id]):null},Galleries}(Backbone.Collection),root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.collections.GallerySlides=function(superClass){function GallerySlides(){return this.onFlush=bind(this.onFlush,this),this.onChangeSlideIndex=bind(this.onChangeSlideIndex,this),this.addShareData=bind(this.addShareData,this),this.model=bind(this.model,this),GallerySlides.__super__.constructor.apply(this,arguments)}return extend(GallerySlides,superClass),GallerySlides.prototype.DEBUG=!1,GallerySlides.prototype.model=function(attributes,options){switch(null==attributes&&(attributes={}),null==options&&(options={}),options.collection=this,options.galleryView=this.galleryView||null,options.galleryModel=this.galleryModel||null,null!=attributes?attributes.slideType:void 0){case"ad":return new Time.models.GallerySlideAd(attributes,options)}return new Time.models.GallerySlide(attributes,options)},GallerySlides.prototype.initialize=function(models,options){return null==models&&(models=[]),null==options&&(options={}),this.DEBUG&&console.info("GallerySlides collection -- init",models,options),null==options.gallery?(console.error("GallerySlides collection needs to be attached to a gallery",options),null):(this.galleryView=options.gallery,this.galleryModel=this.galleryView.model,_.each(models,this.addShareData),"endless"===this.galleryModel.get("type")&&this.galleryModel.get("next_gallery")?this.addEndless(models,this.galleryModel.get("next_gallery")):this.galleryModel.get("galleries")&&this.addRelated(models,this.galleryModel.get("galleries")),this.listenTo(this.galleryModel,"change:slideIndex",this.onChangeSlideIndex),this.listenTo(this,"gallery:slides:flush",this.onFlush),this)},GallerySlides.prototype.addShareData=function(model){model.galleryTitle=this.galleryModel.get("title")||"Untitled Gallery",model.twitterVia=this.galleryModel.get("twitter_via")||"Time",model.twitterText=this.galleryModel.get("twitter_text"),model.facebookText=this.galleryModel.get("fb_text"),model.emailText=this.galleryModel.get("email_body")},GallerySlides.prototype.onChangeSlideIndex=function(model,value,options){var newActiveSlideIndex,newActiveSlideModel,oldActiveModel;this.DEBUG&&console.info("gallery "+this.galleryModel.id+" slides collection heard change:slideIndex toggling slide isActive states"),oldActiveModel=this.findWhere({isActive:!0}),null!=oldActiveModel&&oldActiveModel.set("isActive",!1),newActiveSlideIndex=this.galleryModel.get("slideIndex"),newActiveSlideModel=this.at(newActiveSlideIndex),newActiveSlideModel.set({isActive:!0})},GallerySlides.prototype.onFlush=function(){this.DEBUG&&console.info("gallery "+this.galleryModel.id+" slides collection - flush isRendered for slides"),this.invoke("set",{isRendered:!1})},GallerySlides.prototype.addEndless=function(models,nextGallery){if(null==models&&(models=[]),(null==this.galleryModel||this.galleryModel.id!==nextGallery.id)&&"vertical"!==this.galleryModel.get("size")&&null!=nextGallery)return models.push({slideType:"endless",nextGallery:nextGallery}),this},GallerySlides.prototype.addRelated=function(models,galleries){if(null==models&&(models=[]),"vertical"!==this.galleryModel.get("size")&&(null!=this.galleryModel&&(galleries=_.filter(galleries,function(_this){return function(gallery){return gallery.id!==_this.galleryModel.id}}(this))),null!=galleries?galleries.length:void 0))return models.push({slideType:"related",galleries:galleries}),this},GallerySlides}(Backbone.Collection),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.GallerySlideLightbox=function(superClass){function GallerySlideLightbox(){return GallerySlideLightbox.__super__.constructor.apply(this,arguments)}return extend(GallerySlideLightbox,superClass),GallerySlideLightbox.prototype.events={"click [data-gallery-link]":"clickedTile"},GallerySlideLightbox.prototype.initialize=function(){var ref,ref1;return null==this.model?null:(this.gallery=null!=(ref=this.model)&&null!=(ref1=ref.collection)?ref1.gallery:void 0,this)},GallerySlideLightbox.prototype.clickedTile=function(e){var $galleryThumbnail,galleryId;if(e.stopPropagation(),null!=this.gallery&&this.gallery.get("isSwappable"))return e.preventDefault(),$galleryThumbnail=$(e.currentTarget),galleryId=$galleryThumbnail.data("gallery-link"),this.swapGallery(galleryId)},GallerySlideLightbox.prototype.swapGallery=function(galleryId){var ref,ref1;if(null!=galleryId)return Time.application.model.set("initialGallerySlug",""),null!=(ref=this.gallery)&&null!=(ref1=ref.collection)&&ref1.trigger("gallery:replace",this.gallery.id,galleryId),this},GallerySlideLightbox}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.GallerySlidesView=function(superClass){function GallerySlidesView(){return GallerySlidesView.__super__.constructor.apply(this,arguments)}return extend(GallerySlidesView,superClass),GallerySlidesView.prototype.initialize=function(options){return null==options&&(options={}),console.info("GallerySlidesView init ",options),this.galleryView=options.gallery,this.listenTo(this,"view:destroy",function(){var ref;console.info("GallerySlidesView heard view:destroy, destroying",this),null!=(ref=this.collection)&&ref.invoke("set",{isRendered:!1,isActive:!1}),this.collection=null,this.galleryView=null}),this},GallerySlidesView}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.Gallery=function(superClass){function Gallery(){return Gallery.__super__.constructor.apply(this,arguments)}return extend(Gallery,superClass),Gallery.prototype.initialize=function(options){var slidesData,startingIndex,startingSlide;return null==options&&(options={}),this.model=options.model,this.parent=options.parent,this.$parent=options.$parent,this.$slides=null,this.slidesView=null,slidesData=this.model.get("photos").slice(0),this.slidesCollection=new Time.collections.GallerySlides(slidesData,{gallery:this}),this.listenTo(this,"view:destroy",function(){var ref;console.info("GalleryView (super) heard view:destroy, destroying @slidesView"),null!=(ref=this.slidesView)&&"function"==typeof ref.destroy&&ref.destroy(),this.slidesView=null,this.slidesCollection=null,this.model=null}),Time.application.model.get("initialGallerySlug")&&(startingSlide=this.slidesCollection.findWhere({slug:Time.application.model.get("initialGallerySlug")}),startingSlide&&(startingIndex=this.slidesCollection.indexOf(startingSlide),this.model.set({slideIndex:startingIndex},{silent:!0})),Time.application.model.set("initialGallerySlug","")),this},Gallery}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.GallerySlideLightboxEndless=function(superClass){function GallerySlideLightboxEndless(){return GallerySlideLightboxEndless.__super__.constructor.apply(this,arguments)}return extend(GallerySlideLightboxEndless,superClass),GallerySlideLightboxEndless.prototype.template=Time.templates["gallery-slide-lightbox-endless"],GallerySlideLightboxEndless.prototype.render=function(){var nextGallery,ref;if(nextGallery=this.model.get("nextGallery"))return this.setElement(this.template.render(nextGallery,Time.partials)),(null!=(ref=this.gallery)?ref.get("isAdvanceable"):void 0)&&this.listenTo(this.gallery,"gallery:pastEnd",function(){return this.swapGallery(nextGallery.id)}),this},GallerySlideLightboxEndless}(Time.views.GallerySlideLightbox),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.GallerySlideLightboxRelated=function(superClass){function GallerySlideLightboxRelated(){return GallerySlideLightboxRelated.__super__.constructor.apply(this,arguments)}return extend(GallerySlideLightboxRelated,superClass),GallerySlideLightboxRelated.prototype.template=Time.templates["gallery-slide-lightbox-related"],GallerySlideLightboxRelated.prototype.render=function(){var data;return data={galleries:this.model.get("galleries")},this.setElement(this.template.render(data,Time.partials)),this},GallerySlideLightboxRelated}(Time.views.GallerySlideLightbox),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.GalleryLightboxSlides=function(superClass){function GalleryLightboxSlides(){return GalleryLightboxSlides.__super__.constructor.apply(this,arguments)}return extend(GalleryLightboxSlides,superClass),GalleryLightboxSlides.prototype.initialize=function(options){return null==options&&(options={}),GalleryLightboxSlides.__super__.initialize.apply(this,arguments),this.render(),this},GalleryLightboxSlides.prototype.render=function(){var ref,startAt;return startAt=(null!=(ref=this.galleryView.model)?ref.get("slideIndex"):void 0)||0,this.renderAround(startAt),this.galleryView.trigger("gallery:slides:rendered"),this},GalleryLightboxSlides.prototype.reallyRender=function(models){var renderedViews;return renderedViews=_.map(models,function(_this){return function(slideModel){return _this.renderSlideView(slideModel)}}(this)),this.$el.html(renderedViews),this},GalleryLightboxSlides.prototype.renderSlideView=function(model){if(null!=model)return model.set("isRendered",!0),model.view.render().el},GalleryLightboxSlides.prototype.renderAround=function(index,around){var end,models,start;return null==index&&(index=0),null==around&&(around=3),start=index-around,end=index+around,start<0&&(start=0),end>this.collection.size()&&(end=this.collection.size()),this.collection.invoke("set",{isActive:!1,isRendered:!1}),models=this.collection.slice(start,end+1),this.reallyRender(models),this},GalleryLightboxSlides.prototype.renderAt=function(index,inject,classes){var $renderedView,model,renderedView;return null==index&&(index=0),null==inject&&(inject="append"),null==classes&&(classes=""),index<0?this:index>this.collection.size()?this:(model=this.collection.at(index))?model.get("isRendered")?this:(renderedView=this.renderSlideView(model),$renderedView=$(renderedView),classes&&$renderedView.addClass(classes),"append"===inject?$renderedView.appendTo(this.$el):$renderedView.prependTo(this.$el),this):this},GalleryLightboxSlides.prototype.cleanAround=function(index,around){var derender,end,start;return null==around&&(around=3),start=index-around,end=index+around,start<0&&(start=0),end>this.collection.size()&&(end=this.collection.size()),derender=this.collection.filter(function(slide,index){return index<start||index>end}),_.each(derender,function(slide){return slide.view.$el.remove(),slide.set("isRendered",!1)}),derender},GalleryLightboxSlides}(Time.views.GallerySlidesView),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.GalleryLightbox=function(superClass){function GalleryLightbox(){return this.onSwipe=bind(this.onSwipe,this),GalleryLightbox.__super__.constructor.apply(this,arguments)}return extend(GalleryLightbox,superClass),GalleryLightbox.prototype.events={"click .galleryLightbox__meta":"closeCaption","click .galleryLightbox__slides":"clickedSlide",'click [data-gallery-action="next"]':"goNextSlide",'click [data-gallery-action="prev"]':"goPrevSlide",'click [data-gallery-action="restart"]':"goFirstSlide","click .galleryLightbox__caption__wrapper.truncated":"toggleCaption",'click [data-gallery-action="toggleFullscreen"]':"toggleFullscreen"},GalleryLightbox.prototype.template=Time.templates["gallery-module-lightbox"],GalleryLightbox.prototype.IS_SIDE_CLICKING_ENABLED=!1,GalleryLightbox.prototype.initialize=function(options){return null==options&&(options={}),GalleryLightbox.__super__.initialize.apply(this,arguments),this.$caption=null,this.$captionWrapper=null,this.captionMoreTemplate='<button data-gallery-action = "toggleCaption">MORE</button>',this.captionCloseTemplate='<button data-gallery-action = "toggleCaption">CLOSE</button>',this.$restart=null,this.$shareDiv=null,this.$shareToggle=null,this.$counterCurrent=null,this.$counterTotal=null,this.$shareEmail=null,this.$shareTwitter=null,this.$shareGooglePlus=null,this.$shareLinkedIn=null,this.$shareFacebook=null,this.$fullscreenToggle=null,this.$prevButton=null,this.$nextButton=null,this.bindListeners(),this},GalleryLightbox.prototype.bindListeners=function(){return this.listenTo(Time,"body:clicked",function(_this){return function(){_this.resetCaption()}}(this)),this.listenToOnce(this,"gallery:slides:rendered",function(){this.bindTouchEvents(),this.bindResizeEvents()}),this.listenTo(this,"gallery:slides:rendered",function(){var activeSlide;0!==this.slidesCollection.size()&&(this.setSlideClasses(),this.setMeta(),activeSlide=this.slidesCollection.at(this.model.getSlideIndex()),null!=activeSlide&&activeSlide.set("isActive",!0)),console.info("GalleryVertical view heard gallery:slides:rendered, bubbling up to article"),this.parent.trigger("gallery:slides:rendered",this)}),this.listenTo(this,"gallery:keyboardEvent",function(e){this.doKeyboardEvent(e)}),this.listenTo(this.model,"change:isCaptionExpanded",function(_this){return function(model,value,options){var captionText,ref;value?(captionText=null!=(ref=_this.model.currentSlide())?ref.get("caption"):void 0,_this.$captionWrapper.html(captionText+_this.captionCloseTemplate),_this.$captionWrapper.trigger("destroy.dot"),_this.$captionWrapper.addClass("expanded")):(_this.$captionWrapper.removeClass("expanded"),_this.setCaption())}}(this)),this.listenTo(this.model,"change:isFullscreen",function(_this){return function(model,value,options){_this.$el.toggleClass("fullscreen",value),value&&_this.setFullscreenImage(),Time.trigger("gallery:isFullscreen",_this,value)}}(this)),this.listenTo(this.model,"change:slideIndex",function(_this){return function(model,value,options){var omniData,slideIndex,threeSlidesAfter,threeSlidesBefore;console.info("gallery view heard change:slideIndex on model"),_this.model.set("lastSlideIndex",_this.model.previous("slideIndex")),slideIndex=_this.model.get("slideIndex"),0===slideIndex||slideIndex===_this.model.getTotalSlides()-1?_this.renderOnly():(_this.model.previous("slideIndex")>slideIndex?(threeSlidesBefore=slideIndex-_this.model.get("prerenderCount"),_this.slidesView.renderAt(threeSlidesBefore,"prepend","passed")):(threeSlidesAfter=slideIndex+_this.model.get("prerenderCount")-1,_this.slidesView.renderAt(threeSlidesAfter,"append","upcoming")),_this.slidesView.cleanAround(slideIndex)),Time.application.model.get("activeArticle")&&(omniData=Time.application.model.get("activeArticle").toJSON(),omniData.userAction="gallery",Time.Tracking.article_view(omniData)),_this.model.get("isFullscreen")&&_this.setFullscreenImage(),_this.setSlideClasses(),_this.resetCaption(),_this.setMeta(),Time.trigger("gallery:slide:changed",_this.model,slideIndex)}}(this)),this},GalleryLightbox.prototype.render=function($parent){return null==$parent&&($parent=null),console.info("GalleryLightboxView render into ",$parent),this.setElement(this.template.render(this.model.toJSON(),Time.partials)),null!=$parent&&$parent.html(this.el),this.$counterCurrent=this.$(".current-slide"),this.$counter=this.$(".galleryLightbox__counter"),this.$credit=this.$(".galleryLightbox__credit"),this.$caption=this.$(".galleryLightbox__caption"),this.$captionWrapper=this.$(".galleryLightbox__caption__wrapper"),this.$restart=this.$(".galleryLightbox__restart"),this.$shareDiv=this.$(".gallery__shareLinks"),this.$shareEmail=this.$(".time-icons-mail"),this.$shareTwitter=this.$(".time-icons-tw"),this.$shareGooglePlus=this.$(".time-icons-gplus"),this.$shareLinkedIn=this.$(".time-icons-linkedin"),this.$shareFacebook=this.$(".time-icons-fb"),this.$prevButton=this.$('.time-icons[data-gallery-action="prev"]'),this.$nextButton=this.$('.time-icons[data-gallery-action="next"]'),this.trigger("gallery:rendered"),this.$slides=this.$(".galleryLightbox__slides"),this.slidesView=new Time.views.GalleryLightboxSlides({el:this.$slides,gallery:this,collection:this.slidesCollection}),this.setTotal(),this},GalleryLightbox.prototype.renderOnly=function(){return this.slidesCollection.trigger("gallery:slides:flush"),this.$slides.html(this.slidesView.render().el),this.slidesView.renderAround(this.model.get("slideIndex"),this.model.get("prerenderCount")),this},GalleryLightbox.prototype.setMeta=function(){var adSlides,ref,slideIndexText,slideType;return adSlides=0,this.setCredit(),slideType=null!=(ref=this.model.currentSlide())?ref.get("slideType"):void 0,"ad"===slideType||this.model.isAtEnd()?this.$counter.css({visibility:"hidden"}):this.$counter.css({visibility:"visible"}),slideIndexText=this.model.getSlideIndex()+1,this.model.get("hasAds")&&!this.model.isAtEnd()&&(slideIndexText-=Math.floor((this.model.getSlideIndex()+1)/6)),this.$counterCurrent.text(slideIndexText),this.$el.attr("data-slideType",slideType),this.setCaption(),"default"===slideType&&this.setShare(this.model.currentSlide()),this.setControlClasses(),this},GalleryLightbox.prototype.setTotal=function(){var ref,totalImages;return this.$counterTotal=this.$(".total-slides"),totalImages=this.model.getTotalSlides(),null==(null!=(ref=this.model.attributes)?ref.custom_recirc_url:void 0)&&(totalImages-=1),this.model.get("hasAds")&&(totalImages-=Math.floor(totalImages/6)),this.$counterTotal.text(totalImages),this},GalleryLightbox.prototype.setCredit=function(text){var ref;return null==text&&(text=""),text=null!=(ref=this.model.currentSlide())?ref.get("credit"):void 0,text||(text="&nbsp;"),this.$credit.html(text),this},GalleryLightbox.prototype.setCaption=function(text){var ref;return null==text&&(text="&nbsp;"),this.$captionWrapper.trigger("destroy.dot"),text=null!=(ref=this.model.currentSlide())?ref.get("caption"):void 0,text?this.$captionWrapper.html(text+this.captionMoreTemplate).dotdotdot({ellipsis:"...",after:"button",watch:!0,callback:function(_this){return function(isTruncated,originalContent){return _this.truncateCaptionCallback(isTruncated,originalContent)}}(this)}):(text="&nbsp;",this.$captionWrapper.html(text)),this},GalleryLightbox.prototype.truncateCaptionCallback=function(isTruncated,originalContent){return this.model.set("isCaptionTruncated",isTruncated),this.$captionWrapper.toggleClass("truncated",isTruncated)},GalleryLightbox.prototype.setShare=function(slideModel){return this.$(".time-icons-mail").attr("href",slideModel.getShareMail()),this.$(".time-icons-tw").attr("href",slideModel.getShareTwitter()),this.$(".time-icons-gplus").attr("href",slideModel.getShareGplus()),this.$(".time-icons-linkedin").attr("href",slideModel.getShareLinkedIn()),this.$(".time-icons-fb").attr("href",slideModel.getShareFacebook()),this},GalleryLightbox.prototype.setControlClasses=function(currentIndex){var disableNextButton,ref;return null==currentIndex&&(currentIndex=this.model.getSlideIndex()),this.$prevButton.toggleClass("disabled",0===currentIndex),disableNextButton=this.model.isAtEnd(),this.model.get("isMovePastToNextGalleryEnabled")&&(disableNextButton=disableNextButton&&"endless"!==(null!=(ref=this.model.currentSlide())?ref.get("slideType"):void 0)),this.$nextButton.toggleClass("disabled",disableNextButton),this},GalleryLightbox.prototype.setSlideClasses=function(currentIndex,currentSlide){var passedEls,passedModels,upcomingEls,upcomingModels;return null==currentIndex&&(currentIndex=this.model.getSlideIndex()),null==currentSlide&&(currentSlide=this.model.currentSlide()),null!=currentSlide&&currentSlide.view.$el.addClass("current").removeClass("passed upcoming"),passedModels=this.slidesCollection.take(currentIndex),passedEls=_.map(passedModels,function(slideModel){return slideModel.view.el}),$(passedEls).addClass("passed").removeClass("current upcoming"),upcomingModels=this.slidesCollection.drop(currentIndex+1),upcomingEls=_.map(upcomingModels,function(slideModel){return slideModel.view.el}),$(upcomingEls).addClass("upcoming").removeClass("passed current"),this},GalleryLightbox.prototype.resetCaption=function(){return this.model.set("isCaptionTruncated",!1),this.model.set("isCaptionExpanded",!1)},GalleryLightbox.prototype.toggleCaption=function(e){return null!=e&&e.stopPropagation(),this.model.get("isCaptionTruncated")?(Time.application.toggle_share_tooltip("close"),
this.model.set("isCaptionExpanded",!this.model.get("isCaptionExpanded")),this):this},GalleryLightbox.prototype.toggleFullscreen=function(toggleOn){return"object"==typeof toggleOn&&(toggleOn=!this.model.get("isFullscreen")),this.model.set("isFullscreen",toggleOn),this},GalleryLightbox.prototype.bindResizeEvents=function(){return this.listenTo(Time,"application:resize",function(_this){return function(){return _this.setCaption()}}(this))},GalleryLightbox.prototype.bindTouchEvents=function(){var threshold,velocity;if(Modernizr.touch)return this.slideHammer=new Hammer(this.$slides.get(0),{}),threshold=7,velocity=.4,Time.application.isIOS7&&(threshold=5,velocity=.2),this.slideHammer.get("swipe").set({threshold:threshold,velocity:velocity}),this.slideHammer.on("swipe",this.onSwipe),this},GalleryLightbox.prototype.onSwipe=function(e){var isLeftSwipe,isRightSwipe;return isRightSwipe=2===e.offsetDirection,isLeftSwipe=4===e.offsetDirection,isRightSwipe?this.goPrevSlide(e):isLeftSwipe?this.goNextSlide(e):void 0},GalleryLightbox.prototype.doKeyboardEvent=function(e){return 27===e.keyCode&&(Time.application.toggle_share_tooltip("close"),this.toggleFullscreen(!1)),37===e.keyCode&&(Time.application.toggle_share_tooltip("close"),this.goPrevSlide(e)),39===e.keyCode&&(Time.application.toggle_share_tooltip("close"),this.goNextSlide(e)),69===e.keyCode&&(Time.application.toggle_share_tooltip("close"),this.goLastSlide(e)),82===e.keyCode&&(Time.application.toggle_share_tooltip("close"),this.goFirstSlide(e)),e},GalleryLightbox.prototype.clickedSlide=function(e){var ref,slideMidpoint,target;if(target=$(e.target),!("ad"===(null!=(ref=this.model.currentSlide())?ref.get("slideType"):void 0)&&this.model.currentSlide().view.$(".gallery__ad__skip").is(":visible")||Time.application.isRailToggleable&&Time.application.isRailOpen))return target.is("a")||(this.IS_SIDE_CLICKING_ENABLED?(slideMidpoint=e.currentTarget.clientWidth/2,e.offsetX<slideMidpoint?this.model.goPrevSlide():this.model.goNextSlide()):this.model.goNextSlide()),e},GalleryLightbox.prototype.goNextSlide=function(e){if(null!=e&&"function"==typeof e.stopPropagation&&e.stopPropagation(),!Time.application.isRailToggleable||!Time.application.isRailOpen)return this.model.goNextSlide()},GalleryLightbox.prototype.goPrevSlide=function(e){if(null!=e&&"function"==typeof e.stopPropagation&&e.stopPropagation(),!Time.application.model.isRailToggleable||!Time.application.isRailOpen)return this.model.goPrevSlide()},GalleryLightbox.prototype.goFirstSlide=function(e){return this.model.goSlide(0)},GalleryLightbox.prototype.goLastSlide=function(e){return this.model.goSlide(this.model.getTotalSlides()-1)},GalleryLightbox.prototype.closeCaption=function(e){return this.model.get("isCaptionTruncated")?this.model.set("isCaptionExpanded",!1):this},GalleryLightbox.prototype.setFullscreenImage=function(){var $images,ww;$images=this.$(".galleryLightbox__slide--image img"),$images.length&&(ww=$(window).width(),$images.each(function(){var $image,currentSrc,largest,sizes;if($image=$(this),sizes=$image.data("fullscreen"),null!=sizes?sizes.length:void 0)return largest=_.find(sizes,function(size){return!(ww>size.width)}),null==largest&&(largest=_.drop(sizes)),currentSrc=$image.attr("src"),(null!=largest?largest.src:void 0)&&currentSrc!==largest.src?$image.attr("src",largest.src):void 0}))},GalleryLightbox}(Time.views.Gallery),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.GalleryParent=function(superClass){function GalleryParent(){return GalleryParent.__super__.constructor.apply(this,arguments)}return extend(GalleryParent,superClass),GalleryParent.prototype.initialize=function(options){return null==options&&(options={}),console.info("galleryParentView init"),this.$el.length?(this.galleryId=this.$el.data("gallery"),this.galleryId?null==options.article?(console.error("GalleryParentView needs to be attached to an ReadingPaneArticle view",options),this.remove(),null):(this.articleView=options.article,null==options.galleries?(console.error("GalleryParentView needs to be attached to a Galleries collection",options),this.remove(),null):(this.galleriesCollection=options.galleries,this.galleryView=null,this.galleryModel=this.getGalleryModel(this.galleryId),this.listenTo(this,"view:destroy",function(){var ref,ref1;console.info("GalleryParentView in article "+articleModel.id+" heard view:destroy"),this.galleriesCollection=null,null!=(ref=this.galleryView)&&ref.destroy(),this.galleryView=null,null!=(ref1=this.galleryModel)&&(ref1.view=null),this.galleryModel=null,this.articleView=null}),null!=this.galleryModel&&this.render(),this)):(console.error("GalleryParentView couldn't get galleryId from el",this.$el),this.remove(),null)):(console.error("GalleryParentView needs to be instantiated with an el",options),this.remove(),null)},GalleryParent.prototype.render=function(){return console.info("galleryParentView render"),this.listenToOnce(this.galleryModel,"gallery:dataReady",function(_this){return function(){return console.info("GalleryParentView - render - heard gallery:dataReady on galleryModel "+_this.galleryModel.id),_this.galleryView=_this.galleryModel.getView(_this.articleView),null!=_this.articleView.model.collection&&_this.listenTo(Time,"readingPane:reset",function(){var ref;console.info("GalleryParentView heard readingPane:reset on Time -- destroying GalleryView"),null!=(ref=_this.galleryView)&&ref.destroy(),_this.galleryView=null,_this.galleryModel.view=null,_this.$el.empty(),_this.stopListening(Time)}),_this.listenToOnce(_this.galleryView,"gallery:rendered",function(){console.info("GalleryParentView - render - heard gallery:rendered on galleryView "+_this.galleryModel.id),_this.articleView.trigger("gallery:rendered")}),_this.galleryView.render(_this.$el)}}(this)),this.galleryModel.getData(),this},GalleryParent.prototype.getGalleryModel=function(galleryId){var galleryModel,size;return(galleryId=parseInt(galleryId,10))?(galleryModel=this.galleriesCollection.get(galleryId),console.info("GalleryParentView looking for existing model in galleriesCollection",galleryId,"found:",null!=galleryModel),null!=galleryModel?galleryModel:(size=this.$el.data("size"))?(this.galleryModel=this.galleriesCollection.push({id:galleryId,size:size}),this.galleryModel):(console.error("GalleryParentView -- could not create a new gallery model",galleryId,size),null)):(console.error("GalleryParentView -- getGalleryModel -- invalid galleryId",galleryId),null)},GalleryParent}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.GallerySlideAd=function(superClass){function GallerySlideAd(){return GallerySlideAd.__super__.constructor.apply(this,arguments)}return extend(GallerySlideAd,superClass),GallerySlideAd.prototype.SKIP_BUTTON_DELAY=1500,GallerySlideAd.prototype.SKIP_AD_COUNTDOWN=2,GallerySlideAd.prototype.initialize=function(options){return this.template=options.template,this.listenTo(this.model,"change:isActive",function(_this){return function(model,value,options){value?_this.activate():_this.deactivate()}}(this)),this},GallerySlideAd.prototype.render=function(){return this.setElement(this.template.render()),this.$(".gallery__ad").attr("id",this.model.get("adModelId")),this},GallerySlideAd.prototype.getAdSize=function(gallerySize){var adSizes;return adSizes=["300x250"],"vertical"===gallerySize&&"mobile"!==Time.device&&adSizes.push("450x375"),adSizes},GallerySlideAd.prototype.activate=function(){var articleModel,articleView,callback,galleryModel,gallerySize,galleryView,params,ref,slideModel,slidesCollection;if(slideModel=this.model,slidesCollection=(null!=slideModel?slideModel.collection:void 0)||null,galleryModel=(null!=slidesCollection?slidesCollection.galleryModel:void 0)||null,galleryView=(null!=slidesCollection?slidesCollection.galleryView:void 0)||null,articleView=(null!=slidesCollection&&null!=(ref=slidesCollection.galleryView)?ref.parent:void 0)||null,articleModel=(null!=articleView?articleView.model:void 0)||null,!articleModel)return console.error("GallerySlideAd.activate - no articleModel",this.model),this;this.model.set("canSkip",!1),galleryView.$(".gallery__ad__skip__text").html('<span class="gallery__ad__skip__text" data-gallery-action="next">YOU CAN SKIP AD IN <span class="gallery__ad__countdown">2</span></span>'),gallerySize=galleryModel.get("size"),params={id:this.model.get("adModelId"),size:this.getAdSize(gallerySize),position:this.model.get("adIndex"),group:"gallery",subgroup:gallerySize,slide:slideModel.get("index")+1},callback="vertical"!==gallerySize,"vertical"!==gallerySize&&(callback=function(_this){return function(){var adDivIds;adDivIds=[params.id],_this.listenToOnce(Time,"dfpAdManager:afterDisplay",function(adIds){(null!=adIds?adIds.indexOf(_this.model.get("adModelId")):void 0)!==-1&&(window.clearTimeout(_this.skipAd),_this.skipAd=window.setTimeout(function(){return null!=galleryView&&galleryView.$(".gallery__ad__skip").addClass("gallery__ad__skip--visible"),_this.startCountdown(galleryView)},_this.SKIP_BUTTON_DELAY))}),Time.trigger("leftRail:syncAds",articleModel,adDivIds)}}(this)),Time.trigger("dfpAdManager:activateAd",articleModel,params,callback);try{OBR.extern.refreshWidget()}catch(_error){}return this},GallerySlideAd.prototype.deactivate=function(){return console.info("GallerySlideAdView deactivating",this),Time.trigger("dfpAdManager:deleteAd",this.model.get("adModelId")),this},GallerySlideAd.prototype.onActivated=function(){return console.info("GallerySlideAdView activated",this),this},GallerySlideAd.prototype.startCountdown=function(galleryView){var timer;if(galleryView)return timer=this.SKIP_AD_COUNTDOWN,this.countdownInterval=window.setInterval(function(_this){return function(){var seconds;return seconds=parseInt(timer%60,10),galleryView.$(".gallery__ad__countdown").text(seconds),timer<0&&(galleryView.$(".gallery__ad__skip__text").text("SKIP AD"),_this.stopCountdown()),timer-=1}}(this),1e3)},GallerySlideAd.prototype.stopCountdown=function(){return window.clearInterval(this.countdownInterval),this.model.set("canSkip",!0)},GallerySlideAd}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.GallerySlide=function(superClass){function GallerySlide(){return GallerySlide.__super__.constructor.apply(this,arguments)}return extend(GallerySlide,superClass),GallerySlide.prototype.initialize=function(options){var ref,ref1,ref2;return null==options&&(options={}),this.galleryModel=null!=(ref=this.model)&&null!=(ref1=ref.collection)?ref1.galleryModel:void 0,this.articleView=this.galleryModel.collection.article,this.articleModel=this.articleView.model,"vertical"===(null!=(ref2=this.galleryModel)?ref2.get("size"):void 0)?this.initVertical():this.initLightbox(),this},GallerySlide.prototype.initVertical=function(){return this.template=Time.templates["gallery-slide-vertical"],this},GallerySlide.prototype.initLightbox=function(){return this.template=Time.templates["gallery-slide-lightbox"],this.listenTo(this.model,"change:isActive",function(model,value,options){value&&this.activate()}),this},GallerySlide.prototype.activate=function(){var galleryView,slideModel,slidesCollection;return slideModel=this.model,slidesCollection=(null!=slideModel?slideModel.collection:void 0)||null,galleryView=(null!=slidesCollection?slidesCollection.galleryView:void 0)||null,null!=galleryView&&(window.clearTimeout(galleryView.skipTimeout),galleryView.$(".gallery__ad__skip").removeClass("gallery__ad__skip--visible")),Time.trigger("gallery:slide:activated",this.galleryModel,this.articleView),this},GallerySlide.prototype.render=function(){return this.setElement(this.template.render(this.model.toJSON(),Time.partials)),this},GallerySlide.prototype.setShare=function(){return this.$(".time-icons-mail").attr("href",this.model.getShareMail()),this.$(".time-icons-tw").data("href",this.model.getShareTwitter()),this.$(".time-icons-gplus").attr("href",this.model.getShareGplus()),this.$(".time-icons-linkedin").attr("href",this.model.getShareLinkedIn()),this.$(".time-icons-fb").attr("href",this.model.getShareFacebook()),this},GallerySlide}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.GalleryVerticalSlides=function(superClass){function GalleryVerticalSlides(){return GalleryVerticalSlides.__super__.constructor.apply(this,arguments)}return extend(GalleryVerticalSlides,superClass),GalleryVerticalSlides.prototype.events={"click .galleryVertical__loadMore":"loadMore"},GalleryVerticalSlides.prototype.DEFAULT_RENDER_LIMIT=6,GalleryVerticalSlides.prototype.initialize=function(options){return null==options&&(options={}),GalleryVerticalSlides.__super__.initialize.apply(this,arguments),this.initialRenderLimit=options.initialRenderLimit||this.DEFAULT_RENDER_LIMIT,this},GalleryVerticalSlides.prototype.render=function(){var initialModelsToRender;return initialModelsToRender=this.collection.take(this.initialRenderLimit),this.reallyRender(initialModelsToRender),this.collection.size()>this.initialRenderLimit&&(this.$el.append('<div class="galleryVertical__loadMore">Load More Photos</div>'),this.$loadMore=this.$(".galleryVertical__loadMore")),this.galleryView.trigger("gallery:slides:rendered"),this},GalleryVerticalSlides.prototype.reallyRender=function(models){var html,ref;return null==models&&(models=this.collection.models),html=_.map(models,function(slideModel){return slideModel.view.render().el}),(null!=(ref=this.$el)?ref.children().length:void 0)?this.$el.append(html):this.$el.html(html),_.invoke(models,"set",{isRendered:!0}),this},GalleryVerticalSlides.prototype.loadMore=function(){var ref,remainingModelsToRender;return null!=(ref=this.$loadMore)&&ref.addClass("activated"),remainingModelsToRender=this.collection.drop(this.initialRenderLimit),this.reallyRender(remainingModelsToRender),this.galleryView.trigger("gallery:slides:loadedMore"),this},GalleryVerticalSlides}(Time.views.GallerySlidesView),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.GalleryVertical=function(superClass){function GalleryVertical(){return GalleryVertical.__super__.constructor.apply(this,arguments)}return extend(GalleryVertical,superClass),GalleryVertical.prototype.template=Time.templates["gallery-module-vertical"],GalleryVertical.prototype.initialize=function(options){return null==options&&(options={}),GalleryVertical.__super__.initialize.apply(this,arguments),this.articleModel=this.parent.model,this.listenTo(this,"gallery:slides:rendered",function(_this){return function(){console.info("GalleryVertical view heard gallery:slides:rendered, activating slides"),_this.activateSlides(),console.info("GalleryVertical view heard gallery:slides:rendered, bubbling up to article"),_this.parent.trigger("gallery:slides:rendered",_this)}}(this)),this.listenTo(this,"gallery:slides:loadedMore",function(_this){return function(){console.info("GalleryVertical view heard gallery:slides:loadedMore, activating slides"),_this.activateSlides(),Time.trigger("gallery:slides:loadedMore",_this,_this.parent)}}(this)),this.listenTo(this.articleModel,"change:isActive",function(_this){return function(model,value,options){value===!1&&_this.deactivateSlides()}}(this)),this.slidesView=new Time.views.GalleryVerticalSlides({gallery:this,collection:this.slidesCollection}),this},GalleryVertical.prototype.render=function($parent){return null==$parent&&($parent=null),this.setElement(this.template.render(this.model.toJSON(),Time.partials)),null!=$parent&&$parent.html(this.el),this.trigger("gallery:rendered"),this.$slides=this.$(".galleryVertical__slides"),this.slidesView.setElement(this.$slides),this.slidesView.render(),this},GalleryVertical.prototype.activateSlides=function(){var renderedModels;return renderedModels=this.slidesCollection.where({isRendered:!0}),_.invoke(renderedModels,"set",{isActive:!0})},GalleryVertical.prototype.deactivateSlides=function(){return this.slidesCollection.invoke("set",{isActive:!1})},GalleryVertical}(Time.views.Gallery)}).call(this);;
(function(){var $,LODASH_VERSION,Time,module,require,root,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;LODASH_VERSION="3.9.3","undefined"!=typeof _&&null!==_&&_.VERSION!==LODASH_VERSION&&_.noConflict(),module={},require=_.noop,$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,module=module||{},module.exports=Time.collections.Articles=function(superClass){function Articles(){return this.attachNextArticles=bind(this.attachNextArticles,this),Articles.__super__.constructor.apply(this,arguments)}return extend(Articles,superClass),Articles.prototype.DEBUG=!1,Articles.prototype.model=Time.models.Article,Articles.prototype.IS_SPONSORED_ARTICLES_ENABLED=!0,Articles.prototype.SPONSORED_FREQUENCY=10,Articles.prototype.SPONSORED_OFFSET=6,Articles.prototype.sponsored_article_index=0,Articles.prototype.sponsored_article_cycles=0,Articles.prototype.endpoint="latest",Articles.prototype.endpointSub="",Articles.prototype.syncing=!1,Articles.prototype.page=0,Articles.prototype._isFetchedEverything=!1,Articles.prototype.active_env="trending",Articles.prototype.freeze_url=!1,Articles.prototype.freeze_url_once=!1,Articles.prototype.MAX_ARTICLES=40,Articles.prototype.initialize=function(models,options){var ref,ref1,ref2,ref3;return null==options&&(options={}),this.app=options.app,"time"===Time.bootstrap.branding&&null!=(null!=(ref=Time.bootstrap.latest)?ref.endpoint:void 0)&&(this.endpointSub=Time.bootstrap.latest.endpoint,"latest"===this.endpointSub?this.endpoint=this.endpointSub:this.endpoint="section-related/"+this.endpointSub),null!=(null!=(ref1=Time.bootstrap.latest)?ref1.name:void 0)&&(this.endpointSub=Time.bootstrap.latest.endpoint,this.endpointSubName=Time.bootstrap.latest.name),Time.trigger("leftRail:flush"),"life"!==(ref2=this.endpointSub)&&"lightbox"!==ref2&&(Time.trigger("ticker:enable"),Time.trigger("dynamicHeader:enable")),(null!=(ref3=Time.bootstrap.single_article)?ref3.sponsor:void 0)&&Time.bootstrap.sponsors[0].id===Time.bootstrap.single_article.id&&Time.bootstrap.sponsors.push(Time.bootstrap.sponsors.shift()),this.view=new Time.views.DefaultLeftRail({collection:this,app:this.app,containingEl:$(".rail-articles-scroll"),parentEl:$(".rail-articles-scroll")}),this.bindAdd(),this.bindReset(),this},Articles.prototype.isSponsorIndex=function(){return this.view.regularTileViewsRendered%this.SPONSORED_FREQUENCY===this.SPONSORED_OFFSET},Articles.prototype.hasSponsors=function(){return!!this.IS_SPONSORED_ARTICLES_ENABLED&&null!=Time.bootstrap.sponsors},Articles.prototype.bindAdd=function(){this.listenTo(this,"add",function(model){model.realIndex=this.view.regularTileViewsRendered,model.isNativo()||model.isSponsored()||this.hasSponsors()&&this.isSponsorIndex()&&this.addSponsoredArticle(model),Time.trigger("leftRail:model:added",model)})},Articles.prototype.bindReset=function(){return this.listenTo(this,"reset",function(models,options){_.each(options.previousModels,function(model){var ref,ref1;null!=(ref=model.views.tile_view)&&ref.destroy(),model.views.tile_view=null,null!=(ref1=model.views.singleView)&&ref1.destroy(),model.views.singleView=null})})},Articles.prototype.getIdFromUrl=function(){var id,matches,route;return route=Backbone.history.fragment,id=null,matches=/^money\/([0-9]+)\/?/.exec(route),matches&&(id=matches[1]),id||(id=route.substring(0,route.indexOf("/"))),isNaN(id)||(id=parseInt(id,10)),id},Articles.prototype.moveArticleFirst=function(article,articles){var id;return null==article&&(article=null),(null!=articles?articles.length:void 0)?(article||(id=this.getIdFromUrl(),article=this.getArticleFromBootstrap(id)),article?(articles=_.reject(articles,function(a){return a.id===article.id}),null!=article.toJSON&&(article=article.toJSON()),this.firstArticle=article,articles.unshift(article),articles):(this.DEBUG&&console.info("moveArticleFirst needs an article to move first"),articles)):[article]},Articles.prototype.attachNextArticles=function(articles){var article,i,j,len;if(!(null!=articles?articles.length:void 0))return articles;for(i=j=0,len=articles.length;j<len;i=++j)article=articles[i],article.next_article=articles[i+1];return articles.slice(0,this.MAX_ARTICLES)},Articles.prototype.load_articles=function(firstArticle,articles){var ref,ref1,ref2;return null==firstArticle&&(firstArticle=null!=(ref=Time.bootstrap)?ref.single_article:void 0),articles=(null!=(ref1=Time.bootstrap)&&null!=(ref2=ref1.latest)?ref2.articles:void 0)||[],firstArticle&&(articles=this.moveArticleFirst(firstArticle,articles)),articles=this.attachNextArticles(articles),articles.length?this.add(articles):this.app.railXHR=this.fetch(),this},Articles.prototype.url=function(){var url;return url=[Time.api_url],this.app.isMoney()&&url.push("money/"),url.push(this.endpoint,"/"),this.page>1&&url.push("page/",this.page,"/"),url.join("")},Articles.prototype.fetch=function(opts){var fn_complete,fn_error,fn_success;if(null==opts&&(opts={}),!this.syncing)return(null==opts.cache||opts.cache)&&(opts.cache=!0),this.trigger("sync:syncing"),this.syncing=!0,opts.dataType="json",opts.next_page&&(this.page+=1),fn_complete=opts.complete,opts.complete=function(_this){return function(model,response,options){_this.syncing=!1,_this.trigger("sync:complete"),null!=fn_complete&&fn_complete(model,response,options)}}(this),fn_success=opts.success,opts.success=function(_this){return function(model,response,options){return null==response||"object"!=typeof response?(_this.trigger("sync:error"),opts.error(model,response,options),!1):void _this.fetchSuccess(fn_success,model,response,options)}}(this),fn_error=opts.error,opts.error=function(_this){return function(model,response,object){_this._isFetchedEverything=!0,_this.trigger("sync:error"),null!=fn_error&&fn_error(model,response,options)}}(this),Backbone.Collection.prototype.fetch.call(this,opts)},Articles.prototype.fetchSuccess=function(originalCallback,model,response,options){var hasReadAndOrSharedArrays,isLoadedLessThanRequested,noArticles,noMoreToLoad,ref,ref1,ref2;return this.trigger("sync:success"),"function"==typeof originalCallback&&originalCallback(model,response,options),isLoadedLessThanRequested=(null!=response&&null!=(ref=response.articles)?ref.length:void 0)<Time.posts_per_page,hasReadAndOrSharedArrays=(null!=response&&null!=(ref1=response.read)?ref1.length:void 0)>0||(null!=response&&null!=(ref2=response.shared)?ref2.length:void 0)>0,noArticles=response.error||response.articles===!1,noMoreToLoad=null==response||noArticles||isLoadedLessThanRequested,(noMoreToLoad||hasReadAndOrSharedArrays)&&this.reached_page_limit(),this},Articles.prototype.freezeIfSlug=function(slug,articleModel){var ref,ref1;slug&&(this.freeze_url_once=!0,this.app.hide_loader(this.app.$viewportWrapper),"gallery"===(null!=articleModel?articleModel.get("format"):void 0)?this.app.model.set("initialGallerySlug",slug):null!=articleModel&&null!=(ref=articleModel.views)&&null!=(ref1=ref.singleView)&&ref1.scrollToListItem(slug))},Articles.prototype.getArticleFromBootstrap=function(articleId){var article,ref;return article=!1,articleId===(null!=(ref=Time.bootstrap.single_article)?ref.id:void 0)?Time.bootstrap.single_article:null!=Time.bootstrap.latest&&(article=_.find(Time.bootstrap.latest,function(a){return articleId===a.id}))},Articles.prototype.load_single_article=function(articleId,itemSlug){var articleData,articleModel,existingArticleModel;return existingArticleModel=this.get(articleId),null!=existingArticleModel?(itemSlug&&existingArticleModel.set("slug",itemSlug),this.app.readingPane.startOnArticle(existingArticleModel),this):(articleModel=new Time.models.Article({id:articleId}),this.listenToOnce(articleModel,"change:title",function(_this){return function(model,value,options){var $tile;_this.unshift(articleModel),$tile=$('.rail-article[data-article="'+articleModel.id+'"]').detach(),$tile.prependTo(".article-list"),_this.app.readingPane.startOnArticle(articleModel)}}(this)),articleData=this.getArticleFromBootstrap(articleId),null!=articleData?articleModel.set(articleData):articleModel.fetch(),this)},Articles.prototype.parse=function(response){var eacharticle,i,j,len,ref,ref1;if(null==response)return this.parseError("No response from server.");if(response.error)return this.parseError("Server returned error.",response);if(!(null!=(ref=response.articles)?ref.length:void 0))return this._isFetchedEverything=!0,[];for(response.articles=this.moveArticleFirst(null,response.articles),ref1=response.articles,i=j=0,len=ref1.length;j<len;i=++j)eacharticle=ref1[i],eacharticle.next_article=response.articles[i+1];return response.articles},Articles.prototype.parseError=function(message,data){return console.error(message,data),this._isFetchedEverything=!0,[]},Articles.prototype.set_visible_article=function(model){return this.visible_article=model},Articles.prototype.get_visible_article=function(){return this.get(this.visible_article)},Articles.prototype.fetch_next_page=function(opts){null==opts&&(opts={}),this._isFetchedEverything||this.fetch(_.extend({next_page:!0,remove:!1},opts))},Articles.prototype.reached_page_limit=function(){this._isFetchedEverything=!0,this.app.$viewport.removeClass("loading")},Articles.prototype.getNextSponsoredArticle=function(){var articleData,hasNext;return this.sponsored_article_index+1>Time.bootstrap.sponsors.length&&(this.sponsored_article_index=0,this.sponsored_article_cycles+=1),(hasNext=null!=Time.bootstrap.sponsors[this.sponsored_article_index])?(articleData=_.clone(Time.bootstrap.sponsors[this.sponsored_article_index]),articleData.id=parseInt(this.sponsored_article_cycles.toString()+Time.bootstrap.sponsors[this.sponsored_article_index].id.toString(),10),articleData):null},Articles.prototype.addSponsoredArticle=function(prevModel){var articleData,railIndex;if(articleData=this.getNextSponsoredArticle())return railIndex=this.indexOf(prevModel)+1,this.add(articleData,{at:railIndex})},Articles.prototype.load_tabs=function(label){var href,new_tab_data,sub;return new_tab_data=Time.tab_data.default,href="/"+this.active_env+"/"+this.sub+"/",sub=this.sub,new_tab_data.tabs[0]={label:null!=this.label?this.label:label,omniture:this.is_collection?"nav-collection":"nav-"+this.sub,env:this.active_env,sub:null!=this.sub?this.sub:sub,href:null!=this.href?this.href:href},this.app.load_tabs(new_tab_data),this.app.tabs_view.set_active(0),this},Articles.prototype.getNextListArticle=function(startIndex){var nextListArticle;return nextListArticle=null,_.each(this.models,function(article,index){if(index>startIndex&&article.get("list_gallery_style")&&null===nextListArticle)return nextListArticle=article}),nextListArticle},Articles.prototype.getPrevListArticle=function(startIndex){var prevListArticle;return prevListArticle=null,_.each(this.models,function(article,index){if(index<startIndex&&article.get("list_gallery_style"))return prevListArticle=article}),prevListArticle},Articles}(Backbone.Collection),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.collections.AuthorArticles=function(superClass){function AuthorArticles(){return AuthorArticles.__super__.constructor.apply(this,arguments)}return extend(AuthorArticles,superClass),AuthorArticles.prototype.active_env="author",AuthorArticles.prototype.endpoint="author",AuthorArticles.prototype.IS_SPONSORED_ARTICLES_ENABLED=!1,AuthorArticles.prototype.initialize=function(models,options){return null==options&&(options={}),this.app=options.app,this.freeze_url_once=!0,this.sub=options.sub,this.endpoint+="/"+this.sub,Time.trigger("leftRail:flush"),this.view=new Time.views.DefaultLeftRail({collection:this,app:this.app,containingEl:$(".rail-articles-scroll"),parentEl:$(".rail-articles-scroll")}),this.bindAdd(),this.bindReset(),this},AuthorArticles.prototype.load_articles=function(firstArticle,articles){var ref,ref1;return null==firstArticle&&(firstArticle=null!=(ref=Time.bootstrap)?ref.single_article:void 0),articles=(null!=(ref1=Time.bootstrap.author)?ref1[this.sub].articles:void 0)||[],articles.length?(Time.application.render_top_banner(Time.bootstrap.author[this.sub].author),this.add(Time.bootstrap.author[this.sub].articles),this.view.render_author_header(Time.bootstrap.author[this.sub].author)):this.fetch({success:function(_this){return function(collection,response){return Time.application.render_top_banner(response.author),_this.view.render_author_header(response.author)}}(this)})},AuthorArticles}(Time.collections.Articles),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.collections.LifeCategoryArticles=function(superClass){function LifeCategoryArticles(){return LifeCategoryArticles.__super__.constructor.apply(this,arguments)}return extend(LifeCategoryArticles,superClass),LifeCategoryArticles.prototype.active_env="life_category",LifeCategoryArticles.prototype.endpoint="life/category",LifeCategoryArticles.prototype.initialize=function(models,options){return this.app=options.app,this.freeze_url_once=!1,Time.trigger("leftRail:flush"),this.sub=options.sub,this.endpoint+="/"+this.sub,this.view=new Time.views.DefaultLeftRail({collection:this,app:this.app,containingEl:$(".rail-articles-scroll"),parentEl:$(".rail-articles-scroll")}),this.bindAdd(),this.bindReset(),this},LifeCategoryArticles.prototype.load_articles=function(firstArticle,articles){var ref,ref1;return null==firstArticle&&(firstArticle=null!=(ref=Time.bootstrap)?ref.single_article:void 0),null!=(null!=(ref1=Time.bootstrap.life_category)?ref1[this.sub]:void 0)?(Time.bootstrap.life_category[this.sub].name&&this.load_tabs(Time.bootstrap.life_category[this.sub].name),null!=Time.bootstrap.life_category[this.sub].articles&&this.add(Time.bootstrap.life_category[this.sub].articles),this):(this.fetch({success:function(_this){return function(model,response){if(response.name)return _this.load_tabs(response.name)}}(this)}),this)},LifeCategoryArticles}(Time.collections.Articles),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.collections.MagazineArticles=function(superClass){function MagazineArticles(){return MagazineArticles.__super__.constructor.apply(this,arguments)}return extend(MagazineArticles,superClass),MagazineArticles.prototype.active_env="magazine",MagazineArticles.prototype.endpoint="magazine",MagazineArticles.prototype.IS_SPONSORED_ARTICLES_ENABLED=!1,MagazineArticles.prototype.initialize=function(models,options){var fullTitle;return null==options&&(options={}),this.app=options.app,this.freeze_url_once=!0,Time.trigger("leftRail:flush"),Time.trigger("dynamicHeader:disable"),this.region=options.sub||"us",options.magazineId?this.endpoint+="/issue/"+options.magazineId:this.endpoint+="/region/"+this.region,fullTitle=$("[data-region='"+this.region+"']").html(),$(".toggle-magazine-region-dropdown").html(fullTitle),this.view=new Time.views.DefaultLeftRail({collection:this,app:this.app,containingEl:$(".rail-articles-scroll"),parentEl:$(".rail-articles-scroll")}),this.bindAdd(),this.bindReset(),this},MagazineArticles.prototype.parse=function(response){var article,articles,i,j,key,len,ref,ref1,ref2,ref3,val;if(null==response&&(response={}),!(null!=(ref=response[0])&&null!=(ref1=ref.articles)?ref1[0]:void 0))return this._isFetchedEverything=!0,console.error("Bad magazine API response - maybe no articles?",response),[];if(articles=null!=(ref2=response[0])?ref2.articles:void 0,articles[0].cover=1,articles[0].magazine={},response[0]){ref3=response[0];for(key in ref3)val=ref3[key],"articles"!==key&&(articles[0].magazine[key]=val)}for(i=j=0,len=articles.length;j<len;i=++j)article=articles[i],article.next_article=articles[i+1];return"undefined"!=typeof console&&null!==console&&console.log("magazine articles: ",articles),articles},MagazineArticles.prototype.load_articles=function(){return null!=Time.bootstrap.magazine&&Time.bootstrap.magazine[this.region]?this.add(this.parse(Time.bootstrap.magazine[this.region])):this.fetch(),this},MagazineArticles}(Time.collections.Articles),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.collections.NativoArticles=function(superClass){function NativoArticles(){return NativoArticles.__super__.constructor.apply(this,arguments)}return extend(NativoArticles,superClass),NativoArticles.prototype.active_env="nativo",NativoArticles.prototype.initialize=function(models,options){return null==options&&(options={}),this.app=options.app,Time.trigger("leftRail:flush"),Time.trigger("ticker:disable"),Time.trigger("dynamicHeader:enable"),this.view=new Time.views.NativoLeftRail({app:this.app,collection:this,containingEl:$(".rail-articles-scroll")}),this},NativoArticles.prototype.fetch=function(){},NativoArticles.prototype.load_articles=function(firstArticle,articles){var ref;return null==firstArticle&&(firstArticle=null!=(ref=Time.bootstrap)?ref.single_article:void 0),!1},NativoArticles}(Time.collections.Articles),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.collections.PopularArticles=function(superClass){function PopularArticles(){return PopularArticles.__super__.constructor.apply(this,arguments)}return extend(PopularArticles,superClass),PopularArticles.prototype.active_env="popular",PopularArticles.prototype.endpoint="popular",PopularArticles.prototype.initialize=function(models,options){return null==options&&(options={}),this.app=options.app,this.freeze_url_once=!0,Time.trigger("leftRail:flush"),Time.trigger("ticker:enable"),Time.trigger("dynamicHeader:enable"),this.view=new Time.views.DefaultLeftRail({collection:this,app:this.app,containingEl:$(".rail-articles-scroll"),parentEl:$(".rail-articles-scroll")}),this.app.tabs_view.set_active("popular"),this.bindAdd(),this.bindReset(),this},PopularArticles.prototype.load_articles=function(firstArticle,articles){var readArticles,ref,ref1,ref2,sharedArticles;return null==firstArticle&&(firstArticle=null!=(ref=Time.bootstrap)?ref.single_article:void 0),readArticles=(null!=(ref1=Time.bootstrap.popular)?ref1.read:void 0)||[],sharedArticles=(null!=(ref2=Time.bootstrap.popular)?ref2.shared:void 0)||[],readArticles.length||sharedArticles.length?(this.view.render_header("10 Most Read"),_.each(readArticles,function(_this){return function(item,i){return _this.add(new Time.models.Article(item))}}(this)),this.view.render_header("10 Most Shared"),_.each(sharedArticles,function(_this){return function(item,i){return _this.add(new Time.models.Article(item))}}(this))):this.app.railXHR=this.fetch({success:function(_this){return function(collection,response){return _this.view.render_header("10 Most Read"),_.each(response.read,function(item,i){return _this.add(new Time.models.Article(item))}),_this.view.render_header("10 Most Shared"),_.each(response.shared,function(item,i){return _this.add(new Time.models.Article(item))})}}(this)}),this},PopularArticles}(Time.collections.Articles),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.collections.SectionArticles=function(superClass){function SectionArticles(){return SectionArticles.__super__.constructor.apply(this,arguments)}return extend(SectionArticles,superClass),SectionArticles.prototype.active_env="section",SectionArticles.prototype.endpoint="section",SectionArticles.prototype.initialize=function(models,options){return null==options&&(options={}),this.app=options.app,this.freeze_url_once=!0,this.sub=options.sub,this.endpoint+="/"+this.sub,this.section_tag=options.section_tag,Time.trigger("leftRail:flush"),$("body").addClass("tax-time_section"),this.view=new Time.views.DefaultLeftRail({collection:this,app:this.app,containingEl:$(".rail-articles-scroll"),parentEl:$(".rail-articles-scroll")}),this.section_tag?(this.load_tabs(this.sub,".rail-tabs"),$("body").addClass("tax-time-section-tag")):$("body").hasClass("tax-time-section-tag")&&$("body").removeClass("tax-time-section-tag"),this.bindAdd(),this.bindReset(),this},SectionArticles.prototype.fetchArticles=function(){return this.fetch({success:function(_this){return function(collection,response){return _this.section_tag?(Time.trigger("ticker:enable"),Time.trigger("dynamicHeader:enable")):_this.app.render_section_header(response)}}(this)}),this},SectionArticles.prototype.load_articles=function(firstArticle,articles){var bootstrap,initialArticle,ref,ref1,ref2,ref3;if(null==firstArticle&&(firstArticle=null!=(ref=Time.bootstrap)?ref.single_article:void 0),null!=(null!=(ref1=Time.bootstrap.section)?ref1[this.sub]:void 0))bootstrap=null!=(ref2=Time.bootstrap.section)?ref2[this.sub]:void 0,null!=bootstrap.articles&&this.add(this.parse(Time.bootstrap.section[this.sub])),this.view.render_section_header(bootstrap),this.load_tabs(this.sub,".rail-tabs");else{if(this.app.model.get("isPreview")&&null!=(null!=(ref3=Time.bootstrap.latest)?ref3.articles:void 0))return initialArticle=Time.bootstrap.single_article||null,initialArticle&&(articles=this.moveArticleFirst(initialArticle,Time.bootstrap.latest.articles)),void this.add(articles);this.fetchArticles()}},SectionArticles.prototype.load_tabs=function(label,el_selector){var href,new_tab_data;new_tab_data=Time.tab_data.default,"us"===label&&(label="U.S."),href="/"+this.sub+"/",this.app.isMoney()&&(href="/money"+href),new_tab_data.tabs[0]={label:label.replace("-"," "),omniture:"nav-"+this.sub,env:this.active_env,sub:this.sub,href:href},this.app.load_tabs(new_tab_data,el_selector),this.app.tabs_view.set_active(0)},SectionArticles.prototype.parse=function(response){var articles;return null!=response.lineup?(articles=response.articles,response.format="section-front",response.title="Today in "+response.name,articles.unshift(response),articles):response.articles},SectionArticles}(Time.collections.Articles),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.collections.SponsorArticles=function(superClass){function SponsorArticles(){return SponsorArticles.__super__.constructor.apply(this,arguments)}return extend(SponsorArticles,superClass),SponsorArticles.prototype.active_env="sponsor",SponsorArticles.prototype.endpoint="sponsor",SponsorArticles.prototype.initialize=function(models,options){return null==options&&(options={}),this.app=options.app,Time.trigger("leftRail:flush"),this.sponsor=options.sub,this.endpoint+="/"+this.sponsor,this.view=new Time.views.DefaultLeftRail({collection:this,app:this.app,containingEl:$(".rail-articles-scroll"),parentEl:$(".rail-articles-scroll")}),this.bindAdd(),this.bindReset(),this},SponsorArticles.prototype.load_articles=function(firstArticle,articles){var ref;return null==firstArticle&&(firstArticle=null!=(ref=Time.bootstrap)?ref.single_article:void 0),null!=Time.bootstrap.sponsor&&null!=Time.bootstrap.sponsor[this.slug]?null!=Time.bootstrap.sponsor[this.slug].articles&&this.add(Time.bootstrap.sponsor[this.slug].articles):this.fetch(),this},SponsorArticles}(Time.collections.Articles),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.collections.TagArticles=function(superClass){function TagArticles(){return TagArticles.__super__.constructor.apply(this,arguments)}return extend(TagArticles,superClass),TagArticles.prototype.active_env="tag",TagArticles.prototype.endpoint="tag",TagArticles.prototype.initialize=function(models,options){return this.app=options.app,this.freeze_url_once=!0,Time.trigger("leftRail:flush"),this.sub=options.sub,this.endpoint+="/"+this.sub,this.view=new Time.views.DefaultLeftRail({collection:this,app:this.app,containingEl:$(".rail-articles-scroll"),parentEl:$(".rail-articles-scroll")}),this.bindAdd(),this.bindReset(),this},TagArticles.prototype.load_articles=function(firstArticle,articles){var ref,ref1;return null==firstArticle&&(firstArticle=null!=(ref=Time.bootstrap)?ref.single_article:void 0),null!=(null!=(ref1=Time.bootstrap.tag)?ref1[this.sub]:void 0)?(Time.bootstrap.tag[this.sub].name&&this.load_tabs(Time.bootstrap.tag[this.sub].name),null!=Time.bootstrap.tag[this.sub].articles&&this.add(Time.bootstrap.tag[this.sub].articles),this.app.render_top_banner(Time.bootstrap.tag[this.sub]),this):(this.fetch({success:function(_this){return function(model,response){if(_this.app.render_top_banner(response),response.name)return _this.load_tabs(response.name)}}(this)}),this)},TagArticles}(Time.collections.Articles),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.collections.TopicArticles=function(superClass){function TopicArticles(){return this.onFetchSuccess=bind(this.onFetchSuccess,this),TopicArticles.__super__.constructor.apply(this,arguments)}return extend(TopicArticles,superClass),TopicArticles.prototype.active_env="topic",TopicArticles.prototype.endpoint="topic",TopicArticles.prototype.initialize=function(models,options){var ref;return this.app=options.app,this.freeze_url_once=!0,Time.trigger("leftRail:flush"),this.sub=options.sub,this.endpoint+="/"+this.sub,this.href="/topic/"+this.sub+"/",this.app.isMoney()&&(this.href="/money"+this.href),this.view=new Time.views.DefaultLeftRail({collection:this,app:this.app,containingEl:$(".rail-articles-scroll"),parentEl:$(".rail-articles-scroll")}),this.view.unbind=function(_this){return function(){var ref;_this.app.$body.removeClass("topic-intro-added"),(null!=(ref=_this.$leftRailEmbeddedShortcode)?ref.length:void 0)&&_this.$leftRailEmbeddedShortcode.trigger("embed.destroy")}}(this),null!=(null!=(ref=Time.bootstrap.topic)?ref[this.sub]:void 0)&&(this.load_tabs(Time.bootstrap.topic[this.sub].left_rail_title),null!=Time.bootstrap.topic[this.sub].intro?this.load_intro(Time.bootstrap.topic[this.sub]):this.app.$body.addClass("topic-intro-added")),this.listenTo(Time,"router:route",function(_this){return function(){Time.application.isInTopic()||_this.app.$body.removeClass("time-vault")}}(this)),this.bindAdd(),this.bindReset(),this},TopicArticles.prototype.load_topic_embed=function(html){this.$leftRailEmbeddedShortcode=$(html),this.$leftRailEmbeddedShortcode.length&&this.view.render_topic_header_embed(html)},TopicArticles.prototype.onFetchSuccess=function(collection,response){this.load_tabs(response.left_rail_title),this.view.render_topic_header(response),null!=response.embed&&this.load_topic_embed(response.embed),null!=response.is_vault&&this.app.$body.addClass("time-vault"),null!=response.intro?this.load_intro(response):this.app.$body.addClass("topic-intro-added")},TopicArticles.prototype.load_articles=function(firstArticle,articles){var ref,ref1,ref2;return null==firstArticle&&(firstArticle=null!=(ref=Time.bootstrap)?ref.single_article:void 0),null!=(null!=(ref1=Time.bootstrap)&&null!=(ref2=ref1.topic)?ref2[this.sub]:void 0)?this.loadArticlesFromBootstrap():(this.fetch({success:this.onFetchSuccess}),this)},TopicArticles.prototype.load_intro=function(topic){var topicIntro;$(".topic-intro").remove(),topicIntro=Time.templates["topic-intro"].render(topic),$(topicIntro).prependTo(this.app.$viewport),this.app.$body.addClass("topic-intro-added"),this.listenTo(Time,"router:route",function(){Time.application.isInTopic()||$(".topic-intro").remove()})},TopicArticles.prototype.loadArticlesFromBootstrap=function(){var articles,initialArticle,ref,topicObject;return topicObject=Time.bootstrap.topic[this.sub],articles=topicObject.articles,null!=articles?(initialArticle=(null!=(ref=Time.bootstrap)?ref.single_article:void 0)||null,articles=this.moveArticleFirst(initialArticle,articles),articles=this.attachNextArticles(articles),this.add(articles)):console.warn("load_articles -- No articles in topic! How did you get here..."),this.view.render_topic_header(topicObject),null!=topicObject.embed&&this.load_topic_embed(topicObject.embed),this},TopicArticles}(Time.collections.Articles),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.collections.VideoArticles=function(superClass){function VideoArticles(){return VideoArticles.__super__.constructor.apply(this,arguments)}return extend(VideoArticles,superClass),VideoArticles.prototype.active_env="videos",VideoArticles.prototype.endpoint="video",VideoArticles.prototype.IS_SPONSORED_ARTICLES_ENABLED=!1,VideoArticles.prototype.initialize=function(models,options){return null==options&&(options={}),this.app=options.app,this.freeze_url_once=!0,Time.trigger("leftRail:flush"),Time.trigger("ticker:enable"),Time.trigger("dynamicHeader:enable"),this.view=new Time.views.DefaultLeftRail({collection:this,app:this.app,containingEl:$(".rail-articles-scroll"),parentEl:$(".rail-articles-scroll")}),this.app.tabs_view.set_active("videos"),Time.trigger("leftRail:load:videos"),this.bindReset(),this},VideoArticles.prototype.load_articles=function(firstArticle,articles){var ref;return null==firstArticle&&(firstArticle=null!=(ref=Time.bootstrap)?ref.single_article:void 0),Time.application.railXHR=this.fetch({complete:function(collection,response){}}),this},VideoArticles}(Time.collections.Articles),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,module=module||{},module.exports=Time.views.Stream=function(superClass){function Stream(){return this.renderDivider=bind(this.renderDivider,this),this.reset=bind(this.reset,this),this.prependArticle=bind(this.prependArticle,this),this.appendArticle=bind(this.appendArticle,this),this.flushArticles=bind(this.flushArticles,this),Stream.__super__.constructor.apply(this,arguments)}return extend(Stream,superClass),Stream.prototype.articleViews=[],Stream.prototype.$viewport=null,Stream.prototype.$viewportWrapper=null,Stream.prototype._infiniteScroll=null,Stream.prototype.initialize=function(options){return null==options&&(options={}),Stream.__super__.initialize.apply(this,arguments),this.app=options.app,this.subapp=options.subapp,this.$viewport=this.$(".article-viewport"),this.$viewportWrapper=this.$(".article-viewport > .wrapper"),this},Stream.prototype.render=function(){return Stream.__super__.render.apply(this,arguments),this.bindInfiniteScrollingEvents(),this.listenTo(Time,"stream:reset",this.reset),this.$el.on("click",".read-video-article",this.showCollapsibleArticleContents),this},Stream.prototype.invokeVisibility=function(){_.each(this.articleViews,function(_this){return function(articleView){if(articleView.isScrollEventActive)return _this.setArticleVisibilityAndCheckScroll(articleView)}}(this))},Stream.prototype.activateArticle=function(articleView){var articleModel,inactiveArticles;return null==articleView&&(articleView=this.findActiveArticle()),articleView?(articleModel=articleView.model,inactiveArticles=this.collection.filter(function(otherModel){return otherModel.id!==articleModel.id}),_.invoke(inactiveArticles,"set",{isActive:!1}),articleModel.set("isActive",!0),articleModel):(articleModel=this.collection.findWhere({isActive:!0}),articleModel?articleModel:this.articleViews.length?this.activateArticle(this.articleViews[0]):null)},Stream.prototype.bindInfiniteScrollingEvents=function(){this.listenTo(Time,"stream:rendered",function(_this){return function(e){_this.invokeVisibility(),_this.activateArticle()}}(this))},Stream.prototype.findActiveArticle=function(){var foundActiveArticle;return foundActiveArticle=_.find(this.articleViews,function(_this){return function(articleView){return _this.isArticleActive(articleView)}}(this)),foundActiveArticle?foundActiveArticle:null},Stream.prototype.setArticleVisibilityAndCheckScroll=function(articleView){var $el,articleAbove,articleBelow,position;$el=articleView.$el,articleAbove=this.getArticleAbove(articleView),articleBelow=this.getArticleBelow(articleView),position=this.elPosition($el),"above"===position||"below"===position?articleView.isVisible&&(articleView.isVisible=!1,this.app.hide_images($el),$el.addClass("offScreen"),Time.trigger("article:offscreen",articleView),
"above"===position&&(null!=articleAbove&&(articleAbove.isScrollEventActive=!1),null!=articleBelow&&(articleBelow.isScrollEventActive=!0)),"below"===position&&(null!=articleAbove&&(articleAbove.isScrollEventActive=!0),null!=articleBelow&&(articleBelow.isScrollEventActive=!1))):articleView.isVisible||(articleView.isVisible=!0,this.app.show_images($el),$el.removeClass("offScreen"),Time.trigger("article:onscreen",articleView),null!=articleAbove&&(articleAbove.isScrollEventActive=!0),null!=articleBelow&&(articleBelow.isScrollEventActive=!0))},Stream.prototype.flushArticles=function(){_.each(this.articleViews,function(articleView){articleView.deactivateView(),articleView.destroy()}),this.articleViews.length=0},Stream.prototype.appendArticle=function(articleView){return this.articleViews.push(articleView),this.$viewportWrapper.append(articleView.render().$el),Time.trigger("article:rendered",articleView),articleView},Stream.prototype.prependArticle=function(articleView){return this.articleViews.unshift(articleView),this.$viewportWrapper.prepend(articleView.render({method:"prepend"}).$el),this.app.scrollTo(articleView.$el,{margin:!0,over:{top:.99}}),Time.trigger("article:rendered",articleView),articleView},Stream.prototype.reset=function(){this.flushArticles(),this.$viewportWrapper.empty()},Stream.prototype.getArticleEl=function(id){return this.$viewportWrapper.find('article[data-article="'+id+'"]')},Stream.prototype.hasArticleEl=function(id){return this.$viewportWrapper.find('article[data-article="'+id+'"]').length},Stream.prototype.isArticleActive=function(articleView){return!!this.isOnThreshold(articleView.el)&&articleView},Stream.prototype.getArticleViewIndex=function(articleView){return _.chain(this.articleViews).pluck("cid").indexOf(articleView.cid).value()},Stream.prototype.getArticleAbove=function(articleView){var articleIndex;return articleIndex=this.getArticleViewIndex(articleView),(articleIndex=0)?null:this.articleViews[articleIndex-1]},Stream.prototype.getArticleBelow=function(articleView){var articleIndex;return articleIndex=this.getArticleViewIndex(articleView),(articleIndex=this.articleViews.length)?null:this.articleViews[articleIndex+1]},Stream.prototype.showCollapsibleArticleContents=function(e){var $this;e.preventDefault(),$this=$(e.target),$this.toggleClass("collapsed"),$this.hasClass("collapsed")?$this.text("+ READ ARTICLE"):$this.text("+ HIDE ARTICLE")},Stream.prototype.flushDividers=function(){_.invoke(this.dividerViews,"destroy"),this.dividerViews.length=0},Stream.prototype.getDividerViewByArticleView=function(articleView){var articleModel;return articleModel=articleView.model,_.findWhere(this.dividerViews,{article:articleModel})},Stream.prototype.renderDivider=function(articleView){var divider,ref;if("nativo"!==(null!=(ref=this.app.active_rail)?ref.active_env:void 0)&&!this.app.model.get("isPrintMode")&&"section-front"!==articleView.model.get("format"))return divider=new Time.views.Divider({parent:this,article:articleView.model,type:this.getDividerType()}),this.dividerViews.push(divider),"mobile"===Time.device?divider.render().$el.prependTo(articleView.$el):divider.render().$el.insertAfter(articleView.$el),this},Stream.prototype.isEvenDivider=function(index){return null==index&&(index=this.articleViews.length),index%2===0},Stream.prototype.isFirstDivider=function(index){return null==index&&(index=this.articleViews.length),index<=1},Stream.prototype.getDividerType=function(){return console.error("OVERRIDE THIS FUNCTION"),"empty"},Stream}(Time.views.ContainingView),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,module=module||{},module.exports=Time.views.ReadingPaneArticle=function(superClass){function ReadingPaneArticle(){return this.renderRightRailAd=bind(this.renderRightRailAd,this),this.renderDividerAds=bind(this.renderDividerAds,this),this._reallyRefreshOutbrain=bind(this._reallyRefreshOutbrain,this),this.adjustToRightRail=bind(this.adjustToRightRail,this),ReadingPaneArticle.__super__.constructor.apply(this,arguments)}var TEMPLATE_FORMAT_MAP;return extend(ReadingPaneArticle,superClass),ReadingPaneArticle.prototype.el=null,ReadingPaneArticle.prototype.template=Time.templates["article-single"],TEMPLATE_FORMAT_MAP={list:"article-single-list",gallery:"article-single-gallery",video:"article-single-video",collection_intro:"collection-intro","section-front":"section-front"},ReadingPaneArticle.prototype.parent=null,ReadingPaneArticle.prototype.isScrollEventActive=!0,ReadingPaneArticle.prototype.isVisible=!1,ReadingPaneArticle.prototype._totalFbEmbeds=0,ReadingPaneArticle.prototype._totalVideos=0,ReadingPaneArticle.prototype._refreshTwitterTimeout=null,ReadingPaneArticle.prototype._brightcoveRenderTimeout=null,ReadingPaneArticle.prototype._outbrainTimeout=null,ReadingPaneArticle.prototype._galleriesRendered=0,ReadingPaneArticle.prototype.listicleViews=[],ReadingPaneArticle.prototype.aboveDivider=null,ReadingPaneArticle.prototype.belowDivider=null,ReadingPaneArticle.prototype.initialize=function(options){return null==options&&(options={}),this.chaseFacade(),this.parent=options.parent,this.model.set("trending_videos",Time.bootstrap.trending_videos),this.model.set("most_popular_stories",Time.bootstrap.most_popular_stories),this.initializeEl(),this.galleriesCollection=new Time.collections.Galleries(null,{article:this}),this.collectPrimaryGallery(),this.collectGalleries(),this.collectListGalleries(),this._totalFbEmbeds=this.$(".fb-post").length,this._totalVideos=this.$(".video-wrapper").length,this.listenTo(Time,"article:beforeActivate",function(_this){return function(articleView){var articleModel;if(articleModel=articleView.model,articleModel.id!==_this.model.id)return _this.deactivateView()}}(this)),this.listenTo(this.model,"change:isActive",function(_this){return function(model,value,options){if(value)return _this.activateView()}}(this)),this.listenTo(Time,"dfpAdManager:callback",function(id){(id.indexOf("content-ad-mobile")>-1||id.indexOf("right-rail__ad-"+this.model.id)>-1||this.$(".right-rail__container").length>0)&&(_.delay(this.adjustToRightRail,500),this.stopListening(Time,"dfpAdManager:callback"))}),this.listenTo(Time,"application:resize",function(_this){return function(){return _this.adjustToRightRail(),_this.maybeClipArticle()}}(this)),this},ReadingPaneArticle.prototype.chaseFacade=function(){var $content;this.model.get("sponsor")&&"chase"===this.model.get("sponsor").slug&&(window.CHASE&&($content=$(this.model.get("content")),$content.find('script[src="//chaseonline.chase.com/js/Reporting.js"]').remove(),this.model.set("content",$content.prop("outerHTML"))),this.listenTo(this.model,"change:isActive",function(_this){return function(model,value,options){value&&window.CHASE&&window.CHASE.analytics&&(RPT_AddVariables("wa_sr",window.CHASE.analytics.config.ScreenResolution,"wa_br",window.CHASE.analytics.config.BrowserSize,"wa_fv",window.CHASE.analytics.config.FlashVersion,"wa_pt",model.get("title")),window.CHASE.analytics.requestPageDot())}}(this)))},ReadingPaneArticle.prototype.initializeEl=function(){var $existing,html,ref;return $existing=null!=(ref=this.parent)?ref.$("#article-"+this.model.id).first():void 0,(null!=$existing?$existing.length:void 0)&&""!==$existing.html()?this.setElement($existing):(this.getTemplate(),html=this.template.render(this.model.toJSON(),Time.partials),this.setElement($(html))),this.el},ReadingPaneArticle.prototype.collectPrimaryGallery=function(){var galleryData,galleryModel;if(galleryData=this.model.get("gallery"),null!=galleryData)return this.galleriesCollection.add(galleryData),galleryModel=this.galleriesCollection.get(galleryData.id),galleryModel.set("isPrimary",!0),this},ReadingPaneArticle.prototype.collectGalleries=function(){var galleriesData;if(galleriesData=this.model.get("galleries"),null!=galleriesData)return this.galleriesCollection.add(galleriesData),this},ReadingPaneArticle.prototype.collectListGalleries=function(){var li;if(li=this.model.get("list_items"),null!=li)return _.each(li,function(_this){return function(item){var ref;if(null!=(ref=item.galleries)?ref.length:void 0)return _.each(item.galleries,function(listItemGalleryModel){return _this.galleriesCollection.add(listItemGalleryModel)})}}(this)),this},ReadingPaneArticle.prototype.hasVideos=function(){return this._totalVideos||"video"===this.model.get("format")},ReadingPaneArticle.prototype.isNextToRightRailModule=function($el){var elementBottom,elementTop,result,totalRightrailModule;return result=!1,elementTop=$el.position().top,elementBottom=elementTop+$el.outerHeight(!0),totalRightrailModule=this.$(".right-rail__module").size(),this.$(".right-rail__module").each(function(index){var rrModuleEnd,rrModuleStart;if(rrModuleStart=$(this).position().top,rrModuleEnd=rrModuleStart+$(this).outerHeight(!0),rrModuleStart<=elementTop&&elementTop<=rrModuleEnd||rrModuleStart<=elementBottom&&elementBottom<=rrModuleEnd)return result=!0}),result},ReadingPaneArticle.prototype.getTemplate=function(){var templateName;return null!=this.model.get("cover")?(this.template=Time.templates["article-single-cover"],this.template):null!=this.model.get("sponsor")&&"time_collection_post"!==this.model.get("post_type")?(this.template=Time.templates["article-single-sponsored"],this.template):_.has(TEMPLATE_FORMAT_MAP,this.model.get("format"))?(templateName=TEMPLATE_FORMAT_MAP[this.model.get("format")],this.template=Time.templates[templateName],this.template):Time.templates["article-single"]},ReadingPaneArticle.prototype.render=function(opts){if(null==opts&&(opts={}),!this.isRendered)return this.prepended="prepend"===opts.method,this.$el.toggleClass("collection-article__last",this.model.get("last_article")===!0),"list"===this.model.get("format")&&this.renderLists(),this.renderEmbeds(),this.renderEmbeddedListicles(),this.isRendered=!0,this},ReadingPaneArticle.prototype.renderEmbeds=function(oEmbedsArray){var $oEmbedEl,j,len,oEmbed,ref,ref1;if(null==oEmbedsArray&&(oEmbedsArray=this.model.get("oembeds")),oEmbedsArray)for(j=0,len=oEmbedsArray.length;j<len;j++)if(oEmbed=oEmbedsArray[j],$oEmbedEl=this.$('.time-embed[data-url="'+oEmbed.url+'"]'),$oEmbedEl.length>0&&oEmbed.content)switch($oEmbedEl.html($(oEmbed.content).children()),oEmbed.provider){case"facebook":null!=(ref=window.FB)&&ref.XFBML.parse();break;case"instagram":null!=(ref1=window.instgrm)&&ref1.Embeds.process();break;case"twitter":window.clearTimeout(this._refreshTwitterTimeout),this._refreshTwitterTimeout=window.setTimeout(function(){var ref2;return"undefined"!=typeof twttr&&null!==twttr&&null!=(ref2=twttr.widgets)?ref2.load():void 0},100)}},ReadingPaneArticle.prototype.adjustToRightRail=function(){var ref,that;return that=this,this.$(".alignright, .inline-portrait_small_2x").each(function(){return $(this).toggleClass("right-rail-adjacent",that.isNextToRightRailModule($(this)))}),this.$(".galleryContainer--embedded").each(function(){return $(this).toggleClass("galleryContainer--fullwidth",!that.isNextToRightRailModule($(this)))}),this.$(".article-video").each(function(){var ref;if("primary-video-wrapper video-brightcove"!==(null!=(ref=$(this).parent())?ref.prop("className"):void 0))return $(this).toggleClass("right-rail-adjacent",that.isNextToRightRailModule($(this)))}),this.$(".article-content > table").each(function(){if(that.isNextToRightRailModule($(this)))return $(this).addClass("right-rail-adjacent")}),this.$(".clearvideofloat").each(function(){if(that.isNextToRightRailModule($(this)))return $(this).addClass("rail-adjacent")}),this.$(".trump-cover-interactive").each(function(){if(that.isNextToRightRailModule($(this)))return $(this).addClass("right-rail-adjacent")}),750<(ref=Time.application.$window.width())&&ref<=1024?this.$(".article-body > p, .inline-portrait_small, .inline-portrait_small_2x, .aligncenter").each(function(){return $(this).toggleClass("right-rail-adjacent",that.isNextToRightRailModule($(this)))}):this.$(".image-wrapper img").each(function(){if($(this).attr("width")>550)return $(this).toggleClass("right-rail-adjacent",that.isNextToRightRailModule($(this)))}),this},ReadingPaneArticle.prototype.renderLists=function(){var j,len,listItem,listItems,listicleView;if(this.model.get("list_gallery_style")&&Time.application.$window.width()>750)listicleView=new Time.views.ListicleView({el:this.$el,article:this}),this.listicleViews.push(listicleView);else{if(this.$el.removeClass("listicle"),listItems=this.model.get("list_items"))for(j=0,len=listItems.length;j<len;j++)listItem=listItems[j],this.renderEmbeds(listItem.oembeds);Time.trigger("article:list:injectAds",this.model),Time.trigger("article:list:activateAds",this.model)}return this},ReadingPaneArticle.prototype.renderBrightcoveVideos=function(){var renderDelay;return renderDelay="desktop"===Time.device?0:3e3,this._brightcoveRenderTimeout=window.setTimeout(function(){try{return window.bcFacade.reflow()}catch(_error){}},renderDelay),this},ReadingPaneArticle.prototype.renderEmbeddedListicles=function(){return this.$listicles=this.$(".listicle--embedded"),0===this.$listicles.length?this:(this.$listicles.each(function(_this){return function(i,el){var listicleView;return listicleView=new Time.views.ListicleView({el:el,article:_this,embedded:!0}),_this.listicleViews.push(listicleView)}}(this)),this)},ReadingPaneArticle.prototype.renderGalleries=function(){return this.$galleries=this.$("div[data-gallery]"),this._galleriesRendered===this.$galleries.length?this:(this.$galleries.each(function(_this){return function(i,el){var galleryParentView;return galleryParentView=new Time.views.GalleryParent({el:el,article:_this,galleries:_this.galleriesCollection})}}(this)),this)},ReadingPaneArticle.prototype.setupArticleCollapse=function(){var $articleBody,$content,$toggle;$articleBody=$(".article-body"),$content=$(".article-content"),$toggle=$(".article-body .clipper-toggle"),$toggle.one("click",function(e){return e.preventDefault(),Time.trigger("article:read-more"),$content.css("height","auto"),$articleBody.removeClass("article--is-clipped").addClass("article--is-unclipped")}),this.maybeClipArticle()},ReadingPaneArticle.prototype.maybeClipArticle=function(){var $content,NUM_BLOCKS_TO_SHOW,blockCounter,clipContentIndex,clipHeight,ref,ref1,ref2;$(".article-body.article--is-unclipped").length>0||(NUM_BLOCKS_TO_SHOW=2,$content=$(".article-content"),$(window).width()<450&&(null!=$content?$content.length:void 0)>0?(clipContentIndex=0,blockCounter=0,$content.children().each(function(index){return blockCounter!==NUM_BLOCKS_TO_SHOW&&($(this).outerHeight(!1)>50&&!$(this).hasClass("right-rail__container")?(clipContentIndex=index,blockCounter++):void 0)}),clipHeight=null!=(ref=$content.children())&&null!=(ref1=ref.eq(clipContentIndex))&&null!=(ref2=ref1.position())?ref2.top:void 0,clipHeight&&($content.css("height",clipHeight+"px"),$(".article-body").addClass("article--is-clipped"))):$(".article-body").hasClass("article--is-clipped")&&($content.css("height","auto"),$(".article-body").removeClass("article--is-clipped")))},ReadingPaneArticle.prototype.renderProtectedIframes=function(){if($(".wpcom-protected-iframe").length)return window.TIMEContentLoaded=document.createEvent("Event"),window.TIMEContentLoaded.initEvent("DOMContentLoaded",!0,!0),window.document.dispatchEvent(TIMEContentLoaded)},ReadingPaneArticle.prototype.refreshOutbrain=function(){window.clearTimeout(this._outbrainTimeout),this.model.get("isActive")&&(this._outbrainTimeout=window.setTimeout(function(_this){return function(){var outbrain,ref;return outbrain=null!=(ref=window.OBR)?ref.extern:void 0,outbrain?_this._reallyRefreshOutbrain():_this.refreshOutbrain()}}(this),250))},ReadingPaneArticle.prototype._reallyRefreshOutbrain=function(){var e,outbrain;if(window.clearTimeout(this._outbrainTimeout),this.model.get("isActive")){outbrain=window.OBR.extern;try{outbrain.researchWidget()}catch(_error){e=_error,console.error("Outbrain refresh error",e)}}},ReadingPaneArticle.prototype.renderCollegeAbacus=function(){window.clearTimeout(this._collegeAbacusTimeout),this.model.get("isActive")&&(this._collegeAbacusTimeout=window.setTimeout(function(_this){return function(){return window.CollegeAbacus?($(".time-college-abacus:not(.time-college-abacus--rendered)").append(window.CollegeAbacus.makeIFrame()).addClass("time-college-abacus--rendered"),window.clearTimeout(_this._collegeAbacusTimeout)):_this.renderCollegeAbacus()}}(this),250))},ReadingPaneArticle.prototype.deactivateView=function(){return this.stopListening(this.model,"change:componentsToRender"),this.$el.removeClass("active"),window.clearTimeout(this._refreshTwitterTimeout),window.clearTimeout(this._outbrainTimeout),window.clearTimeout(this._brightcoveRenderTimeout),this.stopListening(this,"gallery:slides:rendered"),this.galleriesCollection.trigger("galleries:flush"),this._galleriesRendered=0,Time.trigger("article:deactivated",this),this},ReadingPaneArticle.prototype.activateView=function(){var $w,componentsToRender,galleriesToRender;return Time.trigger("article:beforeActivate",this),Time.trigger("ticker:show"),this.$el.removeClass("offScreen"),this.$el.addClass("active"),$w=$(window),this.model.get("scripts")?$.getScript(this.model.get("scripts")[0],function(){return $(window).trigger("post-load",{el:this.$el})}):$w.trigger("post-load",{el:this.$el}),this._totalFbEmbeds&&Time.trigger("article:fbembeds:activate",this.el),this.renderProtectedIframes(),this.renderBrightcoveVideos(),this.refreshOutbrain(),this.$(".time-college-abacus").length>0&&this.renderCollegeAbacus(),this.renderDividerAds(),this.renderRightRailAd(),this.setupArticleCollapse(),this.$(".trump-cover-interactive").length>0&&this.trumpInteractive(),this.model.set("componentsToRender",1),this.listenTo(this.model,"change:componentsToRender",function(){console.info("-- components left to render: ",this.model.get("componentsToRender")),0===this.model.get("componentsToRender")&&(this.stopListening(this.model,"change:componentsToRender"),this.$(".right-rail__ad").length>0||this.adjustToRightRail(),Time.trigger("article:activated",this),Time.application.activeArticleView=this)}),this.$galleries=this.$("div[data-gallery]"),galleriesToRender=this.galleriesCollection.size(),this.$galleries.length<galleriesToRender&&(galleriesToRender=this.$galleries.length),this.renderComponent("_galleriesRendered",galleriesToRender,"gallery:slides:rendered")&&this.renderGalleries(),componentsToRender=this.model.get("componentsToRender"),this.model.set("componentsToRender",componentsToRender-1),this},ReadingPaneArticle.prototype.renderDividerAds=function(){if(!this.model.get("is_nativo")&&!Time.application.model.get("isPrintMode")&&(this.belowDivider=new Time.views.Divider({article:this.model,type:"advert-below"}),this.belowDivider.render().$el.insertBefore($(".article-footer__popular-module")),"desktop"!==Time.device&&!this.model.get("cover")))return this.aboveDivider=new Time.views.Divider({article:this.model,type:"advert-above"}),this.aboveDivider.render().$el.prependTo(this.$el),this},ReadingPaneArticle.prototype.renderRightRailAd=function(){var position,size;Time.application.model.get("isPrintMode")||"mobile"===Time.device||(position=1,size=$(".right-rail__ad__wrapper").hasClass("ad-300-250")?Time.application.adSizes["right-rail-short"]:Time.application.adSizes["right-rail"],this.model.isNativo()&&"desktop"!==Time.device&&(position=2),this.rightRailAd={id:"right-rail__ad-"+this.model.id,position:position,size:size,group:"right-rail"})},ReadingPaneArticle.prototype.renderComponent=function(counter,total,listener){return!!total&&(this.model.set("componentsToRender",this.model.get("componentsToRender")+1),this.listenTo(this,listener,function(_this){return function(){var componentsToRender;_this[counter]=_this[counter]+1,_this[counter]===total&&(_this.stopListening(_this,listener),componentsToRender=_this.model.get("componentsToRender"),_this.model.set("componentsToRender",componentsToRender-1))}}(this)),!0)},ReadingPaneArticle.prototype.scrollToListItem=function(itemSlug){var $item,itemOffsetTop;if(!this.model.get("list_gallery_style"))return $item=this.$("[data-item-slug='"+itemSlug+"']"),!!$item.length&&(itemOffsetTop=$item.offset().top,"complete"!==document.readyState?void(window.onload=function(){return Time.application.reset_scroll(itemOffsetTop)}):void Time.application.reset_scroll(itemOffsetTop))},ReadingPaneArticle.prototype.trumpInteractive=function(){var canvas,ctx,img,populateShareButtons,ref;canvas=document.getElementById("trump-canvas"),ctx=canvas.getContext("2d"),img=document.getElementById("trump-image"),ctx.lineWidth=5,ctx.font="700 22px Lora",ctx.strokeStyle="black",ctx.fillStyle="black",ctx.textAlign="center",img.onload=function(){ctx.drawImage(img,0,0,canvas.width,canvas.height)},populateShareButtons=function(_this){return function(fileName){var imageUrl,shareLanguage,shareUrl;shareUrl=_this.model.get("url")+"share/trump-"+fileName+"/",imageUrl="https://timecom.s3.amazonaws.com/trump/"+fileName+".jpg",shareLanguage=encodeURIComponent("Make Your Own Donald Trump Cover"),$(".trump-cover-interactive .social-link-fb").attr("href","https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(shareUrl)),$(".trump-cover-interactive .social-link-tw").attr("href","https://twitter.com/intent/tweet?url="+encodeURIComponent(shareUrl)+"&amp;text="+shareLanguage+"&amp;&via=Time"),$(".trump-cover-interactive .social-link-pinterest").attr("href","https://www.pinterest.com/pin/create/button/?url="+encodeURIComponent(shareUrl)+"&media="+encodeURIComponent(imageUrl)+"&&description="+shareLanguage),$(".trump-cover-interactive .social-link-mail").attr("href","mailto:?subject="+shareLanguage+"&amp;body="+encodeURIComponent(shareUrl)),$(".trump-cover-interactive .social-link-reddit").attr("href","http://www.reddit.com/submit?url="+encodeURIComponent(shareUrl)+"&title="+shareLanguage),$(".trump-cover-interactive .results-download").attr("href",imageUrl)}}(this),0===(null!=(ref=this.model.get("slug"))?ref.indexOf("trump-"):void 0)&&($(".trump-cover-interactive .results-image").attr("src","https://timecom.s3.amazonaws.com/trump/"+this.model.get("slug").slice(6)+".jpg"),$(".trump-cover-interactive .results-wrapper").show(),$(".trump-cover-interactive .cover-generator-wrapper").hide(),populateShareButtons(this.model.get("slug").slice(6))),$(".trump-cover-interactive .another-one-button").click(function(e){return e.preventDefault(),$(".trump-cover-interactive .results-wrapper").hide(),$(".trump-cover-interactive .cover-generator-wrapper").show()}),$(".trump-cover-interactive .cover-generator-form input").on("input",function(e){return ctx.clearRect(0,0,canvas.width,canvas.height),ctx.drawImage(img,0,0,canvas.width,canvas.height),ctx.wrapText($("#box-one").val(),70,545,120,22),ctx.wrapText($("#box-two").val(),210,545,145,22),ctx.wrapText($("#box-three").val(),340,545,145,22),ctx.wrapText($("#box-four").val(),475,545,145,22)}),$(".trump-cover-interactive .generate-button").click(function(e){var dataURL,fileName;return e.preventDefault(),$(".trump-cover-interactive .generate-button").prop("disabled",!0),$(".trump-cover-interactive .generate-button").html("Generating..."),dataURL=canvas.toDataURL("image/jpeg",.5),fileName=(new Date).getTime(),$.ajax({type:"POST",url:"https://pltqupl8ug.execute-api.us-west-2.amazonaws.com/prod/imageSaveToS3",data:{img:dataURL,fileName:fileName}}).done(function(o){return $(".trump-cover-interactive .generate-button").prop("disabled",!1),$(".trump-cover-interactive .generate-button").html("Make My Trump Cover"),$(".trump-cover-interactive .cover-generator-wrapper").hide(),$(".trump-cover-interactive .results-image").attr("src",o.Location),$(".trump-cover-interactive .results-wrapper").show(),populateShareButtons(fileName)})})},ReadingPaneArticle}(Backbone.View),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,module=module||{},module.exports=Time.views.DefaultStream=function(superClass){function DefaultStream(){return this.render=bind(this.render,this),DefaultStream.__super__.constructor.apply(this,arguments)}return extend(DefaultStream,superClass),DefaultStream.prototype.initialize=function(options){return null==options&&(options={}),DefaultStream.__super__.initialize.apply(this,arguments),this.listenTo(Time,"link:navigate",function(_this){return function(path,options){return _this.app.scrollTo(0)}}(this)),this},DefaultStream.prototype.render=function(){return DefaultStream.__super__.render.apply(this,arguments),this},DefaultStream.prototype.startOnArticle=function(articleModel){var articleView;null==articleModel&&(articleModel=this.collection.at(0)),this.DEBUG&&("undefined"!=typeof console&&null!==console?console.info("Stream -- startOnArticle"):void 0),Time.trigger("stream:reset"),articleView=new Time.views.ReadingPaneArticle({app:this.app,model:articleModel,parent:this}),articleModel.views.singleView=articleView,this.appendArticle(articleView),this.app.hide_loader(this.app.$viewportWrapper),this.collection.set_visible_article(articleModel),this.collection.freezeIfSlug(articleModel.get("slug"),articleModel),Time.trigger("stream:rendered")},DefaultStream.prototype.isSixthOfSevenDividers=function(index){return null==index&&(index=this.dividerViews.length),index%7===6},DefaultStream.prototype.getDividerType=function(env){var ref;return null==env&&(env=null!=(ref=this.app.active_rail)?ref.active_env:void 0),"nativo"===env?"empty":"mobile"===Time.device?"advert":"desktop"===Time.device?this.isSixthOfSevenDividers()?"article":"advert":this.isEvenDivider()?"advert":"article"},DefaultStream}(Time.views.Stream),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,module=module||{},module.exports=Time.views.Divider=function(superClass){function Divider(){return Divider.__super__.constructor.apply(this,arguments)}return extend(Divider,superClass),Divider.prototype.type="",Divider.prototype.divId=null,Divider.prototype.bootstrapHtml="",Divider.prototype.initialize=function(options){var ref,ref1;return null==options&&(options={}),this.parent=options.parent,this.article=options.article,this.type=options.type,"article"===this.type&&(this.bootstrapHtml=null!=(ref=Time.application)&&null!=(ref1=ref.model)?ref1.getDividerHtml():void 0),this},Divider.prototype.render=function(type){var $adEl,$html;switch(null==type&&(type=this.type),this.position="1",this.group="dividers",this.subgroup="advertisement",type){case"advert-below":this.divId="ad-below-"+this.article.id,"money"===Time.bootstrap.branding?this.size=Time.application.adSizes["ad-divider-money"]:(this.position="3",this.size=Time.application.adSizes["ad-divider"]),$adEl=$("<div />",{id:this.divId,class:"divider-advert divider-"+type,"data-cb-ad-id":"ad-below"}).data("cb-ad-id","ad-below").height("auto"),this.setElement($adEl);break;case"advert-above":if(this.divId="ad-above-"+this.article.id,this.size=Time.application.adSizes["ad-divider-above"],null==this.size)return this;$html=$("<div/>",{class:"divider-"+type+"__wrapper"}),$adEl=$("<div />",{id:this.divId,class:"divider-advert divider-"+type,"data-cb-ad-id":"ad-above"}).data("cb-ad-id","ad-above").height("auto"),$html.append($adEl),this.setElement($html)}return this},Divider}(Backbone.View)}).call(this);;
(function(){var $,LODASH_VERSION,Time,module,require,root,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};LODASH_VERSION="3.9.3","undefined"!=typeof _&&null!==_&&_.VERSION!==LODASH_VERSION&&_.noConflict(),module={},require=_.noop,$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.collections.SkyboxArticles=function(superClass){function SkyboxArticles(){return SkyboxArticles.__super__.constructor.apply(this,arguments)}return extend(SkyboxArticles,superClass),SkyboxArticles.prototype.url=function(){return"money"===Time.bootstrap.branding?Time.api_url+"money/skybox/":Time.api_url+"skybox/"},SkyboxArticles.prototype.parse=function(response){return null!=response.error?[]:response},SkyboxArticles.prototype.maybeFetch=function(){return null!=Time.bootstrap.ticker?this.reset(Time.bootstrap.ticker):this.fetch({reset:!0})},SkyboxArticles}(Backbone.Collection),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,Time.views.SkyboxTicker=function(superClass){function SkyboxTicker(){return this.render=bind(this.render,this),SkyboxTicker.__super__.constructor.apply(this,arguments)}return extend(SkyboxTicker,superClass),SkyboxTicker.prototype.el=".top-banner",SkyboxTicker.prototype.template=Time.templates["ticker-module"],SkyboxTicker.prototype.articlesTemplate=Time.templates["ticker-article"],SkyboxTicker.prototype.collection=new Time.collections.SkyboxArticles,SkyboxTicker.prototype.initialize=function(options){return null==options&&(options={}),this.listenTo(this.collection,"reset",this.render),this.collection.maybeFetch(),this},SkyboxTicker.prototype.render=function(){return this.$el.empty(),0===this.collection.length?this:(this.$el.html(this.template.render({})),this.$(".headlines").html(this.renderArticles()),this)},SkyboxTicker.prototype.renderArticles=function(){var $articles;return $articles=this.collection.map(function(_this){return function(model){var $articlesHtml,articles,articlesHtml,data,randomizedArticles,recentVideo1,recentVideo2;return articles=model.get("articles"),randomizedArticles=_.shuffle(articles),recentVideo1=randomizedArticles[0],recentVideo2=randomizedArticles[1],data={articles:_.compact([recentVideo1,recentVideo2])},articlesHtml=_this.articlesTemplate.render(data),$articlesHtml=$(articlesHtml)}}(this))},SkyboxTicker}(Backbone.View)}).call(this);;
(function(){var LODASH_VERSION,Time,module,require,root;LODASH_VERSION="3.9.3","undefined"!=typeof _&&null!==_&&_.VERSION!==LODASH_VERSION&&_.noConflict(),module={},require=_.noop,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,null==Time.fixes&&(Time.fixes={}),Time.fixes.playBuzzEmbedFix=function($){var PLAYBUZZ_SCRIPT_URL,fixPlayBuzz,maybeLoadPlayBuzz,renderPlayBuzz;return PLAYBUZZ_SCRIPT_URL="http://cdn.playbuzz.com/widget/feed.js",renderPlayBuzz=function(){if($(".pb_feed").length)return window.PlayBuzz.Feed.renderFeed()},maybeLoadPlayBuzz=function(after){return window.PlayBuzz?after():$.getScript(PLAYBUZZ_SCRIPT_URL,after.bind(this))},fixPlayBuzz=function(){return maybeLoadPlayBuzz(renderPlayBuzz)},$(function(_this){return function(){return Time.on("stream:rendered",fixPlayBuzz),Time.on("article:rendered",fixPlayBuzz)}}(this))}(jQuery)}).call(this);;
(function(){var $,LODASH_VERSION,Time,appModel,module,require,root,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;LODASH_VERSION="3.9.3","undefined"!=typeof _&&null!==_&&_.VERSION!==LODASH_VERSION&&_.noConflict(),module={},require=_.noop,$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time,module=module||{},module.exports=Time.Router=function(superClass){function Router(){return Router.__super__.constructor.apply(this,arguments)}return extend(Router,superClass),Router.prototype.DEBUG=!0,Router.prototype.routes={"(/)":"index",index:"index","time_homepage/:homepage/":"index","money/magazine/":"moneyMagazine","money/popular/":"popular","money/videos/":"videos","money/topic/:topic/":"topic","money/page/:special/":"special","money/content-from/:sponsor/(:sponsor_id/)":"nativoLanding","money/content-from/:sponsor/(:article_id/)(:article_slug/)":"moneySponsored","money/best-colleges/(:landing_page/)":"moneyCollegesLanding","digital-account/(:landing_page/)":"digitalAccountLanding","popular/":"popular","right-now/":"right_now","videos/":"videos","photography/(:section/)(:category/)":"photography","tag/:tag/":"tag","topic/:topic/":"topic","author/:author/":"author","magazine/(:region/)(:magazine_id/)(:magazine_slug/)":"magazine","content-from/:sponsor/(:sponsor_id/)":"nativoLanding","content-from/:sponsor/(:article_id/)(:article_slug/)":"sponsored","vault/(:filterType/)(:filterValue/)(:context/)(:page/)":"vault","time_vault/:id/":"vault","(:vertical)/homepage/(:money_homepage_slug/)":"vertical",":special/":"special"},Router.prototype.initialize=function(options){return null==options&&(options={}),this.app=null!=options?options.app:void 0,this.bindListeners(),this.bindTimeRoutes(),this.bindMoneyRoutes(),this},Router.prototype.bindTimeRoutes=function(){this.route(/[\?\&]preview=true/,"preview"),this.route(/[\?\&]p=([0-9]+)/,"preview"),this.route(/[\?\&]page_id=([0-9]+)/,"preview"),this.route(/^([0-9]+)\/([a-z0-9-]+)?/,"article"),this.route(/^([0-9]+)\/([a-z0-9-]+)\/(item|photo|vote|share)\/([a-z0-9-_]+)/,"article"),this.route(/^(business)\//,"section"),this.route(/^(culture)\//,"section"),this.route(/^(history)\//,"section"),this.route(/^(living)\//,"section"),this.route(/^(life)\//,"section"),this.route(/^(lightbox)\//,"section"),this.route(/^(entertainment)\//,"section"),this.route(/^(health)\//,"section"),this.route(/^(ideas)\//,"section"),this.route(/^(newsfeed)\//,"section"),this.route(/^(opinion)\//,"section"),this.route(/^(politics)\//,"section"),this.route(/^(science)\//,"section"),this.route(/^(sports)\//,"section"),this.route(/^(style)\//,"section"),this.route(/^(tech)\//,"section"),this.route(/^(us)\//,"section"),this.route(/^(world)\//,"section"),this.route(/^collection\/([a-z0-9-]+)\/([a-z0-9-]+)?/,"collection"),this.route(/^(collection|tag|topic)\/([a-z0-9-]+)\/grid\//,"photography")},Router.prototype.bindMoneyRoutes=function(){this.route(/^money\/([0-9]+)\/([a-z0-9-]+)?/,"article"),this.route(/^money\/([0-9]+)\/([a-z0-9-]+)\/(item|vote|photo|share)\/([a-z0-9-_]+)/,"article"),this.route(/^money\/(careers)\//,"section"),this.route(/^money\/(everyday-money)\//,"section"),this.route(/^money\/(family-finance)\//,"section"),this.route(/^money\/(investing)\//,"section"),this.route(/^money\/(real-estate)\//,"section"),this.route(/^money\/(retirement)\//,"section"),this.route(/^money\/(travel)\//,"section"),this.route(/^money\/collection\/([a-z0-9-]+)\/([a-z0-9-]+)?/,"collection"),this.route(/^(money)(\/\?.+)?\/?$/,"vertical")},Router.prototype.bindListeners=function(){this.listenTo(this,"route",function(route,params){"undefined"!=typeof console&&null!==console&&console.log("################## new route",route,params),Time.trigger("router:route",route,params)}),this.listenTo(Time,"link:navigate",function(_this){return function(path,options){_this.navigate(path,options),_this.app.isInitialRoute=!1}}(this)),this.listenTo(Time,"article:navigate",function(_this){return function(path,options){_this.navigate(path,options),_this.app.isInitialRoute=!1}}(this)),this.listenTo(Time,"gallery:daisychain",function(_this){return function(path){_this.navigate(path,!0),_this.app.isInitialRoute=!1}}(this)),this.listenTo(Time,"vault:navigate",function(_this){return function(path,options){null==options&&(options={}),_this.navigate(path,options),_this.app.isInitialRoute=!1}}(this))},Router.prototype.isMoneyUrl=function(url){var regexIsMoneyPage;return null==url&&(url=window.location.href),regexIsMoneyPage=/[\?\&]money_page&p=([0-9]+)/,regexIsMoneyPage.test(url)},Router.prototype.isPageUrl=function(url){var regexIsPage;return null==url&&(url=window.location.href),regexIsPage=/[\?\&]page_id=([0-9]+)/,regexIsPage.test(url)},Router.prototype.isHomepageUrl=function(url){var regexMatchesTimeHomepage;return null==url&&(url=window.location.href),regexMatchesTimeHomepage=/time_homepage/,regexMatchesTimeHomepage.test(url)},Router.prototype.isMoneyHomepageUrl=function(url){var regexMatchesMoneyHomepage;return null==url&&(url=window.location.href),regexMatchesMoneyHomepage=/money\/homepage/,regexMatchesMoneyHomepage.test(url)},Router.prototype.isMasonryCollection=function(url){var regexMatchesCollectionMasonry;return null==url&&(url=window.location.href),regexMatchesCollectionMasonry=/[\?\&]view=masonry/,regexMatchesCollectionMasonry.test(url)},Router.prototype.index=Time.controllers.index,Router.prototype.article=Time.controllers.article,Router.prototype.collection=Time.controllers.collection,Router.prototype.magazine=Time.controllers.magazine,Router.prototype.vault=Time.controllers.vault,Router.prototype.magazinePreview=function(url){var matchesMagazine,regexMatchesMagazine;return null==url&&(url=window.location.href),regexMatchesMagazine=/[\?\&]post_type=time_magazine&p=([0-9]+)/,matchesMagazine=regexMatchesMagazine.exec(url),!(null==matchesMagazine||!matchesMagazine[1])&&(this.magazine(null,matchesMagazine[1],null),!0)},Router.prototype.collectionPreview=function(url){var matchesCollection,regexMatchesCollection;return null==url&&(url=window.location.href),regexMatchesCollection=/[\?\&]post_type=time_collection&p=([0-9]+)/,matchesCollection=regexMatchesCollection.exec(window.location.href),null!=matchesCollection&&(this.isMasonryCollection()?(this.photography("collection"),!0):!(null==matchesCollection||!matchesCollection[1])&&(this.collection(matchesCollection[1],null),!0))},Router.prototype.articlePreview=function(url){var matchesPost,regexMatchesPost;return null==url&&(url=window.location.href),regexMatchesPost=/[\?\&]p=([0-9]+)/,matchesPost=regexMatchesPost.exec(window.location.href),!(null==matchesPost||!matchesPost[1])&&(this.article(matchesPost[1]),!0)},Router.prototype.preview=function(){return this.app.model.set("isPreview",!0),this.isHomepageUrl()?this.index():this.isMoneyHomepageUrl()?this.vertical("money"):this.isMoneyUrl()?this.special():this.isPageUrl()?this.special():void(this.magazinePreview()||this.collectionPreview()||this.articlePreview()||"undefined"!=typeof console&&null!==console&&console.error("Unmatched &preview=true route!"))},Router.prototype.right_now=function(){this.app.readingPane||(this.app.readingPane=new Time.views.CategoryLandingView({app:this.app,el:".readingpane",section:section}))},Router.prototype.section=function(section){this.app.readingPane||(this.app.readingPane=new Time.views.CategoryLandingView({app:this.app,el:".readingpane",section:section}))},Router.prototype.author=function(author){this.app.readingPane||(this.app.readingPane=new Time.views.CategoryLandingView({app:this.app,el:".readingpane",author:author}))},Router.prototype.topic=function(topic){this.app.readingPane||(this.app.readingPane=new Time.views.CategoryLandingView({app:this.app,el:".readingpane",topic:topic}))},Router.prototype.tag=function(tag){this.app.readingPane||(this.app.readingPane=new Time.views.CategoryLandingView({app:this.app,el:".readingpane",tag:tag}))},Router.prototype.popular=function(){return this.app.readingPane||(this.app.readingPane=new Time.views.DefaultStream({app:this.app,el:".readingpane",thresholdEl:document.getElementById("notTheHeader"),threshold:.25}),this.app.readingPane.render()),this.app.getArticleCollection({env:"popular"})},Router.prototype.videos=function(){this.app.readingPane||(this.app.readingPane=new Time.views.CategoryLandingView({app:this.app,el:".readingpane",videos:!0}))},Router.prototype.special=function(){this.app.active_route="special",Time.page=new Time.views.SpecialPage({app:this.app})},Router.prototype.vertical=function(vertical){return this.app.isInitialRoute?(Time.page=new Time.views.MoneyHomepage({app:this.app,vertical:vertical}),void Time.page.render()):void window.location.reload()},Router.prototype.photography=function(_tax,category){var TAX_MAP,sub,tax;null==_tax&&(_tax="tag"),null==category&&(category=null),TAX_MAP={life:"section",lightbox:"section"},_.has(TAX_MAP,_tax)?(sub=_tax,tax=TAX_MAP[_tax]):tax=_tax,"life"===_tax&&null!=category&&(tax="life_category",sub=category),Time.page=new Time.views.MasonryPageView({app:this.app,tax:tax,sub:sub})},Router.prototype.sponsored=function(sponsor,articleId){if(!this.app.isInitialRoute||!this.maybeRouteNativo())return this.app.readingPane||(this.app.readingPane=new Time.views.DefaultStream({app:this.app,el:".readingpane",thresholdEl:document.getElementById("notTheHeader"),threshold:.25}),this.app.readingPane.render()),null!=articleId?this.app.load_article(articleId):void this.app.getArticleCollection({env:"sponsor",sub:sponsor})},Router.prototype.nativoLanding=function(sponsorId){this.app.page_view=new Time.views.NativoLanding({app:this.app})},Router.prototype.maybeRouteNativo=function(){var isNativoMatch;return isNativoMatch=/\?ntv_a=(.*)/.exec(window.location.href),null!=isNativoMatch&&(this.app.readingPane||(this.app.readingPane=new Time.views.DefaultStream({app:this.app,el:".readingpane",thresholdEl:document.getElementById("notTheHeader"),threshold:.25}),this.app.readingPane.render()),this.app.getArticleCollection({env:"nativo"}),!0)},Router.prototype.moneyMagazine=function(){this.app.readingPane||(this.app.readingPane=new Time.views.DefaultStream({app:this.app,el:".readingpane",thresholdEl:document.getElementById("notTheHeader"),threshold:.25}),this.app.readingPane.render()),this.app.getArticleCollection({env:"money_magazine",sub:"magazine",open_rail:!0})},Router.prototype.moneySponsored=function(sponsor,articleId){this.app.model.set("isMoneySponsor",!0),this.sponsored(sponsor,articleId)},Router.prototype.moneyCollegesLanding=function(landing_page){this.app.page_view=new Time.views.MoneyCollegesLanding({app:this.app})},Router.prototype.digitalAccountLanding=function(landing_page){this.app.page_view=new Time.views.DigitalAccountLanding({app:this.app})},Router}(Backbone.Router),$=jQuery,root="undefined"!=typeof exports&&null!==exports?exports:this,Time=root.Time||(root.Time={}),_.extend(Time,Backbone.Events),Time.$_GET={},null==Time.bootstrap&&(Time.bootstrap={}),Time.runningAdPreroll=function(){return!1},appModel=new Time.models.Application(Time.bootstrap||{},{parse:!0}),Time.application=new Time.views.Application({model:appModel}),Time.router=new Time.Router({app:Time.application}),$(function(){var fragment,isSilentStart,pathname;if(null==Time.isDocumentReady){if(Time.isDocumentReady=!0,Time.on("application:rendered article:activated leftRail:filled leftRail:tile:rendered collectionHubs:rendered stream:rendered article:read-more",function(){return window.clearTimeout(Time.imgLazyLoad),Time.imgLazyLoad=window.setTimeout(window.maybeLoadHiddenImages,100)}),Time.application.render(),fragment=null,isSilentStart=!Time.application.hasPushstate,$(".error404").length)return Time.page=new Time.views.Error404({app:Time.application}),!1;if($(".page-template-pagespage-vault-php").length&&(fragment=Backbone.history.fragment),Backbone.History.started&&Backbone.history.stop(),$(".page-template-pagespage-special-story-php, .money-home, .masonry").length)return Backbone.history.start({pushState:!1,hashChange:!1}),!1;Backbone.history.start({pushState:Time.application.hasPushstate,hashChange:!Time.application.hasPushstate,silent:isSilentStart}),Time.application.hasPushstate?Time.bootstrap.pathname=Backbone.history.fragment:(pathname=window.location.pathname.substr(Backbone.history.options.root.length),Time.bootstrap.pathname=pathname,fragment||(fragment=pathname),fragment||(fragment="index"),Backbone.history.navigate("/",{trigger:!1}),Backbone.history.navigate(fragment,{trigger:!0,replace:!0}))}})}).call(this);;
function bcFacadeWaitForBC(){return"undefined"==typeof window.videojs||"undefined"==typeof BrightcoveFacade?void setTimeout(function(){bcFacadeWaitForBC()},400):void(window.bcFacade=new BrightcoveFacade.default([".primary-video-wrapper .video-js",".lead .video-container .video-js",".page-template-pagespage-special-story-v3-php .video-js"],.5))}bcFacadeWaitForBC();;
