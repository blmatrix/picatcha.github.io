function printLogs(a){sminternalconfig.logs&&console.log(a)}function printErrors(a){sminternalconfig.logs&&console.error(a)}function getShortString(a,b){return a.length>=b&&(a=a.substring(0,b-3),a+="EOS"),a}function smCreateObjectContainsValues(a,b){var c={};for(var d in a)0==d.indexOf(b)&&(c[d]=a[d]);return c}function createSessionId(a){for(var b="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",d=0;d<a;d++)b+=c.charAt(Math.floor(Math.random()*c.length));return b}function smConvertObjectToString(a){for(var b="",c=Object.keys(a),d=0;d<c.length;d++)b=b+c[d]+"="+a[c[d]]+"&";return b}function getServingScenarioType(){try{if(window.top==window)return"OnPage";for(var a=window;a.parent!=a;){if(a.parent.document.domain!=a.document.domain)return"CrossDomainIframe";a=a.parent}return"SameDomainIframe"}catch(a){}return"CrossDomainIframe"}function smCallURL(a){printLogs("Start sending request: "+a);try{var b=a;b=getShortString(b,sminternalconfig.maxUrlSize);var c=document.createElement("script");c.type="text/javascript",c.async=!0,c.src=b;var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(c,d),printLogs("Finished sending request: "+a)}catch(b){smcounters.smLogicErrorsCollection=smcounters.smLogicErrorsCollection+" smCallURL:"+b,printErrors("Error while get smCallURL , url: "+a+", error: "+b)}}function getConsoleSummary(){return res="",smcounters.counterErrors>0&&(res=res+" Errors:"+smcounters.counterErrors),smcounters.counterWarnings>0&&(res=res+" Warnings:"+smcounters.counterWarnings),smcounters.counterLogs>0&&(res=res+" Logs:"+smcounters.counterLogs),smcounters.windowError>0&&(res=res+" windowErrors:"+smcounters.windowError),res}function smReportThirdPartyPixel(a){"IMPRESSION"==a&&0==smoperational.impressionPixel.indexOf("http")?smCallURL(smoperational.impressionPixel):"COMPLETE"==a&&0==smoperational.completePixel.indexOf("http")?smCallURL(smoperational.completePixel):"AD_CLICK"==a&&0==smoperational.clickPixel.indexOf("http")&&smCallURL(smoperational.clickPixel)}function updatesmTagsObjects(a,b){"IMPRESSION"==b?(smTagsObjects[a].imptime=(new Date).getTime(),smTagsObjects[a].impressions++,smTagsObjects[a].latency=smTagsObjects[a].imptime-smTagsObjects[a].starttime):"COMPLETE"==b?(smTagsObjects[a].completes++,smTagsObjects[a].latency=(new Date).getTime()-smTagsObjects[a].imptime):"AD_PLAY"==b?smTagsObjects[a].latency=(new Date).getTime()-smTagsObjects[a].starttime:"AD_VERIFY"==b?(smTagsObjects[a].verifys++,smTagsObjects[a].latency=(new Date).getTime()-smTagsObjects[a].imptime):"AD_REQUEST"==b?(smTagsObjects[a].starttime=(new Date).getTime(),smTagsObjects[a].requests++,smTagsObjects[a].latency=0,1==smTagsObjects[a].order&&smcounters.breakIndex++):"AD_ERROR"==b&&(smTagsObjects[a].errors++,smTagsObjects[a].latency=(new Date).getTime()-smTagsObjects[a].starttime)}function SMreportEvent(a,b,c){var d="";b&&(d+=b),smReportThirdPartyPixel(a);try{var f,g,h,e=JSON.stringify(smMacrosList),i="",j=-1,l=((new Date).getTime(),0),m=smoperational.lastEvent;try{h=Math.round(((new Date).getTime()-smcounters.lastEventTS)/100)/10;var n=Math.round(((new Date).getTime()-smoperational.startTime)/100)/10;g="s:"+smoperational.loopnumber+",servingScenario:"+smoperational.servingScenario+smMembers.screen,c&&(updatesmTagsObjects(c,a),l=smTagsObjects[c].order,i="("+c+")",j=smTagsObjects[c].latency),smcounters.eventsSentLog=smcounters.eventsSentLog+a+i+":"+n+",",f=smcounters.eventsSentLog;var o=f.length;o>250&&(f=f.substring(o-250,o))}catch(a){d=d+"error: "+a+" ",smcounters.smLogicErrorsCollection=smcounters.smLogicErrorsCollection+" SMreportEvent1:"+a,printErrors("Error while msg:"+a)}finally{j>smcounters.latencyLimit&&(j=smcounters.latencyLimit)}try{g=getShortString(g,2*sminternalconfig.maxParamSize)}catch(a){smcounters.smLogicErrorsCollection=smcounters.smLogicErrorsCollection+" dynamicThree:"+a}try{e+=getConsoleSummary(),randomNumber=Math.floor(100*Math.random());var p=0;smEventsDictionary[a]&&(p=smEventsDictionary[a])}catch(a){smcounters.smLogicErrorsCollection=smcounters.smLogicErrorsCollection+" dynamicOne:"+a}""!=smcounters.smLogicErrorsCollection&&(d+=smcounters.smLogicErrorsCollection),""!=smcounters.windowErrorMessage&&(d="newScriptError:"+smcounters.windowErrorMessage);try{d=getShortString(d,2*sminternalconfig.maxParamSize),d=encodeURIComponent(d)}catch(a){smcounters.smLogicErrorsCollection=smcounters.smLogicErrorsCollection+" msgEnc:"+a}if(randomNumber<p){smcounters.smLogicErrorsCollection="",smcounters.windowErrorMessage="";var q=smoperational.eventUrl+"?eventType="+a+"&"+smStringParams+"samplingPercent="+p+"&randomNumber="+randomNumber+"&breakIndex="+smcounters.breakIndex+"&smTagId="+c+"&hftResponseType="+smoperational.hftResponseType+"&tagPriority="+l+"&smserveflash="+smcounters.serveFlash+"&smssl="+smoperational.ssl+"&smlatency="+j+"&visibility="+smoperational.visibilityState+":"+smoperational.servingScenario+"&clientVersion="+smoperational.clientVersion+"&waterfallString="+smoperational.waterfallStr+"&sessionId="+smoperational.sessionId+"&initts="+n+"&hftnumber="+smcounters.hftNumber+"&docReferrer="+smMembers.docReferrer+"&topLocation="+smMembers.topLocation+"&smwidth="+smoperational.width+"&smheight="+smoperational.height+"&message="+d+"&previouseventtype="+m+"&smdynamic3="+g+"&smdynamic4="+h+"&smdynamic2="+f+"&smdynamic1="+e;smCallURL(q)}smcounters.lastEventTS=(new Date).getTime(),smoperational.lastEvent=a,printLogs("%c event= "+a+" tagId= "+c+" breakIndex= "+smcounters.breakIndex+" order= "+l+" time from start= "+n,"color: #0000FF")}catch(c){printErrors("Error while report event. event="+a+", msg="+b+", sampling="+p+", randomNumber="+randomNumber+", error="+c),smcounters.smLogicErrorsCollection=smcounters.smLogicErrorsCollection+" SMreportEvent2:"+c}}function getFlashVersion(){try{try{var a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");try{a.AllowScriptAccess="always"}catch(a){return"6,0,0"}}catch(a){}return new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(a){try{if(navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin)return(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]).description.replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(a){}}return"0,0,1"}function smConvertStringToObject(a,b){var c=[],d=[];a.indexOf("&")!==-1&&(c=a.split("&")),a.indexOf("?")!==-1&&(d=c[0].split("?")),a.indexOf("#")!==-1&&(d=c[0].split("#")),c.push(d[1]),c.shift();for(var e=0;e<c.length;e++){var f=c[e].split("=");b[f[0]]=f[1].toString()}}function smGetVisibilityState(){try{var a,b;"undefined"!=typeof document.hidden?(b="visibilitychange",a="visibilityState"):"undefined"!=typeof document.mozHidden?(b="mozvisibilitychange",a="mozVisibilityState"):"undefined"!=typeof document.msHidden?(b="msvisibilitychange",a="msVisibilityState"):"undefined"!=typeof document.webkitHidden&&(b="webkitvisibilitychange",a="webkitVisibilityState"),smoperational.visibilityState=document[a],document.addEventListener(b,function(){smoperational.visibilityState=document[a],"DYNAMIC"!=smoperational.hftResponseType||smoperational.isUserInteraction||SMreportEvent("UI",smoperational.visibilityState)},!1)}catch(a){smoperational.visibilityState="error"}}function smGetSessionSummary(){var a=0,b=0,c=0,d=0,e=0,f="";for(var g in smTagsObjects)a=+smTagsObjects[g].requests,b=+smTagsObjects[g].impressions,c<smTagsObjects[g].impressions&&(c=smTagsObjects[g].impressions,d=smTagsObjects[g].requests,e=g);return f="totalRequests="+a+" totalImpressions="+b+" bestTag="+e+" req="+d+" imps="+e}function smGetTagSummary(a){var b=smTagsObjects[a].requests,c=smTagsObjects[a].impressions,d=smTagsObjects[a].errors,e=smTagsObjects[a].verifys,f=smTagsObjects[a].completes,g="req="+b+" imp="+c+" ver="+e+" com="+f+" err="+d;return f>c&&(0==smcounters.sentImpDiscrepancy&&(smcounters.sentImpDiscrepancy++,SMreportEvent("LOGIC_ERROR","More completes then impressions for tag:"+a+" data:"+g)),g="invalidComplete"),g}function smGetStaticEnvVariables(){var a=location.protocol;"https:"==a?smoperational.ssl=1:"http:"==a?smoperational.ssl=0:(smoperational.validSession=!1,smoperational.sessionBreakReason=smMembers.protocol),getFlashVersion().split(",").shift()<11&&(smcounters.serveFlash=0);try{smMembers.topLocation=decodeURIComponent(top.location.href)}catch(a){smMembers.topLocation=null}if(!smMembers.topLocation||smMembers.topLocation.indexOf(".")==-1)try{smMembers.topLocation=decodeURIComponent(window.location.href)+"&smLoc=window"}catch(a){printErrors("Error while init smdocReferrer from window.location.href"+a)}try{smMembers.docReferrer=decodeURIComponent(document.referrer)}catch(a){printErrors("Error while init smdocReferrer. "+a),smMembers.docReferrer="undefined"}if(smMembers.topLocation.indexOf("printsmlogs")>-1){sminternalconfig.logs=!0;for(key in smEventsDictionary)smEventsDictionary[key]=100}try{var b=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,c=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,d=screen.availHeight,e=screen.height,f=screen.width,g=screen.availWidth;smMembers.screen=" doc:"+b+"x"+c+",av:"+g+"x"+d+",res:"+f+"x"+e}catch(a){smMembers.screen="error"}}function smHandleMacros(){try{var a={},b=document.getElementById("sm_main_script");b&&smConvertStringToObject(b.src,a),a.cv&&delete a.cv,a.click&&(smoperational.click=decodeURIComponent(a.click),delete a.click),a.cname&&(sminternalconfig.domain=decodeURIComponent(a.cname),delete a.cname),a.serve_flash&&(smcounters.serveFlash=a.serve_flash,smoperational.clientVersion=smoperational.clientVersion+"_serve_flash="+smcounters.serveFlash,delete a.serve_flash),smMacrosList=smCreateObjectContainsValues(a,"sm_macro_");for(c in a)0==c.indexOf("sm_macro_")&&delete a[c]}catch(a){SMreportEvent("LOGIC_ERROR","smHandleMacros:"+a)}smoperational.eventUrl="https://"+a.server+"."+sminternalconfig.domain+"/gta.evt",smoperational.hftUrl="https://"+a.server+"."+sminternalconfig.domain+"/gta.hft",delete a.server,delete a.cb,printLogs("smMacrosObject= "+JSON.stringify(a));try{a.declaredurl=decodeURIComponent(a.declaredurl)}catch(b){a.declaredurl="undefined"}a.declaredurl.indexOf(".")==-1&&(a.declaredurl=smHandleEmptyReportUrl()),a.declaredurl=smHandleLongEncodingUrls(a.declaredurl);for(var c in a)a[c]=getShortString(a[c],sminternalconfig.maxParamSize);try{smStringParams=smConvertObjectToString(a)}catch(a){smStringParams="",smStringParams=b.src.slice(b.src.indexOf("?")+1)+"&",SMreportEvent("LOGIC_ERROR",a)}}function smHandleEmptyReportUrl(){var a="";try{var b={};smMembers.docReferrer&&smMembers.docReferrer.indexOf(".")>-1&&(smMembers.docReferrer.indexOf("?")>-1||smMembers.docReferrer.indexOf("#")>-1)&&smConvertStringToObject(smMembers.docReferrer,b),smMembers.topLocation&&smMembers.topLocation.indexOf(".")>-1&&(smMembers.topLocation.indexOf("?")>-1||smMembers.topLocation.indexOf("#")>-1)&&smConvertStringToObject(smMembers.topLocation,b),b.url?a=b.url:b.referrer?a=b.referrer:b.p&&(a=b.p),a=a.replace('unescape("',""),a=a.replace('")',"")}catch(b){a="undefined"}finally{return a}}function smHandleLongEncodingUrls(a){var b=encodeURIComponent(a),c=Math.floor(sminternalconfig.maxParamSize/5);return b.length>2*a.length&&(a=a.substring(0,c)),encodeURIComponent(a)}function initMembers(){printLogs("Start init  members"),smGetStaticEnvVariables(),smHandleMacros(),smGetVisibilityState(),smoperational.sessionId=createSessionId(25),smoperational.servingScenario=getServingScenarioType(),smMembers.docReferrer=smHandleLongEncodingUrls(smMembers.docReferrer),smMembers.topLocation=smHandleLongEncodingUrls(smMembers.topLocation);for(var a in smMembers)smMembers[a]=getShortString(smMembers[a],sminternalconfig.maxParamSize);setInterval(function(){var a=smGetSessionSummary();SMreportEvent("TIMER","loop="+smoperational.loopnumber+" "+a)},6e4)}function getHftResponseFromServer(a){if(smoperational.validSession){smcounters.hftNumber++;var b=smoperational.hftUrl+"?"+smStringParams+"smserveflash="+smcounters.serveFlash+"&smssl="+smoperational.ssl+"&smlistsize="+smcounters.listsize+"&hftnumber="+smcounters.hftNumber+"&visibility="+smoperational.visibilityState+":"+smoperational.servingScenario+a+"&docReferrer="+smMembers.docReferrer+"&topLocation="+smMembers.topLocation+"&clientVersion="+smoperational.clientVersion+"&randomNumber="+randomNumber;smCallURL(b)}else SMreportEvent("LOGIC_ERROR","invalid session: "+smoperational.sessionBreakReason)}function buildHftResObject(a){function e(){smoperational.isUserInteraction=!0,d.removeEventListener("mouseenter",e,!1)}function f(){SMreportEvent("PLAYER_CLICK",""),d.removeEventListener("click",f,!1)}printLogs(JSON.stringify(a));var b=(new Date).getTime()-smoperational.startTime;if(b<100&&smcounters.hftNumber<2)return void getHftResponseFromServer("&responseType=STATIC");if(!document.getElementById("sm_player")){var c=document.createElement("div");c.id="sm_player",document.body.appendChild(c)}var d=document.getElementById("sm_player");d.addEventListener("mouseenter",e,!1),d.addEventListener("click",f,!1),smMembers.sessionTTL=1e3*a.hftRefresh,smoperational.hftResponseType=a.responseType,smoperational.waterfallStr=a.waterfallId,smoperational.impressionPixel=a.impressionPixel,smoperational.clickPixel=a.clickPixel,smoperational.completePixel=a.completePixel,smoperational.loop=a.loopNumber,smoperational.width=a.width,smoperational.height=a.height,clearInterval(smcounters.hftRefreshInterval),"STATIC"!==a.responseType&&(smcounters.hftRefreshInterval=setInterval(function(){getHftResponseFromServer("")},smMembers.sessionTTL)),smMainResponse=a;var g=(new Date).getTime(),h="";h=a.playerRecord.url?a.playerRecord.url+"?cb="+g:"https://cloud.selectmedia.asia/Code/player/sr_api_min.js?cb="+g,smCallURL(h)}function parseHftResponseEvent(a){var b="";try{b=a.responseStatus,printLogs("Got HFT event from server. Start parsing HFT response. Status="+b),buildHftResObject(a),printLogs("Finished parse server HFT response. Status="+b)}catch(a){printErrors("Exception while parsing server HFT response. loading defaults. "+a),SMreportEvent("LOGIC_ERROR","Failed to parse erver HFT response. err="+a)}printLogs("Start init SR player immediately after getting response from server")}var smMainClientVersion="5.0.0.9",sminternalconfig={logs:!1,maxParamSize:200,maxUrlSize:2e3,domain:"selectmedia.asia"},smEventsDictionary={PRE_INIT:100,CDN_CHECK:10,LOAD:100,UI:10,LOGIC_ERROR:100,PLAYER_CLICK:100,SETUP_ERROR:100,HFT:10,TIMER:10,PLAYER_ERROR:100,AD_REQUEST:10,AD_PLAY:10,AD_ERROR:10,IMPRESSION:100,AD_VERIFY:100,COMPLETE:100,AD_CLICK:100},smMacrosList={},smMainScript="",smPlayer=null,smMainResponse="",smoperational={validSession:!0,sessionBreakReason:"",clientVersion:smMainClientVersion,ssl:0,responseType:"",loopnumber:0,loop:0,lastEvent:"",startTime:(new Date).getTime(),adTagId:null,tagPriority:0,waterfallStr:"",hftResponseType:"",eventUrl:"",hftUrl:"",sessionId:"",visibilityState:"unknown",impressionPixel:"",clickPixel:"",completePixel:"",click:"",isUserInteraction:!1,servingScenario:"",width:"",height:"",playerVersion:""},smcounters={breakIndex:0,lastTag:"",lastEventTS:(new Date).getTime(),eventsSentLog:"",serveFlash:1,latencyLimit:12e4,listsize:0,sentImpDiscrepancy:0,sentSetupError:0,hftNumber:0,counterErrors:0,counterWarnings:0,counterLogs:0,windowError:0,windowErrorMessage:"",smLogicErrorsCollection:"",hftRefreshInterval:0},smStringParams="",smMembers={screen:"",docReferrer:"",topLocation:"",sessionTTL:3e5},smTagsObjects={};!function(){var a=console.error;console.error=function(){smcounters.counterErrors++,a.apply(this,Array.prototype.slice.call(arguments))}}(),function(){var a=console.warn;console.warn=function(){smcounters.counterWarnings++,a.apply(this,Array.prototype.slice.call(arguments))}}(),function(){var a=console.log;console.log=function(){smcounters.counterLogs++,a.apply(this,Array.prototype.slice.call(arguments))}}(),window.onerror=function(a,b,c,d,e){smcounters.windowError++,a&&(smcounters.windowErrorMessage=smcounters.windowErrorMessage+" m:"+a),b&&(smcounters.windowErrorMessage=smcounters.windowErrorMessage+" url:"+b.split("?")[0]),e&&(smcounters.windowErrorMessage=smcounters.windowErrorMessage+" error:"+e)};try{initMembers(),SMreportEvent("PRE_INIT",""),getHftResponseFromServer(""),printLogs("*** Finished SelectMedia main script ***")}catch(a){printErrors("Error while executing SelectMedia main script. "+a)}