!(function(k,x,l){var c={url:k.location.href,cs_uuid:"8bc9be37-df15-4459-9cc8-bf317a4f3620",channel_id:"9909d3b7-4932-487b-b65d-565581f37483",url_clean:"http://nzherald.co.nz/article.cfm?objectid=11852196",device_type:"desktop",traffic_source:"",whitelisted:"False",uuid_c_key:"__nfmp",message_rate:"5000"};function v(){for(var u=1;u<arguments.length;u++){for(var d in arguments[u]){if(arguments[u].hasOwnProperty(d)){arguments[0][d]=arguments[u][d]}}}return arguments[0]}function b(w,F){try{var u,C=0,D=w.length,d=D===undefined||typeof w==="function";if(d){for(u in w){if(F.call(w[u],u,w[u])===false){break}}}else{for(;C<D;){if(F.call(w[C],C,w[C++])===false){break}}}}catch(E){}return w}var B=function(u,C,w,d){if(w.addEventListener){w.addEventListener(u,function(D){C&&v(D,{data:C,element:w});d(D)},false)}else{if(w.attachEvent){w.attachEvent("on"+u,function(D){C&&v(D,{data:C,element:w});d(D)})}}};function o(u,E,d,D,w,C){x.cookie=u+"="+escape(E)+((d)?(";expires="+d):"")+((D)?";path="+D:"")+((w)?";domain="+w:"")+((C&&(C==true))?"; secure":"")}function j(){var G="body",F="scrollHeight",I="offsetHeight",d="clientHeight",H="documentElement";var J="getElementsByTagName",u=x[J]("html")[0],w=x[J]("body")[0],C=u.style.height,D=w.style.height;u.style.height="auto";w.style.height="auto";var E=Math.max(x[G][F]||0,x[H][F]||0,x[G][I]||0,x[H][I]||0,x[G][d]||0,x[H][d]||0);u.style.height=C;w.style.height=D;return E}function r(){var d="clientHeight",u="documentElement";return Math.max(x[u][d],k.innerHeight||0)}var z=function(){this.dct={};this.k=new Array()};z.prototype.put=function f(u,w){this.dct[u]=w;var d=this.k.indexOf(u);if(d==-1){this.k.push(u)}return this};z.prototype.get=function y(d){return this.dct[d]};z.prototype.remove=function A(u){var d=this.k.indexOf(u);if(d!=-1){this.k.splice(d,1);delete this.dct[u]}return this};z.prototype.clear=function q(){this.dct={};this.k=new Array()};z.prototype.size=function p(){return this.k.length};z.prototype.query=function(){var u=[];for(var d in this.dct){if(this.dct.hasOwnProperty(d)){u.push(encodeURIComponent(d)+"="+encodeURIComponent(this.dct[d]))}}return u.join("&")};z.prototype.send=function(w,C){var d=new Image(1,1);d.src=w+"?"+this.query();if(typeof C=="function"){if(d.complete){C()}else{var u=false;d.addEventListener("load",function(){if(u!=true){C()}u=true});setTimeout(function(){if(u!=true){C();u=true}},4000)}}};var g=function(){this.dct={};this.k=new Array()};g.prototype.put=function f(u,w){this.dct[u]=w;var d=this.k.indexOf(u);if(d==-1){this.k.push(u)}return this};g.prototype.get=function y(d){return this.dct[d]};g.prototype.remove=function A(u){var d=this.k.indexOf(u);if(d!=-1){this.k.splice(d,1);delete this.dct[u]}return this};g.prototype.clear=function q(){this.dct={};this.k=new Array()};g.prototype.size=function p(){return this.k.length};g.prototype.query=function(){var u=[];for(var d in this.dct){if(this.dct.hasOwnProperty(d)){u.push(encodeURIComponent(d)+"="+encodeURIComponent(this.dct[d]))}}return u.join("&")};g.prototype.send=function(u,C,w){var d=x.createElement("script");d.src=u+"?"+this.query();d.onload=function(){if(typeof C=="function"){C()}if(typeof w!="undefined"){d.parentNode.removeChild(d)}};x.getElementsByTagName("head")[0].appendChild(d)};var s=function(){this.timer=0;this.iInstance=undefined;this.start();this.is_paused=false};s.prototype.start=function(){this.is_paused=false;if(typeof this.iInstance=="undefined"){var d=this;this.iInstance=k.setInterval(function(){d.timer+=1},1000)}};s.prototype.stop=function(){if(typeof this.iInstance!="undefined"){this.is_paused=true;clearInterval(this.iInstance);this.iInstance=undefined}};s.prototype.reset=function(){this.timer=0};s.prototype.get=function(){return this.timer};s.prototype.paused=function(){return this.is_paused};var i=function(){return{rimg:function(){return{trigger:function(u){var d=new z();d.put("rand",new Date().getTime());b(u,function(C,w){d.put(C,w)});d.put("url",c.url_clean);d.put("device_type",c.device_type);d.put("traffic_source",c.traffic_source);d.put("whitelisted",c.whitelisted);d.put("_fp",c.cs_uuid);d.put("channel",c.channel_id);d.send("//fallsm.ndg.io/collect/px.gif",undefined)}}}}}();var h=new function(){var d=this;this.event=new function(){return{scroll:function(u){if(typeof ndg_tracker_info!="undefined"&&ndg_tracker_info.fb_integration==true){d.network.facebook.scroll_50(u)}},timespent:function(u){if(typeof ndg_tracker_info!="undefined"&&ndg_tracker_info.fb_integration==true){d.network.facebook.attention_6(u)}}}}();this.network=new function(){this.attention_fired=false;this.scroll_fired=false;var u=this;return{facebook:{scroll_50:function(w){if((w+(r()/2))>(j()/2)&&u.scroll_fired===false){u.scroll_fired=true;typeof fbq=="function"&&fbq("trackCustom","scrollPercent",{scrollPercent:"50"})}},attention_6:function(w){if(w>=36&&u.attention_fired===false){u.attention_fired=true;typeof fbq=="function"&&fbq("trackCustom","Attention",{Attention:"0.6"})}}}}}()}();var t=new function(){this.Utils=function(){return{Tld:function(){var C=location.host,E=C.split("."),D=E.length;if(E[0]!="www"){return C}return E.slice(1).join(".")},getDate:function(C){var D=new Date();D.setMinutes(D.getMinutes()+C);return D},repeat:function(D,F){var E="";for(var C=0;C<F;C++){E+=D}return E}}}();var w="FallsmGlobalObj",d=this;this.gfaParam=function(E){var C=k[w],F="",D;if(C&&typeof k[C]=="function"){if(D=k[C].q){b(D,function(H,G){if(G[0]&&typeof G[0]=="string"&&G[0]==E){F=G[1];return false}})}}return F};function u(){d.loadinterval=k.setInterval(function(){if(x.readyState=="complete"){clearTimeout(d.loadinterval);d.loaded()}},100)}this.loaded=function(D){if(typeof this.readylist=="undefined"){this.readylist=[]}if(typeof D!="undefined"){if(x.readyState=="complete"){D()}else{this.readylist.push(D)}}else{for(var C=0;C<d.readylist.length;C++){d.readylist[C]()}}};u()}(),a={startSession:function(d){v(this.globals,d);this.start=new Date()},get_scroll_height_adjuster:function(u){if(typeof k.ndg_tracker_info!="undefined"&&typeof k.ndg_tracker_info.infinite_scroll!="undefined"){var d=k.ndg_tracker_info.doc_heights;for(var w in d){if(u>=d[w][0]&&u<=d[w][1]){return d[w][0]-1}}}return 0},scroll:function(d){var w=this.get_scroll_height_adjuster(d);d-=w;h.event.scroll(d);this.globals.last_scroll_pos=d;d=(d+r())/(j()-w);if(this.data.max_scroll<d){var u=this.data.max_scroll;this.data.max_scroll=d;this.data.esf=d-u}},share:function(d){var u=(new Date())-this.start;if(this.globals.share_types.indexOf(d)===-1){this.data.tus+=1;this.globals.share_types.push(d)}this.data.share.push({network:d,time_offset:u})},timespent:{check_unfilled:function(){var C=function(H,G){var D=[];for(var F in H){D.push(F)}for(var E=D.length-1;E>=0;E--){G.call(H,D[E])}};var d=v({},a.data.time_taken);var w=0,u=0;C(d,function(D){if(parseInt(D)<parseInt(w)&&a.data.time_taken[D]==0){a.data.time_taken[D]=u;a.globals.timespent_changed=true}if(a.data.time_taken[D]!=0){w=D;u=a.data.time_taken[D]}})},check:function(){h.event.timespent(a.data.heartbeat);var d=a.globals.last_scroll_pos,u=a.globals.doc_height/20,w=d+a.globals.viewport_height;b(a.data.time_taken,function(E,D){var F=((E/5)-1)*u,C=(E/5)*u;if(F>d-(u/1.5)&&C<w+(u/1.5)){if(a.data.time_taken[E]==0){a.data.time_taken[E]=a.data.heartbeat;a.globals.timespent_changed=true}}});this.check_unfilled()}},collectStatic:function(){return{hbv:c.message_rate/1000}},globals:{last_scroll_pos:0,timespent_changed:false,adblock_send:false,share_types:[]},data:{heartbeat:0,share:[],max_scroll:0,tus:0,esf:0,time_taken:{5:0,10:0,15:0,20:0,25:0,30:0,35:0,40:0,45:0,50:0,55:0,60:0,65:0,70:0,75:0,80:0,85:0,90:0,95:0,100:0}},clean:function(){this.data.share=[];this.data.esf=0;this.data.tus=0;this.globals.share_types=[];this.globals.timespent_changed=false}},n=function(){return{old_target:undefined,scroll_pos:-1,timer:undefined,idleTimer:undefined,registerMouseMove:function(d){this.notifyActive()},registerClick:function(d){this.notifyActive()},registerBlur:function(){this.notifyInactive()},registerFocus:function(){this.notifyActive()},notifyActive:function(){this.timer.start();this.idleTimer.reset()},notifyInactive:function(){this.timer.stop()},getScrollPosition:function(){var d=this,u=x.body.scrollTop;if(u==0){if(k.pageYOffset){u=k.pageYOffset}else{u=(x.body.parentElement)?x.body.parentElement.scrollTop:0}}if(d.scroll_pos!=u){d.scroll_pos=u;a.scroll(d.scroll_pos);this.notifyActive()}}}},e=function(){return{}}(),m=(function(){var D="mousemove",u="mouseup",w="blur",d="focus";var C=new n();return{transport:{notifyShare:function(E){a.share(E)}},getCollectData:function(){var G={};if(typeof k.FaAdblock!="undefined"&&a.globals.adblock_send==false){var F=FaAdblock.checkAdBlocked();G={adblock:F};a.globals.adblock_send=true}var E=v({},G,a.data);if(a.globals.timespent_changed==false){delete E.time_taken}return E},init_session_timer:function(){a.startSession({doc_height:j(),viewport_height:r()});B(w,{},k,function(F){C.registerBlur(F)});B(d,{},k,function(F){C.registerFocus(F)});C.timer=new s();C.idleTimer=new s();var E=this;this.Intvl_heartbeat=setInterval(function(){if(!C.timer.paused()){a.data.heartbeat=C.timer.get();a.timespent.check()}window.nca_timer=C.timer.get();if(C.idleTimer.get()>=20){C.notifyInactive()}if(!C.timer.paused()){var F=E.getCollectData();v(F,a.collectStatic());E.engine.trigger({data:JSON.stringify(F)});a.clean()}},c.message_rate)},init_mouse_events:function(){B(D,{},k,function(E){C.registerMouseMove(E)});B(u,{},k,function(E){C.registerClick(E)});setInterval(function(){C.getScrollPosition()},300)},fix_inifinity_scroll_heights:function(){if(typeof k.ndg_tracker_info!="undefined"&&k.ndg_tracker_info.infinite_scroll==1){var E=j();var F=k.ndg_tracker_info.old_doc_height?k.ndg_tracker_info.old_doc_height:0;if(F==0){k.ndg_tracker_info.doc_heights=[];k.ndg_tracker_info.doc_heights.push([0,E]);k.ndg_tracker_info.old_doc_height=E}else{if(F<E){k.ndg_tracker_info.doc_heights.push([F+1,E]);k.ndg_tracker_info.old_doc_height=E}}}},init:function(){var E=this;this.engine=i.rimg();o(c.uuid_c_key,c.cs_uuid,t.Utils.getDate(60*24*365*2).toGMTString(),"/",t.Utils.Tld());this.fix_inifinity_scroll_heights();E.init_session_timer();this.init_mouse_events();var F=new g();F.send("//cdn.ndg.io/shared/ab.js");var F=new g();F.send("//cdn.ndg.io/shared/shares.js")}}})();k.fm_channel=m;m.init()})(window,document);